jQuery.extend({
    browser: function () {
        var
            rwebkit = /(webkit)\/([\w.]+)/,
            ropera = /(opera)(?:.*version)?[ \/]([\w.]+)/,
            rmsie = /(msie) ([\w.]+)/,
            rmozilla = /(mozilla)(?:.*? rv:([\w.]+))?/,
            browser = {},
            ua = window.navigator.userAgent,
            browserMatch = uaMatch(ua);

        if (browserMatch.browser) {
            browser[browserMatch.browser] = true;
            browser.version = browserMatch.version;
        }
        return { browser: browser };
    },
});

function uaMatch(ua) {
    ua = ua.toLowerCase();

    var match = rwebkit.exec(ua)
        || ropera.exec(ua)
        || rmsie.exec(ua)
        || ua.indexOf("compatible") < 0 && rmozilla.exec(ua)
        || [];

    return {
        browser: match[1] || "",
        version: match[2] || "0"
    };
}
/**
 * 整理：胡尐睿丶
 * 联系：hooray@hoorayos.com
 */

/**
 * ie6 png透明修正
 * DD_belatedPNG.fix('.png_bg');
 * DD_belatedPNG.fixPng( someNode );
 * http://www.dillerdesign.com/experiment/DD_belatedPNG/
 */
if ($.browser.msie && ($.browser.version == "6.0") && !$.support.style) {
	var DD_belatedPNG = {
		ns: "DD_belatedPNG",
		imgSize: {},
		delay: 10,
		nodesFixed: 0,
		createVmlNameSpace: function () {
			if (document.namespaces && !document.namespaces[this.ns]) {
				document.namespaces.add(this.ns, "urn:schemas-microsoft-com:vml");
			}
		},
		createVmlStyleSheet: function () {
			var b, a;
			b = document.createElement("style");
			b.setAttribute("media", "screen");
			document.documentElement.firstChild.insertBefore(b, document.documentElement.firstChild.firstChild);
			if (b.styleSheet) {
				b = b.styleSheet;
				b.addRule(this.ns + "\\:*", "{behavior:url(#default#VML)}");
				b.addRule(this.ns + "\\:shape", "position:absolute;");
				b.addRule("img." + this.ns + "_sizeFinder", "behavior:none; border:none; position:absolute; z-index:-1; top:-10000px; visibility:hidden;");
				this.screenStyleSheet = b;
				a = document.createElement("style");
				a.setAttribute("media", "print");
				document.documentElement.firstChild.insertBefore(a, document.documentElement.firstChild.firstChild);
				a = a.styleSheet;
				a.addRule(this.ns + "\\:*", "{display: none !important;}");
				a.addRule("img." + this.ns + "_sizeFinder", "{display: none !important;}");
			}
		},
		readPropertyChange: function () {
			var b, c, a;
			b = event.srcElement;
			if (!b.vmlInitiated) {
				return;
			}
			if (event.propertyName.search("background") != -1 || event.propertyName.search("border") != -1) {
				DD_belatedPNG.applyVML(b);
			}
			if (event.propertyName == "style.display") {
				c = (b.currentStyle.display == "none") ? "none" : "block";
				for (a in b.vml) {
					if (b.vml.hasOwnProperty(a)) {
						b.vml[a].shape.style.display = c;
					}
				}
			}
			if (event.propertyName.search("filter") != -1) {
				DD_belatedPNG.vmlOpacity(b);
			}
		},
		vmlOpacity: function (b) {
			if (b.currentStyle.filter.search("lpha") != -1) {
				var a = b.currentStyle.filter;
				a = parseInt(a.substring(a.lastIndexOf("=") + 1, a.lastIndexOf(")")), 10) / 100;
				b.vml.color.shape.style.filter = b.currentStyle.filter;
				b.vml.image.fill.opacity = a;
			}
		},
		handlePseudoHover: function (a) {
			setTimeout(function () {
				DD_belatedPNG.applyVML(a);
			},
				1);
		},
		fix: function (a) {
			if (this.screenStyleSheet) {
				var c, b;
				c = a.split(",");
				for (b = 0; b < c.length; b++) {
					this.screenStyleSheet.addRule(c[b], "behavior:expression(DD_belatedPNG.fixPng(this))");
				}
			}
		},
		applyVML: function (a) {
			a.runtimeStyle.cssText = "";
			this.vmlFill(a);
			this.vmlOffsets(a);
			this.vmlOpacity(a);
			if (a.isImg) {
				this.copyImageBorders(a);
			}
		},
		attachHandlers: function (i) {
			var d, c, g, e, b, f;
			d = this;
			c = {
				resize: "vmlOffsets",
				move: "vmlOffsets"
			};
			if (i.nodeName == "A") {
				e = {
					mouseleave: "handlePseudoHover",
					mouseenter: "handlePseudoHover",
					focus: "handlePseudoHover",
					blur: "handlePseudoHover"
				};
				for (b in e) {
					if (e.hasOwnProperty(b)) {
						c[b] = e[b];
					}
				}
			}
			for (f in c) {
				if (c.hasOwnProperty(f)) {
					g = function () {
						d[c[f]](i);
					};
					i.attachEvent("on" + f, g);
				}
			}
			i.attachEvent("onpropertychange", this.readPropertyChange);
		},
		giveLayout: function (a) {
			a.style.zoom = 1;
			if (a.currentStyle.position == "static") {
				a.style.position = "relative";
			}
		},
		copyImageBorders: function (b) {
			var c, a;
			c = {
				borderStyle: true,
				borderWidth: true,
				borderColor: true
			};
			for (a in c) {
				if (c.hasOwnProperty(a)) {
					b.vml.color.shape.style[a] = b.currentStyle[a];
				}
			}
		},
		vmlFill: function (e) {
			if (!e.currentStyle) {
				return;
			} else {
				var d, f, g, b, a, c;
				d = e.currentStyle;
			}
			for (b in e.vml) {
				if (e.vml.hasOwnProperty(b)) {
					e.vml[b].shape.style.zIndex = d.zIndex;
				}
			}
			e.runtimeStyle.backgroundColor = "";
			e.runtimeStyle.backgroundImage = "";
			f = true;
			if (d.backgroundImage != "none" || e.isImg) {
				if (!e.isImg) {
					e.vmlBg = d.backgroundImage;
					e.vmlBg = e.vmlBg.substr(5, e.vmlBg.lastIndexOf('")') - 5);
				} else {
					e.vmlBg = e.src;
				}
				g = this;
				if (!g.imgSize[e.vmlBg]) {
					a = document.createElement("img");
					g.imgSize[e.vmlBg] = a;
					a.className = g.ns + "_sizeFinder";
					a.runtimeStyle.cssText = "behavior:none; position:absolute; left:-10000px; top:-10000px; border:none; margin:0; padding:0;";
					c = function () {
						this.width = this.offsetWidth;
						this.height = this.offsetHeight;
						g.vmlOffsets(e);
					};
					a.attachEvent("onload", c);
					a.src = e.vmlBg;
					a.removeAttribute("width");
					a.removeAttribute("height");
					document.body.insertBefore(a, document.body.firstChild);
				}
				e.vml.image.fill.src = e.vmlBg;
				f = false;
			}
			e.vml.image.fill.on = !f;
			e.vml.image.fill.color = "none";
			e.vml.color.shape.style.backgroundColor = d.backgroundColor;
			e.runtimeStyle.backgroundImage = "none";
			e.runtimeStyle.backgroundColor = "transparent";
		},
		vmlOffsets: function (d) {
			var h, n, a, e, g, m, f, l, j, i, k;
			h = d.currentStyle;
			n = {
				W: d.clientWidth + 1,
				H: d.clientHeight + 1,
				w: this.imgSize[d.vmlBg].width,
				h: this.imgSize[d.vmlBg].height,
				L: d.offsetLeft,
				T: d.offsetTop,
				bLW: d.clientLeft,
				bTW: d.clientTop
			};
			a = (n.L + n.bLW == 1) ? 1 : 0;
			e = function (b, p, q, c, s, u) {
				b.coordsize = c + "," + s;
				b.coordorigin = u + "," + u;
				b.path = "m0,0l" + c + ",0l" + c + "," + s + "l0," + s + " xe";
				b.style.width = c + "px";
				b.style.height = s + "px";
				b.style.left = p + "px";
				b.style.top = q + "px";
			};
			e(d.vml.color.shape, (n.L + (d.isImg ? 0 : n.bLW)), (n.T + (d.isImg ? 0 : n.bTW)), (n.W - 1), (n.H - 1), 0);
			e(d.vml.image.shape, (n.L + n.bLW), (n.T + n.bTW), (n.W), (n.H), 1);
			g = {
				X: 0,
				Y: 0
			};
			if (d.isImg) {
				g.X = parseInt(h.paddingLeft, 10) + 1;
				g.Y = parseInt(h.paddingTop, 10) + 1;
			} else {
				for (j in g) {
					if (g.hasOwnProperty(j)) {
						this.figurePercentage(g, n, j, h["backgroundPosition" + j]);
					}
				}
			}
			d.vml.image.fill.position = (g.X / n.W) + "," + (g.Y / n.H);
			m = h.backgroundRepeat;
			f = {
				T: 1,
				R: n.W + a,
				B: n.H,
				L: 1 + a
			};
			l = {
				X: {
					b1: "L",
					b2: "R",
					d: "W"
				},
				Y: {
					b1: "T",
					b2: "B",
					d: "H"
				}
			};
			if (m != "repeat" || d.isImg) {
				i = {
					T: (g.Y),
					R: (g.X + n.w),
					B: (g.Y + n.h),
					L: (g.X)
				};
				if (m.search("repeat-") != -1) {
					k = m.split("repeat-")[1].toUpperCase();
					i[l[k].b1] = 1;
					i[l[k].b2] = n[l[k].d];
				}
				if (i.B > n.H) {
					i.B = n.H;
				}
				d.vml.image.shape.style.clip = "rect(" + i.T + "px " + (i.R + a) + "px " + i.B + "px " + (i.L + a) + "px)";
			} else {
				d.vml.image.shape.style.clip = "rect(" + f.T + "px " + f.R + "px " + f.B + "px " + f.L + "px)";
			}
		},
		figurePercentage: function (d, c, f, a) {
			var b, e;
			e = true;
			b = (f == "X");
			switch (a) {
				case "left":
				case "top":
					d[f] = 0;
					break;
				case "center":
					d[f] = 0.5;
					break;
				case "right":
				case "bottom":
					d[f] = 1;
					break;
				default:
					if (a.search("%") != -1) {
						d[f] = parseInt(a, 10) / 100;
					} else {
						e = false;
					}
			}
			d[f] = Math.ceil(e ? ((c[b ? "W" : "H"] * d[f]) - (c[b ? "w" : "h"] * d[f])) : parseInt(a, 10));
			if (d[f] % 2 === 0) {
				d[f]++;
			}
			return d[f];
		},
		fixPng: function (c) {
			c.style.behavior = "none";
			var g, b, f, a, d;
			if (c.nodeName == "BODY" || c.nodeName == "TD" || c.nodeName == "TR") {
				return;
			}
			c.isImg = false;
			if (c.nodeName == "IMG") {
				if (c.src.toLowerCase().search(/\.png$/) != -1) {
					c.isImg = true;
					c.style.visibility = "hidden";
				} else {
					return;
				}
			} else {
				if (c.currentStyle.backgroundImage.toLowerCase().search(".png") == -1) {
					return;
				}
			}
			g = DD_belatedPNG;
			c.vml = {
				color: {},
				image: {}
			};
			b = {
				shape: {},
				fill: {}
			};
			for (a in c.vml) {
				if (c.vml.hasOwnProperty(a)) {
					for (d in b) {
						if (b.hasOwnProperty(d)) {
							f = g.ns + ":" + d;
							c.vml[a][d] = document.createElement(f);
						}
					}
					c.vml[a].shape.stroked = false;
					c.vml[a].shape.appendChild(c.vml[a].fill);
					c.parentNode.insertBefore(c.vml[a].shape, c);
				}
			}
			c.vml.image.shape.fillcolor = "none";
			c.vml.image.fill.type = "tile";
			c.vml.color.fill.on = false;
			g.attachHandlers(c);
			g.giveLayout(c);
			g.giveLayout(c.offsetParent);
			c.vmlInitiated = true;
			g.applyVML(c);
		}
	};
	try {
		document.execCommand("BackgroundImageCache", false, true);
	} catch (r) { }
	DD_belatedPNG.createVmlNameSpace();
	DD_belatedPNG.createVmlStyleSheet();
}

/**
 * SWFObject v2.2
 * http://code.google.com/p/swfobject/
 * swfobject.embedSWF("test.swf", "myContent", "300", "120", "9.0.0", "expressInstall.swf");
 */
var swfobject = function () {
	var D = "undefined",
		r = "object",
		S = "Shockwave Flash",
		W = "ShockwaveFlash.ShockwaveFlash",
		q = "application/x-shockwave-flash",
		R = "SWFObjectExprInst",
		x = "onreadystatechange",
		O = window,
		j = document,
		t = navigator,
		T = false,
		U = [h],
		o = [],
		N = [],
		I = [],
		l,
		Q,
		E,
		B,
		J = false,
		a = false,
		n,
		G,
		m = true,
		M = function () {
			var aa = typeof j.getElementById != D && typeof j.getElementsByTagName != D && typeof j.createElement != D,
				ah = t.userAgent.toLowerCase(),
				Y = t.platform.toLowerCase(),
				ae = Y ? /win/.test(Y) : /win/.test(ah),
				ac = Y ? /mac/.test(Y) : /mac/.test(ah),
				af = /webkit/.test(ah) ? parseFloat(ah.replace(/^.*webkit\/(\d+(\.\d+)?).*$/, "$1")) : false,
				X = !+"\v1",
				ag = [0, 0, 0],
				ab = null;
			if (typeof t.plugins != D && typeof t.plugins[S] == r) {
				ab = t.plugins[S].description;
				if (ab && !(typeof t.mimeTypes != D && t.mimeTypes[q] && !t.mimeTypes[q].enabledPlugin)) {
					T = true;
					X = false;
					ab = ab.replace(/^.*\s+(\S+\s+\S+$)/, "$1");
					ag[0] = parseInt(ab.replace(/^(.*)\..*$/, "$1"), 10);
					ag[1] = parseInt(ab.replace(/^.*\.(.*)\s.*$/, "$1"), 10);
					ag[2] = /[a-zA-Z]/.test(ab) ? parseInt(ab.replace(/^.*[a-zA-Z]+(.*)$/, "$1"), 10) : 0;
				}
			} else {
				if (typeof O.ActiveXObject != D) {
					try {
						var ad = new ActiveXObject(W);
						if (ad) {
							ab = ad.GetVariable("$version");
							if (ab) {
								X = true;
								ab = ab.split(" ")[1].split(",");
								ag = [parseInt(ab[0], 10), parseInt(ab[1], 10), parseInt(ab[2], 10)];
							}
						}
					} catch (Z) { }
				}
			}
			return {
				w3: aa,
				pv: ag,
				wk: af,
				ie: X,
				win: ae,
				mac: ac
			};
		}(),
		k = function () {
			if (!M.w3) {
				return;
			}
			if ((typeof j.readyState != D && j.readyState == "complete") || (typeof j.readyState == D && (j.getElementsByTagName("body")[0] || j.body))) {
				f();
			}
			if (!J) {
				if (typeof j.addEventListener != D) {
					j.addEventListener("DOMContentLoaded", f, false);
				}
				if (M.ie && M.win) {
					j.attachEvent(x,
						function () {
							if (j.readyState == "complete") {
								j.detachEvent(x, arguments.callee);
								f();
							}
						});
					if (O == top) {
						(function () {
							if (J) {
								return;
							}
							try {
								j.documentElement.doScroll("left");
							} catch (X) {
								setTimeout(arguments.callee, 0);
								return;
							}
							f();
						})();
					}
				}
				if (M.wk) {
					(function () {
						if (J) {
							return;
						}
						if (!/loaded|complete/.test(j.readyState)) {
							setTimeout(arguments.callee, 0);
							return;
						}
						f();
					})();
				}
				s(f);
			}
		}();
	function f() {
		if (J) {
			return;
		}
		try {
			var Z = j.getElementsByTagName("body")[0].appendChild(C("span"));
			Z.parentNode.removeChild(Z);
		} catch (aa) {
			return;
		}
		J = true;
		var X = U.length;
		for (var Y = 0; Y < X; Y++) {
			U[Y]();
		}
	}
	function K(X) {
		if (J) {
			X();
		} else {
			U[U.length] = X;
		}
	}
	function s(Y) {
		if (typeof O.addEventListener != D) {
			O.addEventListener("load", Y, false);
		} else {
			if (typeof j.addEventListener != D) {
				j.addEventListener("load", Y, false);
			} else {
				if (typeof O.attachEvent != D) {
					i(O, "onload", Y);
				} else {
					if (typeof O.onload == "function") {
						var X = O.onload;
						O.onload = function () {
							X();
							Y();
						};
					} else {
						O.onload = Y;
					}
				}
			}
		}
	}
	function h() {
		if (T) {
			V();
		} else {
			H();
		}
	}
	function V() {
		var X = j.getElementsByTagName("body")[0];
		var aa = C(r);
		aa.setAttribute("type", q);
		var Z = X.appendChild(aa);
		if (Z) {
			var Y = 0; (function () {
				if (typeof Z.GetVariable != D) {
					var ab = Z.GetVariable("$version");
					if (ab) {
						ab = ab.split(" ")[1].split(",");
						M.pv = [parseInt(ab[0], 10), parseInt(ab[1], 10), parseInt(ab[2], 10)];
					}
				} else {
					if (Y < 10) {
						Y++;
						setTimeout(arguments.callee, 10);
						return;
					}
				}
				X.removeChild(aa);
				Z = null;
				H();
			})();
		} else {
			H();
		}
	}
	function H() {
		var ag = o.length;
		if (ag > 0) {
			for (var af = 0; af < ag; af++) {
				var Y = o[af].id;
				var ab = o[af].callbackFn;
				var aa = {
					success: false,
					id: Y
				};
				if (M.pv[0] > 0) {
					var ae = c(Y);
					if (ae) {
						if (F(o[af].swfVersion) && !(M.wk && M.wk < 312)) {
							w(Y, true);
							if (ab) {
								aa.success = true;
								aa.ref = z(Y);
								ab(aa);
							}
						} else {
							if (o[af].expressInstall && A()) {
								var ai = {};
								ai.data = o[af].expressInstall;
								ai.width = ae.getAttribute("width") || "0";
								ai.height = ae.getAttribute("height") || "0";
								if (ae.getAttribute("class")) {
									ai.styleclass = ae.getAttribute("class");
								}
								if (ae.getAttribute("align")) {
									ai.align = ae.getAttribute("align");
								}
								var ah = {};
								var X = ae.getElementsByTagName("param");
								var ac = X.length;
								for (var ad = 0; ad < ac; ad++) {
									if (X[ad].getAttribute("name").toLowerCase() != "movie") {
										ah[X[ad].getAttribute("name")] = X[ad].getAttribute("value");
									}
								}
								P(ai, ah, Y, ab);
							} else {
								p(ae);
								if (ab) {
									ab(aa);
								}
							}
						}
					}
				} else {
					w(Y, true);
					if (ab) {
						var Z = z(Y);
						if (Z && typeof Z.SetVariable != D) {
							aa.success = true;
							aa.ref = Z;
						}
						ab(aa);
					}
				}
			}
		}
	}
	function z(aa) {
		var X = null;
		var Y = c(aa);
		if (Y && Y.nodeName == "OBJECT") {
			if (typeof Y.SetVariable != D) {
				X = Y;
			} else {
				var Z = Y.getElementsByTagName(r)[0];
				if (Z) {
					X = Z;
				}
			}
		}
		return X;
	}
	function A() {
		return !a && F("6.0.65") && (M.win || M.mac) && !(M.wk && M.wk < 312);
	}
	function P(aa, ab, X, Z) {
		a = true;
		E = Z || null;
		B = {
			success: false,
			id: X
		};
		var ae = c(X);
		if (ae) {
			if (ae.nodeName == "OBJECT") {
				l = g(ae);
				Q = null;
			} else {
				l = ae;
				Q = X;
			}
			aa.id = R;
			if (typeof aa.width == D || (!/%$/.test(aa.width) && parseInt(aa.width, 10) < 310)) {
				aa.width = "310";
			}
			if (typeof aa.height == D || (!/%$/.test(aa.height) && parseInt(aa.height, 10) < 137)) {
				aa.height = "137";
			}
			j.title = j.title.slice(0, 47) + " - Flash Player Installation";
			var ad = M.ie && M.win ? "ActiveX" : "PlugIn",
				ac = "MMredirectURL=" + O.location.toString().replace(/&/g, "%26") + "&MMplayerType=" + ad + "&MMdoctitle=" + j.title;
			if (typeof ab.flashvars != D) {
				ab.flashvars += "&" + ac;
			} else {
				ab.flashvars = ac;
			}
			if (M.ie && M.win && ae.readyState != 4) {
				var Y = C("div");
				X += "SWFObjectNew";
				Y.setAttribute("id", X);
				ae.parentNode.insertBefore(Y, ae);
				ae.style.display = "none"; (function () {
					if (ae.readyState == 4) {
						ae.parentNode.removeChild(ae);
					} else {
						setTimeout(arguments.callee, 10);
					}
				})();
			}
			u(aa, ab, X);
		}
	}
	function p(Y) {
		if (M.ie && M.win && Y.readyState != 4) {
			var X = C("div");
			Y.parentNode.insertBefore(X, Y);
			X.parentNode.replaceChild(g(Y), X);
			Y.style.display = "none"; (function () {
				if (Y.readyState == 4) {
					Y.parentNode.removeChild(Y);
				} else {
					setTimeout(arguments.callee, 10);
				}
			})();
		} else {
			Y.parentNode.replaceChild(g(Y), Y);
		}
	}
	function g(ab) {
		var aa = C("div");
		if (M.win && M.ie) {
			aa.innerHTML = ab.innerHTML;
		} else {
			var Y = ab.getElementsByTagName(r)[0];
			if (Y) {
				var ad = Y.childNodes;
				if (ad) {
					var X = ad.length;
					for (var Z = 0; Z < X; Z++) {
						if (!(ad[Z].nodeType == 1 && ad[Z].nodeName == "PARAM") && !(ad[Z].nodeType == 8)) {
							aa.appendChild(ad[Z].cloneNode(true));
						}
					}
				}
			}
		}
		return aa;
	}
	function u(ai, ag, Y) {
		var X, aa = c(Y);
		if (M.wk && M.wk < 312) {
			return X;
		}
		if (aa) {
			if (typeof ai.id == D) {
				ai.id = Y;
			}
			if (M.ie && M.win) {
				var ah = "";
				for (var ae in ai) {
					if (ai[ae] != Object.prototype[ae]) {
						if (ae.toLowerCase() == "data") {
							ag.movie = ai[ae];
						} else {
							if (ae.toLowerCase() == "styleclass") {
								ah += ' class="' + ai[ae] + '"';
							} else {
								if (ae.toLowerCase() != "classid") {
									ah += " " + ae + '="' + ai[ae] + '"';
								}
							}
						}
					}
				}
				var af = "";
				for (var ad in ag) {
					if (ag[ad] != Object.prototype[ad]) {
						af += '<param name="' + ad + '" value="' + ag[ad] + '" />';
					}
				}
				aa.outerHTML = '<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"' + ah + ">" + af + "</object>";
				N[N.length] = ai.id;
				X = c(ai.id);
			} else {
				var Z = C(r);
				Z.setAttribute("type", q);
				for (var ac in ai) {
					if (ai[ac] != Object.prototype[ac]) {
						if (ac.toLowerCase() == "styleclass") {
							Z.setAttribute("class", ai[ac]);
						} else {
							if (ac.toLowerCase() != "classid") {
								Z.setAttribute(ac, ai[ac]);
							}
						}
					}
				}
				for (var ab in ag) {
					if (ag[ab] != Object.prototype[ab] && ab.toLowerCase() != "movie") {
						e(Z, ab, ag[ab]);
					}
				}
				aa.parentNode.replaceChild(Z, aa);
				X = Z;
			}
		}
		return X;
	}
	function e(Z, X, Y) {
		var aa = C("param");
		aa.setAttribute("name", X);
		aa.setAttribute("value", Y);
		Z.appendChild(aa);
	}
	function y(Y) {
		var X = c(Y);
		if (X && X.nodeName == "OBJECT") {
			if (M.ie && M.win) {
				X.style.display = "none"; (function () {
					if (X.readyState == 4) {
						b(Y);
					} else {
						setTimeout(arguments.callee, 10);
					}
				})();
			} else {
				X.parentNode.removeChild(X);
			}
		}
	}
	function b(Z) {
		var Y = c(Z);
		if (Y) {
			for (var X in Y) {
				if (typeof Y[X] == "function") {
					Y[X] = null;
				}
			}
			Y.parentNode.removeChild(Y);
		}
	}
	function c(Z) {
		var X = null;
		try {
			X = j.getElementById(Z);
		} catch (Y) { }
		return X;
	}
	function C(X) {
		return j.createElement(X);
	}
	function i(Z, X, Y) {
		Z.attachEvent(X, Y);
		I[I.length] = [Z, X, Y];
	}
	function F(Z) {
		var Y = M.pv,
			X = Z.split(".");
		X[0] = parseInt(X[0], 10);
		X[1] = parseInt(X[1], 10) || 0;
		X[2] = parseInt(X[2], 10) || 0;
		return (Y[0] > X[0] || (Y[0] == X[0] && Y[1] > X[1]) || (Y[0] == X[0] && Y[1] == X[1] && Y[2] >= X[2])) ? true : false;
	}
	function v(ac, Y, ad, ab) {
		if (M.ie && M.mac) {
			return;
		}
		var aa = j.getElementsByTagName("head")[0];
		if (!aa) {
			return;
		}
		var X = (ad && typeof ad == "string") ? ad : "screen";
		if (ab) {
			n = null;
			G = null;
		}
		if (!n || G != X) {
			var Z = C("style");
			Z.setAttribute("type", "text/css");
			Z.setAttribute("media", X);
			n = aa.appendChild(Z);
			if (M.ie && M.win && typeof j.styleSheets != D && j.styleSheets.length > 0) {
				n = j.styleSheets[j.styleSheets.length - 1];
			}
			G = X;
		}
		if (M.ie && M.win) {
			if (n && typeof n.addRule == r) {
				n.addRule(ac, Y);
			}
		} else {
			if (n && typeof j.createTextNode != D) {
				n.appendChild(j.createTextNode(ac + " {" + Y + "}"));
			}
		}
	}
	function w(Z, X) {
		if (!m) {
			return;
		}
		var Y = X ? "visible" : "hidden";
		if (J && c(Z)) {
			c(Z).style.visibility = Y;
		} else {
			v("#" + Z, "visibility:" + Y);
		}
	}
	function L(Y) {
		var Z = /[\\\"<>\.;]/;
		var X = Z.exec(Y) != null;
		return X && typeof encodeURIComponent != D ? encodeURIComponent(Y) : Y;
	}
	var d = function () {
		if (M.ie && M.win) {
			window.attachEvent("onunload",
				function () {
					var ac = I.length;
					for (var ab = 0; ab < ac; ab++) {
						I[ab][0].detachEvent(I[ab][1], I[ab][2]);
					}
					var Z = N.length;
					for (var aa = 0; aa < Z; aa++) {
						y(N[aa]);
					}
					for (var Y in M) {
						M[Y] = null;
					}
					M = null;
					for (var X in swfobject) {
						swfobject[X] = null;
					}
					swfobject = null;
				});
		}
	}();
	return {
		registerObject: function (ab, X, aa, Z) {
			if (M.w3 && ab && X) {
				var Y = {};
				Y.id = ab;
				Y.swfVersion = X;
				Y.expressInstall = aa;
				Y.callbackFn = Z;
				o[o.length] = Y;
				w(ab, false);
			} else {
				if (Z) {
					Z({
						success: false,
						id: ab
					});
				}
			}
		},
		getObjectById: function (X) {
			if (M.w3) {
				return z(X);
			}
		},
		embedSWF: function (ab, ah, ae, ag, Y, aa, Z, ad, af, ac) {
			var X = {
				success: false,
				id: ah
			};
			if (M.w3 && !(M.wk && M.wk < 312) && ab && ah && ae && ag && Y) {
				w(ah, false);
				K(function () {
					ae += "";
					ag += "";
					var aj = {};
					if (af && typeof af === r) {
						for (var al in af) {
							aj[al] = af[al];
						}
					}
					aj.data = ab;
					aj.width = ae;
					aj.height = ag;
					var am = {};
					if (ad && typeof ad === r) {
						for (var ak in ad) {
							am[ak] = ad[ak];
						}
					}
					if (Z && typeof Z === r) {
						for (var ai in Z) {
							if (typeof am.flashvars != D) {
								am.flashvars += "&" + ai + "=" + Z[ai];
							} else {
								am.flashvars = ai + "=" + Z[ai];
							}
						}
					}
					if (F(Y)) {
						var an = u(aj, am, ah);
						if (aj.id == ah) {
							w(ah, true);
						}
						X.success = true;
						X.ref = an;
					} else {
						if (aa && A()) {
							aj.data = aa;
							P(aj, am, ah, ac);
							return;
						} else {
							w(ah, true);
						}
					}
					if (ac) {
						ac(X);
					}
				});
			} else {
				if (ac) {
					ac(X);
				}
			}
		},
		switchOffAutoHideShow: function () {
			m = false;
		},
		ua: M,
		getFlashPlayerVersion: function () {
			return {
				major: M.pv[0],
				minor: M.pv[1],
				release: M.pv[2]
			};
		},
		hasFlashPlayerVersion: F,
		createSWF: function (Z, Y, X) {
			if (M.w3) {
				return u(Z, Y, X);
			} else {
				return undefined;
			}
		},
		showExpressInstall: function (Z, aa, X, Y) {
			if (M.w3 && A()) {
				P(Z, aa, X, Y);
			}
		},
		removeSWF: function (X) {
			if (M.w3) {
				y(X);
			}
		},
		createCSS: function (aa, Z, Y, X) {
			if (M.w3) {
				v(aa, Z, Y, X);
			}
		},
		addDomLoadEvent: K,
		addLoadEvent: s,
		getQueryParamValue: function (aa) {
			var Z = j.location.search || j.location.hash;
			if (Z) {
				if (/\?/.test(Z)) {
					Z = Z.split("?")[1];
				}
				if (aa == null) {
					return L(Z);
				}
				var Y = Z.split("&");
				for (var X = 0; X < Y.length; X++) {
					if (Y[X].substring(0, Y[X].indexOf("=")) == aa) {
						return L(Y[X].substring((Y[X].indexOf("=") + 1)));
					}
				}
			}
			return "";
		},
		expressInstallCallback: function () {
			if (a) {
				var X = c(R);
				if (X && l) {
					X.parentNode.replaceChild(l, X);
					if (Q) {
						w(Q, true);
						if (M.ie && M.win) {
							l.style.display = "block";
						}
					}
					if (E) {
						E(B);
					}
				}
				a = false;
			}
		}
	};
}();

/**
 * jQuery JSON plugin 2.4.0
 * https://code.google.com/p/jquery-json/
 */
(function ($) {
	var escape = /["\\\x00-\x1f\x7f-\x9f]/g,
		meta = {
			"\b": "\\b",
			"\t": "\\t",
			"\n": "\\n",
			"\f": "\\f",
			"\r": "\\r",
			'"': '\\"',
			"\\": "\\\\"
		},
		hasOwn = Object.prototype.hasOwnProperty;
	$.toJSON = typeof JSON === "object" && JSON.stringify ? JSON.stringify : function (o) {
		if (o === null) {
			return "null";
		}
		var pairs, k, name, val, type = $.type(o);
		if (type === "undefined") {
			return undefined;
		}
		if (type === "number" || type === "boolean") {
			return String(o);
		}
		if (type === "string") {
			return $.quoteString(o);
		}
		if (typeof o.toJSON === "function") {
			return $.toJSON(o.toJSON());
		}
		if (type === "date") {
			var month = o.getUTCMonth() + 1,
				day = o.getUTCDate(),
				year = o.getUTCFullYear(),
				hours = o.getUTCHours(),
				minutes = o.getUTCMinutes(),
				seconds = o.getUTCSeconds(),
				milli = o.getUTCMilliseconds();
			if (month < 10) {
				month = "0" + month;
			}
			if (day < 10) {
				day = "0" + day;
			}
			if (hours < 10) {
				hours = "0" + hours;
			}
			if (minutes < 10) {
				minutes = "0" + minutes;
			}
			if (seconds < 10) {
				seconds = "0" + seconds;
			}
			if (milli < 100) {
				milli = "0" + milli;
			}
			if (milli < 10) {
				milli = "0" + milli;
			}
			return '"' + year + "-" + month + "-" + day + "T" + hours + ":" + minutes + ":" + seconds + "." + milli + 'Z"';
		}
		pairs = [];
		if ($.isArray(o)) {
			for (k = 0; k < o.length; k++) {
				pairs.push($.toJSON(o[k]) || "null");
			}
			return "[" + pairs.join(",") + "]";
		}
		if (typeof o === "object") {
			for (k in o) {
				if (hasOwn.call(o, k)) {
					type = typeof k;
					if (type === "number") {
						name = '"' + k + '"';
					} else {
						if (type === "string") {
							name = $.quoteString(k);
						} else {
							continue;
						}
					}
					type = typeof o[k];
					if (type !== "function" && type !== "undefined") {
						val = $.toJSON(o[k]);
						pairs.push(name + ":" + val);
					}
				}
			}
			return "{" + pairs.join(",") + "}";
		}
	};
	$.evalJSON = typeof JSON === "object" && JSON.parse ? JSON.parse : function (str) {
		return eval("(" + str + ")");
	};
	$.secureEvalJSON = typeof JSON === "object" && JSON.parse ? JSON.parse : function (str) {
		var filtered = str.replace(/\\["\\\/bfnrtu]/g, "@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, "]").replace(/(?:^|:|,)(?:\s*\[)+/g, "");
		if (/^[\],:{}\s]*$/.test(filtered)) {
			return eval("(" + str + ")");
		}
		throw new SyntaxError("Error parsing JSON, source is not valid.");
	};
	$.quoteString = function (str) {
		if (str.match(escape)) {
			return '"' + str.replace(escape,
				function (a) {
					var c = meta[a];
					if (typeof c === "string") {
						return c;
					}
					c = a.charCodeAt();
					return "\\u00" + Math.floor(c / 16).toString(16) + (c % 16).toString(16);
				}) + '"';
		}
		return '"' + str + '"';
	};
}(jQuery));

/**
 * zClip :: jQuery ZeroClipboard v1.1.1
 * http://steamdev.com/zclip
 */
(function (a) {
	a.fn.zclip = function (c) {
		if (typeof c == "object" && !c.length) {
			var b = a.extend({
				path: "ZeroClipboard.swf",
				copy: null,
				beforeCopy: null,
				afterCopy: null,
				clickAfter: true,
				setHandCursor: true,
				setCSSEffects: true
			},
				c);
			return this.each(function () {
				var e = a(this);
				if (e.is(":visible") && (typeof b.copy == "string" || a.isFunction(b.copy))) {
					ZeroClipboard.setMoviePath(b.path);
					var d = new ZeroClipboard.Client();
					if (a.isFunction(b.copy)) {
						e.bind("zClip_copy", b.copy);
					}
					if (a.isFunction(b.beforeCopy)) {
						e.bind("zClip_beforeCopy", b.beforeCopy);
					}
					if (a.isFunction(b.afterCopy)) {
						e.bind("zClip_afterCopy", b.afterCopy);
					}
					d.setHandCursor(b.setHandCursor);
					d.setCSSEffects(b.setCSSEffects);
					d.addEventListener("mouseOver",
						function (f) {
							e.trigger("mouseenter");
						});
					d.addEventListener("mouseOut",
						function (f) {
							e.trigger("mouseleave");
						});
					d.addEventListener("mouseDown",
						function (f) {
							e.trigger("mousedown");
							if (!a.isFunction(b.copy)) {
								d.setText(b.copy);
							} else {
								d.setText(e.triggerHandler("zClip_copy"));
							}
							if (a.isFunction(b.beforeCopy)) {
								e.trigger("zClip_beforeCopy");
							}
						});
					d.addEventListener("complete",
						function (f, g) {
							if (a.isFunction(b.afterCopy)) {
								e.trigger("zClip_afterCopy");
							} else {
								if (g.length > 500) {
									g = g.substr(0, 500) + "...\n\n(" + (g.length - 500) + " characters not shown)";
								}
								e.removeClass("hover");
								alert("Copied text to clipboard:\n\n " + g);
							}
							if (b.clickAfter) {
								e.trigger("click");
							}
						});
					d.glue(e[0], e.parent()[0]);
					a(window).bind("load resize",
						function () {
							d.reposition();
						});
				}
			});
		} else {
			if (typeof c == "string") {
				return this.each(function () {
					var f = a(this);
					c = c.toLowerCase();
					var e = f.data("zclipId");
					var d = a("#" + e + ".zclip");
					if (c == "remove") {
						d.remove();
						f.removeClass("active hover");
					} else {
						if (c == "hide") {
							d.hide();
							f.removeClass("active hover");
						} else {
							if (c == "show") {
								d.show();
							}
						}
					}
				});
			}
		}
	};
})(jQuery);
var ZeroClipboard = {
	version: "1.0.7",
	clients: {},
	moviePath: "ZeroClipboard.swf",
	nextId: 1,
	$: function (a) {
		if (typeof (a) == "string") {
			a = document.getElementById(a);
		}
		if (!a.addClass) {
			a.hide = function () {
				this.style.display = "none";
			};
			a.show = function () {
				this.style.display = "";
			};
			a.addClass = function (b) {
				this.removeClass(b);
				this.className += " " + b;
			};
			a.removeClass = function (d) {
				var e = this.className.split(/\s+/);
				var b = -1;
				for (var c = 0; c < e.length; c++) {
					if (e[c] == d) {
						b = c;
						c = e.length;
					}
				}
				if (b > -1) {
					e.splice(b, 1);
					this.className = e.join(" ");
				}
				return this;
			};
			a.hasClass = function (b) {
				return !!this.className.match(new RegExp("\\s*" + b + "\\s*"));
			};
		}
		return a;
	},
	setMoviePath: function (a) {
		this.moviePath = a;
	},
	dispatch: function (d, b, c) {
		var a = this.clients[d];
		if (a) {
			a.receiveEvent(b, c);
		}
	},
	register: function (b, a) {
		this.clients[b] = a;
	},
	getDOMObjectPosition: function (c, a) {
		var b = {
			left: 0,
			top: 0,
			width: c.width ? c.width : c.offsetWidth,
			height: c.height ? c.height : c.offsetHeight
		};
		if (c && (c != a)) {
			b.left += c.offsetLeft;
			b.top += c.offsetTop;
		}
		return b;
	},
	Client: function (a) {
		this.handlers = {};
		this.id = ZeroClipboard.nextId++;
		this.movieId = "ZeroClipboardMovie_" + this.id;
		ZeroClipboard.register(this.id, this);
		if (a) {
			this.glue(a);
		}
	}
};
ZeroClipboard.Client.prototype = {
	id: 0,
	ready: false,
	movie: null,
	clipText: "",
	handCursorEnabled: true,
	cssEffects: true,
	handlers: null,
	glue: function (d, b, e) {
		this.domElement = ZeroClipboard.$(d);
		var f = 99;
		if (this.domElement.style.zIndex) {
			f = parseInt(this.domElement.style.zIndex, 10) + 1;
		}
		if (typeof (b) == "string") {
			b = ZeroClipboard.$(b);
		} else {
			if (typeof (b) == "undefined") {
				b = document.getElementsByTagName("body")[0];
			}
		}
		var c = ZeroClipboard.getDOMObjectPosition(this.domElement, b);
		this.div = document.createElement("div");
		this.div.className = "zclip";
		this.div.id = "zclip-" + this.movieId;
		$(this.domElement).data("zclipId", "zclip-" + this.movieId);
		var a = this.div.style;
		a.position = "absolute";
		a.left = "" + c.left + "px";
		a.top = "" + c.top + "px";
		a.width = "" + c.width + "px";
		a.height = "" + c.height + "px";
		a.zIndex = f;
		if (typeof (e) == "object") {
			for (addedStyle in e) {
				a[addedStyle] = e[addedStyle];
			}
		}
		b.appendChild(this.div);
		this.div.innerHTML = this.getHTML(c.width, c.height);
	},
	getHTML: function (d, a) {
		var c = "";
		var b = "id=" + this.id + "&width=" + d + "&height=" + a;
		if (navigator.userAgent.match(/MSIE/)) {
			var e = location.href.match(/^https/i) ? "https://" : "http://";
			c += '<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="' + e + 'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="' + d + '" height="' + a + '" id="' + this.movieId + '" align="middle"><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="' + ZeroClipboard.moviePath + '" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="' + b + '"/><param name="wmode" value="transparent"/></object>';
		} else {
			c += '<embed id="' + this.movieId + '" src="' + ZeroClipboard.moviePath + '" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="' + d + '" height="' + a + '" name="' + this.movieId + '" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="' + b + '" wmode="transparent" />';
		}
		return c;
	},
	hide: function () {
		if (this.div) {
			this.div.style.left = "-2000px";
		}
	},
	show: function () {
		this.reposition();
	},
	destroy: function () {
		if (this.domElement && this.div) {
			this.hide();
			this.div.innerHTML = "";
			var a = document.getElementsByTagName("body")[0];
			try {
				a.removeChild(this.div);
			} catch (b) { }
			this.domElement = null;
			this.div = null;
		}
	},
	reposition: function (c) {
		if (c) {
			this.domElement = ZeroClipboard.$(c);
			if (!this.domElement) {
				this.hide();
			}
		}
		if (this.domElement && this.div) {
			var b = ZeroClipboard.getDOMObjectPosition(this.domElement);
			var a = this.div.style;
			a.left = "" + b.left + "px";
			a.top = "" + b.top + "px";
		}
	},
	setText: function (a) {
		this.clipText = a;
		if (this.ready) {
			this.movie.setText(a);
		}
	},
	addEventListener: function (a, b) {
		a = a.toString().toLowerCase().replace(/^on/, "");
		if (!this.handlers[a]) {
			this.handlers[a] = [];
		}
		this.handlers[a].push(b);
	},
	setHandCursor: function (a) {
		this.handCursorEnabled = a;
		if (this.ready) {
			this.movie.setHandCursor(a);
		}
	},
	setCSSEffects: function (a) {
		this.cssEffects = !!a;
	},
	receiveEvent: function (d, f) {
		d = d.toString().toLowerCase().replace(/^on/, "");
		switch (d) {
			case "load":
				this.movie = document.getElementById(this.movieId);
				if (!this.movie) {
					var c = this;
					setTimeout(function () {
						c.receiveEvent("load", null);
					},
						1);
					return;
				}
				if (!this.ready && navigator.userAgent.match(/Firefox/) && navigator.userAgent.match(/Windows/)) {
					var c = this;
					setTimeout(function () {
						c.receiveEvent("load", null);
					},
						100);
					this.ready = true;
					return;
				}
				this.ready = true;
				try {
					this.movie.setText(this.clipText);
				} catch (h) { }
				try {
					this.movie.setHandCursor(this.handCursorEnabled);
				} catch (h) { }
				break;
			case "mouseover":
				if (this.domElement && this.cssEffects) {
					this.domElement.addClass("hover");
					if (this.recoverActive) {
						this.domElement.addClass("active");
					}
				}
				break;
			case "mouseout":
				if (this.domElement && this.cssEffects) {
					this.recoverActive = false;
					if (this.domElement.hasClass("active")) {
						this.domElement.removeClass("active");
						this.recoverActive = true;
					}
					this.domElement.removeClass("hover");
				}
				break;
			case "mousedown":
				if (this.domElement && this.cssEffects) {
					this.domElement.addClass("active");
				}
				break;
			case "mouseup":
				if (this.domElement && this.cssEffects) {
					this.domElement.removeClass("active");
					this.recoverActive = false;
				}
				break;
		}
		if (this.handlers[d]) {
			for (var b = 0,
				a = this.handlers[d].length; b < a; b++) {
				var g = this.handlers[d][b];
				if (typeof (g) == "function") {
					g(this, f);
				} else {
					if ((typeof (g) == "object") && (g.length == 2)) {
						g[0][g[1]](this, f);
					} else {
						if (typeof (g) == "string") {
							window[g](this, f);
						}
					}
				}
			}
		}
	}
};

/**
 * jQuery Easing v1.3 - http://gsgd.co.uk/sandbox/jquery/easing/
 * t: current time, b: begInnIng value, c: change In value, d: duration
 */
jQuery.easing["jswing"] = jQuery.easing["swing"];
jQuery.extend(jQuery.easing, {
	def: "easeOutQuad",
	swing: function (e, f, a, h, g) {
		return jQuery.easing[jQuery.easing.def](e, f, a, h, g);
	},
	easeInQuad: function (e, f, a, h, g) {
		return h * (f /= g) * f + a;
	},
	easeOutQuad: function (e, f, a, h, g) {
		return -h * (f /= g) * (f - 2) + a;
	},
	easeInOutQuad: function (e, f, a, h, g) {
		if ((f /= g / 2) < 1) {
			return h / 2 * f * f + a;
		}
		return -h / 2 * ((--f) * (f - 2) - 1) + a;
	},
	easeInCubic: function (e, f, a, h, g) {
		return h * (f /= g) * f * f + a;
	},
	easeOutCubic: function (e, f, a, h, g) {
		return h * ((f = f / g - 1) * f * f + 1) + a;
	},
	easeInOutCubic: function (e, f, a, h, g) {
		if ((f /= g / 2) < 1) {
			return h / 2 * f * f * f + a;
		}
		return h / 2 * ((f -= 2) * f * f + 2) + a;
	},
	easeInQuart: function (e, f, a, h, g) {
		return h * (f /= g) * f * f * f + a;
	},
	easeOutQuart: function (e, f, a, h, g) {
		return -h * ((f = f / g - 1) * f * f * f - 1) + a;
	},
	easeInOutQuart: function (e, f, a, h, g) {
		if ((f /= g / 2) < 1) {
			return h / 2 * f * f * f * f + a;
		}
		return -h / 2 * ((f -= 2) * f * f * f - 2) + a;
	},
	easeInQuint: function (e, f, a, h, g) {
		return h * (f /= g) * f * f * f * f + a;
	},
	easeOutQuint: function (e, f, a, h, g) {
		return h * ((f = f / g - 1) * f * f * f * f + 1) + a;
	},
	easeInOutQuint: function (e, f, a, h, g) {
		if ((f /= g / 2) < 1) {
			return h / 2 * f * f * f * f * f + a;
		}
		return h / 2 * ((f -= 2) * f * f * f * f + 2) + a;
	},
	easeInSine: function (e, f, a, h, g) {
		return -h * Math.cos(f / g * (Math.PI / 2)) + h + a;
	},
	easeOutSine: function (e, f, a, h, g) {
		return h * Math.sin(f / g * (Math.PI / 2)) + a;
	},
	easeInOutSine: function (e, f, a, h, g) {
		return -h / 2 * (Math.cos(Math.PI * f / g) - 1) + a;
	},
	easeInExpo: function (e, f, a, h, g) {
		return (f == 0) ? a : h * Math.pow(2, 10 * (f / g - 1)) + a;
	},
	easeOutExpo: function (e, f, a, h, g) {
		return (f == g) ? a + h : h * (-Math.pow(2, -10 * f / g) + 1) + a;
	},
	easeInOutExpo: function (e, f, a, h, g) {
		if (f == 0) {
			return a;
		}
		if (f == g) {
			return a + h;
		}
		if ((f /= g / 2) < 1) {
			return h / 2 * Math.pow(2, 10 * (f - 1)) + a;
		}
		return h / 2 * (-Math.pow(2, -10 * --f) + 2) + a;
	},
	easeInCirc: function (e, f, a, h, g) {
		return -h * (Math.sqrt(1 - (f /= g) * f) - 1) + a;
	},
	easeOutCirc: function (e, f, a, h, g) {
		return h * Math.sqrt(1 - (f = f / g - 1) * f) + a;
	},
	easeInOutCirc: function (e, f, a, h, g) {
		if ((f /= g / 2) < 1) {
			return -h / 2 * (Math.sqrt(1 - f * f) - 1) + a;
		}
		return h / 2 * (Math.sqrt(1 - (f -= 2) * f) + 1) + a;
	},
	easeInElastic: function (f, h, e, l, k) {
		var i = 1.70158;
		var j = 0;
		var g = l;
		if (h == 0) {
			return e;
		}
		if ((h /= k) == 1) {
			return e + l;
		}
		if (!j) {
			j = k * 0.3;
		}
		if (g < Math.abs(l)) {
			g = l;
			var i = j / 4;
		} else {
			var i = j / (2 * Math.PI) * Math.asin(l / g);
		}
		return -(g * Math.pow(2, 10 * (h -= 1)) * Math.sin((h * k - i) * (2 * Math.PI) / j)) + e;
	},
	easeOutElastic: function (f, h, e, l, k) {
		var i = 1.70158;
		var j = 0;
		var g = l;
		if (h == 0) {
			return e;
		}
		if ((h /= k) == 1) {
			return e + l;
		}
		if (!j) {
			j = k * 0.3;
		}
		if (g < Math.abs(l)) {
			g = l;
			var i = j / 4;
		} else {
			var i = j / (2 * Math.PI) * Math.asin(l / g);
		}
		return g * Math.pow(2, -10 * h) * Math.sin((h * k - i) * (2 * Math.PI) / j) + l + e;
	},
	easeInOutElastic: function (f, h, e, l, k) {
		var i = 1.70158;
		var j = 0;
		var g = l;
		if (h == 0) {
			return e;
		}
		if ((h /= k / 2) == 2) {
			return e + l;
		}
		if (!j) {
			j = k * (0.3 * 1.5);
		}
		if (g < Math.abs(l)) {
			g = l;
			var i = j / 4;
		} else {
			var i = j / (2 * Math.PI) * Math.asin(l / g);
		}
		if (h < 1) {
			return -0.5 * (g * Math.pow(2, 10 * (h -= 1)) * Math.sin((h * k - i) * (2 * Math.PI) / j)) + e;
		}
		return g * Math.pow(2, -10 * (h -= 1)) * Math.sin((h * k - i) * (2 * Math.PI) / j) * 0.5 + l + e;
	},
	easeInBack: function (e, f, a, i, h, g) {
		if (g == undefined) {
			g = 1.70158;
		}
		return i * (f /= h) * f * ((g + 1) * f - g) + a;
	},
	easeOutBack: function (e, f, a, i, h, g) {
		if (g == undefined) {
			g = 1.70158;
		}
		return i * ((f = f / h - 1) * f * ((g + 1) * f + g) + 1) + a;
	},
	easeInOutBack: function (e, f, a, i, h, g) {
		if (g == undefined) {
			g = 1.70158;
		}
		if ((f /= h / 2) < 1) {
			return i / 2 * (f * f * (((g *= (1.525)) + 1) * f - g)) + a;
		}
		return i / 2 * ((f -= 2) * f * (((g *= (1.525)) + 1) * f + g) + 2) + a;
	},
	easeInBounce: function (e, f, a, h, g) {
		return h - jQuery.easing.easeOutBounce(e, g - f, 0, h, g) + a;
	},
	easeOutBounce: function (e, f, a, h, g) {
		if ((f /= g) < (1 / 2.75)) {
			return h * (7.5625 * f * f) + a;
		} else {
			if (f < (2 / 2.75)) {
				return h * (7.5625 * (f -= (1.5 / 2.75)) * f + 0.75) + a;
			} else {
				if (f < (2.5 / 2.75)) {
					return h * (7.5625 * (f -= (2.25 / 2.75)) * f + 0.9375) + a;
				} else {
					return h * (7.5625 * (f -= (2.625 / 2.75)) * f + 0.984375) + a;
				}
			}
		}
	},
	easeInOutBounce: function (e, f, a, h, g) {
		if (f < g / 2) {
			return jQuery.easing.easeInBounce(e, f * 2, 0, h, g) * 0.5 + a;
		}
		return jQuery.easing.easeOutBounce(e, f * 2 - g, 0, h, g) * 0.5 + h * 0.5 + a;
	}
});

/**
 * jQuery Cookie v1.4.1
 * https://github.com/carhartl/jquery-cookie
 * $.cookie('the_cookie'); //读取Cookie值
 * $.cookie('the_cookie', 'the_value'); //设置cookie的值
 * $.cookie('the_cookie', 'the_value', {expires: 7, path: '/', domain: 'jquery.com', secure: true, raw: true});
 * expires：有效期，以天数为单位
 * path：默认情况，只有设置cookie的网页才能读取该cookie
 * domain：创建cookie的网页所拥有的域名
 * secure：如果为true，cookie的传输需要使用安全协议（HTTPS）
 * raw：读取和写入的时候自动进行编码，要关闭这功能设置为true即可
 */
!
	function (a) {
		"function" == typeof define && define.amd ? define(["jquery"], a) : "object" == typeof exports ? a(require("jquery")) : a(jQuery);
	}(function (a) {
		function c(a) {
			return h.raw ? a : encodeURIComponent(a);
		}
		function d(a) {
			return h.raw ? a : decodeURIComponent(a);
		}
		function e(a) {
			return c(h.json ? JSON.stringify(a) : String(a));
		}
		function f(a) {
			0 === a.indexOf('"') && (a = a.slice(1, -1).replace(/\\"/g, '"').replace(/\\\\/g, "\\"));
			try {
				return a = decodeURIComponent(a.replace(b, " ")),
					h.json ? JSON.parse(a) : a;
			} catch (c) { }
		}
		function g(b, c) {
			var d = h.raw ? b : f(b);
			return a.isFunction(c) ? c(d) : d;
		}
		var b = /\+/g,
			h = a.cookie = function (b, f, i) {
				if (arguments.length > 1 && !a.isFunction(f)) {
					if (i = a.extend({},
						h.defaults, i), "number" == typeof i.expires) {
						var j = i.expires,
							k = i.expires = new Date;
						k.setTime(+k + 864e5 * j);
					}
					return document.cookie = [c(b), "=", e(f), i.expires ? "; expires=" + i.expires.toUTCString() : "", i.path ? "; path=" + i.path : "", i.domain ? "; domain=" + i.domain : "", i.secure ? "; secure" : ""].join("");
				}
				for (var l = b ? void 0 : {},
					m = document.cookie ? document.cookie.split("; ") : [], n = 0, o = m.length; o > n; n++) {
					var p = m[n].split("="),
						q = d(p.shift()),
						r = p.join("=");
					if (b && b === q) {
						l = g(r, f);
						break;
					}
					b || void 0 === (r = g(r)) || (l[q] = r);
				}
				return l;
			};
		h.defaults = {},
			a.removeCookie = function (b, c) {
				return void 0 === a.cookie(b) ? !1 : (a.cookie(b, "", a.extend({},
					c, {
						expires: -1
					})), !a.cookie(b));
			};
	});

/**
 * 快捷键 mousetrap v1.4.6
 * http://craig.is/killing/mice
 */
(function (J, r, f) {
	function s(a, b, d) {
		a.addEventListener ? a.addEventListener(b, d, !1) : a.attachEvent("on" + b, d);
	}
	function A(a) {
		if ("keypress" == a.type) {
			var b = String.fromCharCode(a.which);
			a.shiftKey || (b = b.toLowerCase());
			return b;
		}
		return h[a.which] ? h[a.which] : B[a.which] ? B[a.which] : String.fromCharCode(a.which).toLowerCase();
	}
	function t(a) {
		a = a || {};
		var b = !1,
			d;
		for (d in n) a[d] ? b = !0 : n[d] = 0;
		b || (u = !1);
	}
	function C(a, b, d, c, e, v) {
		var g, k, f = [],
			h = d.type;
		if (!l[a]) return [];
		"keyup" == h && w(a) && (b = [a]);
		for (g = 0; g < l[a].length; ++g) if (k = l[a][g], !(!c && k.seq && n[k.seq] != k.level || h != k.action || ("keypress" != h || d.metaKey || d.ctrlKey) && b.sort().join(",") !== k.modifiers.sort().join(","))) {
			var m = c && k.seq == c && k.level == v; (!c && k.combo == e || m) && l[a].splice(g, 1);
			f.push(k);
		}
		return f;
	}
	function K(a) {
		var b = [];
		a.shiftKey && b.push("shift");
		a.altKey && b.push("alt");
		a.ctrlKey && b.push("ctrl");
		a.metaKey && b.push("meta");
		return b;
	}
	function x(a, b, d, c) {
		m.stopCallback(b, b.target || b.srcElement, d, c) || !1 !== a(b, d) || (b.preventDefault ? b.preventDefault() : b.returnValue = !1, b.stopPropagation ? b.stopPropagation() : b.cancelBubble = !0);
	}
	function y(a) {
		"number" !== typeof a.which && (a.which = a.keyCode);
		var b = A(a);
		b && ("keyup" == a.type && z === b ? z = !1 : m.handleKey(b, K(a), a));
	}
	function w(a) {
		return "shift" == a || "ctrl" == a || "alt" == a || "meta" == a;
	}
	function L(a, b, d, c) {
		function e(b) {
			return function () {
				u = b; ++n[a];
				clearTimeout(D);
				D = setTimeout(t, 1E3);
			};
		}
		function v(b) {
			x(d, b, a);
			"keyup" !== c && (z = A(b));
			setTimeout(t, 10);
		}
		for (var g = n[a] = 0; g < b.length; ++g) {
			var f = g + 1 === b.length ? v : e(c || E(b[g + 1]).action);
			F(b[g], f, c, a, g);
		}
	}
	function E(a, b) {
		var d, c, e, f = [];
		d = "+" === a ? ["+"] : a.split("+");
		for (e = 0; e < d.length; ++e) c = d[e],
			G[c] && (c = G[c]),
			b && "keypress" != b && H[c] && (c = H[c], f.push("shift")),
			w(c) && f.push(c);
		d = c;
		e = b;
		if (!e) {
			if (!p) {
				p = {};
				for (var g in h) 95 < g && 112 > g || h.hasOwnProperty(g) && (p[h[g]] = g);
			}
			e = p[d] ? "keydown" : "keypress";
		}
		"keypress" == e && f.length && (e = "keydown");
		return {
			key: c,
			modifiers: f,
			action: e
		};
	}
	function F(a, b, d, c, e) {
		q[a + ":" + d] = b;
		a = a.replace(/\s+/g, " ");
		var f = a.split(" ");
		1 < f.length ? L(a, f, b, d) : (d = E(a, d), l[d.key] = l[d.key] || [], C(d.key, d.modifiers, {
			type: d.action
		},
			c, a, e), l[d.key][c ? "unshift" : "push"]({
				callback: b,
				modifiers: d.modifiers,
				action: d.action,
				seq: c,
				level: e,
				combo: a
			}));
	}
	var h = {
		8: "backspace",
		9: "tab",
		13: "enter",
		16: "shift",
		17: "ctrl",
		18: "alt",
		20: "capslock",
		27: "esc",
		32: "space",
		33: "pageup",
		34: "pagedown",
		35: "end",
		36: "home",
		37: "left",
		38: "up",
		39: "right",
		40: "down",
		45: "ins",
		46: "del",
		91: "meta",
		93: "meta",
		224: "meta"
	},
		B = {
			106: "*",
			107: "+",
			109: "-",
			110: ".",
			111: "/",
			186: ";",
			187: "=",
			188: ",",
			189: "-",
			190: ".",
			191: "/",
			192: "`",
			219: "[",
			220: "\\",
			221: "]",
			222: "'"
		},
		H = {
			"~": "`",
			"!": "1",
			"@": "2",
			"#": "3",
			$: "4",
			"%": "5",
			"^": "6",
			"&": "7",
			"*": "8",
			"(": "9",
			")": "0",
			_: "-",
			"+": "=",
			":": ";",
			'"': "'",
			"<": ",",
			">": ".",
			"?": "/",
			"|": "\\"
		},
		G = {
			option: "alt",
			command: "meta",
			"return": "enter",
			escape: "esc",
			mod: /Mac|iPod|iPhone|iPad/.test(navigator.platform) ? "meta" : "ctrl"
		},
		p,
		l = {},
		q = {},
		n = {},
		D,
		z = !1,
		I = !1,
		u = !1;
	for (f = 1; 20 > f; ++f) h[111 + f] = "f" + f;
	for (f = 0; 9 >= f; ++f) h[f + 96] = f;
	s(r, "keypress", y);
	s(r, "keydown", y);
	s(r, "keyup", y);
	var m = {
		bind: function (a, b, d) {
			a = a instanceof Array ? a : [a];
			for (var c = 0; c < a.length; ++c) F(a[c], b, d);
			return this;
		},
		unbind: function (a, b) {
			return m.bind(a,
				function () { },
				b);
		},
		trigger: function (a, b) {
			if (q[a + ":" + b]) q[a + ":" + b]({},
				a);
			return this;
		},
		reset: function () {
			l = {};
			q = {};
			return this;
		},
		stopCallback: function (a, b) {
			return -1 < (" " + b.className + " ").indexOf(" mousetrap ") ? !1 : "INPUT" == b.tagName || "SELECT" == b.tagName || "TEXTAREA" == b.tagName || b.isContentEditable;
		},
		handleKey: function (a, b, d) {
			var c = C(a, b, d),
				e;
			b = {};
			var f = 0,
				g = !1;
			for (e = 0; e < c.length; ++e) c[e].seq && (f = Math.max(f, c[e].level));
			for (e = 0; e < c.length; ++e) c[e].seq ? c[e].level == f && (g = !0, b[c[e].seq] = 1, x(c[e].callback, d, c[e].combo, c[e].seq)) : g || x(c[e].callback, d, c[e].combo);
			c = "keypress" == d.type && I;
			d.type != u || w(a) || c || t(b);
			I = g && "keydown" == d.type;
		}
	};
	J.Mousetrap = m;
	"function" === typeof define && define.amd && define(m);
})(window, document);

/**
 * jquery.mousewheel 3.1.12
 * https://github.com/brandonaaron/jquery-mousewheel/
 */
!
	function (a) {
		"function" == typeof define && define.amd ? define(["jquery"], a) : "object" == typeof exports ? module.exports = a : a(jQuery);
	}(function (a) {
		function b(b) {
			var g = b || window.event,
				h = i.call(arguments, 1),
				j = 0,
				l = 0,
				m = 0,
				n = 0,
				o = 0,
				p = 0;
			if (b = a.event.fix(g), b.type = "mousewheel", "detail" in g && (m = -1 * g.detail), "wheelDelta" in g && (m = g.wheelDelta), "wheelDeltaY" in g && (m = g.wheelDeltaY), "wheelDeltaX" in g && (l = -1 * g.wheelDeltaX), "axis" in g && g.axis === g.HORIZONTAL_AXIS && (l = -1 * m, m = 0), j = 0 === m ? l : m, "deltaY" in g && (m = -1 * g.deltaY, j = m), "deltaX" in g && (l = g.deltaX, 0 === m && (j = -1 * l)), 0 !== m || 0 !== l) {
				if (1 === g.deltaMode) {
					var q = a.data(this, "mousewheel-line-height");
					j *= q,
						m *= q,
						l *= q;
				} else if (2 === g.deltaMode) {
					var r = a.data(this, "mousewheel-page-height");
					j *= r,
						m *= r,
						l *= r;
				}
				if (n = Math.max(Math.abs(m), Math.abs(l)), (!f || f > n) && (f = n, d(g, n) && (f /= 40)), d(g, n) && (j /= 40, l /= 40, m /= 40), j = Math[j >= 1 ? "floor" : "ceil"](j / f), l = Math[l >= 1 ? "floor" : "ceil"](l / f), m = Math[m >= 1 ? "floor" : "ceil"](m / f), k.settings.normalizeOffset && this.getBoundingClientRect) {
					var s = this.getBoundingClientRect();
					o = b.clientX - s.left,
						p = b.clientY - s.top;
				}
				return b.deltaX = l,
					b.deltaY = m,
					b.deltaFactor = f,
					b.offsetX = o,
					b.offsetY = p,
					b.deltaMode = 0,
					h.unshift(b, j, l, m),
					e && clearTimeout(e),
					e = setTimeout(c, 200),
					(a.event.dispatch || a.event.handle).apply(this, h);
			}
		}
		function c() {
			f = null;
		}
		function d(a, b) {
			return k.settings.adjustOldDeltas && "mousewheel" === a.type && b % 120 === 0;
		}
		var e, f, g = ["wheel", "mousewheel", "DOMMouseScroll", "MozMousePixelScroll"],
			h = "onwheel" in document || document.documentMode >= 9 ? ["wheel"] : ["mousewheel", "DomMouseScroll", "MozMousePixelScroll"],
			i = Array.prototype.slice;
		if (a.event.fixHooks) for (var j = g.length; j;) a.event.fixHooks[g[--j]] = a.event.mouseHooks;
		var k = a.event.special.mousewheel = {
			version: "3.1.12",
			setup: function () {
				if (this.addEventListener) for (var c = h.length; c;) this.addEventListener(h[--c], b, !1);
				else this.onmousewheel = b;
				a.data(this, "mousewheel-line-height", k.getLineHeight(this)),
					a.data(this, "mousewheel-page-height", k.getPageHeight(this));
			},
			teardown: function () {
				if (this.removeEventListener) for (var c = h.length; c;) this.removeEventListener(h[--c], b, !1);
				else this.onmousewheel = null;
				a.removeData(this, "mousewheel-line-height"),
					a.removeData(this, "mousewheel-page-height");
			},
			getLineHeight: function (b) {
				var c = a(b),
					d = c["offsetParent" in a.fn ? "offsetParent" : "parent"]();
				return d.length || (d = a("body")),
					parseInt(d.css("fontSize"), 10) || parseInt(c.css("fontSize"), 10) || 16;
			},
			getPageHeight: function (b) {
				return a(b).height();
			},
			settings: {
				adjustOldDeltas: !0,
				normalizeOffset: !0
			}
		};
		a.fn.extend({
			mousewheel: function (a) {
				return a ? this.bind("mousewheel", a) : this.trigger("mousewheel");
			},
			unmousewheel: function (a) {
				return this.unbind("mousewheel", a);
			}
		});
	});

/**
 * 分页插件 jquery_pagination 修改版
 * http://hooray.github.com/jquery.pagination/
 */
(function ($) {
	$.PaginationCalculator = function (maxentries, opts) {
		this.maxentries = maxentries;
		this.opts = opts;
	};
	$.extend($.PaginationCalculator.prototype, {
		numPages: function () {
			return Math.ceil(this.maxentries / this.opts.items_per_page);
		},
		getInterval: function (current_page) {
			var ne_half = Math.floor(this.opts.num_display_entries / 2);
			var np = this.numPages();
			var upper_limit = np - this.opts.num_display_entries;
			var start = current_page > ne_half ? Math.max(Math.min(current_page - ne_half, upper_limit), 0) : 0;
			var end = current_page > ne_half ? Math.min(current_page + ne_half + (this.opts.num_display_entries % 2), np) : Math.min(this.opts.num_display_entries, np);
			return {
				start: start,
				end: end
			};
		}
	});
	$.PaginationRenderers = {};
	$.PaginationRenderers.defaultRenderer = function (maxentries, opts) {
		this.maxentries = maxentries;
		this.opts = opts;
		this.pc = new $.PaginationCalculator(maxentries, opts);
	};
	$.extend($.PaginationRenderers.defaultRenderer.prototype, {
		createLink: function (page_id, current_page, appendopts) {
			var lnk, np = this.pc.numPages();
			page_id = page_id < 0 ? 0 : (page_id < np ? page_id : np - 1);
			appendopts = $.extend({
				text: page_id + 1,
				classes: ""
			},
				appendopts || {});
			if (page_id == current_page) {
				if (isNaN(appendopts.text)) {
					lnk = $("<li class='disabled'><a>" + appendopts.text + "</a></li>");
				} else {
					lnk = $("<li class='active'><a>" + appendopts.text + "</a></li>");
				}
			} else {
				lnk = $("<li><a href='" + this.opts.link_to.replace(/__id__/, page_id) + "'>" + appendopts.text + "</a></li>");
			}
			if (appendopts.classes) {
				lnk.addClass(appendopts.classes);
			}
			lnk.data("page_id", page_id);
			return lnk;
		},
		appendRange: function (container, current_page, start, end, opts) {
			var i;
			for (i = start; i < end; i++) {
				this.createLink(i, current_page, opts).appendTo(container);
			}
		},
		getLinks: function (current_page, eventHandler) {
			current_page = parseInt(current_page);
			var begin, end, interval = this.pc.getInterval(current_page),
				np = this.pc.numPages(),
				fragment = $("<ul></ul>");
			if (this.opts.prev_text && (current_page > 0 || this.opts.prev_show_always)) {
				fragment.append(this.createLink(current_page - 1, current_page, {
					text: this.opts.prev_text,
					classes: "prev"
				}));
			}
			if (interval.start > 0 && this.opts.num_edge_entries > 0) {
				end = Math.min(this.opts.num_edge_entries, interval.start);
				this.appendRange(fragment, current_page, 0, end, {
					classes: "sp"
				});
				if (this.opts.num_edge_entries < interval.start && this.opts.ellipse_text) {
					$("<li class='disabled'><a>" + this.opts.ellipse_text + "</a></li>").appendTo(fragment);
				}
			}
			this.appendRange(fragment, current_page, interval.start, interval.end);
			if (interval.end < np && this.opts.num_edge_entries > 0) {
				if (np - this.opts.num_edge_entries > interval.end && this.opts.ellipse_text) {
					$("<li class='disabled'><a>" + this.opts.ellipse_text + "</a></li>").appendTo(fragment);
				}
				begin = Math.max(np - this.opts.num_edge_entries, interval.end);
				this.appendRange(fragment, current_page, begin, np, {
					classes: "ep"
				});
			}
			if (this.opts.next_text && (current_page < np - 1 || this.opts.next_show_always)) {
				fragment.append(this.createLink(current_page + 1, current_page, {
					text: this.opts.next_text,
					classes: "next"
				}));
			}
			$("li:not(.disabled, .active) a", fragment).click(eventHandler);
			return fragment;
		}
	});
	$.fn.pagination = function (maxentries, opts) {

		opts = $.extend({
			items_per_page: 10,
			num_display_entries: 11,
			current_page: 0,
			num_edge_entries: 0,
			link_to: "###",
			prev_text: "Prev",
			next_text: "Next",
			ellipse_text: "...",
			prev_show_always: true,
			next_show_always: true,
			renderer: "defaultRenderer",
			load_first_page: false,
			callback: function () {
				return false;
			}
		},
			opts || {});
		var containers = this,
			renderer, links, current_page;
		function paginationClickHandler(evt) {
			var links, new_current_page = $(evt.target).parent().data("page_id"),
				continuePropagation = selectPage(new_current_page);
			if (!continuePropagation) {
				evt.stopPropagation();
			}
			return continuePropagation;
		}
		function selectPage(new_current_page) {
			containers.data("current_page", new_current_page);
			links = renderer.getLinks(new_current_page, paginationClickHandler);
			containers.empty();
			links.appendTo(containers);
			var continuePropagation = opts.callback(new_current_page, containers);
			return continuePropagation;
		}
		current_page = opts.current_page;
		containers.data("current_page", current_page);
		maxentries = (!maxentries || maxentries < 0) ? 1 : maxentries;
		opts.items_per_page = (!opts.items_per_page || opts.items_per_page < 0) ? 1 : opts.items_per_page;
		if (!$.PaginationRenderers[opts.renderer]) {
			throw new ReferenceError("Pagination renderer '" + opts.renderer + "' was not found in jQuery.PaginationRenderers object.");
		}
		renderer = new $.PaginationRenderers[opts.renderer](maxentries, opts);
		var pc = new $.PaginationCalculator(maxentries, opts);
		var np = pc.numPages();
		containers.off("setPage").on("setPage", {
			numPages: np
		},
			function (evt, page_id) {
				if (page_id >= 0 && page_id < evt.data.numPages) {
					selectPage(page_id);
					return false;
				}
			});
		containers.off("prevPage").on("prevPage",
			function (evt) {
				var current_page = $(this).data("current_page");
				if (current_page > 0) {
					selectPage(current_page - 1);
				}
				return false;
			});
		containers.off("nextPage").on("nextPage", {
			numPages: np
		},
			function (evt) {
				var current_page = $(this).data("current_page");
				if (current_page < evt.data.numPages - 1) {
					selectPage(current_page + 1);
				}
				return false;
			});
		containers.off("currentPage").on("currentPage",
			function () {
				var current_page = $(this).data("current_page");
				selectPage(current_page);
				return false;
			});
		links = renderer.getLinks(current_page, paginationClickHandler);
		containers.empty();
		links.appendTo(containers);
		if (opts.load_first_page) {
			opts.callback(current_page, containers);
		}
	};
})(jQuery);

/**
 * 腾讯UED提示信息
 * NewCrm.msgbox.show("服务器繁忙，请稍后再试。", 1, 2000);
 * NewCrm.msgbox.show("设置成功！", 4, 2000);
 * NewCrm.msgbox.show("数据拉取失败", 5, 2000);
 * NewCrm.msgbox.show("正在加载中，请稍后...", 6,8000);
 */
window.NewCrm = window.NewCrm || {};
NewCrm.dom = {
	getById: function (id) {
		return document.getElementById(id);
	}, get: function (e) {
		return (typeof (e) == "string") ? document.getElementById(e) : e;
	}, createElementIn: function (tagName, elem, insertFirst, attrs) {
		var _e = (elem = NewCrm.dom.get(elem) || document.body).ownerDocument.createElement(tagName || "div"), k;
		if (typeof (attrs) == 'object') {
			for (k in attrs) {
				if (k == "class") {
					_e.className = attrs[k];
				} else if (k == "style") {
					_e.style.cssText = attrs[k];
				} else {
					_e[k] = attrs[k];
				}
			}
		}
		insertFirst ? elem.insertBefore(_e, elem.firstChild) : elem.appendChild(_e);
		return _e;
	}, getStyle: function (el, property) {
		el = NewCrm.dom.get(el);
		if (!el || el.nodeType == 9) {
			return null;
		}
		var w3cMode = document.defaultView && document.defaultView.getComputedStyle, computed = !w3cMode ? null : document.defaultView.getComputedStyle(el, ''), value = "";
		switch (property) {
			case "float":
				property = w3cMode ? "cssFloat" : "styleFloat";
				break;
			case "opacity":
				if (!w3cMode) {
					var val = 100;
					try {
						val = el.filters['DXImageTransform.Microsoft.Alpha'].opacity;
					} catch (e) {
						try {
							val = el.filters('alpha').opacity;
						} catch (e) {
						}
					}
					return val / 100;
				} else {
					return parseFloat((computed || el.style)[property]);
				}
				break;
			case "backgroundPositionX":
				if (w3cMode) {
					property = "backgroundPosition";
					return ((computed || el.style)[property]).split(" ")[0];
				}
				break;
			case "backgroundPositionY":
				if (w3cMode) {
					property = "backgroundPosition";
					return ((computed || el.style)[property]).split(" ")[1];
				}
				break;
		}
		if (w3cMode) {
			return (computed || el.style)[property];
		} else {
			return (el.currentStyle[property] || el.style[property]);
		}
	}, setStyle: function (el, properties, value) {
		if (!(el = NewCrm.dom.get(el)) || el.nodeType != 1) {
			return false;
		}
		var tmp, bRtn = true, w3cMode = (tmp = document.defaultView) && tmp.getComputedStyle, rexclude = /z-?index|font-?weight|opacity|zoom|line-?height/i;
		if (typeof (properties) == 'string') {
			tmp = properties;
			properties = {};
			properties[tmp] = value;
		}
		for (var prop in properties) {
			value = properties[prop];
			if (prop == 'float') {
				prop = w3cMode ? "cssFloat" : "styleFloat";
			} else if (prop == 'opacity') {
				if (!w3cMode) {
					prop = 'filter';
					value = value >= 1 ? '' : ('alpha(opacity=' + Math.round(value * 100) + ')');
				}
			} else if (prop == 'backgroundPositionX' || prop == 'backgroundPositionY') {
				tmp = prop.slice(-1) == 'X' ? 'Y' : 'X';
				if (w3cMode) {
					var v = NewCrm.dom.getStyle(el, "backgroundPosition" + tmp);
					prop = 'backgroundPosition';
					typeof (value) == 'number' && (value = value + 'px');
					value = tmp == 'Y' ? (value + " " + (v || "top")) : ((v || 'left') + " " + value);
				}
			}
			if (typeof el.style[prop] != "undefined") {
				el.style[prop] = value + (typeof value === "number" && !rexclude.test(prop) ? 'px' : '');
				bRtn = bRtn && true;
			} else {
				bRtn = bRtn && false;
			}
		}
		return bRtn;
	}, getScrollTop: function (doc) {
		var _doc = doc || document;
		return Math.max(_doc.documentElement.scrollTop, _doc.body.scrollTop);
	}, getClientHeight: function (doc) {
		var _doc = doc || document;
		return _doc.compatMode == "CSS1Compat" ? _doc.documentElement.clientHeight : _doc.body.clientHeight;
	}
};
NewCrm.string = {
	RegExps: { trim: /^\s+|\s+$/g, ltrim: /^\s+/, rtrim: /\s+$/, nl2br: /\n/g, s2nb: /[\x20]{2}/g, URIencode: /[\x09\x0A\x0D\x20\x21-\x29\x2B\x2C\x2F\x3A-\x3F\x5B-\x5E\x60\x7B-\x7E]/g, escHTML: { re_amp: /&/g, re_lt: /</g, re_gt: />/g, re_apos: /\x27/g, re_quot: /\x22/g }, escString: { bsls: /\\/g, sls: /\//g, nl: /\n/g, rt: /\r/g, tab: /\t/g }, restXHTML: { re_amp: /&amp;/g, re_lt: /&lt;/g, re_gt: /&gt;/g, re_apos: /&(?:apos|#0?39);/g, re_quot: /&quot;/g }, write: /\{(\d{1,2})(?:\:([xodQqb]))?\}/g, isURL: /^(?:ht|f)tp(?:s)?\:\/\/(?:[\w\-\.]+)\.\w+/i, cut: /[\x00-\xFF]/, getRealLen: { r0: /[^\x00-\xFF]/g, r1: /[\x00-\xFF]/g }, format: /\{([\d\w\.]+)\}/g }, commonReplace: function (s, p, r) {
		return s.replace(p, r);
	}, format: function (str) {
		var args = Array.prototype.slice.call(arguments), v;
		str = String(args.shift());
		if (args.length == 1 && typeof (args[0]) == 'object') {
			args = args[0];
		}
		NewCrm.string.RegExps.format.lastIndex = 0;
		return str.replace(NewCrm.string.RegExps.format, function (m, n) {
			v = NewCrm.object.route(args, n);
			return v === undefined ? m : v;
		});
	}
};
NewCrm.object = {
	routeRE: /([\d\w_]+)/g,
	route: function (obj, path) {
		obj = obj || {};
		path = String(path);
		var r = NewCrm.object.routeRE, m;
		r.lastIndex = 0;
		while ((m = r.exec(path)) !== null) {
			obj = obj[m[0]];
			if (obj === undefined || obj === null) {
				break;
			}
		}
		return obj;
	}
};
var ua = NewCrm.userAgent = {}, agent = navigator.userAgent;
ua.ie = 9 - ((agent.indexOf('Trident/5.0') > -1) ? 0 : 1) - (window.XDomainRequest ? 0 : 1) - (window.XMLHttpRequest ? 0 : 1);

if (typeof (NewCrm.msgbox) == 'undefined') {
	NewCrm.msgbox = {};
}
NewCrm.msgbox._timer = null;
NewCrm.msgbox.loadingAnimationPath = NewCrm.msgbox.loadingAnimationPath || ("loading.gif");
NewCrm.msgbox.show = function (msgHtml, type, timeout, opts) {
	if (typeof (opts) == 'number') {
		opts = { topPosition: opts };
	}
	opts = opts || {};
	var _s = NewCrm.msgbox,
		template = '<span class="zeng_msgbox_layer zeng_msgbox_layer_{layerStyle}" style="display:none;z-index:9998;" id="mode_tips_v2"><span class="gtl_ico_{type}"></span>{loadIcon}{msgHtml}<span class="gtl_end"></span></span>', loading = '<span class="gtl_ico_loading"></span>', typeClass = [0, 0, 0, 0, "succ", "fail", "clear"], mBox, tips;
	_s._loadCss && _s._loadCss(opts.cssPath);
	mBox = NewCrm.dom.get("q_Msgbox") || NewCrm.dom.createElementIn("div", document.body, false, { className: "zeng_msgbox_layer_wrap" });
	mBox.id = "q_Msgbox";
	mBox.style.display = "";
	mBox.innerHTML = NewCrm.string.format(template, { type: typeClass[type] || "hits", msgHtml: msgHtml || "", loadIcon: type == 6 ? loading : "", layerStyle: type == 6 ? 'loading' : "normal" });
	_s._setPosition(mBox, timeout, opts.topPosition);
};
NewCrm.msgbox._setPosition = function (tips, timeout, topPosition) {
	timeout = timeout || 5000;
	var _s = NewCrm.msgbox, bt = NewCrm.dom.getScrollTop(), ch = NewCrm.dom.getClientHeight(), t = Math.floor(ch / 2) - 40;
	NewCrm.dom.setStyle(tips, "top", ((document.compatMode == "BackCompat" || NewCrm.userAgent.ie < 7) ? bt : 0) + ((typeof (topPosition) == "number") ? topPosition : t) + "px");

	clearTimeout(_s._timer);
	tips.firstChild.style.display = "";
	timeout && (_s._timer = setTimeout(_s._hide, timeout));
};

NewCrm.msgbox._hide = function () {
	var _mBox = NewCrm.dom.get("q_Msgbox"), _s = NewCrm.msgbox;
	clearTimeout(_s._timer);
	if (_mBox) {
		var _tips = _mBox.firstChild;
		NewCrm.dom.setStyle(_mBox, "display", "none");
	}
};

if (typeof define === "function") {
	// AMD. Register as an anonymous module.
	module.exports = NewCrm;
} else {
	window.NewCrm = NewCrm;
}

NewCrm.msgbox.info = function (msg, timeout) {
	NewCrm.msgbox.show(msg, 1, timeout || 2000);
};
NewCrm.msgbox.success = function (msg, timeout) {
	NewCrm.msgbox.show(msg, 4, timeout || 2000);
};
NewCrm.msgbox.fail = function (msg, timeout) {
	NewCrm.msgbox.show(msg || '出现未知错误，请重试', 5, timeout || 2000);
};
NewCrm.msgbox.loading = function (msg) {
	NewCrm.msgbox.show(msg, 6, 10000);
};
NewCrm.msgbox.close = function () {
	NewCrm.msgbox._hide()
};

/**
 * 全屏插件
 * http://johndyer.name/native-fullscreen-javascript-api-plus-jquery-plugin/
 */
(function () {
	var d = {
		supportsFullScreen: false,
		isFullScreen: function () {
			return false;
		},
		requestFullScreen: function () { },
		cancelFullScreen: function () { },
		fullScreenEventName: "",
		prefix: ""
	},
		c = "webkit moz o ms khtml".split(" ");
	if (typeof document.cancelFullScreen != "undefined") {
		d.supportsFullScreen = true;
	} else {
		for (var b = 0,
			a = c.length; b < a; b++) {
			d.prefix = c[b];
			if (typeof document[d.prefix + "CancelFullScreen"] != "undefined") {
				d.supportsFullScreen = true;
				break;
			}
		}
	}
	if (d.supportsFullScreen) {
		d.fullScreenEventName = d.prefix + "fullscreenchange";
		d.isFullScreen = function () {
			switch (this.prefix) {
				case "":
					return document.fullScreen;
				case "webkit":
					return document.webkitIsFullScreen;
				default:
					return document[this.prefix + "FullScreen"];
			}
		};
		d.requestFullScreen = function (e) {
			return (this.prefix === "") ? e.requestFullScreen() : e[this.prefix + "RequestFullScreen"]();
		};
		d.cancelFullScreen = function (e) {
			return (this.prefix === "") ? document.cancelFullScreen() : document[this.prefix + "CancelFullScreen"]();
		};
	}
	if (typeof jQuery != "undefined") {
		jQuery.fn.requestFullScreen = function () {
			return this.each(function () {
				if (d.supportsFullScreen) {
					d.requestFullScreen(this);
				}
			});
		};
	}
	window.fullScreenApi = d;
})();

/**
 * artTemplate 3.0 - Template Engine
 * https://github.com/aui/artTemplate
 */
!
	function () {
		function a(a) {
			return a.replace(t, "").replace(u, ",").replace(v, "").replace(w, "").replace(x, "").split(y);
		}
		function b(a) {
			return "'" + a.replace(/('|\\)/g, "\\$1").replace(/\r/g, "\\r").replace(/\n/g, "\\n") + "'";
		}
		function c(c, d) {
			function e(a) {
				return m += a.split(/\n/).length - 1,
					k && (a = a.replace(/\s+/g, " ").replace(/<!--[\w\W]*?-->/g, "")),
					a && (a = s[1] + b(a) + s[2] + "\n"),
					a;
			}
			function f(b) {
				var c = m;
				if (j ? b = j(b, d) : g && (b = b.replace(/\n/g,
					function () {
						return m++ ,
							"$line=" + m + ";";
					})), 0 === b.indexOf("=")) {
					var e = l && !/^=[=#]/.test(b);
					if (b = b.replace(/^=[=#]?|[\s;]*$/g, ""), e) {
						var f = b.replace(/\s*\([^\)]+\)/, "");
						n[f] || /^(include|print)$/.test(f) || (b = "$escape(" + b + ")");
					} else b = "$string(" + b + ")";
					b = s[1] + b + s[2];
				}
				return g && (b = "$line=" + c + ";" + b),
					r(a(b),
						function (a) {
							if (a && !p[a]) {
								var b;
								b = "print" === a ? u : "include" === a ? v : n[a] ? "$utils." + a : o[a] ? "$helpers." + a : "$data." + a,
									w += a + "=" + b + ",",
									p[a] = !0;
							}
						}),
					b + "\n";
			}
			var g = d.debug,
				h = d.openTag,
				i = d.closeTag,
				j = d.parser,
				k = d.compress,
				l = d.escape,
				m = 1,
				p = {
					$data: 1,
					$filename: 1,
					$utils: 1,
					$helpers: 1,
					$out: 1,
					$line: 1
				},
				q = "".trim,
				s = q ? ["$out='';", "$out+=", ";", "$out"] : ["$out=[];", "$out.push(", ");", "$out.join('')"],
				t = q ? "$out+=text;return $out;" : "$out.push(text);",
				u = "function(){var text=''.concat.apply('',arguments);" + t + "}",
				v = "function(filename,data){data=data||$data;var text=$utils.$include(filename,data,$filename);" + t + "}",
				w = "'use strict';var $utils=this,$helpers=$utils.$helpers," + (g ? "$line=0," : ""),
				x = s[0],
				y = "return new String(" + s[3] + ");";
			r(c.split(h),
				function (a) {
					a = a.split(i);
					var b = a[0],
						c = a[1];
					1 === a.length ? x += e(b) : (x += f(b), c && (x += e(c)));
				});
			var z = w + x + y;
			g && (z = "try{" + z + "}catch(e){throw {filename:$filename,name:'Render Error',message:e.message,line:$line,source:" + b(c) + ".split(/\\n/)[$line-1].replace(/^\\s+/,'')};}");
			try {
				var A = new Function("$data", "$filename", z);
				return A.prototype = n,
					A;
			} catch (B) {
				throw B.temp = "function anonymous($data,$filename) {" + z + "}",
				B;
			}
		}
		var d = function (a, b) {
			return "string" == typeof b ? q(b, {
				filename: a
			}) : g(a, b);
		};
		d.version = "3.0.0",
			d.config = function (a, b) {
				e[a] = b;
			};
		var e = d.defaults = {
			openTag: "<%",
			closeTag: "%>",
			escape: !0,
			cache: !0,
			compress: !1,
			parser: null
		},
			f = d.cache = {};
		d.render = function (a, b) {
			return q(a, b);
		};
		var g = d.renderFile = function (a, b) {
			var c = d.get(a) || p({
				filename: a,
				name: "Render Error",
				message: "Template not found"
			});
			return b ? c(b) : c;
		};
		d.get = function (a) {
			var b;
			if (f[a]) b = f[a];
			else if ("object" == typeof document) {
				var c = document.getElementById(a);
				if (c) {
					var d = (c.value || c.innerHTML).replace(/^\s*|\s*$/g, "");
					b = q(d, {
						filename: a
					});
				}
			}
			return b;
		};
		var h = function (a, b) {
			return "string" != typeof a && (b = typeof a, "number" === b ? a += "" : a = "function" === b ? h(a.call(a)) : ""),
				a;
		},
			i = {
				"<": "&#60;",
				">": "&#62;",
				'"': "&#34;",
				"'": "&#39;",
				"&": "&#38;"
			},
			j = function (a) {
				return i[a];
			},
			k = function (a) {
				return h(a).replace(/&(?![\w#]+;)|[<>"']/g, j);
			},
			l = Array.isArray ||
				function (a) {
					return "[object Array]" === {}.toString.call(a);
				},
			m = function (a, b) {
				var c, d;
				if (l(a)) for (c = 0, d = a.length; d > c; c++) b.call(a, a[c], c, a);
				else for (c in a) b.call(a, a[c], c);
			},
			n = d.utils = {
				$helpers: {},
				$include: g,
				$string: h,
				$escape: k,
				$each: m
			};
		d.helper = function (a, b) {
			o[a] = b;
		};
		var o = d.helpers = n.$helpers;
		d.onerror = function (a) {
			var b = "Template Error\n\n";
			for (var c in a) b += "<" + c + ">\n" + a[c] + "\n\n";
			"object" == typeof console && console.error(b);
		};
		var p = function (a) {
			return d.onerror(a),
				function () {
					return "{Template Error}";
				};
		},
			q = d.compile = function (a, b) {
				function d(c) {
					try {
						return new i(c, h) + "";
					} catch (d) {
						return b.debug ? p(d)() : (b.debug = !0, q(a, b)(c));
					}
				}
				b = b || {};
				for (var g in e) void 0 === b[g] && (b[g] = e[g]);
				var h = b.filename;
				try {
					var i = c(a, b);
				} catch (j) {
					return j.filename = h || "anonymous",
						j.name = "Syntax Error",
						p(j);
				}
				return d.prototype = i.prototype,
					d.toString = function () {
						return i.toString();
					},
					h && b.cache && (f[h] = d),
					d;
			},
			r = n.$each,
			s = "break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield,undefined",
			t = /\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|\s*\.\s*[$\w\.]+/g,
			u = /[^\w$]+/g,
			v = new RegExp(["\\b" + s.replace(/,/g, "\\b|\\b") + "\\b"].join("|"), "g"),
			w = /^\d[^,]*|,\d[^,]*/g,
			x = /^,+|,+$/g,
			y = /^$|,+/;
		"function" == typeof define ? define(function () {
			return d;
		}) : "undefined" != typeof exports ? module.exports = d : this.template = d;
	}();

//https://github.com/h5bp/html5-boilerplate
(function () {
	var method;
	var noop = function () { };
	var methods = ["assert", "clear", "count", "debug", "dir", "dirxml", "error", "exception", "group", "groupCollapsed", "groupEnd", "info", "log", "markTimeline", "profile", "profileEnd", "table", "time", "timeEnd", "timeStamp", "trace", "warn"];
	var length = methods.length;
	var console = (window.console = window.console || {});
	while (length--) {
		method = methods[length];
		if (!console[method]) {
			console[method] = noop;
		}
	}
}());


/**
* Bootstrap.js by @fat & @mdo
* plugins: bootstrap-transition.js, bootstrap-modal.js, bootstrap-dropdown.js, bootstrap-scrollspy.js, bootstrap-tab.js, bootstrap-tooltip.js, bootstrap-popover.js, bootstrap-affix.js, bootstrap-alert.js, bootstrap-button.js, bootstrap-collapse.js, bootstrap-carousel.js, bootstrap-typeahead.js
* Copyright 2013 Twitter, Inc.
* http://www.apache.org/licenses/LICENSE-2.0.txt
*/
!function (a) { a(function () { a.support.transition = function () { var a = function () { var a = document.createElement("bootstrap"), b = { WebkitTransition: "webkitTransitionEnd", MozTransition: "transitionend", OTransition: "oTransitionEnd otransitionend", transition: "transitionend" }, c; for (c in b) if (a.style[c] !== undefined) return b[c] }(); return a && { end: a } }() }) }(window.jQuery), !function (a) { var b = function (b, c) { this.options = c, this.$element = a(b).delegate('[data-dismiss="modal"]', "click.dismiss.modal", a.proxy(this.hide, this)), this.options.remote && this.$element.find(".modal-body").load(this.options.remote) }; b.prototype = { constructor: b, toggle: function () { return this[this.isShown ? "hide" : "show"]() }, show: function () { var b = this, c = a.Event("show"); this.$element.trigger(c); if (this.isShown || c.isDefaultPrevented()) return; this.isShown = !0, this.escape(), this.backdrop(function () { var c = a.support.transition && b.$element.hasClass("fade"); b.$element.parent().length || b.$element.appendTo(document.body), b.$element.show(), c && b.$element[0].offsetWidth, b.$element.addClass("in").attr("aria-hidden", !1), b.enforceFocus(), c ? b.$element.one(a.support.transition.end, function () { b.$element.focus().trigger("shown") }) : b.$element.focus().trigger("shown") }) }, hide: function (b) { b && b.preventDefault(); var c = this; b = a.Event("hide"), this.$element.trigger(b); if (!this.isShown || b.isDefaultPrevented()) return; this.isShown = !1, this.escape(), a(document).off("focusin.modal"), this.$element.removeClass("in").attr("aria-hidden", !0), a.support.transition && this.$element.hasClass("fade") ? this.hideWithTransition() : this.hideModal() }, enforceFocus: function () { var b = this; a(document).on("focusin.modal", function (a) { b.$element[0] !== a.target && !b.$element.has(a.target).length && b.$element.focus() }) }, escape: function () { var a = this; this.isShown && this.options.keyboard ? this.$element.on("keyup.dismiss.modal", function (b) { b.which == 27 && a.hide() }) : this.isShown || this.$element.off("keyup.dismiss.modal") }, hideWithTransition: function () { var b = this, c = setTimeout(function () { b.$element.off(a.support.transition.end), b.hideModal() }, 500); this.$element.one(a.support.transition.end, function () { clearTimeout(c), b.hideModal() }) }, hideModal: function () { var a = this; this.$element.hide(), this.backdrop(function () { a.removeBackdrop(), a.$element.trigger("hidden") }) }, removeBackdrop: function () { this.$backdrop && this.$backdrop.remove(), this.$backdrop = null }, backdrop: function (b) { var c = this, d = this.$element.hasClass("fade") ? "fade" : ""; if (this.isShown && this.options.backdrop) { var e = a.support.transition && d; this.$backdrop = a('<div class="modal-backdrop ' + d + '" />').appendTo(document.body), this.$backdrop.click(this.options.backdrop == "static" ? a.proxy(this.$element[0].focus, this.$element[0]) : a.proxy(this.hide, this)), e && this.$backdrop[0].offsetWidth, this.$backdrop.addClass("in"); if (!b) return; e ? this.$backdrop.one(a.support.transition.end, b) : b() } else !this.isShown && this.$backdrop ? (this.$backdrop.removeClass("in"), a.support.transition && this.$element.hasClass("fade") ? this.$backdrop.one(a.support.transition.end, b) : b()) : b && b() } }; var c = a.fn.modal; a.fn.modal = function (c) { return this.each(function () { var d = a(this), e = d.data("modal"), f = a.extend({}, a.fn.modal.defaults, d.data(), typeof c == "object" && c); e || d.data("modal", e = new b(this, f)), typeof c == "string" ? e[c]() : f.show && e.show() }) }, a.fn.modal.defaults = { backdrop: !0, keyboard: !0, show: !0 }, a.fn.modal.Constructor = b, a.fn.modal.noConflict = function () { return a.fn.modal = c, this }, a(document).on("click.modal.data-api", '[data-toggle="modal"]', function (b) { var c = a(this), d = c.attr("href"), e = a(c.attr("data-target") || d && d.replace(/.*(?=#[^\s]+$)/, "")), f = e.data("modal") ? "toggle" : a.extend({ remote: !/#/.test(d) && d }, e.data(), c.data()); b.preventDefault(), e.modal(f).one("hide", function () { c.focus() }) }) }(window.jQuery), !function (a) { function d() { a(".dropdown-backdrop").remove(), a(b).each(function () { e(a(this)).removeClass("open") }) } function e(b) { var c = b.attr("data-target"), d; c || (c = b.attr("href"), c = c && /#/.test(c) && c.replace(/.*(?=#[^\s]*$)/, "")), d = c && a(c); if (!d || !d.length) d = b.parent(); return d } var b = "[data-toggle=dropdown]", c = function (b) { var c = a(b).on("click.dropdown.data-api", this.toggle); a("html").on("click.dropdown.data-api", function () { c.parent().removeClass("open") }) }; c.prototype = { constructor: c, toggle: function (b) { var c = a(this), f, g; if (c.is(".disabled, :disabled")) return; return f = e(c), g = f.hasClass("open"), d(), g || ("ontouchstart" in document.documentElement && a('<div class="dropdown-backdrop"/>').insertBefore(a(this)).on("click", d), f.toggleClass("open")), c.focus(), !1 }, keydown: function (c) { var d, f, g, h, i, j; if (!/(38|40|27)/.test(c.keyCode)) return; d = a(this), c.preventDefault(), c.stopPropagation(); if (d.is(".disabled, :disabled")) return; h = e(d), i = h.hasClass("open"); if (!i || i && c.keyCode == 27) return c.which == 27 && h.find(b).focus(), d.click(); f = a("[role=menu] li:not(.divider):visible a", h); if (!f.length) return; j = f.index(f.filter(":focus")), c.keyCode == 38 && j > 0 && j-- , c.keyCode == 40 && j < f.length - 1 && j++ , ~j || (j = 0), f.eq(j).focus() } }; var f = a.fn.dropdown; a.fn.dropdown = function (b) { return this.each(function () { var d = a(this), e = d.data("dropdown"); e || d.data("dropdown", e = new c(this)), typeof b == "string" && e[b].call(d) }) }, a.fn.dropdown.Constructor = c, a.fn.dropdown.noConflict = function () { return a.fn.dropdown = f, this }, a(document).on("click.dropdown.data-api", d).on("click.dropdown.data-api", ".dropdown form", function (a) { a.stopPropagation() }).on("click.dropdown.data-api", b, c.prototype.toggle).on("keydown.dropdown.data-api", b + ", [role=menu]", c.prototype.keydown) }(window.jQuery), !function (a) { function b(b, c) { var d = a.proxy(this.process, this), e = a(b).is("body") ? a(window) : a(b), f; this.options = a.extend({}, a.fn.scrollspy.defaults, c), this.$scrollElement = e.on("scroll.scroll-spy.data-api", d), this.selector = (this.options.target || (f = a(b).attr("href")) && f.replace(/.*(?=#[^\s]+$)/, "") || "") + " .nav li > a", this.$body = a("body"), this.refresh(), this.process() } b.prototype = { constructor: b, refresh: function () { var b = this, c; this.offsets = a([]), this.targets = a([]), c = this.$body.find(this.selector).map(function () { var c = a(this), d = c.data("target") || c.attr("href"), e = /^#\w/.test(d) && a(d); return e && e.length && [[e.position().top + (!a.isWindow(b.$scrollElement.get(0)) && b.$scrollElement.scrollTop()), d]] || null }).sort(function (a, b) { return a[0] - b[0] }).each(function () { b.offsets.push(this[0]), b.targets.push(this[1]) }) }, process: function () { var a = this.$scrollElement.scrollTop() + this.options.offset, b = this.$scrollElement[0].scrollHeight || this.$body[0].scrollHeight, c = b - this.$scrollElement.height(), d = this.offsets, e = this.targets, f = this.activeTarget, g; if (a >= c) return f != (g = e.last()[0]) && this.activate(g); for (g = d.length; g--;)f != e[g] && a >= d[g] && (!d[g + 1] || a <= d[g + 1]) && this.activate(e[g]) }, activate: function (b) { var c, d; this.activeTarget = b, a(this.selector).parent(".active").removeClass("active"), d = this.selector + '[data-target="' + b + '"],' + this.selector + '[href="' + b + '"]', c = a(d).parent("li").addClass("active"), c.parent(".dropdown-menu").length && (c = c.closest("li.dropdown").addClass("active")), c.trigger("activate") } }; var c = a.fn.scrollspy; a.fn.scrollspy = function (c) { return this.each(function () { var d = a(this), e = d.data("scrollspy"), f = typeof c == "object" && c; e || d.data("scrollspy", e = new b(this, f)), typeof c == "string" && e[c]() }) }, a.fn.scrollspy.Constructor = b, a.fn.scrollspy.defaults = { offset: 10 }, a.fn.scrollspy.noConflict = function () { return a.fn.scrollspy = c, this }, a(window).on("load", function () { a('[data-spy="scroll"]').each(function () { var b = a(this); b.scrollspy(b.data()) }) }) }(window.jQuery), !function (a) { var b = function (b) { this.element = a(b) }; b.prototype = { constructor: b, show: function () { var b = this.element, c = b.closest("ul:not(.dropdown-menu)"), d = b.attr("data-target"), e, f, g; d || (d = b.attr("href"), d = d && d.replace(/.*(?=#[^\s]*$)/, "")); if (b.parent("li").hasClass("active")) return; e = c.find(".active:last a")[0], g = a.Event("show", { relatedTarget: e }), b.trigger(g); if (g.isDefaultPrevented()) return; f = a(d), this.activate(b.parent("li"), c), this.activate(f, f.parent(), function () { b.trigger({ type: "shown", relatedTarget: e }) }) }, activate: function (b, c, d) { function g() { e.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"), b.addClass("active"), f ? (b[0].offsetWidth, b.addClass("in")) : b.removeClass("fade"), b.parent(".dropdown-menu") && b.closest("li.dropdown").addClass("active"), d && d() } var e = c.find("> .active"), f = d && a.support.transition && e.hasClass("fade"); f ? e.one(a.support.transition.end, g) : g(), e.removeClass("in") } }; var c = a.fn.tab; a.fn.tab = function (c) { return this.each(function () { var d = a(this), e = d.data("tab"); e || d.data("tab", e = new b(this)), typeof c == "string" && e[c]() }) }, a.fn.tab.Constructor = b, a.fn.tab.noConflict = function () { return a.fn.tab = c, this }, a(document).on("click.tab.data-api", '[data-toggle="tab"], [data-toggle="pill"]', function (b) { b.preventDefault(), a(this).tab("show") }) }(window.jQuery), !function (a) { var b = function (a, b) { this.init("tooltip", a, b) }; b.prototype = { constructor: b, init: function (b, c, d) { var e, f, g, h, i; this.type = b, this.$element = a(c), this.options = this.getOptions(d), this.enabled = !0, g = this.options.trigger.split(" "); for (i = g.length; i--;)h = g[i], h == "click" ? this.$element.on("click." + this.type, this.options.selector, a.proxy(this.toggle, this)) : h != "manual" && (e = h == "hover" ? "mouseenter" : "focus", f = h == "hover" ? "mouseleave" : "blur", this.$element.on(e + "." + this.type, this.options.selector, a.proxy(this.enter, this)), this.$element.on(f + "." + this.type, this.options.selector, a.proxy(this.leave, this))); this.options.selector ? this._options = a.extend({}, this.options, { trigger: "manual", selector: "" }) : this.fixTitle() }, getOptions: function (b) { return b = a.extend({}, a.fn[this.type].defaults, this.$element.data(), b), b.delay && typeof b.delay == "number" && (b.delay = { show: b.delay, hide: b.delay }), b }, enter: function (b) { var c = a.fn[this.type].defaults, d = {}, e; this._options && a.each(this._options, function (a, b) { c[a] != b && (d[a] = b) }, this), e = a(b.currentTarget)[this.type](d).data(this.type); if (!e.options.delay || !e.options.delay.show) return e.show(); clearTimeout(this.timeout), e.hoverState = "in", this.timeout = setTimeout(function () { e.hoverState == "in" && e.show() }, e.options.delay.show) }, leave: function (b) { var c = a(b.currentTarget)[this.type](this._options).data(this.type); this.timeout && clearTimeout(this.timeout); if (!c.options.delay || !c.options.delay.hide) return c.hide(); c.hoverState = "out", this.timeout = setTimeout(function () { c.hoverState == "out" && c.hide() }, c.options.delay.hide) }, show: function () { var b, c, d, e, f, g, h = a.Event("show"); if (this.hasContent() && this.enabled) { this.$element.trigger(h); if (h.isDefaultPrevented()) return; b = this.tip(), this.setContent(), this.options.animation && b.addClass("fade"), f = typeof this.options.placement == "function" ? this.options.placement.call(this, b[0], this.$element[0]) : this.options.placement, b.detach().css({ top: 0, left: 0, display: "block" }), this.options.container ? b.appendTo(this.options.container) : b.insertAfter(this.$element), c = this.getPosition(), d = b[0].offsetWidth, e = b[0].offsetHeight; switch (f) { case "bottom": g = { top: c.top + c.height, left: c.left + c.width / 2 - d / 2 }; break; case "top": g = { top: c.top - e, left: c.left + c.width / 2 - d / 2 }; break; case "left": g = { top: c.top + c.height / 2 - e / 2, left: c.left - d }; break; case "right": g = { top: c.top + c.height / 2 - e / 2, left: c.left + c.width } }this.applyPlacement(g, f), this.$element.trigger("shown") } }, applyPlacement: function (a, b) { var c = this.tip(), d = c[0].offsetWidth, e = c[0].offsetHeight, f, g, h, i; c.offset(a).addClass(b).addClass("in"), f = c[0].offsetWidth, g = c[0].offsetHeight, b == "top" && g != e && (a.top = a.top + e - g, i = !0), b == "bottom" || b == "top" ? (h = 0, a.left < 0 && (h = a.left * -2, a.left = 0, c.offset(a), f = c[0].offsetWidth, g = c[0].offsetHeight), this.replaceArrow(h - d + f, f, "left")) : this.replaceArrow(g - e, g, "top"), i && c.offset(a) }, replaceArrow: function (a, b, c) { this.arrow().css(c, a ? 50 * (1 - a / b) + "%" : "") }, setContent: function () { var a = this.tip(), b = this.getTitle(); a.find(".tooltip-inner")[this.options.html ? "html" : "text"](b), a.removeClass("fade in top bottom left right") }, hide: function () { function e() { var b = setTimeout(function () { c.off(a.support.transition.end).detach() }, 500); c.one(a.support.transition.end, function () { clearTimeout(b), c.detach() }) } var b = this, c = this.tip(), d = a.Event("hide"); this.$element.trigger(d); if (d.isDefaultPrevented()) return; return c.removeClass("in"), a.support.transition && this.$tip.hasClass("fade") ? e() : c.detach(), this.$element.trigger("hidden"), this }, fixTitle: function () { var a = this.$element; (a.attr("title") || typeof a.attr("data-original-title") != "string") && a.attr("data-original-title", a.attr("title") || "").attr("title", "") }, hasContent: function () { return this.getTitle() }, getPosition: function () { var b = this.$element[0]; return a.extend({}, typeof b.getBoundingClientRect == "function" ? b.getBoundingClientRect() : { width: b.offsetWidth, height: b.offsetHeight }, this.$element.offset()) }, getTitle: function () { var a, b = this.$element, c = this.options; return a = b.attr("data-original-title") || (typeof c.title == "function" ? c.title.call(b[0]) : c.title), a }, tip: function () { return this.$tip = this.$tip || a(this.options.template) }, arrow: function () { return this.$arrow = this.$arrow || this.tip().find(".tooltip-arrow") }, validate: function () { this.$element[0].parentNode || (this.hide(), this.$element = null, this.options = null) }, enable: function () { this.enabled = !0 }, disable: function () { this.enabled = !1 }, toggleEnabled: function () { this.enabled = !this.enabled }, toggle: function (b) { var c = b ? a(b.currentTarget)[this.type](this._options).data(this.type) : this; c.tip().hasClass("in") ? c.hide() : c.show() }, destroy: function () { this.hide().$element.off("." + this.type).removeData(this.type) } }; var c = a.fn.tooltip; a.fn.tooltip = function (c) { return this.each(function () { var d = a(this), e = d.data("tooltip"), f = typeof c == "object" && c; e || d.data("tooltip", e = new b(this, f)), typeof c == "string" && e[c]() }) }, a.fn.tooltip.Constructor = b, a.fn.tooltip.defaults = { animation: !0, placement: "top", selector: !1, template: '<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>', trigger: "hover focus", title: "", delay: 0, html: !1, container: !1 }, a.fn.tooltip.noConflict = function () { return a.fn.tooltip = c, this } }(window.jQuery), !function (a) { var b = function (a, b) { this.init("popover", a, b) }; b.prototype = a.extend({}, a.fn.tooltip.Constructor.prototype, { constructor: b, setContent: function () { var a = this.tip(), b = this.getTitle(), c = this.getContent(); a.find(".popover-title")[this.options.html ? "html" : "text"](b), a.find(".popover-content")[this.options.html ? "html" : "text"](c), a.removeClass("fade top bottom left right in") }, hasContent: function () { return this.getTitle() || this.getContent() }, getContent: function () { var a, b = this.$element, c = this.options; return a = (typeof c.content == "function" ? c.content.call(b[0]) : c.content) || b.attr("data-content"), a }, tip: function () { return this.$tip || (this.$tip = a(this.options.template)), this.$tip }, destroy: function () { this.hide().$element.off("." + this.type).removeData(this.type) } }); var c = a.fn.popover; a.fn.popover = function (c) { return this.each(function () { var d = a(this), e = d.data("popover"), f = typeof c == "object" && c; e || d.data("popover", e = new b(this, f)), typeof c == "string" && e[c]() }) }, a.fn.popover.Constructor = b, a.fn.popover.defaults = a.extend({}, a.fn.tooltip.defaults, { placement: "right", trigger: "click", content: "", template: '<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>' }), a.fn.popover.noConflict = function () { return a.fn.popover = c, this } }(window.jQuery), !function (a) { var b = function (b, c) { this.options = a.extend({}, a.fn.affix.defaults, c), this.$window = a(window).on("scroll.affix.data-api", a.proxy(this.checkPosition, this)).on("click.affix.data-api", a.proxy(function () { setTimeout(a.proxy(this.checkPosition, this), 1) }, this)), this.$element = a(b), this.checkPosition() }; b.prototype.checkPosition = function () { if (!this.$element.is(":visible")) return; var b = a(document).height(), c = this.$window.scrollTop(), d = this.$element.offset(), e = this.options.offset, f = e.bottom, g = e.top, h = "affix affix-top affix-bottom", i; typeof e != "object" && (f = g = e), typeof g == "function" && (g = e.top()), typeof f == "function" && (f = e.bottom()), i = this.unpin != null && c + this.unpin <= d.top ? !1 : f != null && d.top + this.$element.height() >= b - f ? "bottom" : g != null && c <= g ? "top" : !1; if (this.affixed === i) return; this.affixed = i, this.unpin = i == "bottom" ? d.top - c : null, this.$element.removeClass(h).addClass("affix" + (i ? "-" + i : "")) }; var c = a.fn.affix; a.fn.affix = function (c) { return this.each(function () { var d = a(this), e = d.data("affix"), f = typeof c == "object" && c; e || d.data("affix", e = new b(this, f)), typeof c == "string" && e[c]() }) }, a.fn.affix.Constructor = b, a.fn.affix.defaults = { offset: 0 }, a.fn.affix.noConflict = function () { return a.fn.affix = c, this }, a(window).on("load", function () { a('[data-spy="affix"]').each(function () { var b = a(this), c = b.data(); c.offset = c.offset || {}, c.offsetBottom && (c.offset.bottom = c.offsetBottom), c.offsetTop && (c.offset.top = c.offsetTop), b.affix(c) }) }) }(window.jQuery), !function (a) { var b = '[data-dismiss="alert"]', c = function (c) { a(c).on("click", b, this.close) }; c.prototype.close = function (b) { function f() { e.trigger("closed").remove() } var c = a(this), d = c.attr("data-target"), e; d || (d = c.attr("href"), d = d && d.replace(/.*(?=#[^\s]*$)/, "")), e = a(d), b && b.preventDefault(), e.length || (e = c.hasClass("alert") ? c : c.parent()), e.trigger(b = a.Event("close")); if (b.isDefaultPrevented()) return; e.removeClass("in"), a.support.transition && e.hasClass("fade") ? e.on(a.support.transition.end, f) : f() }; var d = a.fn.alert; a.fn.alert = function (b) { return this.each(function () { var d = a(this), e = d.data("alert"); e || d.data("alert", e = new c(this)), typeof b == "string" && e[b].call(d) }) }, a.fn.alert.Constructor = c, a.fn.alert.noConflict = function () { return a.fn.alert = d, this }, a(document).on("click.alert.data-api", b, c.prototype.close) }(window.jQuery), !function (a) { var b = function (b, c) { this.$element = a(b), this.options = a.extend({}, a.fn.button.defaults, c) }; b.prototype.setState = function (a) { var b = "disabled", c = this.$element, d = c.data(), e = c.is("input") ? "val" : "html"; a += "Text", d.resetText || c.data("resetText", c[e]()), c[e](d[a] || this.options[a]), setTimeout(function () { a == "loadingText" ? c.addClass(b).attr(b, b) : c.removeClass(b).removeAttr(b) }, 0) }, b.prototype.toggle = function () { var a = this.$element.closest('[data-toggle="buttons-radio"]'); a && a.find(".active").removeClass("active"), this.$element.toggleClass("active") }; var c = a.fn.button; a.fn.button = function (c) { return this.each(function () { var d = a(this), e = d.data("button"), f = typeof c == "object" && c; e || d.data("button", e = new b(this, f)), c == "toggle" ? e.toggle() : c && e.setState(c) }) }, a.fn.button.defaults = { loadingText: "loading..." }, a.fn.button.Constructor = b, a.fn.button.noConflict = function () { return a.fn.button = c, this }, a(document).on("click.button.data-api", "[data-toggle^=button]", function (b) { var c = a(b.target); c.hasClass("btn") || (c = c.closest(".btn")), c.button("toggle") }) }(window.jQuery), !function (a) { var b = function (b, c) { this.$element = a(b), this.options = a.extend({}, a.fn.collapse.defaults, c), this.options.parent && (this.$parent = a(this.options.parent)), this.options.toggle && this.toggle() }; b.prototype = { constructor: b, dimension: function () { var a = this.$element.hasClass("width"); return a ? "width" : "height" }, show: function () { var b, c, d, e; if (this.transitioning || this.$element.hasClass("in")) return; b = this.dimension(), c = a.camelCase(["scroll", b].join("-")), d = this.$parent && this.$parent.find("> .accordion-group > .in"); if (d && d.length) { e = d.data("collapse"); if (e && e.transitioning) return; d.collapse("hide"), e || d.data("collapse", null) } this.$element[b](0), this.transition("addClass", a.Event("show"), "shown"), a.support.transition && this.$element[b](this.$element[0][c]) }, hide: function () { var b; if (this.transitioning || !this.$element.hasClass("in")) return; b = this.dimension(), this.reset(this.$element[b]()), this.transition("removeClass", a.Event("hide"), "hidden"), this.$element[b](0) }, reset: function (a) { var b = this.dimension(); return this.$element.removeClass("collapse")[b](a || "auto")[0].offsetWidth, this.$element[a !== null ? "addClass" : "removeClass"]("collapse"), this }, transition: function (b, c, d) { var e = this, f = function () { c.type == "show" && e.reset(), e.transitioning = 0, e.$element.trigger(d) }; this.$element.trigger(c); if (c.isDefaultPrevented()) return; this.transitioning = 1, this.$element[b]("in"), a.support.transition && this.$element.hasClass("collapse") ? this.$element.one(a.support.transition.end, f) : f() }, toggle: function () { this[this.$element.hasClass("in") ? "hide" : "show"]() } }; var c = a.fn.collapse; a.fn.collapse = function (c) { return this.each(function () { var d = a(this), e = d.data("collapse"), f = a.extend({}, a.fn.collapse.defaults, d.data(), typeof c == "object" && c); e || d.data("collapse", e = new b(this, f)), typeof c == "string" && e[c]() }) }, a.fn.collapse.defaults = { toggle: !0 }, a.fn.collapse.Constructor = b, a.fn.collapse.noConflict = function () { return a.fn.collapse = c, this }, a(document).on("click.collapse.data-api", "[data-toggle=collapse]", function (b) { var c = a(this), d, e = c.attr("data-target") || b.preventDefault() || (d = c.attr("href")) && d.replace(/.*(?=#[^\s]+$)/, ""), f = a(e).data("collapse") ? "toggle" : c.data(); c[a(e).hasClass("in") ? "addClass" : "removeClass"]("collapsed"), a(e).collapse(f) }) }(window.jQuery), !function (a) { var b = function (b, c) { this.$element = a(b), this.$indicators = this.$element.find(".carousel-indicators"), this.options = c, this.options.pause == "hover" && this.$element.on("mouseenter", a.proxy(this.pause, this)).on("mouseleave", a.proxy(this.cycle, this)) }; b.prototype = { cycle: function (b) { return b || (this.paused = !1), this.interval && clearInterval(this.interval), this.options.interval && !this.paused && (this.interval = setInterval(a.proxy(this.next, this), this.options.interval)), this }, getActiveIndex: function () { return this.$active = this.$element.find(".item.active"), this.$items = this.$active.parent().children(), this.$items.index(this.$active) }, to: function (b) { var c = this.getActiveIndex(), d = this; if (b > this.$items.length - 1 || b < 0) return; return this.sliding ? this.$element.one("slid", function () { d.to(b) }) : c == b ? this.pause().cycle() : this.slide(b > c ? "next" : "prev", a(this.$items[b])) }, pause: function (b) { return b || (this.paused = !0), this.$element.find(".next, .prev").length && a.support.transition.end && (this.$element.trigger(a.support.transition.end), this.cycle(!0)), clearInterval(this.interval), this.interval = null, this }, next: function () { if (this.sliding) return; return this.slide("next") }, prev: function () { if (this.sliding) return; return this.slide("prev") }, slide: function (b, c) { var d = this.$element.find(".item.active"), e = c || d[b](), f = this.interval, g = b == "next" ? "left" : "right", h = b == "next" ? "first" : "last", i = this, j; this.sliding = !0, f && this.pause(), e = e.length ? e : this.$element.find(".item")[h](), j = a.Event("slide", { relatedTarget: e[0], direction: g }); if (e.hasClass("active")) return; this.$indicators.length && (this.$indicators.find(".active").removeClass("active"), this.$element.one("slid", function () { var b = a(i.$indicators.children()[i.getActiveIndex()]); b && b.addClass("active") })); if (a.support.transition && this.$element.hasClass("slide")) { this.$element.trigger(j); if (j.isDefaultPrevented()) return; e.addClass(b), e[0].offsetWidth, d.addClass(g), e.addClass(g), this.$element.one(a.support.transition.end, function () { e.removeClass([b, g].join(" ")).addClass("active"), d.removeClass(["active", g].join(" ")), i.sliding = !1, setTimeout(function () { i.$element.trigger("slid") }, 0) }) } else { this.$element.trigger(j); if (j.isDefaultPrevented()) return; d.removeClass("active"), e.addClass("active"), this.sliding = !1, this.$element.trigger("slid") } return f && this.cycle(), this } }; var c = a.fn.carousel; a.fn.carousel = function (c) { return this.each(function () { var d = a(this), e = d.data("carousel"), f = a.extend({}, a.fn.carousel.defaults, typeof c == "object" && c), g = typeof c == "string" ? c : f.slide; e || d.data("carousel", e = new b(this, f)), typeof c == "number" ? e.to(c) : g ? e[g]() : f.interval && e.pause().cycle() }) }, a.fn.carousel.defaults = { interval: 5e3, pause: "hover" }, a.fn.carousel.Constructor = b, a.fn.carousel.noConflict = function () { return a.fn.carousel = c, this }, a(document).on("click.carousel.data-api", "[data-slide], [data-slide-to]", function (b) { var c = a(this), d, e = a(c.attr("data-target") || (d = c.attr("href")) && d.replace(/.*(?=#[^\s]+$)/, "")), f = a.extend({}, e.data(), c.data()), g; e.carousel(f), (g = c.attr("data-slide-to")) && e.data("carousel").pause().to(g).cycle(), b.preventDefault() }) }(window.jQuery), !function (a) { var b = function (b, c) { this.$element = a(b), this.options = a.extend({}, a.fn.typeahead.defaults, c), this.matcher = this.options.matcher || this.matcher, this.sorter = this.options.sorter || this.sorter, this.highlighter = this.options.highlighter || this.highlighter, this.updater = this.options.updater || this.updater, this.source = this.options.source, this.$menu = a(this.options.menu), this.shown = !1, this.listen() }; b.prototype = { constructor: b, select: function () { var a = this.$menu.find(".active").attr("data-value"); return this.$element.val(this.updater(a)).change(), this.hide() }, updater: function (a) { return a }, show: function () { var b = a.extend({}, this.$element.position(), { height: this.$element[0].offsetHeight }); return this.$menu.insertAfter(this.$element).css({ top: b.top + b.height, left: b.left }).show(), this.shown = !0, this }, hide: function () { return this.$menu.hide(), this.shown = !1, this }, lookup: function (b) { var c; return this.query = this.$element.val(), !this.query || this.query.length < this.options.minLength ? this.shown ? this.hide() : this : (c = a.isFunction(this.source) ? this.source(this.query, a.proxy(this.process, this)) : this.source, c ? this.process(c) : this) }, process: function (b) { var c = this; return b = a.grep(b, function (a) { return c.matcher(a) }), b = this.sorter(b), b.length ? this.render(b.slice(0, this.options.items)).show() : this.shown ? this.hide() : this }, matcher: function (a) { return ~a.toLowerCase().indexOf(this.query.toLowerCase()) }, sorter: function (a) { var b = [], c = [], d = [], e; while (e = a.shift()) e.toLowerCase().indexOf(this.query.toLowerCase()) ? ~e.indexOf(this.query) ? c.push(e) : d.push(e) : b.push(e); return b.concat(c, d) }, highlighter: function (a) { var b = this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, "\\$&"); return a.replace(new RegExp("(" + b + ")", "ig"), function (a, b) { return "<strong>" + b + "</strong>" }) }, render: function (b) { var c = this; return b = a(b).map(function (b, d) { return b = a(c.options.item).attr("data-value", d), b.find("a").html(c.highlighter(d)), b[0] }), b.first().addClass("active"), this.$menu.html(b), this }, next: function (b) { var c = this.$menu.find(".active").removeClass("active"), d = c.next(); d.length || (d = a(this.$menu.find("li")[0])), d.addClass("active") }, prev: function (a) { var b = this.$menu.find(".active").removeClass("active"), c = b.prev(); c.length || (c = this.$menu.find("li").last()), c.addClass("active") }, listen: function () { this.$element.on("focus", a.proxy(this.focus, this)).on("blur", a.proxy(this.blur, this)).on("keypress", a.proxy(this.keypress, this)).on("keyup", a.proxy(this.keyup, this)), this.eventSupported("keydown") && this.$element.on("keydown", a.proxy(this.keydown, this)), this.$menu.on("click", a.proxy(this.click, this)).on("mouseenter", "li", a.proxy(this.mouseenter, this)).on("mouseleave", "li", a.proxy(this.mouseleave, this)) }, eventSupported: function (a) { var b = a in this.$element; return b || (this.$element.setAttribute(a, "return;"), b = typeof this.$element[a] == "function"), b }, move: function (a) { if (!this.shown) return; switch (a.keyCode) { case 9: case 13: case 27: a.preventDefault(); break; case 38: a.preventDefault(), this.prev(); break; case 40: a.preventDefault(), this.next() }a.stopPropagation() }, keydown: function (b) { this.suppressKeyPressRepeat = ~a.inArray(b.keyCode, [40, 38, 9, 13, 27]), this.move(b) }, keypress: function (a) { if (this.suppressKeyPressRepeat) return; this.move(a) }, keyup: function (a) { switch (a.keyCode) { case 40: case 38: case 16: case 17: case 18: break; case 9: case 13: if (!this.shown) return; this.select(); break; case 27: if (!this.shown) return; this.hide(); break; default: this.lookup() }a.stopPropagation(), a.preventDefault() }, focus: function (a) { this.focused = !0 }, blur: function (a) { this.focused = !1, !this.mousedover && this.shown && this.hide() }, click: function (a) { a.stopPropagation(), a.preventDefault(), this.select(), this.$element.focus() }, mouseenter: function (b) { this.mousedover = !0, this.$menu.find(".active").removeClass("active"), a(b.currentTarget).addClass("active") }, mouseleave: function (a) { this.mousedover = !1, !this.focused && this.shown && this.hide() } }; var c = a.fn.typeahead; a.fn.typeahead = function (c) { return this.each(function () { var d = a(this), e = d.data("typeahead"), f = typeof c == "object" && c; e || d.data("typeahead", e = new b(this, f)), typeof c == "string" && e[c]() }) }, a.fn.typeahead.defaults = { source: [], items: 8, menu: '<ul class="typeahead dropdown-menu"></ul>', item: '<li><a href="#"></a></li>', minLength: 1 }, a.fn.typeahead.Constructor = b, a.fn.typeahead.noConflict = function () { return a.fn.typeahead = c, this }, a(document).on("focus.typeahead.data-api", '[data-provide="typeahead"]', function (b) { var c = a(this); if (c.data("typeahead")) return; c.typeahead(c.data()) }) }(window.jQuery);
!function(){function a(a){return function(){return a}}function y(a){var b="Array"===a&&c.isArray||function(b,c){return(c||j.call(b))==="[object "+a+"]"};return o[a]=b}function z(a,b){function c(c){return M(c)?j.call(c)==="[object "+b+"]":typeof c===a}return o[b]=c}function A(a){a.SugarMethods||(F(a,"SugarMethods",{}),B(a,!1,!0,{extend:function(b,c,d){B(a,!1!==d,c,b)},sugarRestore:function(){return D(this,a,arguments,function(a,b,c){F(a,b,c.method)})},sugarRevert:function(){return D(this,a,arguments,function(a,b,c){c.existed?F(a,b,c.original):delete a[b]})}}))}function B(a,b,c,d){var e=b?a.prototype:a;A(a),P(d,function(d,f){var g=e[d],h=L(e,d);x(c)&&g&&(f=E(g,f,c)),!1===c&&g||F(e,d,f),a.SugarMethods[d]={method:f,existed:h,original:g,instance:b}})}function C(a,b,c,d,e){var f={};d=t(d)?d.split(","):d,d.forEach(function(a,b){e(f,a,b)}),B(a,b,c,f)}function D(a,b,c,d){var e=0===c.length,f=G(c),g=!1;return P(b.SugarMethods,function(b,c){(e||-1!==f.indexOf(b))&&(g=!0,d(c.instance?a.prototype:a,b,c))}),g}function E(a,b,c){return function(){return c.apply(this,arguments)?b.apply(this,arguments):a.apply(this,arguments)}}function F(a,c,d){l?b.defineProperty(a,c,{value:d,configurable:!0,enumerable:!1,writable:!0}):a[c]=d}function G(a,b,c){var e,d=[];for(c=c||0,e=a.length;e>c;c++)d.push(a[c]),b&&b.call(a,a[c],c);return d}function H(a,b,c){var d=a[c||0];u(d)&&(a=d,c=0),G(a,b,c)}function I(a){if(!a||!a.call)throw new TypeError("Callback is not callable")}function J(a){return void 0!==a}function K(a){return void 0===a}function L(a,b){return!!a&&k.call(a,b)}function M(a){return!!a&&("object"==typeof a||m&&w(a))}function N(a){var b=typeof a;return null==a||"string"===b||"number"===b||"boolean"===b}function O(a,b){b=b||j.call(a);try{if(a&&a.constructor&&!L(a,"constructor")&&!L(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}return!!a&&"[object Object]"===b&&"hasOwnProperty"in a}function P(a,b){for(var c in a)if(L(a,c)&&!1===b.call(a,c,a[c],a))break}function Q(a,b){for(var c=0;a>c;c++)b(c)}function R(a,b){return P(b,function(c){a[c]=b[c]}),a}function S(a){if(N(a)&&(a=b(a)),n&&t(a))for(var e,c=a,d=0;e=c.charAt(d);)c[d++]=e;return a}function T(a){R(this,S(a))}function _(a,b,c){var d=V(10,U(b||0));return c=c||Y,0>b&&(d=1/d),c(a*d)/d}function ib(){return"	\n\f\r   ᠎             \u2028\u2029　﻿"}function jb(a,b){var c="";for(a=a.toString();b>0;)1&b&&(c+=a),(b>>=1)&&(a+=a);return c}function kb(a,b){var c,d;return c=a.replace(hb,function(a){return a=gb[a],a===eb&&(d=!0),a}),d?parseFloat(c):parseInt(c,b||10)}function lb(a,b,c,d){return d=U(a).toString(d||10),d=jb("0",b-d.replace(/\.\d+/,"").length)+d,(c||0>a)&&(d=(0>a?"-":"+")+d),d}function mb(a){if(a>=11&&13>=a)return"th";switch(a%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}function nb(a,b){function c(a,c){(a||-1<b.indexOf(c))&&(d+=c)}var d="";return b=b||"",c(a.multiline,"m"),c(a.ignoreCase,"i"),c(a.global,"g"),c(a.u,"y"),d}function ob(a){return t(a)||(a=f(a)),a.replace(/([\\\/\'*+?|()\[\]{}.^$])/g,"\\$1")}function pb(a,b){return a["get"+(a._utc?"UTC":"")+b]()}function qb(a,b,c){return a["set"+(a._utc&&"ISOWeek"!=b?"UTC":"")+b](c)}function rb(a,c){var e,g,h,i,k,l,m,d=typeof a;if("string"===d)return a;if(h=j.call(a),e=O(a,h),g=u(a,h),null!=a&&e||g){if(c||(c=[]),1<c.length)for(l=c.length;l--;)if(c[l]===a)return"CYC";for(c.push(a),e=a.valueOf()+f(a.constructor),i=g?a:b.keys(a).sort(),l=0,m=i.length;m>l;l++)k=g?l:i[l],e+=k+rb(a[k],c);c.pop()}else e=-1/0===1/a?"-0":f(a&&a.valueOf?a.valueOf():a);return d+h+e}function sb(a,b){return a===b?0!==a||1/a===1/b:tb(a)&&tb(b)?rb(a)===rb(b):!1}function tb(a){var b=j.call(a);return p.test(b)||O(a,b)}function ub(a,b,c){var d,e=a.length,f=b.length,g=!1!==b[f-1];return f>(g?1:2)?(d=[],G(b,function(b){return r(b)?!1:(d.push(vb(a,e,b,g,c)),void 0)}),d):vb(a,e,b[0],g,c)}function vb(a,b,c,d,e){return d&&(c%=b,0>c&&(c=b+c)),e?a.charAt(c):a[c]}function wb(a,c){C(c,!0,!1,a,function(a,c){a[c+("equal"===c?"s":"")]=function(){return b[c].apply(null,[this].concat(G(arguments)))}})}function zb(a,b,c,d){var e=a.length,f=-1==d,g=f?e-1:0;for(c=isNaN(c)?g:parseInt(c>>0),0>c&&(c=e+c),(!f&&0>c||f&&c>=e)&&(c=g);f&&c>=0||!f&&e>c;){if(a[c]===b)return c;c+=d}return-1}function Ab(a,b,c,d){var e=a.length,f=0,g=J(c);if(I(b),0==e&&!g)throw new TypeError("Reduce called on empty array with no initial value");for(g||(c=a[d?e-1:f],f++);e>f;)g=d?e-f-1:f,g in a&&(c=b(c,a[g],g,a)),f++;return c}function Bb(a){if(0===a.length)throw new TypeError("First argument must be defined")}function Cb(a){return a=d(a),function(b){return a.test(b)}}function Db(a){var b=a.getTime();return function(a){return!(!a||!a.getTime)&&a.getTime()===b}}function Eb(a){return function(b,c,d){return b===a||a.call(this,b,c,d)}}function Fb(a){return function(b,c,d){return b===a||a.call(d,c,b,d)}}function Gb(a,b){var c={};return function(d,e,f){var g;if(!M(d))return!1;for(g in a)if(c[g]=c[g]||Ib(a[g],b),!1===c[g].call(f,d[g],e,f))return!1;return!0}}function Hb(a){return function(b){return b===a||sb(b,a)}}function Ib(a,b){if(!N(a)){if(w(a))return Cb(a);if(v(a))return Db(a);if(x(a))return b?Fb(a):Eb(a);if(O(a))return Gb(a,b)}return Hb(a)}function Jb(a,b,c,d){return b?b.apply?b.apply(c,d||[]):x(a[b])?a[b].call(a):a[b]:a}function Kb(a,b,c,d){var e=+a.length;for(0>c&&(c=a.length+c),c=isNaN(c)?0:c,!0===d&&(e+=c);e>c;){if(d=c%a.length,!(d in a)){Lb(a,b,c);break}if(!1===b.call(a,a[d],d,a))break;c++}}function Lb(a,b,c){var e,d=[];for(e in a)e in a&&e>>>0==e&&4294967295!=e&&e>=c&&d.push(parseInt(e));d.sort().each(function(c){return b.call(a,a[c],c,a)})}function Mb(a,b,c,d,e,f){var g,h,i;return 0<a.length&&(i=Ib(b),Kb(a,function(b,c){return i.call(f,b,c,a)?(g=b,h=c,!1):void 0},c,d)),e?h:g}function Nb(a,b){var e,c=[],d={};return Kb(a,function(f,g){e=b?Jb(f,b,a,[f,g,a]):f,Sb(d,e)||c.push(f)}),c}function Ob(a,b,c){var d=[],e={};return b.each(function(a){Sb(e,a)}),a.each(function(a){var g,b=rb(a),f=!tb(a);if(Rb(e,b,a,f)!==c){if(g=0,f)for(b=e[b];g<b.length;)b[g]===a?b.splice(g,1):g+=1;else delete e[b];d.push(a)}}),d}function Pb(a,b,c){b=b||1/0,c=c||0;var d=[];return Kb(a,function(a){u(a)&&b>c?d=d.concat(Pb(a,b,c+1)):d.push(a)}),d}function Qb(a){var b=[];return G(a,function(a){b=b.concat(a)}),b}function Rb(a,b,c,d){var e=b in a;return d&&(a[b]||(a[b]=[]),e=-1!==a[b].indexOf(c)),e}function Sb(a,b){var c=rb(b),d=!tb(b),e=Rb(a,c,b,d);return d?a[c].push(b):a[c]=b,e}function Tb(a,b,d,e){var f,g,h,i=[],j="max"===d,k="min"===d,l=c.isArray(a);for(f in a)if(a.hasOwnProperty(f)){if(d=a[f],h=Jb(d,b,a,l?[d,parseInt(f),a]:[]),K(h))throw new TypeError("Cannot compare with undefined");h===g?i.push(d):(K(g)||j&&h>g||k&&g>h)&&(i=[d],g=h)}return l||(i=Pb(i,1)),e?i:i[0]}function Ub(a,b){var f,g,h=0,i=0,d=c[Xb],e=c[Yb],j=c[Zb],k=c[Wb],l=c[$b];a=Vb(a,d,e),b=Vb(b,d,e);do d=a.charAt(h),f=j[d]||d,d=b.charAt(h),g=j[d]||d,d=f?k.indexOf(f):null,e=g?k.indexOf(g):null,-1===d||-1===e?(d=a.charCodeAt(h)||null,e=b.charCodeAt(h)||null,l&&(d>=ab&&bb>=d||d>=cb&&db>=d)&&(e>=ab&&bb>=e||e>=cb&&db>=e)&&(d=kb(a.slice(h)),e=kb(b.slice(h)))):(f=f!==a.charAt(h),g=g!==b.charAt(h),f!==g&&0===i&&(i=f-g)),h+=1;while(null!=d&&null!=e&&d===e);return d===e?i:d-e}function Vb(a,b,c){return t(a)||(a=f(a)),c&&(a=a.toLowerCase()),b&&(a=a.replace(b,"")),a}function _b(a,d){C(b,!1,!0,a,function(a,e){a[e]=function(a,f,g){var i,h=b.keys(S(a));return d||(i=Ib(f,!0)),g=c.prototype[e].call(h,function(b){var c=a[b];return d?Jb(c,f,a,[b,c,a]):i(c,b,a)},g),u(g)&&(g=g.reduce(function(b,c){return b[c]=a[c],b},{})),g}}),wb(a,T)}function rc(a){R(this,a),this.g=mc.concat()}function sc(a,b,c){var d,e,f=b[0],g=b[1],h=b[2];return b=a[c]||a.relative,x(b)?b.call(a,f,g,h,c):(e=a.units[8*(a.plural&&f>1?1:0)+g]||a.units[g],a.capitalizeUnit&&(e=zc(e)),d=a.modifiers.filter(function(a){return"sign"==a.name&&a.value==(h>0?1:-1)})[0],b.replace(/\{(.*?)\}/g,function(a,b){switch(b){case"num":return f;case"unit":return e;case"sign":return d.src}}))}function tc(a,b){return b=b||a.code,"en"===b||"en-US"===b?!0:a.variant}function uc(a,b){return b.replace(d(a.num,"g"),function(b){return vc(a,b)||""})}function vc(a,b){var c;return s(b)?b:b&&-1!==(c=a.numbers.indexOf(b))?(c+1)%10:1}function wc(a,b){var c;if(t(a)||(a=""),c=qc[a]||qc[a.slice(0,2)],!1===b&&!c)throw new TypeError("Invalid locale.");return c||fc}function xc(a,b){function c(a){var b=h[a];t(b)?h[a]=b.split(","):b||(h[a]=[])}function d(a,b){a=a.split("+").map(function(a){return a.replace(/(.+):(.+)$/,function(a,b,c){return c.split("|").map(function(a){return b+a}).join("|")})}).join("|"),a.split("|").forEach(b)}function e(a,b,c){var e=[];h[a].forEach(function(a,f){b&&(a+="+"+a.slice(0,3)),d(a,function(a,b){e[b*c+f]=a.toLowerCase()})}),h[a]=e}function f(a,b,c){return a="\\d{"+a+","+b+"}",c&&(a+="|(?:"+Ac(h.numbers)+")+"),a}function g(a,b){h[a]=h[a]||b}var h,i;return h=new rc(b),c("modifiers"),"months weekdays units numbers articles tokens timeMarker ampm timeSuffixes dateParse timeParse".split(" ").forEach(c),i=!h.monthSuffix,e("months",i,12),e("weekdays",i,7),e("units",!1,8),e("numbers",!1,10),g("code",a),g("date",f(1,2,h.digitDate)),g("year","'\\d{2}|"+f(4,4)),g("num",function(){var a=["-?\\d+"].concat(h.articles);return h.numbers&&(a=a.concat(h.numbers)),Ac(a)}()),function(){var a=[];h.i={},h.modifiers.push({name:"day",src:"yesterday",value:-1}),h.modifiers.push({name:"day",src:"today",value:0}),h.modifiers.push({name:"day",src:"tomorrow",value:1}),h.modifiers.forEach(function(b){var c=b.name;d(b.src,function(d){var e=h[c];h.i[d]=b,a.push({name:c,src:d,value:b.value}),h[c]=e?e+"|"+d:d})}),h.day+="|"+Ac(h.weekdays),h.modifiers=a}(),h.monthSuffix&&(h.month=f(1,2),h.months="1 2 3 4 5 6 7 8 9 10 11 12".split(" ").map(function(a){return a+h.monthSuffix})),h.full_month=f(1,2)+"|"+Ac(h.months),0<h.timeSuffixes.length&&h.addFormat(Tc(h),!1,gc),h.addFormat("{day}",!0),h.addFormat("{month}"+(h.monthSuffix||"")),h.addFormat("{year}"+(h.yearSuffix||"")),h.timeParse.forEach(function(a){h.addFormat(a,!0)}),h.dateParse.forEach(function(a){h.addFormat(a)}),qc[a]=h}function yc(a,b,c,e){a.g.unshift({r:e,locale:a,q:d("^"+b+"$","i"),to:c})}function zc(a){return a.slice(0,1).toUpperCase()+a.slice(1)}function Ac(a){return a.filter(function(a){return!!a}).join("|")}function Bc(){var a=e.SugarNewDate;return a?a():new e}function Cc(a,b){var c;return M(a[0])?a:s(a[0])&&!s(a[1])?[a[0]]:t(a[0])&&b?[Dc(a[0]),a[1]]:(c={},kc.forEach(function(b,d){c[b.name]=a[d]}),[c])}function Dc(a){var b,c={};return(a=a.match(/^(\d+)?\s?(\w+?)s?$/i))&&(K(b)&&(b=parseInt(a[1])||1),c[a[2].toLowerCase()]=b),c}function Ec(a,b,c){var d;for(K(c)&&(c=lc.length),b=b||0;c>b&&(d=lc[b],!1!==a(d.name,d,b));b++);}function Fc(a,b){var d,e,c={};return b.forEach(function(b,f){d=a[f+1],K(d)||""===d||("year"===b&&(c.t=d.replace(/'/,"")),e=parseFloat(d.replace(/'/,"").replace(/,/,".")),c[b]=isNaN(e)?d.toLowerCase():e)}),c}function Gc(a){return a=a.trim().replace(/^just (?=now)|\.+$/i,""),Hc(a)}function Hc(a){return a.replace(jc,function(a,b,c){var f,g,d=0,e=1;return b?a:(c.split("").reverse().forEach(function(a){a=ic[a];var b=a>9;b?(f&&(d+=e),e*=a/(g||1),g=a):(!1===f&&(e*=10),d+=e*a),f=b}),f&&(d+=e),d)})}function Ic(a,b,c,d){function f(a){n.push(a)}function g(){n.forEach(function(a){a.call()})}function h(){var a=k.getWeekday();k.setWeekday(7*(p.num-1)+(a>u?u+7:u))}function i(){var a=o.i[p.edge];Ec(function(a){return J(p[a])?(q=a,!1):void 0},4),"year"===q?p.e="month":("month"===q||"week"===q)&&(p.e="day"),k[(0>a.value?"endOf":"beginningOf")+zc(q)](),-2===a.value&&k.reset()}function j(){var a;Ec(function(b,c,d){if("day"===b&&(b="date"),J(p[b])){if(d>=r)return k.setTime(0/0),!1;a=a||{},a[b]=p[b],delete p[b]}}),a&&f(function(){k.set(a,!0)})}var k,l,m,n,o,p,q,r,u,w,x;return k=Bc(),n=[],k.utc(d),v(a)?k.utc(a.isUTC()).setTime(a.getTime()):s(a)?k.setTime(a):M(a)?(k.set(a,!0),p=a):t(a)&&(m=wc(b),a=Gc(a),m&&P(m.o?[m.o].concat(m.g):m.g,function(c,d){var e=a.match(d.q);return e?(o=d.locale,p=Fc(e,d.to),o.o=d,p.utc&&k.utc(),p.timestamp?(p=p.timestamp,!1):(d.r&&!t(p.month)&&(t(p.date)||tc(m,b))&&(x=p.month,p.month=p.date,p.date=x),p.year&&2===p.t.length&&(p.year=100*Y(pb(Bc(),"FullYear")/100)-100*Y(p.year/100)+p.year),p.month&&(p.month=o.getMonth(p.month),p.shift&&!p.unit&&(p.unit=o.units[7])),p.weekday&&p.date?delete p.weekday:p.weekday&&(p.weekday=o.getWeekday(p.weekday),p.shift&&!p.unit&&(p.unit=o.units[5])),p.day&&(x=o.i[p.day])?(p.day=x.value,k.reset(),l=!0):p.day&&-1<(u=o.getWeekday(p.day))&&(delete p.day,p.num&&p.month?(f(h),p.day=1):p.weekday=u),p.date&&!s(p.date)&&(p.date=uc(o,p.date)),p.ampm&&p.ampm===o.ampm[1]&&12>p.hour?p.hour+=12:p.ampm===o.ampm[0]&&12===p.hour&&(p.hour=0),("offset_hours"in p||"offset_minutes"in p)&&(k.utc(),p.offset_minutes=p.offset_minutes||0,p.offset_minutes+=60*p.offset_hours,"-"===p.offset_sign&&(p.offset_minutes*=-1),p.minute-=p.offset_minutes),p.unit&&(l=!0,w=vc(o,p.num),r=o.units.indexOf(p.unit)%8,q=ec.units[r],j(),p.shift&&(w*=(x=o.i[p.shift])?x.value:0),p.sign&&(x=o.i[p.sign])&&(w*=x.value),J(p.weekday)&&(k.set({weekday:p.weekday},!0),delete p.weekday),p[q]=(p[q]||0)+w),p.edge&&f(i),"-"===p.year_sign&&(p.year*=-1),Ec(function(a,b,c){b=p[a];var d=b%1;d&&(p[lc[c-1].name]=Y(d*("second"===a?1e3:60)),p[a]=X(b))},1,4),!1)):void 0}),p?l?k.advance(p):(k._utc&&k.reset(),Sc(k,p,!0,!1,c)):("now"!==a&&(k=new e(a)),d&&k.addMinutes(-k.getTimezoneOffset())),g(),k.utc(!1)),{c:k,set:p}}function Jc(a){var b,c=U(a),d=c,e=0;return Ec(function(a,f,g){b=X(_(c/f.b(),1)),b>=1&&(d=b,e=g)},1),[d,e,a]}function Kc(a){var b=Jc(a.millisecondsFromNow());return(6===b[1]||5===b[1]&&4===b[0]&&a.daysFromNow()>=Bc().daysInMonth())&&(b[0]=U(a.monthsFromNow()),b[1]=6),b}function Lc(a,b,c){function d(a,c){var d=pb(a,"Month");return wc(c).months[d+12*b]}Mc(a,d,c),Mc(zc(a),d,c,1)}function Mc(a,b,c,d){oc[a]=function(a,e){var f=b(a,e);return c&&(f=f.slice(0,c)),d&&(f=f.slice(0,d).toUpperCase()+f.slice(d)),f}}function Nc(a,b,c){oc[a]=b,oc[a+a]=function(a,c){return lb(b(a,c),2)},c&&(oc[a+a+a]=function(a,c){return lb(b(a,c),3)},oc[a+a+a+a]=function(a,c){return lb(b(a,c),4)})}function Oc(a){var b=a.match(/(\{\w+\})|[^{}]+/g);nc[a]=b.map(function(a){return a.replace(/\{(\w+)\}/,function(b,c){return a=oc[c]||c,c}),a})}function Pc(a,b,c,d){var e,f,g;if(!a.isValid())return"Invalid Date";if(Date[b]?b=Date[b]:x(b)&&(e=Kc(a),b=b.apply(a,e.concat(wc(d)))),!b&&c)return e=e||Kc(a),0===e[1]&&(e[1]=1,e[0]=1),a=wc(d),sc(a,e,0<e[2]?"future":"past");for(b=b||"long",("short"===b||"long"===b||"full"===b)&&(b=wc(d)[b]),nc[b]||Oc(b),e="",b=nc[b],f=0,c=b.length;c>f;f++)g=b[f],e+=x(g)?g(a,d):g;return e}function Qc(a,b,c,d,e){var f,g,h,i=0,j=0,k=0;return f=Ic(b,c,null,e),d>0&&(j=k=d,g=!0),f.c.isValid()?(f.set&&f.set.e&&(pc.forEach(function(b){b.name===f.set.e&&(i=b.b(f.c,a-f.c)-1)}),b=zc(f.set.e),(f.set.edge||f.set.shift)&&f.c["beginningOf"+b](),"month"===f.set.e&&(h=f.c.clone()["endOf"+b]().getTime()),!g&&f.set.sign&&"millisecond"!=f.set.e&&(j=50,k=-50)),g=a.getTime(),b=f.c.getTime(),h=Rc(a,b,h||b+i),g>=b-j&&h+k>=g):!1}function Rc(a,b,c){return b=new e(b),a=new e(c).utc(a.isUTC()),23!==pb(a,"Hours")&&(b=b.getTimezoneOffset(),a=a.getTimezoneOffset(),b!==a&&(c+=(a-b).minutes())),c}function Sc(a,b,c,d,e){function f(a){return J(b[a])?b[a]:b[a+"s"]}function g(a){return J(f(a))}var h,i;if(s(b)&&d)b={milliseconds:b};else if(s(b))return a.setTime(b),a;J(b.date)&&(b.day=b.date),Ec(function(d,e,f){var i="day"===d;return g(d)||i&&g("weekday")?(b.e=d,h=+f,!1):(!c||"week"===d||i&&g("week")||qb(a,e.method,i?1:0),void 0)}),pc.forEach(function(c){var h,e=c.name;c=c.method,h=f(e),K(h)||(d?("week"===e&&(h=(b.day||0)+7*h,c="Date"),h=h*d+pb(a,c)):"month"===e&&g("day")&&qb(a,"Date",15),qb(a,c,h),d&&"month"===e&&(e=h,0>e&&(e=e%12+12),e%12!=pb(a,"Month")&&qb(a,"Date",0)))}),d||g("day")||!g("weekday")||a.setWeekday(f("weekday"));a:{switch(e){case-1:i=a>Bc();break a;case 1:i=a<Bc();break a}i=void 0}return i&&Ec(function(b,c){return!(c.k||"week"===b&&g("weekday"))||g(b)||"day"===b&&g("weekday")?void 0:(a[c.j](e),!1)},h+1),a}function Tc(a,b){var e,c=hc,d={h:0,m:1,s:2};return a=a||ec,c.replace(/{([a-z])}/g,function(c,f){var g=[],h="h"===f,i=h&&!b;return"t"===f?a.ampm.join("|"):(h&&g.push(":"),(e=a.timeSuffixes[d[f]])&&g.push(e+"\\s*"),0===g.length?"":"(?:"+g.join("|")+")"+(i?"":"?"))})}function Uc(a,b,c){var d,e;return s(a[1])?d=Cc(a)[0]:(d=a[0],e=a[1]),Ic(d,e,b,c).c}function Vc(a,b){function c(){return Y(this*b)}function d(){return Uc(arguments)[a.j](this)}function e(){return Uc(arguments)[a.j](-this)}var f=a.name,h={};h[f]=c,h[f+"s"]=c,h[f+"Before"]=e,h[f+"sBefore"]=e,h[f+"Ago"]=e,h[f+"sAgo"]=e,h[f+"After"]=d,h[f+"sAfter"]=d,h[f+"FromNow"]=d,h[f+"sFromNow"]=d,g.extend(h)}function Wc(a,b){this.start=Xc(a),this.end=Xc(b)}function Xc(a){return v(a)?new e(a.getTime()):null==a?a:v(a)?a.getTime():a.valueOf()}function Yc(a){return a=null==a?a:v(a)?a.getTime():a.valueOf(),!!a||0===a}function Zc(a,b){var c,d,f,g;return s(b)?new e(a.getTime()+b):(c=b[0],d=b[1],f=pb(a,d),g=new e(a.getTime()),qb(g,d,f+c),g)}function $c(a,b){return f.fromCharCode(a.charCodeAt(0)+b)}function _c(a,b){return a+b}function ad(a,b,c,d,e){1/0!==b&&(a.timers||(a.timers=[]),s(b)||(b=1),a.n=!1,a.timers.push(setTimeout(function(){a.n||c.apply(d,e||[])},b)))}function bd(a,b,c,d,e,f){var g=a.toFixed(20),h=g.search(/\./),g=g.search(/[1-9]/),h=h-g;return h>0&&(h-=1),e=$(Z(X(h/3),!1===e?c.length:e),-d),d=c.charAt(e+d-1),-9>h&&(e=-3,b=U(h)-9,d=c.slice(0,1)),c=f?V(2,10*e):V(10,3*e),_(a/c,b||0).format()+d.trim()}function ed(a,b,c,d){var e,f,g;(f=b.match(/^(.+?)(\[.*\])$/))?(g=f[1],b=f[2].replace(/^\[|\]$/g,"").split("]["),b.forEach(function(b){e=!b||b.match(/^\d+$/),!g&&u(a)&&(g=a.length),L(a,g)||(a[g]=e?[]:{}),a=a[g],g=b}),!g&&e&&(g=a.length.toString()),ed(a,g,c,d)):a[b]=d&&"true"===c?!0:d&&"false"===c?!1:c}function fd(a,b){var c;return u(b)||M(b)&&b.toString===j?(c=[],P(b,function(b,d){a&&(b=a+"["+b+"]"),c.push(fd(b,d))}),c.join("&")):a?gd(a)+"="+(v(b)?b.getTime():gd(b)):""}function gd(a){return a||!1===a||0===a?encodeURIComponent(a).replace(/%20/g,"+"):""}function hd(a,b,c){var d,e=a instanceof T?new T:{};return P(a,function(a,g){d=!1,H(b,function(b){(w(b)?b.test(a):M(b)?b[a]===g:a===f(b))&&(d=!0)},1),d===c&&(e[a]=g)}),e}function id(a){if(a=+a,0>a||1/0===a)throw new RangeError("Invalid number");return a}function jd(a,b){return jb(J(b)?b:" ",a)}function kd(a,b,c,d,e){var f;if(a.length<=b)return a.toString();switch(d=K(d)?"...":d,c){case"left":return a=e?ld(a,b,!0):a.slice(a.length-b),d+a;case"middle":return c=W(b/2),f=X(b/2),b=e?ld(a,c):a.slice(0,c),a=e?ld(a,f,!0):a.slice(a.length-f),b+d+a;default:return b=e?ld(a,b):a.slice(0,b),b+d}}function ld(a,b,c){if(c)return ld(a.reverse(),b).reverse();c=d("(?=["+ib()+"])");var e=0;return a.split(c).filter(function(a){return e+=a.length,b>=e}).join("")}function md(a,b,c){return t(b)&&(b=a.indexOf(b),-1===b&&(b=c?a.length:0)),b}var U,V,W,X,Y,Z,$,hb,ab,bb,cb,db,eb,fb,gb,xb,yb,Wb,Xb,Yb,Zb,$b,ac,bc,cc,dc,ec,fc,jc,kc,lc,gc,hc,ic,mc,nc,oc,pc,qc,cd,dd,nd,od,b=Object,c=Array,d=RegExp,e=Date,f=String,g=Number,h=Math,i="undefined"!=typeof global?global:this,j=b.prototype.toString,k=b.prototype.hasOwnProperty,l=b.defineProperty&&b.defineProperties,m="function"==typeof d(),n=!("0"in new f("a")),o={},p=/^\[object Date|Array|String|Number|RegExp|Boolean|Arguments\]$/,q="Boolean Number String Array Date RegExp Function".split(" "),r=z("boolean",q[0]),s=z("number",q[1]),t=z("string",q[2]),u=y(q[3]),v=y(q[4]),w=y(q[5]),x=y(q[6]);for(T.prototype.constructor=b,U=h.abs,V=h.pow,W=h.ceil,X=h.floor,Y=h.round,Z=h.min,$=h.max,ab=48,bb=57,cb=65296,db=65305,eb=".",fb="",gb={},A(b),P(q,function(a,b){A(i[b])}),yb=0;9>=yb;yb++)xb=f.fromCharCode(yb+cb),fb+=xb,gb[xb]=f.fromCharCode(yb+ab);gb[","]="",gb["．"]=eb,gb[eb]=eb,hb=d("["+fb+"．,"+eb+"]","g"),B(b,!1,!1,{keys:function(a){var b=[];if(!M(a)&&!w(a)&&!x(a))throw new TypeError("Object required");return P(a,function(a){b.push(a)}),b}}),B(c,!1,!1,{isArray:function(a){return u(a)}}),B(c,!0,!1,{every:function(a,b){var c=this.length,d=0;for(Bb(arguments);c>d;){if(d in this&&!a.call(b,this[d],d,this))return!1;d++}return!0},some:function(a,b){var c=this.length,d=0;for(Bb(arguments);c>d;){if(d in this&&a.call(b,this[d],d,this))return!0;d++}return!1},map:function(a,b){b=arguments[1];var c=this.length,d=0,e=Array(c);for(Bb(arguments);c>d;)d in this&&(e[d]=a.call(b,this[d],d,this)),d++;return e},filter:function(a){var b=arguments[1],c=this.length,d=0,e=[];for(Bb(arguments);c>d;)d in this&&a.call(b,this[d],d,this)&&e.push(this[d]),d++;return e},indexOf:function(a,b){return t(this)?this.indexOf(a,b):zb(this,a,b,1)},lastIndexOf:function(a,b){return t(this)?this.lastIndexOf(a,b):zb(this,a,b,-1)},forEach:function(a,b){var c=this.length,d=0;for(I(a);c>d;)d in this&&a.call(b,this[d],d,this),d++},reduce:function(a,b){return Ab(this,a,b)},reduceRight:function(a,b){return Ab(this,a,b,!0)}}),B(Function,!0,!1,{bind:function(a){var d,b=this,c=G(arguments,null,1);if(!x(this))throw new TypeError("Function.prototype.bind called on a non-function");return d=function(){return b.apply(b.prototype&&this instanceof b?this:a,c.concat(G(arguments)))},d.prototype=this.prototype,d}}),B(e,!1,!1,{now:function(){return(new e).getTime()}}),function(){var a=ib().match(/^\s+$/);try{f.prototype.trim.call([1])}catch(b){a=!1}B(f,!0,!a,{trim:function(){return this.toString().trimLeft().trimRight()},trimLeft:function(){return this.replace(d("^["+ib()+"]+"),"")},trimRight:function(){return this.replace(d("["+ib()+"]+$"),"")}})}(),function(){var a=new e(e.UTC(1999,11,31)),a=a.toISOString&&"1999-12-31T00:00:00.000Z"===a.toISOString();C(e,!0,!a,"toISOString,toJSON",function(a,b){a[b]=function(){return lb(this.getUTCFullYear(),4)+"-"+lb(this.getUTCMonth()+1,2)+"-"+lb(this.getUTCDate(),2)+"T"+lb(this.getUTCHours(),2)+":"+lb(this.getUTCMinutes(),2)+":"+lb(this.getUTCSeconds(),2)+"."+lb(this.getUTCMilliseconds(),3)+"Z"}})}(),Wb="AlphanumericSortOrder",Xb="AlphanumericSortIgnore",Yb="AlphanumericSortIgnoreCase",Zb="AlphanumericSortEquivalents",$b="AlphanumericSortNatural",B(c,!1,!0,{create:function(){var a=[];return G(arguments,function(b){(!N(b)&&"length"in b&&("[object Arguments]"===j.call(b)||b.callee)||!N(b)&&"length"in b&&!t(b)&&!O(b))&&(b=c.prototype.slice.call(b,0)),a=a.concat(b)}),a}}),B(c,!0,!1,{find:function(a,b){return I(a),Mb(this,a,0,!1,!1,b)},findIndex:function(a,b){var c;return I(a),c=Mb(this,a,0,!1,!0,b),K(c)?-1:c}}),B(c,!0,!0,{findFrom:function(a,b,c){return Mb(this,a,b,c)},findIndexFrom:function(a,b,c){return b=Mb(this,a,b,c,!0),K(b)?-1:b},findAll:function(a,b,c){var e,d=[];return 0<this.length&&(e=Ib(a),Kb(this,function(a,b,c){e(a,b,c)&&d.push(a)},b,c)),d},count:function(a){return K(a)?this.length:this.findAll(a).length},removeAt:function(a,b){return K(a)?this:(K(b)&&(b=a),this.splice(a,b-a+1),this)},include:function(a,b){return this.clone().add(a,b)},exclude:function(){return c.prototype.remove.apply(this.clone(),arguments)},clone:function(){return R([],this)},unique:function(a){return Nb(this,a)},flatten:function(a){return Pb(this,a)},union:function(){return Nb(this.concat(Qb(arguments)))},intersect:function(){return Ob(this,Qb(arguments),!1)},subtract:function(){return Ob(this,Qb(arguments),!0)},at:function(){return ub(this,arguments)},first:function(a){return K(a)?this[0]:(0>a&&(a=0),this.slice(0,a))},last:function(a){return K(a)?this[this.length-1]:this.slice(0>this.length-a?0:this.length-a)},from:function(a){return this.slice(a)},to:function(a){return K(a)&&(a=this.length),this.slice(0,a)},min:function(a,b){return Tb(this,a,"min",b)},max:function(a,b){return Tb(this,a,"max",b)},least:function(a,b){return Tb(this.groupBy.apply(this,[a]),"length","min",b)},most:function(a,b){return Tb(this.groupBy.apply(this,[a]),"length","max",b)},sum:function(a){return a=a?this.map(a):this,0<a.length?a.reduce(function(a,b){return a+b}):0},average:function(a){return a=a?this.map(a):this,0<a.length?a.sum()/a.length:0},inGroups:function(a,b){var c=1<arguments.length,d=this,e=[],f=W(this.length/a);return Q(a,function(a){a*=f;var g=d.slice(a,a+f);c&&g.length<f&&Q(f-g.length,function(){g=g.add(b)}),e.push(g)}),e},inGroupsOf:function(a,b){var f,c=[],d=this.length,e=this;return 0===d||0===a?e:(K(a)&&(a=1),K(b)&&(b=null),Q(W(d/a),function(d){for(f=e.slice(a*d,a*d+a);f.length<a;)f.push(b);c.push(f)}),c)},isEmpty:function(){return 0==this.compact().length},sortBy:function(a,b){var c=this.clone();return c.sort(function(d,e){var f,g;return f=Jb(d,a,c,[d]),g=Jb(e,a,c,[e]),(t(f)&&t(g)?Ub(f,g):g>f?-1:f>g?1:0)*(b?-1:1)}),c},randomize:function(){for(var c,d,a=this.concat(),b=a.length;b;)c=0|h.random()*b,d=a[--b],a[b]=a[c],a[c]=d;return a},zip:function(){var a=G(arguments);return this.map(function(b,c){return[b].concat(a.map(function(a){return c in a?a[c]:null}))})},sample:function(a){var b=this.randomize();return 0<arguments.length?b.slice(0,a):b[0]},each:function(a,b,c){return Kb(this,a,b,c),this},add:function(a,b){return(!s(g(b))||isNaN(b))&&(b=this.length),c.prototype.splice.apply(this,[b,0].concat(a)),this},remove:function(){var a=this;return G(arguments,function(b){var c=0;for(b=Ib(b);c<a.length;)b(a[c],c,a)?a.splice(c,1):c++}),a},compact:function(a){var b=[];return Kb(this,function(c){u(c)?b.push(c.compact()):a&&c?b.push(c):a||null==c||c.valueOf()!==c.valueOf()||b.push(c)}),b},groupBy:function(a,b){var e,c=this,d={};return Kb(c,function(b,f){e=Jb(b,a,c,[b,f,c]),d[e]||(d[e]=[]),d[e].push(b)}),b&&P(d,b),d},none:function(){return!this.any.apply(this,arguments)}}),B(c,!0,!0,{all:c.prototype.every,any:c.prototype.some,insert:c.prototype.add}),B(b,!1,!0,{map:function(a,b){var d,e,c={};for(d in a)L(a,d)&&(e=a[d],c[d]=Jb(e,b,a,[d,e,a]));return c},reduce:function(a){var c=b.keys(S(a)).map(function(b){return a[b]});return c.reduce.apply(c,G(arguments,null,1))},each:function(a,b){return I(b),P(a,b),a},size:function(a){return b.keys(S(a)).length}}),ac="any all none count find findAll isEmpty".split(" "),bc="sum average min max least most".split(" "),cc=["map","reduce","size"],dc=ac.concat(bc).concat(cc),function(){function a(){var a=arguments;return 0<a.length&&!x(a[0])}var b=c.prototype.map;C(c,!0,a,"every,all,some,filter,any,none,find,findIndex",function(a,b){var d=c.prototype[b];a[b]=function(a){var b=Ib(a);return d.call(this,function(a,c){return b(a,c,this)})}}),B(c,!0,a,{map:function(a){return b.call(this,function(b,c){return Jb(b,a,this,[b,c,this])})}})}(),function(){c[Wb]="AÁÀÂÃĄBCĆČÇDĎÐEÉÈĚÊËĘFGĞHıIÍÌİÎÏJKLŁMNŃŇÑOÓÒÔPQRŘSŚŠŞTŤUÚÙŮÛÜVWXYÝZŹŻŽÞÆŒØÕÅÄÖ".split("").map(function(a){return a+a.toLowerCase()}).join("");var a={};Kb("AÁÀÂÃÄ CÇ EÉÈÊË IÍÌİÎÏ OÓÒÔÕÖ Sß UÚÙÛÜ".split(" "),function(b){var c=b.charAt(0);Kb(b.slice(1).split(""),function(b){a[b]=c,a[b.toLowerCase()]=c.toLowerCase()})}),c[$b]=!0,c[Yb]=!0,c[Zb]=a}(),_b(ac),_b(bc,!0),wb(cc,T),c.AlphanumericSort=Ub,gc="ampm hour minute second ampm utc offset_sign offset_hours offset_minutes ampm".split(" "),hc="({t})?\\s*(\\d{1,2}(?:[,.]\\d+)?)(?:{h}([0-5]\\d(?:[,.]\\d+)?)?{m}(?::?([0-5]\\d(?:[,.]\\d+)?){s})?\\s*(?:({t})|(Z)|(?:([+-])(\\d{2,2})(?::?(\\d{2,2}))?)?)?|\\s*({t}))",ic={},mc=[],nc={},oc={yyyy:function(a){return pb(a,"FullYear")},yy:function(a){return pb(a,"FullYear")%100},ord:function(a){return a=pb(a,"Date"),a+mb(a)},tz:function(a){return a.getUTCOffset()},isotz:function(a){return a.getUTCOffset(!0)},Z:function(a){return a.getUTCOffset()},ZZ:function(a){return a.getUTCOffset().replace(/(\d{2})$/,":$1")}},pc=[{name:"year",method:"FullYear",k:!0,b:function(a){return 864e5*(365+(a?a.isLeapYear()?1:0:.25))}},{name:"month",error:.919,method:"Month",k:!0,b:function(a,b){var d,c=30.4375;return a&&(d=a.daysInMonth(),b<=d.days()&&(c=d)),864e5*c}},{name:"week",method:"ISOWeek",b:a(6048e5)},{name:"day",error:.958,method:"Date",k:!0,b:a(864e5)},{name:"hour",method:"Hours",b:a(36e5)},{name:"minute",method:"Minutes",b:a(6e4)},{name:"second",method:"Seconds",b:a(1e3)},{name:"millisecond",method:"Milliseconds",b:a(1)}],qc={},rc.prototype={getMonth:function(a){return s(a)?a-1:this.months.indexOf(a)%12},getWeekday:function(a){return this.weekdays.indexOf(a)%7},addFormat:function(a,b,c,d,e){var h,f=c||[],g=this;a=a.replace(/\s+/g,"[,. ]*"),a=a.replace(/\{([^,]+?)\}/g,function(a,b){var d,e,i=b.match(/\?$/),h=b.match(/^(\d+)\??$/),j=b.match(/(\d)(?:-(\d))?/),k=b.replace(/[^a-z]+$/,"");return h?d=g.tokens[h[1]]:g[k]?d=g[k]:g[k+"s"]&&(d=g[k+"s"],j&&(e=[],d.forEach(function(a,b){var c=b%(g.units?8:d.length);c>=j[1]&&c<=(j[2]||j[1])&&e.push(a)}),d=e),d=Ac(d)),h?h="(?:"+d+")":(c||f.push(k),h="("+d+")"),i&&(h+="?"),h}),b?(b=Tc(g,e),e=["t","[\\s\\u3000]"].concat(g.timeMarker),h=a.match(/\\d\{\d,\d\}\)+\??$/),yc(g,"(?:"+b+")[,\\s\\u3000]+?"+a,gc.concat(f),d),yc(g,a+"(?:[,\\s]*(?:"+e.join("|")+(h?"+":"*")+")"+b+")?",f.concat(gc),d)):yc(g,a,f,d)}},B(e,!1,!0,{create:function(){return Uc(arguments)},past:function(){return Uc(arguments,-1)},future:function(){return Uc(arguments,1)},addLocale:function(a,b){return xc(a,b)},setLocale:function(a){var b=wc(a,!1);return fc=b,a&&a!=b.code&&(b.code=a),b},getLocale:function(a){return a?wc(a,!1):fc},addFormat:function(a,b,c){yc(wc(c),a,b)}}),B(e,!0,!0,{set:function(){var a=Cc(arguments);return Sc(this,a[0],a[1])},setWeekday:function(a){return K(a)?void 0:qb(this,"Date",pb(this,"Date")+a-pb(this,"Day"))},setISOWeek:function(a){var b=pb(this,"Day")||7;return K(a)?void 0:(this.set({month:0,date:4}),this.set({weekday:1}),a>1&&this.addWeeks(a-1),1!==b&&this.advance({days:b-1}),this.getTime())},getISOWeek:function(){var a=this.clone(),b=pb(a,"Day")||7;return a.addDays(4-b).reset(),1+X(a.daysSince(a.clone().beginningOfYear())/7)},beginningOfISOWeek:function(){var a=this.getDay();return 0===a?a=-6:1!==a&&(a=1),this.setWeekday(a),this.reset()},endOfISOWeek:function(){return 0!==this.getDay()&&this.setWeekday(7),this.endOfDay()},getUTCOffset:function(a){var b=this._utc?0:this.getTimezoneOffset(),c=!0===a?":":"";return!b&&a?"Z":lb(X(-b/60),2,!0)+c+lb(U(b%60),2)},utc:function(a){return F(this,"_utc",!0===a||0===arguments.length),this},isUTC:function(){return!!this._utc||0===this.getTimezoneOffset()},advance:function(){var a=Cc(arguments,!0);return Sc(this,a[0],a[1],1)},rewind:function(){var a=Cc(arguments,!0);return Sc(this,a[0],a[1],-1)},isValid:function(){return!isNaN(this.getTime())},isAfter:function(a,b){return this.getTime()>e.create(a).getTime()-(b||0)},isBefore:function(a,b){return this.getTime()<e.create(a).getTime()+(b||0)},isBetween:function(a,b,c){var f,d=this.getTime();return a=e.create(a).getTime(),f=e.create(b).getTime(),b=Z(a,f),a=$(a,f),c=c||0,d>b-c&&a+c>d},isLeapYear:function(){var a=pb(this,"FullYear");return 0===a%4&&0!==a%100||0===a%400},daysInMonth:function(){return 32-pb(new e(pb(this,"FullYear"),pb(this,"Month"),32),"Date")},format:function(a,b){return Pc(this,a,!1,b)},relative:function(a,b){return t(a)&&(b=a,a=null),Pc(this,a,!0,b)},is:function(a,b,c){var d,e;if(this.isValid()){if(t(a))switch(a=a.trim().toLowerCase(),e=this.clone().utc(c),!0){case"future"===a:return this.getTime()>Bc().getTime();case"past"===a:return this.getTime()<Bc().getTime();case"weekday"===a:return 0<pb(e,"Day")&&6>pb(e,"Day");case"weekend"===a:return 0===pb(e,"Day")||6===pb(e,"Day");case-1<(d=ec.weekdays.indexOf(a)%7):return pb(e,"Day")===d;case-1<(d=ec.months.indexOf(a)%12):return pb(e,"Month")===d}return Qc(this,a,null,b,c)}},reset:function(a){var c,b={};return a=a||"hours","date"===a&&(a="days"),c=pc.some(function(b){return a===b.name||a===b.name+"s"}),b[a]=a.match(/^days?/)?1:0,c?this.set(b,!0):this},clone:function(){var a=new e(this.getTime());return a.utc(!!this._utc),a}}),B(e,!0,!0,{iso:function(){return this.toISOString()},getWeekday:e.prototype.getDay,getUTCWeekday:e.prototype.getUTCDay}),B(g,!0,!0,{duration:function(a){return a=wc(a),sc(a,Jc(this),"duration")}}),ec=fc=e.addLocale("en",{plural:!0,timeMarker:"at",ampm:"am,pm",months:"January,February,March,April,May,June,July,August,September,October,November,December",weekdays:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday",units:"millisecond:|s,second:|s,minute:|s,hour:|s,day:|s,week:|s,month:|s,year:|s",numbers:"one,two,three,four,five,six,seven,eight,nine,ten",articles:"a,an,the",tokens:"the,st|nd|rd|th,of","short":"{Month} {d}, {yyyy}","long":"{Month} {d}, {yyyy} {h}:{mm}{tt}",full:"{Weekday} {Month} {d}, {yyyy} {h}:{mm}:{ss}{tt}",past:"{num} {unit} {sign}",future:"{num} {unit} {sign}",duration:"{num} {unit}",modifiers:[{name:"sign",src:"ago|before",value:-1},{name:"sign",src:"from now|after|from|in|later",value:1},{name:"edge",src:"last day",value:-2},{name:"edge",src:"end",value:-1},{name:"edge",src:"first day|beginning",value:1},{name:"shift",src:"last",value:-1},{name:"shift",src:"the|this",value:0},{name:"shift",src:"next",value:1}],dateParse:["{month} {year}","{shift} {unit=5-7}","{0?} {date}{1}","{0?} {edge} of {shift?} {unit=4-7?}{month?}{year?}"],timeParse:"{num} {unit} {sign};{sign} {num} {unit};{0} {num}{1} {day} of {month} {year?};{weekday?} {month} {date}{1?} {year?};{date} {month} {year};{date} {month};{shift} {weekday};{shift} week {weekday};{weekday} {2?} {shift} week;{num} {unit=4-5} {sign} {day};{0?} {date}{1} of {month};{0?}{month?} {date?}{1?} of {shift} {unit=6-7}".split(";")}),lc=pc.concat().reverse(),kc=pc.concat(),kc.splice(2,1),C(e,!0,!0,pc,function(a,b,c){function d(a){a/=h;
var c=a%1,d=b.error||.999;return c&&U(c%1)>d&&(a=Y(a)),0>a?W(a):X(a)}var i,j,f=b.name,g=zc(f),h=b.b();b.j="add"+g+"s",i=function(a,b){return d(this.getTime()-e.create(a,b).getTime())},j=function(a,b){return d(e.create(a,b).getTime()-this.getTime())},a[f+"sAgo"]=j,a[f+"sUntil"]=j,a[f+"sSince"]=i,a[f+"sFromNow"]=i,a[b.j]=function(a,b){var c={};return c[f]=a,this.advance(c,b)},Vc(b,h),3>c&&["Last","This","Next"].forEach(function(b){a["is"+b+g]=function(){return Qc(this,b+" "+f,"en")}}),4>c&&(a["beginningOf"+g]=function(){var a={};switch(f){case"year":a.year=pb(this,"FullYear");break;case"month":a.month=pb(this,"Month");break;case"day":a.day=pb(this,"Date");break;case"week":a.weekday=0}return this.set(a,!0)},a["endOf"+g]=function(){var a={hours:23,minutes:59,seconds:59,milliseconds:999};switch(f){case"year":a.month=11,a.day=31;break;case"month":a.day=this.daysInMonth();break;case"week":a.weekday=6}return this.set(a,!0)})}),ec.addFormat("([+-])?(\\d{4,4})[-.]?{full_month}[-.]?(\\d{1,2})?",!0,["year_sign","year","month","date"],!1,!0),ec.addFormat("(\\d{1,2})[-.\\/]{full_month}(?:[-.\\/](\\d{2,4}))?",!0,["date","month","year"],!0),ec.addFormat("{full_month}[-.](\\d{4,4})",!1,["month","year"]),ec.addFormat("\\/Date\\((\\d+(?:[+-]\\d{4,4})?)\\)\\/",!1,["timestamp"]),ec.addFormat(Tc(ec),!1,gc),mc=ec.g.slice(0,7).reverse(),ec.g=ec.g.slice(7).concat(mc),Nc("f",function(a){return pb(a,"Milliseconds")},!0),Nc("s",function(a){return pb(a,"Seconds")}),Nc("m",function(a){return pb(a,"Minutes")}),Nc("h",function(a){return pb(a,"Hours")%12||12}),Nc("H",function(a){return pb(a,"Hours")}),Nc("d",function(a){return pb(a,"Date")}),Nc("M",function(a){return pb(a,"Month")+1}),function(){function a(a,b){var c=pb(a,"Hours");return wc(b).ampm[X(c/12)]||""}Mc("t",a,1),Mc("tt",a),Mc("T",a,1,1),Mc("TT",a,null,2)}(),function(){function a(a,b){var c=pb(a,"Day");return wc(b).weekdays[c]}Mc("dow",a,3),Mc("Dow",a,3,1),Mc("weekday",a),Mc("Weekday",a,null,1)}(),Lc("mon",0,3),Lc("month",0),Lc("month2",1),Lc("month3",2),oc.ms=oc.f,oc.milliseconds=oc.f,oc.seconds=oc.s,oc.minutes=oc.m,oc.hours=oc.h,oc["24hr"]=oc.H,oc["12hr"]=oc.h,oc.date=oc.d,oc.day=oc.d,oc.year=oc.yyyy,C(e,!0,!0,"short,long,full",function(a,b){a[b]=function(a){return Pc(this,b,!1,a)}}),"〇一二三四五六七八九十百千万".split("").forEach(function(a,b){b>9&&(b=V(10,b-9)),ic[a]=b}),R(ic,gb),jc=d("([期週周])?([〇一二三四五六七八九十百千万"+fb+"]+)(?!昨)","g"),function(){var a=ec.weekdays.slice(0,7),b=ec.months.slice(0,12);C(e,!0,!0,"today yesterday tomorrow weekday weekend future past".split(" ").concat(a).concat(b),function(a,b){a["is"+zc(b)]=function(a){return this.is(b,0,a)}})}(),e.utc||(e.utc={create:function(){return Uc(arguments,0,!0)},past:function(){return Uc(arguments,-1,!0)},future:function(){return Uc(arguments,1,!0)}}),B(e,!1,!0,{RFC1123:"{Dow}, {dd} {Mon} {yyyy} {HH}:{mm}:{ss} {tz}",RFC1036:"{Weekday}, {dd}-{Mon}-{yy} {HH}:{mm}:{ss} {tz}",ISO8601_DATE:"{yyyy}-{MM}-{dd}",ISO8601_DATETIME:"{yyyy}-{MM}-{dd}T{HH}:{mm}:{ss}.{fff}{isotz}"}),Wc.prototype.toString=function(){return this.isValid()?this.start+".."+this.end:"Invalid Range"},B(Wc,!0,!0,{isValid:function(){return Yc(this.start)&&Yc(this.end)&&typeof this.start==typeof this.end},span:function(){return this.isValid()?U((t(this.end)?this.end.charCodeAt(0):this.end)-(t(this.start)?this.start.charCodeAt(0):this.start))+1:0/0},contains:function(a){return null==a?!1:a.start&&a.end?a.start>=this.start&&a.start<=this.end&&a.end>=this.start&&a.end<=this.end:a>=this.start&&a<=this.end},every:function(a,b){var c,d=this.start,e=this.end,f=d>e,g=d,h=0,i=[];for(x(a)&&(b=a,a=null),a=a||1,s(d)?c=_c:t(d)?c=$c:v(d)&&(c=a,s(c)?a=c:(d=c.toLowerCase().match(/^(\d+)?\s?(\w+?)s?$/i),c=parseInt(d[1])||1,d=d[2].slice(0,1).toUpperCase()+d[2].slice(1),d.match(/hour|minute|second/i)?d+="s":"Year"===d?d="FullYear":"Day"===d&&(d="Date"),a=[c,d]),c=Zc),f&&a>0&&(a*=-1);f?g>=e:e>=g;)i.push(g),b&&b(g,h),g=c(g,a),h++;return i},union:function(a){return new Wc(this.start<a.start?this.start:a.start,this.end>a.end?this.end:a.end)},intersect:function(a){return a.start>this.end||a.end<this.start?new Wc(0/0,0/0):new Wc(this.start>a.start?this.start:a.start,this.end<a.end?this.end:a.end)},clone:function(){return new Wc(this.start,this.end)},clamp:function(a){var b=this.start,c=this.end,d=b>c?c:b,b=b>c?b:c;return Xc(d>a?d:a>b?b:a)}}),[g,f,e].forEach(function(a){B(a,!1,!0,{range:function(b,c){return a.create&&(b=a.create(b),c=a.create(c)),new Wc(b,c)}})}),B(g,!0,!0,{upto:function(a,b,c){return g.range(this,a).every(c,b)},clamp:function(a,b){return new Wc(a,b).clamp(this)},cap:function(a){return this.clamp(void 0,a)}}),B(g,!0,!0,{downto:g.prototype.upto}),B(c,!1,function(a){return a instanceof Wc},{create:function(a){return a.every()}}),B(Function,!0,!0,{lazy:function(a,b,c){function d(){return f.length<c-(g&&b?1:0)&&f.push([this,arguments]),g||(g=!0,b?h():ad(d,i,h)),k}var h,i,j,k,e=this,f=[],g=!1;return a=a||1,c=c||1/0,i=W(a),j=Y(i/a)||1,h=function(){var b,a=f.length;if(0!=a){for(b=$(a-j,0);a>b;)k=Function.prototype.apply.apply(e,f.shift()),a--;ad(d,i,function(){g=!1,h()})}},d},throttle:function(a){return this.lazy(a,!0,1)},debounce:function(a){function b(){b.cancel(),ad(b,a,c,this,arguments)}var c=this;return b},delay:function(a){var b=G(arguments,null,1);return ad(this,a,this,this,b),this},every:function(a){function b(){c.apply(c,d),ad(c,a,b)}var c=this,d=arguments,d=1<d.length?G(d,null,1):[];return ad(c,a,b),c},cancel:function(){var b,a=this.timers;if(u(a))for(;b=a.shift();)clearTimeout(b);return this.n=!0,this},after:function(a){var b=this,c=0,d=[];if(s(a)){if(0===a)return b.call(),b}else a=1;return function(){var e;return d.push(G(arguments)),c++,c==a?(e=b.call(this,d),c=0,d=[],e):void 0}},once:function(){return this.throttle(1/0,!0)},fill:function(){var a=this,b=G(arguments);return function(){var c=G(arguments);return b.forEach(function(a,b){(null!=a||b>=c.length)&&c.splice(b,0,a)}),a.apply(this,c)}}}),B(g,!1,!0,{random:function(a,b){var c,d;return 1==arguments.length&&(b=a,a=0),c=Z(a||0,K(b)?1:b),d=$(a||0,K(b)?1:b)+1,X(h.random()*(d-c)+c)}}),B(g,!0,!0,{log:function(a){return h.log(this)/(a?h.log(a):1)},abbr:function(a){return bd(this,a,"kmbt",0,4)},metric:function(a,b){return bd(this,a,"nμm kMGTPE",4,K(b)?1:b)},bytes:function(a,b){return bd(this,a,"kMGTPE",0,K(b)?4:b,!0)+"B"},isInteger:function(){return 0==this%1},isOdd:function(){return!isNaN(this)&&!this.isMultipleOf(2)},isEven:function(){return this.isMultipleOf(2)},isMultipleOf:function(a){return 0===this%a},format:function(a,b,c){var d,e,f,g="";for(K(b)&&(b=","),K(c)&&(c="."),d=(s(a)?_(this,a||0).toFixed($(a,0)):this.toString()).replace(/^-/,"").split("."),e=d[0],f=d[1],d=e.length;d>0;d-=3)d<e.length&&(g=b+g),g=e.slice($(0,d-3),d)+g;return f&&(g+=c+jb("0",(a||0)-f.length)+f),(0>this?"-":"")+g},hex:function(a){return this.pad(a||1,!1,16)},times:function(a){if(a)for(var b=0;this>b;b++)a.call(this,b);return this.toNumber()},chr:function(){return f.fromCharCode(this)},pad:function(a,b,c){return lb(this,a,b,c)},ordinalize:function(){var a=U(this),a=parseInt(a.toString().slice(-2));return this+mb(a)},toNumber:function(){return parseFloat(this,10)}}),function(){function a(a){return function(b){return b?_(this,b,a):a(this)}}B(g,!0,!0,{ceil:a(W),round:a(Y),floor:a(X)}),C(g,!0,!0,"abs,pow,sin,asin,cos,acos,tan,atan,exp,pow,sqrt",function(a,b){a[b]=function(a,c){return h[b](this,a,c)}})}(),cd=["isObject","isNaN"],dd="keys values select reject each merge clone equal watch tap has toQueryString".split(" "),B(b,!1,!0,{watch:function(a,c,d){if(l){var e=a[c];b.defineProperty(a,c,{enumerable:!0,configurable:!0,get:function(){return e},set:function(b){e=d.call(a,c,e,b)}})}}}),B(b,!1,function(){return 1<arguments.length},{keys:function(a,c){var d=b.keys(a);return d.forEach(function(b){c.call(a,b,a[b])}),d}}),B(b,!1,!0,{isObject:function(a){return O(a)},isNaN:function(a){return s(a)&&a.valueOf()!==a.valueOf()},equal:function(a,b){return sb(a,b)},extended:function(a){return new T(a)},merge:function(a,f,g,h){var i,j,k,l,m,n,o;if(a&&"string"!=typeof f)for(i in f)if(L(f,i)&&a){if(l=f[i],m=a[i],n=J(m),j=M(l),k=M(m),o=n&&!1===h?m:l,n&&x(h)&&(o=h.call(f,i,m,l)),g&&(j||k))if(v(l))o=new e(l.getTime());else{if(!w(l)){k||(a[i]=c.isArray(l)?[]:{}),b.merge(a[i],l,g,h);continue}o=new d(l.source,nb(l))}a[i]=o}return a},values:function(a,b){var c=[];return P(a,function(d,e){c.push(e),b&&b.call(a,e)}),c},clone:function(a,c){var d;if(!M(a))return a;if(d=j.call(a),v(a,d)&&a.clone)return a.clone();if(v(a,d)||w(a,d))return new a.constructor(a);if(a instanceof T)d=new T;else if(u(a,d))d=[];else{if(!O(a,d))throw new TypeError("Clone must be a basic data type.");d={}}return b.merge(d,a,c)},fromQueryString:function(a,c){var d=b.extended();return a=a&&a.toString?a.toString():"",a.replace(/^.*?\?/,"").split("&").forEach(function(a){a=a.split("="),2===a.length&&ed(d,a[0],decodeURIComponent(a[1]),c)}),d},toQueryString:function(a,b){return fd(b,a)},tap:function(a,b){var c=b;return x(b)||(c=function(){b&&a[b]()}),c.call(a,a),a},has:function(a,b){return L(a,b)},select:function(a){return hd(a,arguments,!0)},reject:function(a){return hd(a,arguments,!1)}}),C(b,!1,!0,q,function(a,b){var c="is"+b;cd.push(c),a[c]=o[b]}),B(b,!1,function(){return 0===arguments.length},{extend:function(){var a=cd.concat(dd);"undefined"!=typeof dc&&(a=a.concat(dc)),wb(a,b)}}),wb(dd,T),B(d,!1,!0,{escape:function(a){return ob(a)}}),B(d,!0,!0,{getFlags:function(){return nb(this)},setFlags:function(a){return d(this.source,a)},addFlag:function(a){return this.setFlags(nb(this,a))},removeFlag:function(a){return this.setFlags(nb(this).replace(a,""))}}),B(f,!0,!1,{repeat:function(a){return a=id(a),jb(this,a)}}),B(f,!0,function(a){return w(a)||2<arguments.length},{startsWith:function(a){var b=arguments,c=b[1],b=b[2],e=this;return c&&(e=e.slice(c)),K(b)&&(b=!0),c=w(a)?a.source.replace("^",""):ob(a),d("^"+c,b?"":"i").test(e)},endsWith:function(a){var b=arguments,c=b[1],b=b[2],e=this;return J(c)&&(e=e.slice(0,c)),K(b)&&(b=!0),c=w(a)?a.source.replace("$",""):ob(a),d(c+"$",b?"":"i").test(e)}}),B(f,!0,!0,{escapeRegExp:function(){return ob(this)},escapeURL:function(a){return a?encodeURIComponent(this):encodeURI(this)},unescapeURL:function(a){return a?decodeURI(this):decodeURIComponent(this)},escapeHTML:function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/\//g,"&#x2f;")},unescapeHTML:function(){return this.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&#x2f;/g,"/").replace(/&amp;/g,"&")},encodeBase64:function(){return nd(unescape(encodeURIComponent(this)))},decodeBase64:function(){return decodeURIComponent(escape(od(this)))},each:function(a,b){var c,e,f;if(x(a)?(b=a,a=/[\s\S]/g):a?t(a)?a=d(ob(a),"gi"):w(a)&&(a=d(a.source,nb(a,"g"))):a=/[\s\S]/g,c=this.match(a)||[],b)for(e=0,f=c.length;f>e;e++)c[e]=b.call(this,c[e],e,c)||c[e];return c},shift:function(a){var b="";return a=a||0,this.codes(function(c){b+=f.fromCharCode(c+a)}),b},codes:function(a){var d,e,b=[],c=0;for(d=this.length;d>c;c++)e=this.charCodeAt(c),b.push(e),a&&a.call(this,e,c);return b},chars:function(a){return this.each(a)},words:function(a){return this.trim().each(/\S+/g,a)},lines:function(a){return this.trim().each(/^.*$/gm,a)},paragraphs:function(a){var b=this.trim().split(/[\r\n]{2,}/);return b=b.map(function(b){if(a)var c=a.call(b);return c?c:b})},isBlank:function(){return 0===this.trim().length},has:function(a){return-1!==this.search(w(a)?a:ob(a))},add:function(a,b){return b=K(b)?this.length:b,this.slice(0,b)+a+this.slice(b)},remove:function(a){return this.replace(a,"")},reverse:function(){return this.split("").reverse().join("")},compact:function(){return this.trim().replace(/([\r\n\s\u3000])+/g,function(a,b){return"　"===b?b:" "})},at:function(){return ub(this,arguments,!0)},from:function(a){return this.slice(md(this,a,!0))},to:function(a){return K(a)&&(a=this.length),this.slice(0,md(this,a))},dasherize:function(){return this.underscore().replace(/_/g,"-")},underscore:function(){return this.replace(/[-\s]+/g,"_").replace(f.Inflector&&f.Inflector.acronymRegExp,function(a,b){return(b>0?"_":"")+a.toLowerCase()}).replace(/([A-Z\d]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").toLowerCase()},camelize:function(a){return this.underscore().replace(/(^|_)([^_]+)/g,function(b,c,d,e){return b=(b=f.Inflector)&&b.acronyms[d],b=t(b)?b:void 0,e=!1!==a||e>0,b?e?b:b.toLowerCase():e?d.capitalize():d})},spacify:function(){return this.underscore().replace(/_/g," ")},stripTags:function(){var a=this;return H(0<arguments.length?arguments:[""],function(b){a=a.replace(d("</?"+ob(b)+"[^<>]*>","gi"),"")}),a},removeTags:function(){var a=this;return H(0<arguments.length?arguments:["\\S+"],function(b){b=d("<("+b+")[^<>]*(?:\\/>|>.*?<\\/\\1>)","gi"),a=a.replace(b,"")}),a},truncate:function(a,b,c){return kd(this,a,b,c)},truncateOnWord:function(a,b,c){return kd(this,a,b,c,!0)},pad:function(a,b){var c,d;return a=id(a),c=$(0,a-this.length)/2,d=X(c),c=W(c),jd(d,b)+this+jd(c,b)},padLeft:function(a,b){return a=id(a),jd($(0,a-this.length),b)+this},padRight:function(a,b){return a=id(a),this+jd($(0,a-this.length),b)},first:function(a){return K(a)&&(a=1),this.substr(0,a)},last:function(a){return K(a)&&(a=1),this.substr(0>this.length-a?0:this.length-a)},toNumber:function(a){return kb(this,a)},capitalize:function(a){var b;return this.toLowerCase().replace(a?/[^']/g:/^\S/,function(a){var d,c=a.toUpperCase();return d=b?a:c,b=c!==a,d})},assign:function(){var a={};return H(arguments,function(b,c){M(b)?R(a,b):a[c+1]=b}),this.replace(/\{([^{]+?)\}/g,function(b,c){return L(a,c)?a[c]:b})}}),B(f,!0,!0,{insert:f.prototype.add}),function(a){if(i.btoa)nd=i.btoa,od=i.atob;else{var b=/[^A-Za-z0-9\+\/\=]/g;nd=function(b){var d,e,f,g,h,i,c="",j=0;do d=b.charCodeAt(j++),e=b.charCodeAt(j++),f=b.charCodeAt(j++),g=d>>2,d=(3&d)<<4|e>>4,h=(15&e)<<2|f>>6,i=63&f,isNaN(e)?h=i=64:isNaN(f)&&(i=64),c=c+a.charAt(g)+a.charAt(d)+a.charAt(h)+a.charAt(i);while(j<b.length);return c},od=function(c){var e,g,h,i,j,d="",k=0;if(c.match(b))throw Error("String contains invalid base64 characters");c=c.replace(/[^A-Za-z0-9\+\/\=]/g,"");do e=a.indexOf(c.charAt(k++)),g=a.indexOf(c.charAt(k++)),i=a.indexOf(c.charAt(k++)),j=a.indexOf(c.charAt(k++)),e=e<<2|g>>4,g=(15&g)<<4|i>>2,h=(3&i)<<6|j,d+=f.fromCharCode(e),64!=i&&(d+=f.fromCharCode(g)),64!=j&&(d+=f.fromCharCode(h));while(k<c.length);return d}}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=")}();
/// <reference path="../jquery-3.2.1.min.js" />

"use strict"

let version = '3.2.0';        //版本号
let ajaxUrl = '';     //所有ajax操作指向页面
let TEMP = {};
var HROS = {};

HROS.CONFIG = {
	website: 'http://' + location.hostname + location.pathname, //网站地址，用于分享应用时调用。一般无需修改
	sinaweiboAppkey: '',       //新浪微博appkey。首页加载会自动初始化，一般无需修改
	tweiboAppkey: '',       //腾讯微博appkey。首页加载会自动初始化，一般无需修改
	memberID: 0,        //用户id
	lockPwdAndLoginPwd: false,
	desk: 1,        //当前显示桌面
	dockPos: '',       //应用码头位置，参数有：top,left,right
	appXY: '',       //应用排列方式，参数有：x,y
	appSize: '',       //图标显示尺寸，参数有：s,m
	appButtonTop: 20,       //快捷方式top初始位置
	appButtonLeft: 20,       //快捷方式left初始位置
	windowIndexid: 10000,    //窗口z-index初始值
	widgetIndexid: 1,        //挂件z-index初始值
	windowMinWidth: 215,      //窗口最小宽度
	windowMinHeight: 59,       //窗口最小高度
	wallpaperState: 1,        //1系统壁纸,2自定义壁纸,3网络壁纸
	wallpaper: '',       //壁纸
	wallpaperType: '',       //壁纸显示类型，参数有：tianchong,shiying,pingpu,lashen,juzhong
	wallpaperWidth: 0,        //壁纸宽度
	wallpaperHeight: 0,         //壁纸高度
	appVerticalSpacing: 0,//应用垂直间距
	appHorizontalSpacing: 0,//应用水平间距
	deskCount: 0,//当前用户拥有的桌面数量
	timeOutPrompt: '会话过期,请重新登陆!',
	loadingPrompt: '正在载入中，请稍后...',
	postOnce: '不要重复提交!'
};

HROS.VAR = {
	zoomLevel: 1,
	isAppMoving: false,    //桌面应用是否正在移动中，也就是ajax操作是否正在执行中
	dock: [],
	desk1: [],
	desk2: [],
	desk3: [],
	desk4: [],
	desk5: [],
	folder: []
};//桌面应用
let appbtnTemp = template.compile(
	'<div id="<%=id%>" class="appbtn" title="<%=title%>" appid="<%=appid%>" realappid="<%=realappid%>" type="<%=type%>">' +
	'<img src="<%=imgsrc%>" alt="<%=title%>" style="width:<%=appsize%>px;height:<%=appsize%>px;">' +
	'<span style="width:<%=appsize+10%>px;"><%=title%></span>' +
	'</div>'
);
//桌面"添加应用"应用
let addbtnTemp = template.compile(
	'<div class="appbtn add">' +
	'<div><img src="/images/ui/addicon.png"></div>' +
	'<span style="width:<%=appsize+10%>px;">添加应用</span>' +
	'</div>'
);
//任务栏
let taskTemp = template.compile(
	'<a id="<%=id%>" class="task-item task-item-current" title="<%=title%>" appid="<%=appid%>" realappid="<%=realappid%>" type="<%=type%>">' +
	'<div class="task-item-icon">' +
	'<img src="<%=imgsrc%>" alt="<%=title%>">' +
	'</div>' +
	'<div class="task-item-txt"><%=title%></div>' +
	'</a>'
);
//小挂件
let widgetWindowTemp = template.compile(
	'<div id="<%=id%>" class="widget" appid="<%=appid%>" realappid="<%=realappid%>" type="<%=type%>" style="z-index:<%=zIndex%>;width:<%=width%>px;height:<%=height%>px;top:<%=top%>px;right:<%=right%>px">' +
	'<div class="move">' +
	'<a class="ha-close" href="###" title="关闭"></a>' +
	'<% if(issetbar){ %>' +
	'<a class="ha-star" href="###" title="评分"></a>' +
	'<a class="ha-share" href="###" title="分享"></a>' +
	'<% } %>' +
	'</div>' +
	'<div class="frame">' +
	'<iframe src="<%=url%>" frameborder="0" allowtransparency="true"></iframe>' +
	'</div>' +
	'</div>'
);
//应用窗口
let windowTemp = template.compile(
	'<div id="<%=id%>" class="window-container window-current<% if(isflash){ %> window-container-flash<% } %>" starcount="<%=starcount%>" appid="<%=appid%>" realappid="<%=realappid%>" type="<%=type%>" state="show" style="<% if(isopenmax){ %>width:100%;height:100%;<% }else{ %>width:<%=width%>px;height:<%=height%>px;<% } %>z-index:<%=zIndex%>" ismax="<% if(isopenmax){ %>1<% }else{ %>0<% } %>">' +
	'<div style="height:100%">' +
	'<div class="title-bar">' +
	'<img class="icon" src="<%=imgsrc%>" alt="<%=title%>"><span class="title"><%=title%></span>' +
	'<div class="title-handle">' +
	'<a class="ha-hide" btn="hide" href="###" title="最小化"><b class="hide-b"></b></a>' +
	'<% if(istitlebar){ %>' +
	'<a class="ha-max" btn="max" href="###" title="最大化" <% if(isopenmax){ %>style="display:none"<% } %>><b class="max-b"></b></a>' +
	'<a class="ha-revert" btn="revert" href="###" title="还原" <% if(!isopenmax){ %>style="display:none"<% } %>><b class="revert-b"></b><b class="revert-t"></b></a>' +
	'<% } %>' +
	'<% if(istitlebarFullscreen){ %>' +
	'<a class="ha-fullscreen" btn="fullscreen" href="###" title="全屏">+</a>' +
	'<% } %>' +
	'<a class="ha-close" btn="close" href="###" title="关闭">×</a>' +
	'</div>' +
	'</div>' +
	'<div class="window-frame">' +
	'<% if(isflash){ %>' +
	'<div class="window-mask"><div class="maskbg"></div><div>运行中，点击恢复显示 :)</div></div>' +
	'<% }else{ %>' +
	'<div class="window-mask window-mask-noflash"></div>' +
	'<% } %>' +
	'<div class="window-loading"></div>' +
	'<iframe id="<%=id%>_iframe" frameborder="0" src="<%=url%>"></iframe>' +
	'</div>' +
	'<div class="set-bar"><div class="fr">' +
	'<% if(issetbar){ %>' +
	'<a class="btn share"><i class="icon icon104"></i><span class="btn-con">分享</span></a>' +
	'<a class="btn star"><i class="icon icon177"></i><span class="btn-con">评分</span></a>' +
	'<a class="btn detail"><i class="icon icon120"></i><span class="btn-con">详情</span></a>' +
	'<% } %>' +
	'<a class="btn refresh"><i class="icon icon158"></i><span class="btn-con">刷新</span></a>' +
	'</div></div>' +
	'</div>' +
	'<% if(isresize){ %>' +
	'<div class="window-resize window-resize-t" resize="t"></div>' +
	'<div class="window-resize window-resize-r" resize="r"></div>' +
	'<div class="window-resize window-resize-b" resize="b"></div>' +
	'<div class="window-resize window-resize-l" resize="l"></div>' +
	'<div class="window-resize window-resize-rt" resize="rt"></div>' +
	'<div class="window-resize window-resize-rb" resize="rb"></div>' +
	'<div class="window-resize window-resize-lt" resize="lt"></div>' +
	'<div class="window-resize window-resize-lb" resize="lb"></div>' +
	'<% } %>' +
	'</div>'
);
//文件夹窗口
let folderWindowTemp = template.compile(
	'<div id="<%=id%>" class="folder-window window-container window-current" appid="<%=appid%>" realappid="<%=realappid%>" type="<%=type%>" state="show" style="width:<%=width%>px;height:<%=height%>px;z-index:<%=zIndex%>">' +
	'<div style="height:100%">' +
	'<div class="title-bar">' +
	'<img class="icon" src="<%=imgsrc%>" alt="<%=title%>"><span class="title"><%=title%></span>' +
	'<div class="title-handle">' +
	'<a class="ha-hide" btn="hide" href="###" title="最小化"><b class="hide-b"></b></a>' +
	'<% if(istitlebar){ %>' +
	'<a class="ha-max" btn="max" href="###" title="最大化"><b class="max-b"></b></a>' +
	'<a class="ha-revert" btn="revert" href="###" title="还原" style="display:none"><b class="revert-b"></b><b class="revert-t"></b></a>' +
	'<% } %>' +
	'<a class="ha-close" btn="close" href="###" title="关闭">×</a>' +
	'</div>' +
	'</div>' +
	'<div class="window-frame">' +
	'<div class="folder_body"></div>' +
	'</div>' +
	'<div class="set-bar"><div class="fr">' +
	'<a class="btn refresh"><i class="icon icon158"></i><span class="btn-con">刷新</span></a>' +
	'</div></div>' +
	'</div>' +
	'<% if(isresize){ %>' +
	'<div class="window-resize window-resize-t" resize="t"></div>' +
	'<div class="window-resize window-resize-r" resize="r"></div>' +
	'<div class="window-resize window-resize-b" resize="b"></div>' +
	'<div class="window-resize window-resize-l" resize="l"></div>' +
	'<div class="window-resize window-resize-rt" resize="rt"></div>' +
	'<div class="window-resize window-resize-rb" resize="rb"></div>' +
	'<div class="window-resize window-resize-lt" resize="lt"></div>' +
	'<div class="window-resize window-resize-lb" resize="lb"></div>' +
	'<% } %>' +
	'</div>'
);
//文件夹预览
let folderViewTemp = template.compile(
	'<div id="<%=id%>" class="quick_view_container" appid="<%=appid%>" realappid="<%=realappid%>" style="top:<%=top%>px;left:<%=left%>px">' +
	'<div class="perfect_nine_box">' +
	'<div class="perfect_nine_t">' +
	'<div class="perfect_nine_t_m"></div>' +
	'</div>' +
	'<span class="perfect_nine_t_l"></span>' +
	'<span class="perfect_nine_t_r"></span>' +
	'<div class="perfect_nine_middle">' +
	'<span class="perfect_nine_m_l">' +
	'<div class="perfect_nine_m_l_t" style="top:0px;height:<%=mlt%>px"></div>' +
	'<div class="perfect_nine_m_l_m" style="top:<%=mlt%>px;height:20px;display:<% if(mlm){ %>block<% }else{ %>none<% } %>"></div>' +
	'<div class="perfect_nine_m_l_b" style="top:<% if(mlm){ %><%=mlt+20%><% }else{ %><%=mlt%><% } %>px;height:<%=mlb%>px"></div>' +
	'</span>' +
	'<span class="perfect_nine_m_r">' +
	'<div class="perfect_nine_m_r_t" style="top:0px;height:<%=mrt%>px"></div>' +
	'<div class="perfect_nine_m_r_m" style="top:<%=mrt%>px;height:20px;display:<% if(mrm){ %>block<% }else{ %>none<% } %>"></div>' +
	'<div class="perfect_nine_m_r_b" style="top:<% if(mrm){ %><%=mrt+20%><% }else{ %><%=mrt%><% } %>px;height:<%=mrb%>px"></div>' +
	'</span>' +
	'<div class="perfect_nine_context">' +
	'<div class="quick_view_container_control">' +
	'<a href="###" class="quick_view_container_open">打开</a>' +
	'</div>' +
	'<div class="quick_view_container_list" id="quick_view_container_list_<%=appid%>" realid="<%=appid%>">' +
	'<div class="quick_view_container_list_in" id="quick_view_container_list_in_<%=appid%>" style="height:<%=height%>px">' +
	'<%==apps%>' +
	'</div>' +
	'<div class="scrollBar"></div>' +
	'<div class="scrollBar_bgc"></div>' +
	'</div>' +
	'</div>' +
	'</div>' +
	'<div class="perfect_nine_b">' +
	'<div class="perfect_nine_b_m"></div>' +
	'</div>' +
	'<span class="perfect_nine_b_l"></span>' +
	'<span class="perfect_nine_b_r"></span>' +
	'</div>' +
	'</div>'
);
//文件下载
let fileDownloadTemp = template.compile(
	'<iframe src="filedownload.php?appid=<%=appid%>" frameborder="0" style="display:none"></iframe>'
);
//搜索结果列表
let suggestTemp = template.compile(
	'<li class="resultList" appid="<%=appid%>" realappid="<%=realappid%>" type="<%=type%>">' +
	'<a href="###"><div><%=name%></div></a>' +
	'</li>'
);
//新建&修改文件夹窗口
let editFolderDialogTemp = template.compile(
	'<div id="addfolder">' +
	'<a class="folderSelector"><img src="<%=src%>"></a>' +
	'<div class="folderNameTxt">请输入文件夹名称：</div>' +
	'<div class="folderInput"><input type="text" class="folderName" id="folderName" value="<%=name%>"></div>' +
	'<div class="folderNameError">文件夹名称不能只包含空字符</div>' +
	'<div class="fcDropdown">' +
	'<a class="fcDropdown_item" title="默认"><img class="fcDropdown_img" src="/images/ui/folder_default.png"></a>' +
	'<a class="fcDropdown_item" title="文本"><img class="fcDropdown_img" src="/images/ui/folder_doc.png"></a>' +
	'<a class="fcDropdown_item" title="游戏"><img class="fcDropdown_img" src="/images/ui/folder_game.png"></a>' +
	'<a class="fcDropdown_item" title="生活"><img class="fcDropdown_img" src="/images/ui/folder_life.png"></a>' +
	'<a class="fcDropdown_item" title="音乐"><img class="fcDropdown_img" src="/images/ui/folder_music.png"></a>' +
	'<a class="fcDropdown_item" title="工具"><img class="fcDropdown_img" src="/images/ui/folder_tool.png"></a>' +
	'<a class="fcDropdown_item" title="视频"><img class="fcDropdown_img" src="/images/ui/folder_video.png"></a>' +
	'</div>' +
	'</div>'
);
//应用评分
let starDialogTemp = template.compile(
	'<div id="star" realappid="<%=realappid%>">' +
	'<div class="grade-box">' +
	'<div class="star-num"><%=point%></div>' +
	'<div class="star-box">' +
	'<div>打分：</div>' +
	'<i style="width:<%=realpoint%>%"></i>' +
	'<ul>' +
	'<li class="grade-1" num="1"><a href="###"><em>很不好用</em></a></li>' +
	'<li class="grade-2" num="2"><a href="###"><em>体验一般般</em></a></li>' +
	'<li class="grade-3" num="3"><a href="###"><em>比较好用</em></a></li>' +
	'<li class="grade-4" num="4"><a href="###"><em>很好用</em></a></li>' +
	'<li class="grade-5" num="5"><a href="###"><em>棒极了，推荐</em></a></li>' +
	'</ul>' +
	'</div>' +
	'</div>' +
	'</div>'
);
//锁定
let lockTemp = template.compile(
	'<div id="lock">' +
	'<div class="title">' +
	'<div class="time"></div>' +
	'<div class="week"></div>' +
	'</div>' +
	'<div id="lock-info">' +
	'<div class="img"><img src="<%=avatar%>" title="<%=username%>" alt="<%=username%>"></img></div>' +
	'<div class="text"><input type="password" class="mousetrap" id="lockpassword" placeholder="请输入解锁密码"></div>' +
	'<div class="text-tip"></div>' +
	'<div class="text"><input type="button" id="lockbtn" value="解 锁"></div>' +
	'</div>' +
	'<div class="tip">点击屏幕，开启解锁</div>' +
	'</div>'
);
/*
**  应用
*/
HROS.app = (function () {
	return {
        /*
		**  初始化桌面应用
		*/
		init: function () {
			//绑定'应用市场'点击事件
			$('#desk').on('click', '.add', function () {
				HROS.window.createTemp({
					appid: 'hoorayos-yysc',
					title: '应用市场',
					url: '/AppMarket/Index',
					width: 800,
					height: 484,
					isflash: false
				});
			});
			//绑定应用拖动事件
			HROS.app.move();
			//绑定滚动条拖动事件
			HROS.app.moveScrollbar();
			//绑定应用右击事件
			$('body').on('contextmenu', '.appbtn:not(.add)', function (e) {
				HROS.popupMenu.hide();
				let popupmenu;
				switch ($(this).attr('type')) {
					case 'app':
					case 'widget':
						popupmenu = HROS.popupMenu.app($(this));
						break;
					case 'pwindow':
					case 'pwidget':
						popupmenu = HROS.popupMenu.papp($(this));
						break;
					case 'folder':
						popupmenu = HROS.popupMenu.folder($(this));
						break;
					case 'file':
						popupmenu = HROS.popupMenu.file($(this));
						break;
				}
				let l = ($(window).width() - e.clientX) < popupmenu.width() ? (e.clientX - popupmenu.width()) : e.clientX;
				let t = ($(window).height() - e.clientY) < popupmenu.height() ? (e.clientY - popupmenu.height()) : e.clientY;
				popupmenu.css({
					left: l,
					top: t
				}).show();
				return false;
			});
			//应用窗口上的评分、分享按钮事件
			$('body').on('click', '#star ul li', function () {
				let num = $(this).attr('num');
				if (!isNaN(num) && /^[1-5]$/.test(num)) {
					if (HROS.base.checkLogin()) {
						HROS.request.post('/appmarket/modifystar', { AppId: $('#star').attr('realappid'), StarCount: num }, function (responseText) {
							if (responseText.IsSuccess) {
								if (responseText.IsSuccess) {
									NewCrm.msgbox.success("打分成功！");
								} else {
									NewCrm.msgbox.fail("你已经打过分了！");
								}
							} else {
								NewCrm.msgbox.fail(responseText.Message);
							}
							$.dialog.list['star'].close();
						});
					} else {
						HROS.base.login();
					}
				}
			}).on('click', '#share a', function () {
				$.dialog.list['share'].close();
			});
			//获取桌面应用数据
			HROS.app.get();
		},
        /*
		**  更新应用排列方式
		*/
		updateXY: function (i) {
			if (HROS.CONFIG.appXY.toLowerCase() !== i) {
				if (HROS.base.checkLogin()) {
					HROS.request.post('/desk/modifyxy', { appXy: i }, function (responseText) {
						if (responseText.IsSuccess) {
							HROS.CONFIG.appXY = i.toLowerCase();
							HROS.deskTop.resize();
							NewCrm.msgbox.success('图标排列方向更新成功');
						} else {
							NewCrm.msgbox.fail('图标排列方向更新失败');
						}
					});
				}
			}
		},
        /*
		**  更新应用显示尺寸
		*/
		updateSize: function (i) {
			if (HROS.CONFIG.appSize !== i) {
				HROS.CONFIG.appSize = i;
				HROS.deskTop.resize();
				if (HROS.base.checkLogin()) {
					HROS.request.post('/desk/modifysize', { appSize: i }, function (responseText) {
						if (responseText.IsSuccess) {
							NewCrm.msgbox.success('更新应用显示尺寸成功');
						} else {
							NewCrm.msgbox.fail('更新应用显示尺寸失败');
						}
					});
				}
			}
		},

        /*
		**  更新应用垂直间距
		*/
		updateVertical: function (i) {
			if (HROS.CONFIG.appVerticalSpacing != i) {
				HROS.CONFIG.appVerticalSpacing = i;
				HROS.deskTop.resize();
				if (HROS.base.checkLogin()) {
					HROS.request.post('/desk/modifyverticalspace', { appVertical: i }, function (responseText) {
						if (responseText.IsSuccess) {
							NewCrm.msgbox.success('更新应用垂直间距成功');
						} else {
							NewCrm.msgbox.fail('更新应用垂直间距失败');
						}
					});
				}
			}
		},
        /*
		**  更新应用水平间距
		*/
		updateHorizontal: function (i) {
			if (HROS.CONFIG.appHorizontalSpacing != i) {
				HROS.CONFIG.appHorizontalSpacing = i;
				HROS.deskTop.resize();
				if (HROS.base.checkLogin()) {
					HROS.request.post('/desk/modifyhorizontalspace', { appHorizontal: i }, function (responseText) {
						if (responseText.IsSuccess) {
							NewCrm.msgbox.success('更新应用水平间距成功');
						} else {
							NewCrm.msgbox.fail('更新应用水平间距失败');
						}
					});
				}
			}
		},

        /*
		**  获取桌面应用数据
		*/
		get: function () {
			HROS.VAR.isAppMoving = true;
			HROS.request.get('/desk/getuserdeskmembers', {}, function (responseText) {
				if (responseText.IsSuccess) {
					HROS.VAR.isAppMoving = false;
					if (typeof responseText === 'object') {
						let folders = [], docks = [];
						$.each(responseText.Model, function (k, v) {
							let apps = [];
							$.each(v, function (a, b) {
								if (b.type === 'folder') {
									folders.push(b)
								}
								if (b.isOnDock) {
									docks.push(b)
								} else {
									apps.push(b);
								}
							});
							if (parseInt(k) === 1) {
								HROS.VAR.desk1 = apps
							} else if (parseInt(k) === 2) {
								HROS.VAR.desk2 = apps
							} else if (parseInt(k) === 3) {
								HROS.VAR.desk3 = apps
							} else if (parseInt(k) === 4) {
								HROS.VAR.desk4 = apps
							} else if (parseInt(k) === 5) {
								HROS.VAR.desk5 = apps
							}
						});

						HROS.VAR.folder = folders;
						HROS.VAR.dock = docks;
					}
					//输出桌面应用
					HROS.app.set();
				}
			})
		},
        /*
		**  渲染桌面，输出应用
		*/
		set: function () {
			//加载应用码头应用
			let dock_append = '';
			if (HROS.VAR.dock != null && HROS.VAR.dock !== '') {
				$(HROS.VAR.dock).each(function () {
					dock_append += appbtnTemp({
						'title': this.name,
						'type': this.type,
						'id': 'd_' + this.memberId,
						'appid': this.memberId,
						'realappid': this.appId == 0 ? this.memberId : this.appId,
						'imgsrc': this.icon,
						'appsize': 48
					});
				});
			}
			$('#dock-bar .dock-applist .appbtn').remove();
			$('#dock-bar .dock-applist').append(dock_append);

			//加载桌面应用
			for (let j = 1; j <= HROS.CONFIG.deskCount; j++) {
				let desk_append = '';
				let desk = eval('HROS.VAR.desk' + j);
				if (typeof desk !== 'undefined' && desk !== '') {
					$(desk).each(function () {
						desk_append += appbtnTemp({
							'title': this.name,
							'type': this.type,
							'id': 'd_' + this.memberId,
							'appid': this.memberId,
							'realappid': this.appId == 0 ? this.memberId : this.appId,
							'imgsrc': this.icon,
							'appsize': HROS.CONFIG.appSize
						});
					});
				}
				desk_append += addbtnTemp({ 'appsize': HROS.CONFIG.appSize });
				$('#desk-' + j + ' .desktop-apps-container .appbtn').remove();
				$('#desk-' + j + ' .desktop-apps-container').append(desk_append);
			}

			HROS.app.setPos(false);
			//如果文件夹预览面板为显示状态，则进行更新
			$('body .quick_view_container').each(function () {
				HROS.folderView.get($('#d_' + $(this).attr('appid')));
			});
			//如果文件夹窗口为显示状态，则进行更新
			$('#desk .folder-window').each(function () {
				HROS.window.updateFolder($(this).attr('appid'));
			});
			//加载滚动条
			HROS.app.getScrollbar();
		},

		setPos: function (isAnimate) {
			$('i.addicon').width(HROS.CONFIG.appSize).height(HROS.CONFIG.appSize);
			$('#desk .desktop-container .appbtn img ').width(HROS.CONFIG.appSize).height(HROS.CONFIG.appSize);
			$('#desk .desktop-container .appbtn span').width(Number(HROS.CONFIG.appSize) + 10);
			isAnimate = isAnimate == null ? true : isAnimate;
			let grid = HROS.grid.getAppGrid(), dockGrid = HROS.grid.getDockAppGrid();
			$('#dock-bar .dock-applist .appbtn').each(function (i) {
				$(this).css({
					'top': HROS.CONFIG.dockPos.toLowerCase() === 'top' ? dockGrid[i]['startY'] : dockGrid[i]['startY'] + 5,
					'left': HROS.CONFIG.dockPos.toLowerCase() === 'top' ? dockGrid[i]['startX'] + 5 : dockGrid[i]['startX']
				}).attr('top', $(this).offset().top).attr('left', $(this).offset().left);
			});
			for (let j = 1; j <= 5; j++) {
				$('#desk-' + j + ' .appbtn').each(function (i) {
					let offsetTop = HROS.CONFIG.appVerticalSpacing / 2;
					let offsetLeft = HROS.CONFIG.appHorizontalSpacing / 2;
					let top = grid[i]['startY'] + offsetTop;
					let left = grid[i]['startX'] + offsetLeft;
					$(this).stop(true, false).animate({
						'top': top,
						'left': left
					}, isAnimate ? 500 : 0);
					switch (HROS.CONFIG.dockPos.toLowerCase()) {
						case 'top':
							$(this).attr('left', left).attr('top', top + $('#dock-bar').height());
							break;
						case 'left':
							$(this).attr('left', left + $('#dock-bar').width()).attr('top', top);
							break;
						default:
							$(this).attr('left', left).attr('top', top);
					}
				});
			}
			//更新滚动条
			HROS.app.getScrollbar();
		},
        /*
		**  添加应用
		*/
		add: function (id, callback) {
			function done() {
				callback && callback();
			}
			if (HROS.base.checkLogin()) {
				HROS.request.post('/appmarket/install', { AppId: id, DeskNum: HROS.CONFIG.desk }, function (responseText) {
					if (responseText.IsSuccess) {
						done();
					} else {
						NewCrm.msgbox.fail(responseText.Message);
					}
				})
			} else {
				done();
			}
		},
        /*
		**  删除应用
		*/
		remove: function (id, callback) {
			function done() {
				HROS.widget.removeCookie(id);
				callback && callback();
			}
			if (HROS.base.checkLogin()) {
				HROS.request.post('/desk/uninstall', { memberId: parseInt(id) }, function (responseText) {
					if (responseText.IsSuccess) {
						done();
						NewCrm.msgbox.success('移除成功，刷新后查看')
					} else {
						NewCrm.msgbox.fail(responseText.Message);
					}
				})
			} else {
				done();
			}
		},
        /*
		**  应用拖动、打开
		**  这块代码略多，主要处理了9种情况下的拖动，分别是：
		**  桌面拖动到应用码头、桌面拖动到文件夹内、当前桌面上拖动(排序)
		**  应用码头拖动到桌面、应用码头拖动到文件夹内、应用码头上拖动(排序)
		**  文件夹内拖动到桌面、文件夹内拖动到应用码头、不同文件夹之间拖动
		*/
		move: function () {
			//应用码头应用拖动
			$('#dock-bar .dock-applist').on('mousedown', '.appbtn', function (e) {
				e.preventDefault();
				e.stopPropagation();
				if (e.button === 0 || e.button === 1) {
					let oldobj = $(this);
					let obj = $('<div id="shortcut_shadow">' + oldobj.html() + '</div>');
					let dx = e.clientX;
					let dy = e.clientY;
					let cx = e.clientX;
					let cy = e.clientY;
					let x = dx - oldobj.offset().left;
					let y = dy - oldobj.offset().top;
					let lay = HROS.maskBox.desk();
					//绑定鼠标移动事件
					$(document).on('mousemove', function (e) {
						$('body').append(obj);
						lay.show();
						cx = e.clientX <= 0 ? 0 : e.clientX >= $(window).width() ? $(window).width() : e.clientX;
						cy = e.clientY <= 0 ? 0 : e.clientY >= $(window).height() ? $(window).height() : e.clientY;
						if (dx !== cx || dy !== cy) {
							obj.css({
								left: cx - x,
								top: cy - y
							}).show();
						}
					}).on('mouseup', function () {

						$(document).off('mousemove').off('mouseup');
						obj.remove();
						lay.hide();
						//判断是否移动应用，如果没有则判断为click事件

						if (dx === cx && dy === cy) {
							switch (oldobj.attr('type')) {
								case 'window':
								case 'pwindow':
								case 'file':
									HROS.window.create(oldobj.attr('realappid'), oldobj.attr('type'));
									break;
								case 'widget':
								case 'pwidget':
									HROS.widget.create(oldobj.attr('realappid'), oldobj.attr('type'));
									break;
								case 'folder':
									HROS.folderView.get(oldobj);
									break;
							}
							return false;
						}
						let movegrid = HROS.grid.searchFolderGrid(cx, cy);
						if (movegrid !== null) {
							if (oldobj.hasClass('folder') === false) {
								let id = oldobj.attr('appid');
								let from = oldobj.index();
								let to = movegrid;

								if (HROS.base.checkLogin()) {
									if (!HROS.app.checkIsMoving()) {
										if (HROS.app.dataDockToFolder(id, from, to)) {
											HROS.request.post('/desk/membermove', { model: { MoveType: 'dock-folder', MemberId: id, From: from, To: to } }, function (responseText) {
												if (responseText.IsSuccess) {
													HROS.VAR.isAppMoving = false;
												} else {
													NewCrm.msgbox.fail(responseText.Message);
												}
											})
										}
									}
								} else {
									HROS.app.dataDockToFolder(id, from, to);
								}
							}
						} else {
							let dock_w = HROS.CONFIG.dockPos.toLowerCase() === 'left' ? 0 : HROS.CONFIG.dockPos.toLowerCase() === 'top' ? ($(window).width() - $('#dock-container').width() + 20) / 2 : $(window).width() - $('#dock-container').width();
							let dock_h = HROS.CONFIG.dockPos.toLowerCase() === 'top' ? 0 : ($(window).height() - $('#dock-container').height() + 20) / 2;
							let movegrid = HROS.grid.searchDockAppGrid(cx - dock_w, cy - dock_h);
							if (movegrid !== null) {
								if (movegrid !== oldobj.index()) {
									let movegrid2 = HROS.grid.searchDockAppGrid2(cx - dock_w, cy - dock_h);
									let id = oldobj.attr('appid');
									let from = oldobj.index();
									let to = movegrid;
									let boa = movegrid2 % 2 === 0 ? 'b' : 'a';
									if (HROS.base.checkLogin()) {
										if (!HROS.app.checkIsMoving()) {
											if (HROS.app.dataDockToDock(id, from, to, boa)) {
												// 
												// $.ajax({
												// 	type: 'POST',
												// 	url: ajaxUrl,
												// 	data: 'ac=moveMyApp&movetype=dock-dock&id=' + id + '&from=' + from + '&to=' + to + '&boa=' + boa
												// }).done(function (responseText) {
												// 	HROS.VAR.isAppMoving = false;
												// });
											}
										}
									} else {
										HROS.app.dataDockToDock(id, from, to, boa);
									}
								}
							} else {
								let dock_w = HROS.CONFIG.dockPos.toLowerCase() === 'left' ? $('#dock-bar').width() : 0;
								let dock_h = HROS.CONFIG.dockPos.toLowerCase() === 'top' ? $('#dock-bar').height() : 0;
								let deskScrollLeft = $('#desk-' + HROS.CONFIG.desk + ' .desktop-apps-container').scrollLeft();
								let deskScrollTop = $('#desk-' + HROS.CONFIG.desk + ' .desktop-apps-container').scrollTop();
								let movegrid = HROS.grid.searchAppGrid(cx - dock_w + deskScrollLeft, cy - dock_h + deskScrollTop);
								if (movegrid !== null) {
									let movegrid2 = HROS.grid.searchAppGrid2(cx - dock_w + deskScrollLeft, cy - dock_h + deskScrollTop);
									let id = oldobj.attr('appid');
									let from = oldobj.index();
									let to = movegrid;
									let boa = movegrid2 % 2 === 0 ? 'b' : 'a';
									let desk = HROS.CONFIG.desk;
									if (HROS.base.checkLogin()) {
										if (!HROS.app.checkIsMoving()) {
											if (HROS.app.dataDockToDesk(id, from, to, boa, desk)) {
												HROS.request.post('/desk/membermove', {
													model: { MoveType: 'dock-desk', MemberId: id, From: from, To: desk }
												}, function (responseText) {
													if (responseText.IsSuccess) {
														HROS.VAR.isAppMoving = false;
													} else {
														NewCrm.msgbox.fail(responseText.Message);
													}
												})
											}
										}
									} else {
										HROS.app.dataDockToDesk(id, from, to, boa, desk);
									}
								}
							}
						}
					});
				}
			});
			//桌面应用拖动
			$('#desktop .desktop-apps-container').on('mousedown', '.appbtn:not(.add)', function (e) {
				e.preventDefault();
				e.stopPropagation();
				if (e.button === 0 || e.button === 1) {
					let oldobj = $(this);
					let obj = $('<div id="shortcut_shadow">' + oldobj.html() + '</div>');
					let dx = e.clientX;
					let dy = e.clientY;
					let cx = e.clientX;
					let cy = e.clientY;
					let x = dx - oldobj.offset().left;
					let y = dy - oldobj.offset().top;
					let lay = HROS.maskBox.desk();
					//绑定鼠标移动事件
					$(document).on('mousemove', function (e) {
						$('body').append(obj);
						lay.show();
						cx = e.clientX <= 0 ? 0 : e.clientX >= $(window).width() ? $(window).width() : e.clientX;
						cy = e.clientY <= 0 ? 0 : e.clientY >= $(window).height() ? $(window).height() : e.clientY;
						if (dx !== cx || dy !== cy) {
							obj.css({
								left: cx - x,
								top: cy - y
							}).show();
						}
					}).on('mouseup', function () {
						$(document).off('mousemove').off('mouseup');
						obj.remove();
						lay.hide();
						//判断是否移动应用，如果没有则判断为click事件
						if (dx === cx && dy === cy) {
							switch (oldobj.attr('type')) {
								case 'app':
								case 'pwindow':
								case 'file':
									HROS.window.create(oldobj.attr('realappid'), oldobj.attr('type'));
									break;
								case 'widget':
								case 'pwidget':
									HROS.widget.create(oldobj.attr('realappid'), oldobj.attr('type'));
									break;
								case 'folder':
									HROS.folderView.get(oldobj);
									break;
							}
							return false;
						}
						let movegrid = HROS.grid.searchFolderGrid(cx, cy);
						if (movegrid !== null) {
							if (oldobj.attr('type') !== 'folder') {
								let id = oldobj.attr('appid');
								let from = oldobj.index();
								let to = movegrid;
								let desk = HROS.CONFIG.desk;

								if (HROS.base.checkLogin()) {
									if (!HROS.app.checkIsMoving()) {
										if (HROS.app.dataDeskToFolder(id, from, to, desk)) {
											HROS.request.post('/desk/membermove', { model: { MoveType: 'desk-folder', MemberId: id, From: from, To: to } }, function (responseText) {
												if (responseText.IsSuccess) {
													HROS.VAR.isAppMoving = false;
												} else {
													NewCrm.msgbox.fail(responseText.Message);
												}
											})
										}
									}
								} else {
									HROS.app.dataDeskToFolder(id, from, to, desk);
								}
							}
						} else {
							let dock_w = HROS.CONFIG.dockPos.toLowerCase() === 'left' ? 0 : HROS.CONFIG.dockPos.toLowerCase() === 'top' ? ($(window).width() - $('#dock-container').width() + 20) / 2 : $(window).width() - $('#dock-container').width();
							let dock_h = HROS.CONFIG.dockPos.toLowerCase() === 'top' ? 0 : ($(window).height() - $('#dock-container').height() + 20) / 2;
							let movegrid = HROS.grid.searchDockAppGrid(cx - dock_w, cy - dock_h);
							if (movegrid !== null) {
								let movegrid2 = HROS.grid.searchDockAppGrid2(cx - dock_w, cy - dock_h);
								let id = oldobj.attr('appid');
								let from = oldobj.index();
								let to = movegrid;
								let boa = movegrid2 % 2 === 0 ? 'b' : 'a';
								let desk = HROS.CONFIG.desk;
								if (HROS.base.checkLogin()) {
									if (!HROS.app.checkIsMoving()) {
										if (HROS.app.dataDeskToDock(id, from, to, boa, desk)) {
											HROS.request.post('/desk/membermove', { model: { MoveType: 'desk-dock', MemberId: id, From: from, To: to } }, function (responseText) {
												if (responseText.IsSuccess) {
													HROS.VAR.isAppMoving = false;
												} else {
													NewCrm.msgbox.fail(responseText.Message);
												}
											})
										}
									}
								} else {
									HROS.app.dataDeskToDock(id, from, to, boa, desk);
								}
							} else {
								let dock_w = HROS.CONFIG.dockPos.toLowerCase() === 'left' ? $('#dock-bar').width() : 0;
								let dock_h = HROS.CONFIG.dockPos.toLowerCase() === 'top' ? $('#dock-bar').height() : 0;
								let deskScrollLeft = $('#desk-' + HROS.CONFIG.desk + ' .desktop-apps-container').scrollLeft();
								let deskScrollTop = $('#desk-' + HROS.CONFIG.desk + ' .desktop-apps-container').scrollTop();
								let movegrid = HROS.grid.searchAppGrid(cx - dock_w + deskScrollLeft, cy - dock_h + deskScrollTop);
								if (movegrid !== null && movegrid !== oldobj.index()) {
									let movegrid2 = HROS.grid.searchAppGrid2(cx - dock_w + deskScrollLeft, cy - dock_h + deskScrollTop);
									let id = oldobj.attr('appid');
									let from = oldobj.index();
									let to = movegrid;
									let boa = movegrid2 % 2 === 0 ? 'b' : 'a';
									let desk = HROS.CONFIG.desk;
									if (HROS.base.checkLogin()) {
										if (!HROS.app.checkIsMoving()) {
											if (HROS.app.dataDeskToDesk(id, from, to, boa, desk)) {
												// $.ajax({
												// 	type: 'POST',
												// 	url: ajaxUrl,
												// 	data: 'ac=moveMyApp&movetype=desk-desk&id=' + id + '&from=' + from + '&to=' + to + '&boa=' + boa + '&desk=' + desk
												// }).done(function (responseText) {
												// 	HROS.VAR.isAppMoving = false;
												// });
											}
										}
									} else {
										HROS.app.dataDeskToDesk(id, from, to, boa, desk);
									}
								}
							}
						}
					});
				}
			});
			//文件夹内应用拖动
			$('body').on('mousedown', '.folder_body .appbtn, .quick_view_container .appbtn', function (e) {
				e.preventDefault();
				e.stopPropagation();
				if (e.button === 0 || e.button === 1) {
					let oldobj = $(this);
					let obj = $('<div id="shortcut_shadow">' + oldobj.html() + '</div>');
					let dx = e.clientX;
					let dy = e.clientY;
					let cx = e.clientX;
					let cy = e.clientY;
					let x = dx - oldobj.offset().left;
					let y = dy - oldobj.offset().top;
					let lay = HROS.maskBox.desk();
					//绑定鼠标移动事件
					$(document).on('mousemove', function (e) {
						$('body').append(obj);
						lay.show();
						cx = e.clientX <= 0 ? 0 : e.clientX >= $(window).width() ? $(window).width() : e.clientX;
						cy = e.clientY <= 0 ? 0 : e.clientY >= $(window).height() ? $(window).height() : e.clientY;
						if (dx !== cx || dy !== cy) {
							obj.css({
								left: cx - x,
								top: cy - y
							}).show();
						}
					}).on('mouseup', function () {
						$(document).off('mousemove').off('mouseup');
						obj.remove();
						lay.hide();
						//判断是否移动应用，如果没有则判断为click事件
						if (dx === cx && dy === cy) {
							switch (oldobj.attr('type')) {
								case 'app':
								case 'window':
								case 'pwindow':
								case 'file':
									HROS.window.create(oldobj.attr('realappid'), oldobj.attr('type'));
									break;
								case 'widget':
								case 'pwidget':
									HROS.widget.create(oldobj.attr('realappid'), oldobj.attr('type'));
									break;
							}
							return false;
						}
						let movegrid = HROS.grid.searchFolderGrid(cx, cy);
						if (movegrid !== null) {
							if (oldobj.parents('.folder-window').attr('appid') !== movegrid) {
								let id = oldobj.attr('appid');
								let from = oldobj.index();
								let to = movegrid;
								let fromFolderId = oldobj.parents('.folder-window').attr('appid') || oldobj.parents('.quick_view_container').attr('appid');
								if (HROS.base.checkLogin()) {
									if (!HROS.app.checkIsMoving()) {
										if (HROS.app.dataFolderToFolder(id, from, to, fromFolderId)) {
											HROS.request.post('/desk/membermove', { model: { MoveType: 'folder-folder', MemberId: id, From: from, To: to } }, function (responseText) {
												if (responseText.IsSuccess) {
													HROS.VAR.isAppMoving = false;
												} else {
													NewCrm.msgbox.fail(responseText.Message);
												}
											})
										}
									}
								} else {
									HROS.app.dataFolderToFolder(id, from, to, fromFolderId);
								}
							}
						} else {
							let dock_w = HROS.CONFIG.dockPos.toLowerCase() === 'left' ? 0 : HROS.CONFIG.dockPos.toLowerCase() === 'top' ? ($(window).width() - $('#dock-container').width() + 20) / 2 : $(window).width() - $('#dock-container').width();
							let dock_h = HROS.CONFIG.dockPos.toLowerCase() === 'top' ? 0 : ($(window).height() - $('#dock-container').height() + 20) / 2;
							let movegrid = HROS.grid.searchDockAppGrid(cx - dock_w, cy - dock_h);
							if (movegrid !== null) {

								let movegrid2 = HROS.grid.searchDockAppGrid2(cx - dock_w, cy - dock_h);
								let id = oldobj.attr('appid');
								let from = oldobj.index();
								let to = movegrid;
								let fromFolderId = oldobj.parents('.folder-window').attr('appid') || oldobj.parents('.quick_view_container').attr('appid');
								let boa = movegrid2 % 2 === 0 ? 'b' : 'a';
								let desk = HROS.CONFIG.desk;
								if (HROS.base.checkLogin()) {
									if (!HROS.app.checkIsMoving()) {
										if (HROS.app.dataFolderToDock(id, from, to, fromFolderId, boa, desk)) {
											HROS.request.post('/desk/membermove', { model: { MoveType: 'folder-dock', MemberId: id, From: from, To: to } }, function (responseText) {
												if (responseText.IsSuccess) {
													HROS.VAR.isAppMoving = false;
												} else {
													NewCrm.msgbox.fail(responseText.Message);
												}
											})
										}
									}
								} else {
									HROS.app.dataFolderToDock(id, from, to, fromFolderId, boa, desk);
								}
							} else {
								let dock_w = HROS.CONFIG.dockPos.toLowerCase() === 'left' ? $('#dock-bar').width() : 0;
								let dock_h = HROS.CONFIG.dockPos.toLowerCase() === 'top' ? $('#dock-bar').height() : 0;
								let deskScrollLeft = $('#desk-' + HROS.CONFIG.desk + ' .desktop-apps-container').scrollLeft();
								let deskScrollTop = $('#desk-' + HROS.CONFIG.desk + ' .desktop-apps-container').scrollTop();
								let movegrid = HROS.grid.searchAppGrid(cx - dock_w + deskScrollLeft, cy - dock_h + deskScrollTop);
								if (movegrid !== null) {
									let movegrid2 = HROS.grid.searchAppGrid2(cx - dock_w + deskScrollLeft, cy - dock_h + deskScrollTop);
									let id = oldobj.attr('appid');
									let from = oldobj.index();
									let to = movegrid;
									let fromFolderId = oldobj.parents('.folder-window').attr('appid') || oldobj.parents('.quick_view_container').attr('appid');
									let boa = movegrid2 % 2 === 0 ? 'b' : 'a';
									let desk = HROS.CONFIG.desk;
									if (HROS.base.checkLogin()) {
										if (!HROS.app.checkIsMoving()) {
											if (HROS.app.dataFolderToDesk(id, from, to, fromFolderId, boa, desk)) {
												HROS.request.post('/desk/membermove', {
													model: { MoveType: 'folder-desk', MemberId: id, From: from, To: desk }
												}, function (responseText) {
													if (responseText.IsSuccess) {
														HROS.VAR.isAppMoving = false;
													} else {
														NewCrm.msgbox.fail(responseText.Message);
													}
												})
											}
										}
									} else {
										HROS.app.dataFolderToDesk(id, from, to, fromFolderId, boa, desk);
									}
								}
							}
						}
					});
				}
			});
		},
        /*
		**  加载滚动条
		*/
		getScrollbar: function () {
			setTimeout(function () {
				$('#desk .desktop-container').each(function () {
					let desk = $(this).children('.desktop-apps-container'), scrollbar = $(this).children('.scrollbar');
					let scrollbarLeft = desk.nextAll('.scrollbar-x').position().left, scrollbarTop = desk.nextAll('.scrollbar-y').position().top;
					//先清空所有附加样式
					scrollbar.hide();
					desk.scrollLeft(0).scrollTop(0);
                    /*
					**  判断应用排列方式
					**  横向排列超出屏幕则出现纵向滚动条，纵向排列超出屏幕则出现横向滚动条
					*/
					if (HROS.CONFIG.appXY.toLowerCase() === 'x') {
                        /*
						**  获得桌面应用定位好后的实际高度
						**  因为显示的高度是固定的，而实际的高度是根据应用个数会变化
						*/
						let deskH = parseInt(desk.children('.add').css('top')) + 108;
                        /*
						**  计算滚动条高度
						**  高度公式（应用纵向排列计算滚动条宽度以此类推）：
						**  滚动条实际高度 = 桌面显示高度 / 桌面实际高度 * 滚动条总高度(桌面显示高度)
						**  如果“桌面显示高度 / 桌面实际高度 >= 1”说明应用个数未能超出桌面，则不需要出现滚动条
						*/
						if (desk.height() / deskH < 1) {
							desk.nextAll('.scrollbar-y').height(desk.height() / deskH * desk.height());
							scrollbarTop = scrollbarTop + desk.nextAll('.scrollbar-y').height() > desk.height() ? desk.height() - desk.nextAll('.scrollbar-y').height() : scrollbarTop;
							desk.nextAll('.scrollbar-y').css('top', scrollbarTop).show();
							desk.scrollTop(scrollbarTop / desk.height() * deskH);
						}
					} else {
						let deskW = parseInt(desk.children('.add').css('left')) + 106;
						if (desk.width() / deskW < 1) {
							desk.nextAll('.scrollbar-x').width(desk.width() / deskW * desk.width());
							scrollbarLeft = scrollbarLeft + desk.nextAll('.scrollbar-x').width() > desk.width() ? desk.width() - desk.nextAll('.scrollbar-w').width() : scrollbarLeft;
							desk.nextAll('.scrollbar-x').css('left', scrollbarLeft).show();
							desk.scrollLeft(scrollbarLeft / desk.width() * deskW);
						}
					}
				});
			}, 500);
		},
        /*
		**  移动滚动条
		*/
		moveScrollbar: function () {
            /*
			**  手动拖动
			*/
			$('#desk .scrollbar').on('mousedown', function (e) {
				let x, y, cx, cy, deskrealw, deskrealh, movew, moveh;
				let scrollbar = $(this), desk = scrollbar.prevAll('.desktop-apps-container');
				deskrealw = parseInt(desk.children('.add').css('left')) + 106;
				deskrealh = parseInt(desk.children('.add').css('top')) + 108;
				movew = desk.width() - scrollbar.width();
				moveh = desk.height() - scrollbar.height();
				if (scrollbar.hasClass('scrollbar-x')) {
					x = e.clientX - scrollbar.position().left;
				} else {
					y = e.clientY - scrollbar.position().top;
				}
				$(document).on('mousemove', function (e) {
					if (scrollbar.hasClass('scrollbar-x')) {
						cx = e.clientX - x < 0 ? 0 : e.clientX - x > movew ? movew : e.clientX - x;
						scrollbar.css('left', cx);
						desk.scrollLeft(cx / desk.width() * deskrealw);
					} else {
						cy = e.clientY - y < 0 ? 0 : e.clientY - y > moveh ? moveh : e.clientY - y;
						scrollbar.css('top', cy);
						desk.scrollTop(cy / desk.height() * deskrealh);
					}
				}).on('mouseup', function () {
					$(this).off('mousemove').off('mouseup');
				});
			});
            /*
			**  鼠标滚动
			*/
			for (let i = 1; i <= 5; i++) {
				$('#desk-' + i).on('mousewheel', function (event, delta) {
					let desk = $(this).find('.desktop-apps-container');

					if (HROS.CONFIG.appXY.toLowerCase() === 'x') {
						let deskrealh = parseInt(desk.find('.add').css('top')) + 108, scrollupdown;
                        /*
						**  delta === -1   往下
						**  delta === 1    往上
						**  200px 是鼠标滚轮每滚一次的距离
						*/
						if (delta < 0) {
							scrollupdown = desk.scrollTop() + 200 > deskrealh - desk.height() ? deskrealh - desk.height() : desk.scrollTop() + 200;
						} else {
							scrollupdown = desk.scrollTop() - 200 < 0 ? 0 : desk.scrollTop() - 200;
						}
						desk.stop(false, true).animate({ scrollTop: scrollupdown }, 300);
						desk.nextAll('.scrollbar-y').stop(false, true).animate({
							top: scrollupdown / deskrealh * desk.height()
						}, 300);
					} else {
						let deskrealw = parseInt(desk.find('.add').css('left')) + 106, scrollleftright;
						if (delta < 0) {
							scrollleftright = desk.scrollLeft() + 200 > deskrealw - desk.width() ? deskrealw - desk.width() : desk.scrollLeft() + 200;
						} else {
							scrollleftright = desk.scrollLeft() - 200 < 0 ? 0 : desk.scrollLeft() - 200;
						}
						desk.stop(false, true).animate({ scrollLeft: scrollleftright }, 300);
						desk.nextAll('.scrollbar-x').stop(false, true).animate({
							left: scrollleftright / deskrealw * desk.width()
						}, 300);
					}
				});
			}
		},
		checkIsMoving: function () {
			let rtn = false;
			if (HROS.VAR.isAppMoving) {
				$.dialog({
					title: '温馨提示',
					icon: 'warning',
					content: '数据正在处理中，请稍后。',
					ok: true
				});
				rtn = true;
			} else {
				HROS.VAR.isAppMoving = true;
			}
			return rtn;
		},
		dataWarning: function () {
			$.dialog({
				title: '温馨提示',
				icon: 'warning',
				content: '数据错误，请刷新后重试。',
				ok: true
			});
		},
		dataDockToFolder: function (id, from, to) {
			let rtn = false;

			$(HROS.VAR.dock).each(function (i) {
				if (this.memberId === parseInt(id)) {

					$(HROS.VAR.folder).each(function (j) {
						if (this.memberId === parseInt(to)) {
							HROS.VAR.folder[j].apps.push(HROS.VAR.dock[i]);
							HROS.VAR.folder[j].apps = HROS.VAR.folder[j].apps.sortBy(function (n) {
								return n.memberId;
							}, true);
							HROS.VAR.dock.splice(i, 1);
							rtn = true;
							return false;
						}
					});
					return false;
				}
			});
			if (rtn) {
				if ($('#desktop').is(':visible')) {
					HROS.app.set();
				} else {
					HROS.appmanage.set();
				}
			} else {
				HROS.app.dataWarning();
			}
			return rtn;
		},
		dataDockToDock: function (id, from, to, boa) {
			let rtn = false;

			if (HROS.VAR.dock[from] !== null) {
				if (to === 0) {
					if (boa === 'b') {
						HROS.VAR.dock.splice(0, 0, HROS.VAR.dock[from]);
					} else {
						HROS.VAR.dock.splice(1, 0, HROS.VAR.dock[from]);
					}
				} else {
					if (boa === 'b') {
						HROS.VAR.dock.splice(to, 0, HROS.VAR.dock[from]);
					} else {
						HROS.VAR.dock.splice(to + 1, 0, HROS.VAR.dock[from]);
					}
				}
				if (from > to) {
					HROS.VAR.dock.splice(from + 1, 1);
				} else {
					HROS.VAR.dock.splice(from, 1);
				}
				rtn = true;
			}
			if (rtn) {
				if ($('#desktop').is(':visible')) {
					HROS.app.set();
				} else {
					HROS.appmanage.set();
				}
			} else {
				HROS.app.dataWarning();
			}
			return rtn;
		},
		dataDockToDesk: function (id, from, to, boa, desk) {
			let rtn = false;
			desk = eval('HROS.VAR.desk' + desk);
			if (HROS.VAR.dock[from] !== null) {
				if (to === 0) {
					if (boa === 'b') {
						desk.splice(0, 0, HROS.VAR.dock[from]);
					} else {
						desk.splice(1, 0, HROS.VAR.dock[from]);
					}
				} else {
					if (boa === 'b') {
						desk.splice(to, 0, HROS.VAR.dock[from]);
					} else {
						desk.splice(to + 1, 0, HROS.VAR.dock[from]);
					}
				}
				HROS.VAR.dock.splice(from, 1);
				rtn = true;
			}
			if (rtn) {
				if ($('#desktop').is(':visible')) {
					HROS.app.set();
				} else {
					HROS.appmanage.set();
				}
			} else {
				HROS.app.dataWarning();
			}
			return rtn;
		},
		dataDockToOtherdesk: function (id, from, todesk) {
			let rtn = false;
			todesk = eval('HROS.VAR.desk' + todesk);
			if (HROS.VAR.dock[from] !== null) {
				todesk.push(HROS.VAR.dock[from]);
				HROS.VAR.dock.splice(from, 1);
				rtn = true;
			}
			if (rtn) {
				if ($('#desktop').is(':visible')) {
					HROS.app.set();
				} else {
					HROS.appmanage.set();
				}
			} else {
				HROS.app.dataWarning();
			}
			return rtn;
		},
		dataDockToDelete: function (id, from) {
			let rtn = false;
			if (HROS.VAR.dock[from] !== null) {
				HROS.VAR.dock.splice(from, 1);
				rtn = true;
			}
			if (rtn) {
				if ($('#desktop').is(':visible')) {
					HROS.app.set();
				} else {
					HROS.appmanage.set();
				}
			} else {
				HROS.app.dataWarning();
			}
			return rtn;
		},
		dataDeskToFolder: function (id, from, to, desk) {
			let rtn = false;
			desk = eval('HROS.VAR.desk' + desk);

			$(HROS.VAR.folder).each(function (i) {
				if (this.memberId === parseInt(to) && desk[from] !== null) {
					HROS.VAR.folder[i].apps.push(desk[from]);
					HROS.VAR.folder[i].apps = HROS.VAR.folder[i].apps.sortBy(function (n) {
						return n.memberId;
					}, true);
					desk.splice(from, 1);
					rtn = true;
					return false;
				}
			});
			if (rtn) {
				if ($('#desktop').is(':visible')) {
					HROS.app.set();
				} else {
					HROS.appmanage.set();
				}
			} else {
				HROS.app.dataWarning();
			}
			return rtn;
		},
		dataDeskToDock: function (id, from, to, boa, desk) {
			let rtn = false;
			desk = eval('HROS.VAR.desk' + desk);
			if (desk[from] !== null) {
				if (to === 0) {
					if (boa === 'b') {
						HROS.VAR.dock.splice(0, 0, desk[from]);
					} else {
						HROS.VAR.dock.splice(1, 0, desk[from]);
					}
				} else {
					if (boa === 'b') {
						HROS.VAR.dock.splice(to, 0, desk[from]);
					} else {
						HROS.VAR.dock.splice(to + 1, 0, desk[from]);
					}
				}
				desk.splice(from, 1);
				if (HROS.VAR.dock.length > 7) {
					desk.push(HROS.VAR.dock[7]);
					HROS.VAR.dock.splice(7, 1);
				}
				rtn = true;
			}
			if (rtn) {
				if ($('#desktop').is(':visible')) {
					HROS.app.set();
				} else {
					HROS.appmanage.set();
				}
			} else {
				HROS.app.dataWarning();
			}
			return rtn;
		},
		dataDeskToDesk: function (id, from, to, boa, desk) {
			let rtn = false;
			desk = eval('HROS.VAR.desk' + desk);
			if (desk[from] !== null) {
				if (to === 0) {
					if (boa === 'b') {
						desk.splice(0, 0, desk[from]);
					} else {
						desk.splice(1, 0, desk[from]);
					}
				} else {
					if (boa === 'b') {
						desk.splice(to, 0, desk[from]);
					} else {
						desk.splice(to + 1, 0, desk[from]);
					}
				}
				if (from > to) {
					desk.splice(from + 1, 1);
				} else {
					desk.splice(from, 1);
				}
				rtn = true;
			}
			if (rtn) {
				if ($('#desktop').is(':visible')) {
					HROS.app.set();
				} else {
					HROS.appmanage.set();
				}
			} else {
				HROS.app.dataWarning();
			}
			return rtn;
		},
		dataDeskToOtherdesk: function (id, from, to, boa, todesk, fromdesk) {

			let rtn = false;
			fromdesk = eval('HROS.VAR.desk' + fromdesk);
			todesk = eval('HROS.VAR.desk' + todesk);
			if (fromdesk[from] !== null) {
				if (to === 0) {
					if (boa === 'b') {
						todesk.splice(0, 0, fromdesk[from]);
					} else {
						todesk.splice(1, 0, fromdesk[from]);
					}
				} else {
					if (boa === 'b') {
						todesk.splice(to, 0, fromdesk[from]);
					} else {
						todesk.splice(to + 1, 0, fromdesk[from]);
					}
				}
				fromdesk.splice(from, 1);
				rtn = true;
			}
			if (rtn) {
				if ($('#desktop').is(':visible')) {
					HROS.app.set();
				} else {
					HROS.appmanage.set();
				}
			} else {
				HROS.app.dataWarning();
			}
			return rtn;
		},
		dataFolderToFolder: function (id, from, to, fromFolderId) {
			let rtn = false, flags = 0, fromKey, toKey;

			$(HROS.VAR.folder).each(function (i) {
				if (this.memberId === parseInt(fromFolderId) && HROS.VAR.folder[i].apps[from] !== null) {
					fromKey = i;
					flags += 1;
				}
				if (this.memberId === parseInt(to)) {
					toKey = i;
					flags += 1;
				}
			});
			if (flags === 2) {
				HROS.VAR.folder[toKey].apps.push(HROS.VAR.folder[fromKey].apps[from]);
				HROS.VAR.folder[toKey].apps = HROS.VAR.folder[toKey].apps.sortBy(function (n) {
					return n.appid;
				}, true);
				HROS.VAR.folder[fromKey].apps.splice(from, 1);
				rtn = true;
			}
			if (rtn) {
				if ($('#desktop').is(':visible')) {
					HROS.app.set();
				} else {
					HROS.appmanage.set();
				}
			} else {
				HROS.app.dataWarning();
			}
			return rtn;
		},
		dataFolderToDock: function (id, from, to, fromFolderId, boa, desk) {
			let rtn = false;
			desk = eval('HROS.VAR.desk' + desk);

			$(HROS.VAR.folder).each(function (i) {
				if (this.memberId === parseInt(fromFolderId) && HROS.VAR.folder[i].apps[from] !== null) {
					if (to === 0) {
						if (boa === 'b') {
							HROS.VAR.dock.splice(0, 0, HROS.VAR.folder[i].apps[from]);
						} else {
							HROS.VAR.dock.splice(1, 0, HROS.VAR.folder[i].apps[from]);
						}
					} else {
						if (boa === 'b') {
							HROS.VAR.dock.splice(to, 0, HROS.VAR.folder[i].apps[from]);
						} else {
							HROS.VAR.dock.splice(to + 1, 0, HROS.VAR.folder[i].apps[from]);
						}
					}
					HROS.VAR.folder[i].apps.splice(from, 1);
					if (HROS.VAR.dock.length > 7) {
						desk.push(HROS.VAR.dock[7]);
						HROS.VAR.dock.splice(7, 1);
					}
					rtn = true;
					return false;
				}
			});
			if (rtn) {
				if ($('#desktop').is(':visible')) {
					HROS.app.set();
				} else {
					HROS.appmanage.set();
				}
			} else {
				HROS.app.dataWarning();
			}
			return rtn;
		},
		dataFolderToDesk: function (id, from, to, fromFolderId, boa, desk) {
			let rtn = false;
			desk = eval('HROS.VAR.desk' + desk);

			$(HROS.VAR.folder).each(function (i) {
				if (this.memberId === parseInt(fromFolderId) && HROS.VAR.folder[i].apps[from] !== null) {
					if (to === 0) {
						if (boa === 'b') {
							desk.splice(0, 0, HROS.VAR.folder[i].apps[from]);
						} else {
							desk.splice(1, 0, HROS.VAR.folder[i].apps[from]);
						}
					} else {
						if (boa === 'b') {
							desk.splice(to, 0, HROS.VAR.folder[i].apps[from]);
						} else {
							desk.splice(to + 1, 0, HROS.VAR.folder[i].apps[from]);
						}
					}
					HROS.VAR.folder[i].apps.splice(from, 1);
					rtn = true;
					return false;
				}
			});
			if (rtn) {
				if ($('#desktop').is(':visible')) {
					HROS.app.set();
				} else {
					HROS.appmanage.set();
				}
			} else {
				HROS.app.dataWarning();
			}
			return rtn;
		},
		dataFolderToOtherdesk: function (id, from, todesk, fromFolderId) {
			let rtn = false;
			todesk = eval('HROS.VAR.desk' + todesk);

			$(HROS.VAR.folder).each(function (i) {
				if (this.memberId === parseInt(fromFolderId) && HROS.VAR.folder[i].apps[from] !== null) {
					todesk.push(HROS.VAR.folder[i].apps[from]);
					HROS.VAR.folder[i].apps.splice(from, 1);
					rtn = true;
					return false;
				}
			});
			if (rtn) {
				if ($('#desktop').is(':visible')) {
					HROS.app.set();
				} else {
					HROS.appmanage.set();
				}
			} else {
				HROS.app.dataWarning();
			}
			return rtn;
		},
		dataAllDockToDesk: function (desk) {
			desk = eval('HROS.VAR.desk' + desk);
			$(HROS.VAR.dock).each(function (i) {
				desk.push(HROS.VAR.dock[i]);
			});
			HROS.VAR.dock.splice(0, HROS.VAR.dock.length);
		},
		dataDeleteByAppid: function (appid) {
			$(HROS.VAR.dock).each(function (i) {
				if (this.appid === appid) {
					HROS.VAR.dock.splice(i, 1);
					return false;
				}
			});

			for (let i = 1; i <= 5; i++) {

				let desk = eval('HROS.VAR.desk' + i);
				$(desk).each(function (j) {
					if (this.appid === appid) {
						desk.splice(j, 1);
						if (this.type === 'folder') {
							$(HROS.VAR.folder).each(function (k) {
								if (this.appid === appid) {
									HROS.VAR.folder.splice(k, 1);
									return false;
								}
							});
						}
						return false;
					}
				});
			}
			$(HROS.VAR.folder).each(function (i) {
				$(this.apps).each(function (j) {
					if (this.appid === appid) {
						HROS.VAR.folder[i].apps.splice(j, 1);
						return false;
					}
				});
			});
		}
	}
})();/*
**  全局视图
*/
HROS.appmanage = (function () {
	return {
        /*
		**  初始化
		*/
		init: function () {
			$('#appmanage .amg_close').off('click').on('click', function () {
				HROS.appmanage.close();
			});
			$('#amg_folder_container').on('contextmenu', '.appbtn', function () {
				return false;
			});
			HROS.appmanage.move();
			HROS.appmanage.moveScrollbar();
		},
		set: function () {
			$('#desktop').hide();
			$('#appmanage').show();
			$('#amg_folder_container .folderItem').show().addClass('folderItem_turn');
			$('#amg_folder_container .folderInner').height($(window).height() - 80);
			//加载应用码头应用
			let dockAppend = '';
			if (HROS.VAR.dock !== '') {

				$(HROS.VAR.dock).each(function (i) {
					dockAppend += appbtnTemp({
						'title': this.name,
						'type': this.type,
						'id': 'd_' + this.memberId,
						'appid': this.memberId,
						'realappid': this.appId == 0 ? this.memberId : this.appId,
						'imgsrc': this.icon
					});
				});
			}
			$('#amg_dock_container').html(dockAppend);
			//加载桌面应用
			for (let j = 0; j < HROS.CONFIG.deskCount; j++) {
				let desk_append = '', desk = eval('HROS.VAR.desk' + (j + 1));
				if (desk !== '') {
					$(desk).each(function (i) {
						desk_append += appbtnTemp({
							'title': this.name,
							'type': this.type,
							'id': 'd_' + this.memberId,
							'appid': this.memberId,
							'realappid': this.appId == 0 ? this.memberId : this.appId,
							'imgsrc': this.icon,
							'appsize': 26
						});
					});
				}
				$('#amg_folder_container .folderItem:eq(' + j + ') .folderInner .appbtn').remove();
				$('#amg_folder_container .folderItem:eq(' + j + ') .folderInner').append(desk_append);
			}
			HROS.appmanage.setPos();
			HROS.appmanage.getScrollbar();
		},
		setPos: function () {
			let manageDockGrid = HROS.grid.getManageDockAppGrid(), manageAppGrid = HROS.grid.getManageAppGrid();
			$('#amg_dock_container .appbtn').each(function (i) {
				$(this).css({
					top: 10,
					left: manageDockGrid[i]['startX'] + 6
				});
			});
			for (let j = 0; j < 5; j++) {
				$('#amg_folder_container .folderItem:eq(' + j + ') .folderInner .appbtn').each(function (i) {
					$(this).css({
						top: manageAppGrid[i]['startY'] + 5,
						left: 0
					});
				});
			}
		},
		move: function () {
			$('#amg_dock_container').on('mousedown', '.appbtn', function (e) {
				e.preventDefault();
				e.stopPropagation();
				if (e.button === 0 || e.button === 1) {
					let oldobj = $(this);
					let obj = $('<div id="shortcut_shadow">' + oldobj.html() + '</div>');
					let dx = e.clientX;
					let dy = e.clientY;
					let cx = e.clientX;
					let cy = e.clientY;
					let x = dx - oldobj.offset().left;
					let y = dy - oldobj.offset().top;
					let lay = HROS.maskBox.desk();
					//绑定鼠标移动事件
					$(document).on('mousemove', function (e) {
						$('body').append(obj);
						lay.show();
						cx = e.clientX <= 0 ? 0 : e.clientX >= $(window).width() ? $(window).width() : e.clientX;
						cy = e.clientY <= 0 ? 0 : e.clientY >= $(window).height() ? $(window).height() : e.clientY;
						if (dx !== cx || dy !== cy) {
							obj.css({
								left: cx - x,
								top: cy - y
							}).show();
						}
					}).on('mouseup', function () {

						$(document).off('mousemove').off('mouseup');
						obj.remove();
						lay.hide();
						//判断是否移动应用，如果没有则判断为click事件

						if (dx === cx && dy === cy) {
							HROS.appmanage.close();
							switch (oldobj.attr('type')) {
								case 'widget':
								case 'pwidget':
									HROS.widget.create(oldobj.attr('realappid'), oldobj.attr('type'));
									break;
								case 'window':
								case 'pwindow':
								case 'folder':
									HROS.window.create(oldobj.attr('realappid'), oldobj.attr('type'));
									break;
							}
							return false;
						}
						if (cy <= 80) {
							let movegrid = HROS.grid.searchManageDockAppGrid(cx);
							if (movegrid != null && movegrid != oldobj.index()) {
								let movegrid2 = HROS.grid.searchManageDockAppGrid2(cx);
								let id = oldobj.attr('appid');
								let from = oldobj.index();
								let to = movegrid;
								let boa = movegrid2 % 2 == 0 ? 'b' : 'a';
								if (HROS.base.checkLogin()) {
									if (!HROS.app.checkIsMoving()) {
										if (HROS.app.dataDockToDock(id, from, to, boa)) {
											// 
											// $.ajax({
											// 	type: 'POST',
											// 	url: ajaxUrl,
											// 	data: 'ac=moveMyApp&movetype=dock-dock&id=' + id + '&from=' + from + '&to=' + to + '&boa=' + boa
											// }).done(function (responseText) {
											// 	HROS.VAR.isAppMoving = false;
											// });
										}
									}
								} else {
									HROS.app.dataDockToDock(id, from, to, boa);
								}
							}
						} else {
							let movedesk = parseInt(cx / ($(window).width() / 5));
							let movegrid = HROS.grid.searchManageAppGrid(cy - 80 + $('#amg_folder_container .folderItem:eq(' + movedesk + ') .folderInner').scrollTop());
							if (movegrid != null) {
								let movegrid2 = HROS.grid.searchManageAppGrid2(cy - 80 + $('#amg_folder_container .folderItem:eq(' + movedesk + ') .folderInner').scrollTop());
								let id = oldobj.attr('appid');
								let from = oldobj.index();
								let to = movegrid;
								let boa = movegrid2 % 2 == 0 ? 'b' : 'a';
								let desk = movedesk + 1;
								if (HROS.base.checkLogin()) {
									if (!HROS.app.checkIsMoving()) {
										if (HROS.app.dataDockToDesk(id, from, to, boa, desk)) {
											HROS.request.post('/desk/membermove', { model: { MoveType: 'dock-desk', MemberId: id, From: from, To: desk } }, function (responseText) {
												if (responseText.IsSuccess) {
													HROS.VAR.isAppMoving = false;
												} else {
													NewCrm.msgbox.fail(responseText.Message);
												}
											})
										}
									}
								} else {
									HROS.app.dataDockToDesk(id, from, to, boa, desk);
								}
							}
						}
					});
				}
				return false;
			});
			$('#amg_folder_container').on('mousedown', '.appbtn:not(.add)', function (e) {
				e.preventDefault();
				e.stopPropagation();
				if (e.button == 0 || e.button == 1) {
					let oldobj = $(this);
					let obj = $('<div id="shortcut_shadow2">' + oldobj.html() + '</div>');
					let dx = e.clientX;
					let dy = e.clientY;
					let cx = e.clientX;
					let cy = e.clientY;
					let x = dx - oldobj.offset().left;
					let y = dy - oldobj.offset().top;
					let lay = HROS.maskBox.desk();
					//绑定鼠标移动事件
					$(document).on('mousemove', function (e) {
						$('body').append(obj);
						lay.show();
						cx = e.clientX <= 0 ? 0 : e.clientX >= $(window).width() ? $(window).width() : e.clientX;
						cy = e.clientY <= 0 ? 0 : e.clientY >= $(window).height() ? $(window).height() : e.clientY;
						if (dx != cx || dy != cy) {
							obj.css({
								left: cx - x,
								top: cy - y
							}).show();
						}
					}).on('mouseup', function () {

						$(document).off('mousemove').off('mouseup');
						obj.remove();
						lay.hide();
						//判断是否移动应用，如果没有则判断为click事件

						if (dx == cx && dy == cy) {
							HROS.appmanage.close();
							switch (oldobj.attr('type')) {
								case 'app':
									HROS.window.create(oldobj.attr('realappid'), oldobj.attr('type'));
									break;
								case 'widget':
								case 'pwidget':
									HROS.widget.create(oldobj.attr('realappid'), oldobj.attr('type'));
									break;
								case 'window':
								case 'pwindow':
								case 'folder':
									HROS.window.create(oldobj.attr('realappid'), oldobj.attr('type'));
									break;
							}
							return false;
						}
						if (cy <= 80) {
							function next() {
								let movegrid = HROS.grid.searchManageDockAppGrid(cx);
								if (movegrid != null) {
									let movegrid2 = HROS.grid.searchManageDockAppGrid2(cx);
									let id = oldobj.attr('appid');
									let from = oldobj.index();
									let to = movegrid;
									let boa = movegrid2 % 2 == 0 ? 'b' : 'a';
									let desk = oldobj.parent().attr('desk');
									if (HROS.base.checkLogin()) {
										if (!HROS.app.checkIsMoving()) {
											if (HROS.app.dataDeskToDock(id, from, to, boa, desk)) {
												// 
												// $.ajax({
												// 	type: 'POST',
												// 	url: ajaxUrl,
												// 	data: 'ac=moveMyApp&movetype=desk-dock&id=' + id + '&from=' + from + '&to=' + to + '&boa=' + boa + '&desk=' + desk
												// }).done(function (responseText) {
												// 	HROS.VAR.isAppMoving = false;
												// });
											}
										}
									} else {
										HROS.app.dataDeskToDock(id, from, to, boa, desk);
									}
								}
							}
							if (HROS.CONFIG.dockPos.toLowerCase() == 'none') {
								$.dialog({
									title: '温馨提示',
									icon: 'warning',
									content: '当前应用码头处于停用状态，是否开启？',
									ok: function () {
										HROS.dock.updatePos('top');
										next();
									},
									cancel: true
								});
							} else {
								next();
							}
						} else {
							let movedesk = parseInt(cx / ($(window).width() / 5));
							let movegrid = HROS.grid.searchManageAppGrid(cy - 80 + $('#amg_folder_container .folderItem:eq(' + movedesk + ') .folderInner').scrollTop());
							//判断是在同一桌面移动，还是跨桌面移动
							if (movedesk + 1 == oldobj.parent().attr('desk')) {
								if (movegrid != null && movegrid != oldobj.index()) {
									let movegrid2 = HROS.grid.searchManageAppGrid2(cy - 80 + $('#amg_folder_container .folderItem:eq(' + movedesk + ') .folderInner').scrollTop());
									let id = oldobj.attr('appid');
									let from = oldobj.index();
									let to = movegrid;
									let boa = movegrid2 % 2 == 0 ? 'b' : 'a';
									let desk = movedesk + 1;
									if (HROS.base.checkLogin()) {
										if (!HROS.app.checkIsMoving()) {
											if (HROS.app.dataDeskToDesk(id, from, to, boa, desk)) {
												// $.ajax({
												// 	type: 'POST',
												// 	url: ajaxUrl,
												// 	data: 'ac=moveMyApp&movetype=desk-desk&id=' + id + '&from=' + from + '&to=' + to + '&boa=' + boa + '&desk=' + desk
												// }).done(function (responseText) {
												// 	HROS.VAR.isAppMoving = false;
												// });
											}
										}
									} else {
										HROS.app.dataDeskToDesk(id, from, to, boa, desk);
									}
								}
							} else {
								if (movegrid != null) {
									let movegrid2 = HROS.grid.searchManageAppGrid2(cy - 80 + $('#amg_folder_container .folderItem:eq(' + movedesk + ') .folderInner').scrollTop());
									let id = oldobj.attr('appid');
									let from = oldobj.index();
									let to = movegrid;
									let boa = movegrid2 % 2 == 0 ? 'b' : 'a';
									let todesk = movedesk + 1;
									let fromdesk = oldobj.parent().attr('desk');
									if (HROS.base.checkLogin()) {
										if (!HROS.app.checkIsMoving()) {
											if (HROS.app.dataDeskToOtherdesk(id, from, to, boa, todesk, fromdesk)) {
												HROS.request.post('/desk/membermove', { model: { MoveType: 'desk-desk', MemberId: id, From: from, To: todesk } }, function (responseText) {
													if (responseText.IsSuccess) {
														HROS.VAR.isAppMoving = false;
													} else {
														NewCrm.msgbox.fail(responseText.Message);
													}
												})
											}
										}
									} else {
										HROS.app.dataDeskToOtherdesk(id, from, to, boa, todesk, fromdesk);
									}
								}
							}
						}
					});
				}
				return false;
			});
		},
		getScrollbar: function () {
			$('#amg_folder_container .folderInner').height($(window).height() - 80);
			$('#amg_folder_container .folderItem').each(function () {
				let desk = $(this).find('.folderInner'), deskrealh = parseInt(desk.children('.appbtn:last').css('top')) + 41, scrollbar = desk.next('.scrollBar');
				//记录下滚动条更新前的位置，用于更新后的复原
				let scrollbarTop = scrollbar.position().top;
				//先清空所有附加样式
				scrollbar.hide();
				desk.scrollTop(0);
				if (desk.height() / deskrealh < 1) {
					scrollbar.height(desk.height() / deskrealh * desk.height());
					scrollbarTop = scrollbarTop + scrollbar.height() > desk.height() ? desk.height() - scrollbar.height() : scrollbarTop;
					scrollbar.css('top', scrollbarTop).show();
					desk.scrollTop(scrollbarTop / desk.height() * deskrealh);
				}
			});
		},
		moveScrollbar: function () {
            /*
			**  手动拖动
			*/
			$('.scrollBar').on('mousedown', function (e) {
				let y, cy, deskrealh, moveh;
				let scrollbar = $(this), desk = scrollbar.prev('.folderInner');
				deskrealh = parseInt(desk.children('.appbtn:last').css('top')) + 41;
				moveh = desk.height() - scrollbar.height();
				y = e.clientY - scrollbar.offset().top;
				$(document).on('mousemove', function (e) {
					//减80px是因为顶部dock区域的高度为80px，所以计算移动距离需要先减去80px
					cy = e.clientY - y - 80 < 0 ? 0 : e.clientY - y - 80 > moveh ? moveh : e.clientY - y - 80;
					scrollbar.css('top', cy);
					desk.scrollTop(cy / desk.height() * deskrealh);
				}).on('mouseup', function () {
					$(this).off('mousemove').off('mouseup');
				});
			});
            /*
			**  鼠标滚轮
			*/
			$('#amg_folder_container .folderInner').on('mousewheel', function (event, delta) {
				let desk = $(this), deskrealh = parseInt(desk.children('.appbtn:last').css('top')) + 41, scrollupdown;
                /*
				**  delta == -1   往下
				**  delta == 1    往上
				*/
				if (delta < 0) {
					scrollupdown = desk.scrollTop() + 120 > deskrealh - desk.height() ? deskrealh - desk.height() : desk.scrollTop() + 120;
				} else {
					scrollupdown = desk.scrollTop() - 120 < 0 ? 0 : desk.scrollTop() - 120;
				}
				desk.stop(false, true).animate({
					scrollTop: scrollupdown
				}, 300);
				desk.next('.scrollBar').stop(false, true).animate({
					top: scrollupdown / deskrealh * desk.height()
				}, 300);
			});
		},
		resize: function () {
			HROS.appmanage.getScrollbar();
		},
		close: function () {
			$('#amg_dock_container').html('');
			$('#amg_folder_container .folderInner').html('');
			$('#desktop').show();
			$('#appmanage').hide();
			$('#amg_folder_container .folderItem').removeClass('folderItem_turn');
			HROS.app.set();
			HROS.deskTop.resize();
		}
	}
})();/*
**  一个不属于其他模块的模块
*/
HROS.base = (function () {
	return {
        /*
		**	系统初始化
		*/
		init: function () {
			//更新当前用户ID
			HROS.CONFIG.memberID = $.parseJSON($.cookie('User')).Id;

			//阻止弹出浏览器默认右键菜单
			$('body').on('contextmenu', function () {
				return false;
			});

			HROS.signalR.init();

			//加载皮肤
			HROS.base.getSkin(undefined, function (arg) {
				HROS.base.setSkin(arg, null);
			});
			//用于判断网页是否缩放
			HROS.zoom.init();

			//桌面(容器)初始化
			HROS.deskTop.init();

			//初始化壁纸
			HROS.wallpaper.init();

			//初始化搜索栏
			HROS.searchbar.init();

			//初始化开始菜单
			HROS.startmenu.init();

			//初始化任务栏
			HROS.taskbar.init();

			//初始化应用码头
			HROS.dock.init();

			//初始化桌面应用
			HROS.app.init();

			//初始化widget模块
			HROS.widget.init();

			//初始化窗口模块
			HROS.window.init();

			//初始化文件夹预览
			HROS.folderView.init();

			//初始化全局视图
			HROS.appmanage.init();

			//初始化右键菜单
			HROS.popupMenu.init();

			//初始化锁屏
			HROS.lock.init();

			//初始化快捷键
			HROS.hotkey.init();

			//页面加载后运行
			HROS.base.run();
		},
		login: function () {
			$('.login').animate({
				top: 0
			}, 500, function () {
				changeTabindex('login');
			});
		},
		logout: function () {
			HROS.signalR.stop(function () {
				HROS.request.get('/desk/logout', {}, function (responseText) {
					location.reload();
				})
			});
		},
		checkLogin: function () {
			return parseInt(HROS.CONFIG.memberID) !== 0 ? true : false;
		},
		getSkin: function (objSkin, callback) {
			if (objSkin === undefined) {
				HROS.request.get('/desk/getskin', {}, function (responseText) {
					if (responseText.IsSuccess) {
						if (typeof (callback) === 'function') {
							callback && callback(responseText.Model);
						}
					}
				})
			} else {
				this.setSkin(objSkin, callback);
			}
		},

		setSkin: function (skin, callback) {
			function styleOnload(node, callback) {
				// for IE6-9 and Opera
				if (node.attachEvent) {
					node.attachEvent('onload', callback);
				}
				else {
					setTimeout(function () {
						poll(node, callback);
					}, 0); // for cache
				}
			}
			function poll(node, callback) {
				if (callback.isCalled) {
					return;
				}
				let isLoaded = false;
				//webkit
				if (/webkit/i.test(navigator.userAgent)) {
					if (node['sheet']) {
						isLoaded = true;
					}
				}
				// for Firefox
				else if (node['sheet']) {
					try {
						if (node['sheet'].cssRules) {
							isLoaded = true;
						}
					} catch (ex) {
						// NS_ERROR_DOM_SECURITY_ERR
						if (ex.code === 1000) {
							isLoaded = true;
						}
					}
				}
				if (isLoaded) {
					// give time to render.
					setTimeout(function () {
						callback();
					}, 1);
				} else {
					setTimeout(function () {
						poll(node, callback);
					}, 1);
				}
			}
			//将原样式修改id，并载入新样式
			$('#window-skin').attr('id', 'window-skin-ready2remove');
			let css = document.createElement('link');
			css.href = '/images/skins/' + skin + '.css?' + version;
			css.rel = 'stylesheet'
			css.id = 'window-skin';
			$('head').append(css);
			//新样式载入完毕后清空原样式
			//方法为参考seajs源码并改编，文章地址：http://www.blogjava.net/Hafeyang/archive/2011/10/08/360183.html
			styleOnload(css, function () {
				$('#window-skin-ready2remove').remove();
				HROS.CONFIG.skin = skin;
				callback && callback();
			});
		},
		run: function () {
			let url = location.search;
			let request = new Object();
			if (url.indexOf("?") !== -1) {
				let str = url.substr(1);
				let strs = str.split("&");
				for (let i = 0; i < strs.length; i++) {
					request[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
				}
			}
			if (typeof (request['run']) != 'undefined' && typeof (request['type']) != 'undefined') {

				if (request['type'] === 'app') {
					HROS.window.create(request['run']);
				} else {
					//判断挂件是否存在cookie中，因为如果存在则自动会启动
					if (!HROS.widget.checkCookie(request['run'], request['type'])) {
						HROS.widget.create(request['run']);
					}
				}
			}
		}
	};
})();/*
**  桌面
*/
HROS.deskTop = (function () {
	return {
		init: function () {
			//绑定浏览器resize事件
			$(window).on('resize', function () {
				HROS.deskTop.resize();
			});
			$('body').on('click', '#desktop', function () {
				HROS.popupMenu.hide();
				HROS.folderView.hide();
				HROS.searchbar.hide();
				HROS.startmenu.hide();
			}).on('contextmenu', '#desktop', function (e) {
				HROS.popupMenu.hide();
				HROS.folderView.hide();
				HROS.searchbar.hide();
				HROS.startmenu.hide();
				let popupmenu = HROS.popupMenu.desk();
				let l = ($(window).width() - e.clientX) < popupmenu.width() ? (e.clientX - popupmenu.width()) : e.clientX;
				let t = ($(window).height() - e.clientY) < popupmenu.height() ? (e.clientY - popupmenu.height()) : e.clientY;
				popupmenu.css({
					left: l,
					top: t
				}).show();
				return false;
			});
		},
        /*
		**  处理浏览器改变大小后的事件
		*/
		resize: function () {
			if ($('#desktop').is(':visible')) {
				HROS.dock.setPos();
				//更新应用定位

				HROS.app.setPos();
				//更新窗口定位
				HROS.window.setPos();
				//更新文件夹预览定位
				HROS.folderView.setPos();
			} else {
				HROS.appmanage.resize();
			}
			HROS.wallpaper.set(false);
		},
		updateDefaultDesk: function (i) {
			if (HROS.base.checkLogin()) {
				HROS.request.post('/desk/modifydefaultdesk', { deskNum: i }, function (responseText) {
					if (responseText.IsSuccess) {
						NewCrm.msgbox.success('默认桌面更新成功');
						$('.dock-pagination').find('a').each(function (k, v) {
							if (parseInt(i) === (k + 1)) {
								$(this).trigger('click');
							}
						});
					} else {
						NewCrm.msgbox.fail('默认桌面更新失败');
					}
				});
			}
		},
		modifyWallpaperSource: function (value) {
			if (HROS.base.checkLogin()) {
				HROS.request.post('/desk/modifywallpapersource', { source: value }, function (responseText) {
					if (responseText.IsSuccess) {
						HROS.wallpaper.get(function () { HROS.wallpaper.set() });
					} else {
						NewCrm.msgbox.fail(responseText.Message);
					}
				})
			}
		}
	};
})();/*
**  应用码头
*/
HROS.dock = (function () {
	return {
        /*
		**	初始化
		*/
		init: function () {
			HROS.dock.getPos(function () {
				HROS.dock.setPos();
			});
			//绑定应用码头拖动事件
			HROS.dock.move();
			let dockShowtopFunc;
			$('#dock-container').on('mouseenter', function () {
				dockShowtopFunc = setTimeout(function () {
					$('#dock-container').addClass('showtop');
				}, 300);
			}).on('mouseleave', function () {
				clearInterval(dockShowtopFunc);
				$(this).removeClass('showtop');
			});
			$('body').on('contextmenu', '#dock-container', function (e) {
				HROS.popupMenu.hide();
				HROS.folderView.hide();
				HROS.searchbar.hide();
				HROS.startmenu.hide();
				let popupmenu = HROS.popupMenu.dock();
				let l = ($(window).width() - e.clientX) < popupmenu.width() ? (e.clientX - popupmenu.width()) : e.clientX;
				let t = ($(window).height() - e.clientY) < popupmenu.height() ? (e.clientY - popupmenu.height()) : e.clientY;
				popupmenu.css({
					left: l,
					top: t
				}).show();
				return false;
			});
			//绑定应用码头上各个按钮的点击事件
			$('#dock-bar .dock-tool-setting').on('mousedown', function () {
				return false;
			}).on('click', function () {
				if (HROS.base.checkLogin()) {

					HROS.window.createTemp({
						appid: 'hoorayos-zmsz',
						title: '桌面设置',
						url: '/Desk/ConfigDesk',
						width: 750,
						height: 450,
						isflash: false
					});
				} else {
					HROS.base.login();
				}
			});
			$('#dock-bar .dock-tool-style').on('mousedown', function () {
				return false;
			}).on('click', function () {
				if (HROS.base.checkLogin()) {
					HROS.window.createTemp({
						appid: 'hoorayos-ztsz',
						title: '主题设置',
						url: '/Desk/SystemWallPaper',
						width: 580,
						height: 520,
						isflash: false
					});
				} else {
					HROS.base.login();
				}
			});
			$('#dock-bar .dock-tool-appmanage').on('mousedown', function () {
				return false;
			}).on('click', function () {

				HROS.appmanage.set();

			});
			$('#dock-bar .dock-tool-search').on('mousedown', function () {
				return false;
			}).on('click', function (e) {
				e.stopPropagation();
				HROS.searchbar.get();
			});
			$('#dock-bar .pagination').on('mousedown', function () {
				return false;
			}).on('click', function () {
				HROS.dock.switchDesk($(this).attr('index'));
			});
			$('#dock-bar .dock-tool-start').on('mousedown', function () {
				return false;
			}).on('click', function () {
				HROS.startmenu.show();
				return false;
			});
		},
		setPos: function () {
			HROS.dock.switchDesk(HROS.CONFIG.desk);
			let desktop = $('#desk-' + HROS.CONFIG.desk), desktops = $('#desk .desktop-container');
			let deskW = desktop.css('width', '100%').width(), deskH = desktop.css('height', '100%').height();
			//清除dock位置样式
			$('#dock-container').removeClass('dock-top dock-left dock-right');
			$('#dock-bar').removeClass('top-bar left-bar right-bar').hide();
			if (HROS.CONFIG.dockPos.toLowerCase() === 'top') {
				$('#dock-bar').addClass('top-bar').children('#dock-container').addClass('dock-top');
				desktops.css({
					'width': deskW,
					'height': deskH - $('#task-bar').height() - $('#dock-bar').height(),
					'left': deskW,
					'top': $('#dock-bar').height()
				});
				desktop.css({
					'left': 0
				});
				$('#dock-bar').show();
			} else if (HROS.CONFIG.dockPos.toLowerCase() === 'left') {
				$('#dock-bar').addClass('left-bar').children('#dock-container').addClass('dock-left');
				desktops.css({
					'width': deskW - $('#dock-bar').width(),
					'height': deskH - $('#task-bar').height(),
					'left': deskW + $('#dock-bar').width(),
					'top': 0
				});
				desktop.css({
					'left': $('#dock-bar').width()
				});
				$('#dock-bar').show();
			} else if (HROS.CONFIG.dockPos.toLowerCase() === 'right') {
				$('#dock-bar').addClass('right-bar').children('#dock-container').addClass('dock-right');
				desktops.css({
					'width': deskW - $('#dock-bar').width(),
					'height': deskH - $('#task-bar').height(),
					'left': deskW,
					'top': 0
				});
				desktop.css({
					'left': 0
				});
				$('#dock-bar').show();
			} else if (HROS.CONFIG.dockPos.toLowerCase() === 'none') {
				desktops.css({
					'width': deskW,
					'height': deskH - $('#task-bar').height(),
					'left': deskW,
					'top': 0
				});
				desktop.css({
					'left': 0
				});
			}
			HROS.taskbar.resize();
			HROS.folderView.setPos();
		},
		updatePos: function (pos) {
			if (pos !== HROS.CONFIG.dockPos.toLowerCase() && typeof (pos) != 'undefined') {
				HROS.CONFIG.dockPos = pos.toLowerCase();
				if (pos === 'none') {
					HROS.app.dataAllDockToDesk(HROS.CONFIG.desk);
				}
				if (HROS.base.checkLogin()) {
					HROS.request.post('/desk/modifydockposition', { Pos: pos, DeskNum: HROS.CONFIG.desk }, function (responseText) {
						if (responseText.IsSuccess) {
							NewCrm.msgbox.success('应用码头位置更新成功');
							//更新码头位置
							HROS.dock.setPos();
							//更新桌面应用
							HROS.app.set();
						} else {
							NewCrm.msgbox.fail('应用码头位置更新失败');
						}
					});
				}
			}
		},
		move: function () {
			$('#dock-container').on('mousedown', function (e) {
				if (e.button === 0 || e.button === 1) {
					let lay = HROS.maskBox.dock(), location;
					$(document).on('mousemove', function (e) {
						lay.show();
						if (e.clientY < lay.height() * 0.2) {
							location = 'top';
						} else if (e.clientX < lay.width() * 0.5) {
							location = 'left';
						} else {
							location = 'right';
						}
						$('.dock_drap_effect').removeClass('hover');
						$('.dock_drap_effect_' + location).addClass('hover');
					}).on('mouseup', function () {
						$(document).off('mousemove').off('mouseup');
						lay.hide();
						HROS.dock.updatePos(location);
					});
				}
			});
		},
        /*
		**  切换桌面
		*/
		switchDesk: function (deskNumber) {
			//验证传入的桌面号是否为1-5的正整数
			let r = /^\+?[1-5]*$/;
			deskNumber = r.test(deskNumber) ? deskNumber : 1;
			let pagination = $('#dock-bar .dock-pagination'),
				currindex = HROS.CONFIG.desk,
				switchindex = deskNumber,
				currleft = $('#desk-' + currindex).offset().left,
				switchleft = $('#desk-' + switchindex).offset().left;
			if (currindex !== switchindex) {
				if (!$('#desk-' + switchindex).hasClass('animated') && !$('#desk-' + currindex).hasClass('animated')) {
					$('#desk-' + currindex).addClass('animated').animate({
						left: switchleft
					}, 500, 'easeInOutCirc', function () {
						$(this).removeClass('animated');
					});
					$('#desk-' + switchindex).addClass('animated').animate({
						left: currleft
					}, 500, 'easeInOutCirc', function () {
						$(this).removeClass('animated');
						pagination.removeClass('current-pagination-' + currindex).addClass('current-pagination-' + switchindex);
						HROS.CONFIG.desk = switchindex;
					});
				}
			} else {
				pagination.removeClass('current-pagination-' + currindex).addClass('current-pagination-' + switchindex);
			}
		},
		getPos: function (callback) {
			HROS.request.get('/desk/getdockpos', {}, function (responseText) {
				if (responseText.IsSuccess) {
					HROS.CONFIG.dockPos = responseText.Model.toLowerCase();
					if (typeof (callback) === 'function') {
						callback && callback();
					}
				}
			})
		}
	};
})();
HROS.folderView = (function () {
	return {
		init: function () {
			$('body').on('click', '.quick_view_container', function () {
				HROS.popupMenu.hide();
			}).on('click', '.quick_view_container_open', function () {
				HROS.window.create($(this).parents('.quick_view_container').attr('appid'), 'folder');
				HROS.folderView.hide();
			}).on('click', '.appbtn', function () {
				HROS.popupMenu.hide();
				HROS.folderView.hide();
				HROS.searchbar.hide();
				HROS.startmenu.hide();
			});
			HROS.folderView.moveScrollbar();
		},
		get: function (obj) {
			setTimeout(function () {
				//判断文件夹窗口是否已打开
				let iswindowopen = false;
				$('body .quick_view_container').each(function () {
					if ($(this).attr('realappid') == obj.attr('realappid')) {
						iswindowopen = true;
						return false;
					}
				});
				if (iswindowopen) {
					let folderViewId = '#qv_' + obj.attr('appid');
				} else {
					HROS.folderView.hide();
				}

				let sc = '';
				$(HROS.VAR.folder).each(function () {
					if (this.memberId == parseInt(obj.attr('appid'))) {
						sc = this.apps;
						return false;
					}
				});
				let folderViewHtml = '', height = 0;
				if (sc != '') {
					$(sc).each(function () {
						folderViewHtml += appbtnTemp({
							'title': this.name,
							'type': this.type,
							'id': 'd_' + this.memberId,
							'appid': this.memberId,
							'realappid': this.appId == 0 ? this.memberId : this.appId,
							'imgsrc': this.icon
						});
					});
					if (sc.length % 4 == 0) {
						height += Math.floor(sc.length / 4) * 60;
					} else {
						height += (Math.floor(sc.length / 4) + 1) * 60;
					}
				} else {
					folderViewHtml = '文件夹为空';
					height += 30;
				}
				//判断是桌面上的文件夹，还是应用码头上的文件夹
				let left, top;
				if (obj.parent('div').hasClass('dock-applist')) {
					left = parseInt(obj.attr('left')) + obj.width();
					top = parseInt(obj.attr('top'));
				} else {
					left = parseInt(obj.attr('left')) + obj.width();
					top = parseInt(obj.attr('top')) - 20;
				}
				//判断预览面板是否有超出屏幕
				let isScrollbar = false;
				if (height + top + 44 > $(window).height()) {
					let outH = height + top + 44 - $(window).height();
					if (outH <= top) {
						top -= outH;
					} else {
						height -= outH - top;
						top = 0;
						isScrollbar = true;
					}
				}
				if (left + 330 > $(window).width()) {
					left -= (330 + obj.width());
					//预览居左
					if (iswindowopen) {
						$(folderViewId + ' .quick_view_container_list_in').html('').append(folderViewHtml);
						$(folderViewId).stop(true, false).animate({ 'left': left, 'top': top }, 500);
						$(folderViewId + ' .perfect_nine_m_l_t').stop(true, false).animate({ 'top': 0, 'height': Math.ceil((height + 24) / 2) }, 200);
						$(folderViewId + ' .perfect_nine_m_l_m').stop(true, false).animate({ 'top': Math.ceil((height + 24) / 2) }, 200).hide();
						$(folderViewId + ' .perfect_nine_m_l_b').stop(true, false).animate({ 'top': Math.ceil((height + 24) / 2), 'height': Math.ceil((height + 24) / 2) + 20 }, 200);
						$(folderViewId + ' .perfect_nine_m_r_t').stop(true, false).animate({ 'top': 0, 'height': obj.offset().top - top }, 200);
						$(folderViewId + ' .perfect_nine_m_r_m').stop(true, false).animate({ 'top': parseInt(obj.attr('top')) - top }, 200).show();
						$(folderViewId + ' .perfect_nine_m_r_b').stop(true, false).animate({ 'top': parseInt(obj.attr('top')) - top + 20, 'height': height + 24 - (parseInt(obj.attr('top')) - top) - 20 + 20 }, 200);
						$(folderViewId + ' .quick_view_container_list_in').stop(true, false).animate({ 'height': height }, 200);
					} else {
						$('body').append(folderViewTemp({
							'id': 'qv_' + obj.attr('appid'),
							'appid': obj.attr('appid'),
							'realappid': obj.attr('realappid'),
							'apps': folderViewHtml,
							'top': top,
							'left': left,
							'height': height,
							'mlt': Math.ceil((height + 24) / 2),
							'mlm': false,
							'mlb': Math.ceil((height + 24) / 2),
							'mrt': obj.offset().top - top,
							'mrm': true,
							'mrb': height + 24 - (obj.offset().top - top) - 20
						}));
					}
				} else {
					//预览居右
					if (iswindowopen) {
						$(folderViewId + ' .quick_view_container_list_in').html('').append(folderViewHtml);
						$(folderViewId).stop(true, false).animate({ 'left': left, 'top': top }, 500);
						$(folderViewId + ' .perfect_nine_m_l_t').stop(true, false).animate({ 'top': 0, 'height': parseInt(obj.attr('top')) - top }, 200);
						$(folderViewId + ' .perfect_nine_m_l_m').stop(true, false).animate({ 'top': parseInt(obj.attr('top')) - top }, 200).show();
						$(folderViewId + ' .perfect_nine_m_l_b').stop(true, false).animate({ 'top': parseInt(obj.attr('top')) - top + 20, 'height': height + 24 - (parseInt(obj.attr('top')) - top) - 20 }, 200);
						$(folderViewId + ' .perfect_nine_m_r_t').stop(true, false).animate({ 'top': 0, 'height': Math.ceil((height + 24) / 2) }, 200);
						$(folderViewId + ' .perfect_nine_m_r_m').stop(true, false).animate({ 'top': Math.ceil((height + 24) / 2) }, 200).hide();
						$(folderViewId + ' .perfect_nine_m_r_b').stop(true, false).animate({ 'top': Math.ceil((height + 24) / 2), 'height': Math.ceil((height + 24) / 2) }, 200);
						$(folderViewId + ' .quick_view_container_list_in').stop(true, false).animate({ 'height': height }, 200);
					} else {
						$('body').append(folderViewTemp({
							'id': 'qv_' + obj.attr('appid'),
							'appid': obj.attr('appid'),
							'realappid': obj.attr('realappid'),
							'apps': folderViewHtml,
							'top': top,
							'left': left,
							'height': height,
							'mlt': obj.offset().top - top,
							'mlm': true,
							'mlb': height + 24 - (obj.offset().top - top) - 20,
							'mrt': Math.ceil((height + 24) / 2),
							'mrm': false,
							'mrb': Math.ceil((height + 24) / 2)
						}));
					}
				}
				let view = '#quick_view_container_list_in_' + obj.attr('appid');
				let scrollbar = '#quick_view_container_list_' + obj.attr('appid') + ' .scrollBar';
				$('#quick_view_container_list_' + obj.attr('appid') + ' .scrollBar_bgc').hide();
				$(scrollbar).hide().height(0);
				if (isScrollbar) {
					$('#quick_view_container_list_' + obj.attr('appid') + ' .scrollBar_bgc').show();
					$(scrollbar).show().height($(view).height() / (Math.ceil($(view).children().length / 4) * 60) * $(view).height());
				}
			}, 0);
		},
		setPos: function () {
			$('body .quick_view_container').each(function () {
				HROS.folderView.get($('#d_' + $(this).attr('appid')));
			});
		},
		moveScrollbar: function () {
            /*
			**  手动拖动
			*/
			$('body').on('mousedown', '.quick_view_container .quick_view_container_list .scrollBar', function (e) {
				let scrollbar = $(this), container = scrollbar.prev('.quick_view_container_list_in');
				let offsetTop = container.offset().top;
				let y, cy, containerrealh, moveh;
				containerrealh = Math.ceil(container.children().length / 4) * 60;
				moveh = container.height() - scrollbar.height();
				y = e.clientY - scrollbar.offset().top;
				$(document).on('mousemove', function (e) {
					cy = e.clientY - y - offsetTop < 0 ? 0 : e.clientY - y - offsetTop > moveh ? moveh : e.clientY - y - offsetTop;
					scrollbar.css('top', cy);
					container.scrollTop(cy / container.height() * containerrealh);
				}).on('mouseup', function () {
					$(this).off('mousemove').off('mouseup');
				});
			});
            /*
			**  鼠标滚轮
			*/
			$('body').on('mousewheel', '.quick_view_container_list_in', function (event, delta) {
				let desk = $(this), deskrealh = Math.ceil($(this).children().length / 4) * 60, scrollupdown;
                /*
				**  delta == -1   往下
				**  delta == 1    往上
				*/
				if (delta < 0) {
					scrollupdown = desk.scrollTop() + 40 > deskrealh - desk.height() ? deskrealh - desk.height() : desk.scrollTop() + 40;
				} else {
					scrollupdown = desk.scrollTop() - 40 < 0 ? 0 : desk.scrollTop() - 40;
				}
				desk.stop(false, true).animate({
					scrollTop: scrollupdown
				}, 300);
				$(this).next('.scrollBar').stop(false, true).animate({
					top: scrollupdown / deskrealh * desk.height()
				}, 300);
			});
		},
		hide: function () {
			$('.quick_view_container').remove();
		}
	}
})();/*
**  应用布局格子
**  这篇文章里有简单说明格子的作用
**  http://hooray.cnblogs.com/p/3480087.html
*/
HROS.grid = (function () {
	return {
		getAppGrid: function () {
			let width = $('#desk-' + HROS.CONFIG.desk).width() - HROS.CONFIG.appButtonLeft;
			let height = $('#desk-' + HROS.CONFIG.desk).height() - HROS.CONFIG.appButtonTop;
			let top = HROS.CONFIG.appButtonTop;
			let left = HROS.CONFIG.appButtonLeft;
			let appGrid = [];
			let offsetTop = HROS.CONFIG.appSize == 's' ? 80 : 100;
			let offsetLeft = HROS.CONFIG.appSize == 's' ? 100 : 120;
			for (let i = 0; i < 10000; i++) {
				appGrid.push({
					startY: top,
					endY: top + offsetTop,
					startX: left,
					endX: left + offsetLeft
				});

				if (HROS.CONFIG.appXY.toLowerCase() === 'x') {
					left += offsetLeft;
					if (left + offsetLeft > width) {
						top += offsetTop;
						left = HROS.CONFIG.appButtonLeft;
					}
				} else {
					top += offsetTop;
					if (top + offsetTop > height) {
						top = HROS.CONFIG.appButtonTop;
						left += offsetLeft;
					}
				}
			}
			return appGrid;
		},
		searchAppGrid: function (x, y) {
			let grid = HROS.grid.getAppGrid();
			let flag = null;
			for (let i = 0; i < grid.length; i++) {
				if (x >= grid[i].startX && x <= grid[i].endX && y >= grid[i].startY && y <= grid[i].endY) {
					flag = i;
					break;
				}
			}
			return flag;
		},
		searchAppGrid2: function (x, y) {
			let grid = HROS.grid.getAppGrid();
			let grid2 = [];
			for (let i = 0; i < grid.length; i++) {
				let height = grid[i].endY - grid[i].startY;
				let width = grid[i].endX - grid[i].startX;
				let halfH = height / 2;
				let halfW = width / 2;

				if (HROS.CONFIG.appXY.toLowerCase() == 'x') {
					grid2.push({
						startY: grid[i].startY,
						endY: grid[i].startY + height,
						startX: grid[i].startX,
						endX: grid[i].startX + halfW
					}, {
							startY: grid[i].startY,
							endY: grid[i].startY + height,
							startX: grid[i].startX + halfW,
							endX: grid[i].endX
						});
				} else {
					grid2.push({
						startY: grid[i].startY,
						endY: grid[i].startY + halfH,
						startX: grid[i].startX,
						endX: grid[i].startX + width
					}, {
							startY: grid[i].startY + halfH,
							endY: grid[i].endY,
							startX: grid[i].startX,
							endX: grid[i].startX + width
						});
				}
			}
			let flag = null;
			for (let i = 0; i < grid2.length; i++) {
				if (x >= grid2[i].startX && x <= grid2[i].endX && y >= grid2[i].startY && y <= grid2[i].endY) {
					flag = i;
					break;
				}
			}
			return flag;
		},
		getDockAppGrid: function () {
			let height = $('#dock-bar .dock-applist').height();
			let dockAppGrid = [];
			let top = 0;
			let left = 0;
			let offsetTop = 68;
			let offsetLeft = 68;
			for (let i = 0; i < 7; i++) {
				dockAppGrid.push({
					startY: top,
					endY: top + offsetTop,
					startX: left,
					endX: left + offsetLeft
				});
				top += offsetTop;
				if (top + offsetTop > height) {
					top = 0;
					left += offsetLeft;
				}
			}
			return dockAppGrid;
		},
		searchDockAppGrid: function (x, y) {
			let grid = HROS.grid.getDockAppGrid();
			let flag = null;
			for (let i = 0; i < grid.length; i++) {
				if (x >= grid[i].startX && x <= grid[i].endX && y >= grid[i].startY && y <= grid[i].endY) {
					flag = i;
					break;
				}
			}
			return flag;
		},
		searchDockAppGrid2: function (x, y) {
			let grid = HROS.grid.getDockAppGrid();
			let grid2 = [];
			for (let i = 0; i < grid.length; i++) {
				let height = grid[i].endY - grid[i].startY;
				let width = grid[i].endX - grid[i].startX;
				let halfH = height / 2;
				let halfW = width / 2;
				if (HROS.CONFIG.dockPos.toLowerCase() == 'top') {
					grid2.push({
						startY: grid[i].startY,
						endY: grid[i].startY + height,
						startX: grid[i].startX,
						endX: grid[i].startX + halfW
					}, {
							startY: grid[i].startY,
							endY: grid[i].startY + height,
							startX: grid[i].startX + halfW,
							endX: grid[i].endX
						});
				} else {
					grid2.push({
						startY: grid[i].startY,
						endY: grid[i].startY + halfH,
						startX: grid[i].startX,
						endX: grid[i].startX + width
					}, {
							startY: grid[i].startY + halfH,
							endY: grid[i].endY,
							startX: grid[i].startX,
							endX: grid[i].startX + width
						});
				}
			}
			let flag = null;
			for (let i = 0; i < grid2.length; i++) {
				if (x >= grid2[i].startX && x <= grid2[i].endX && y >= grid2[i].startY && y <= grid2[i].endY) {
					flag = i;
					break;
				}
			}
			return flag;
		},
		getFolderGrid: function () {

			let folderGrid = [];
			$('.quick_view_container, .folder-window:visible').each(function () {
				folderGrid.push({
					zIndex: $(this).css('z-index'),
					id: $(this).attr('appid'),
					startY: $(this).offset().top,
					endY: $(this).offset().top + $(this).height(),
					startX: $(this).offset().left,
					endX: $(this).offset().left + $(this).width()
				});
			});
			folderGrid.sort(function (x, y) {
				return y['zIndex'] - x['zIndex'];
			});
			return folderGrid;
		},
		searchFolderGrid: function (x, y) {
			let folderGrid = HROS.grid.getFolderGrid();
			let flag = null;
			for (let i = 0; i < folderGrid.length; i++) {
				if (x >= folderGrid[i].startX && x <= folderGrid[i].endX && y >= folderGrid[i].startY && y <= folderGrid[i].endY) {
					flag = folderGrid[i]['id'];
					break;
				}
			}

			return flag;
		},
		getManageDockAppGrid: function () {
			let manageDockAppGrid = [];
			let left = 20;
			for (let i = 0; i < 100; i++) {
				manageDockAppGrid.push({
					startX: left,
					endX: left + 70
				});
				left += 70;
			}
			return manageDockAppGrid;
		},
		searchManageDockAppGrid: function (x) {
			let grid = HROS.grid.getManageDockAppGrid();
			let flag = null;
			for (let i = 0; i < grid.length; i++) {
				if (x >= grid[i].startX && x <= grid[i].endX) {
					flag = i;
					break;
				}
			}
			return flag;
		},
		searchManageDockAppGrid2: function (x) {
			let grid = HROS.grid.getManageDockAppGrid();
			let grid2 = [];
			for (let i = 0; i < grid.length; i++) {
				let width = grid[i].endX - grid[i].startX;
				let halfW = width / 2;
				grid2.push({
					startX: grid[i].startX,
					endX: grid[i].startX + halfW
				}, {
						startX: grid[i].startX + halfW,
						endX: grid[i].endX
					});
			}
			let flag = null;
			for (let i = 0; i < grid2.length; i++) {
				if (x >= grid2[i].startX && x <= grid2[i].endX) {
					flag = i;
					break;
				}
			}
			return flag;
		},
		getManageAppGrid: function () {
			let manageAppGrid = [];
			let top = 0;
			for (let i = 0; i < 10000; i++) {
				manageAppGrid.push({
					startY: top,
					endY: top + 40
				});
				top += 40;
			}
			return manageAppGrid;
		},
		searchManageAppGrid: function (y) {
			let grid = HROS.grid.getManageAppGrid();
			let flag = null;
			for (let i = 0; i < grid.length; i++) {
				if (y >= grid[i].startY && y <= grid[i].endY) {
					flag = i;
					break;
				}
			}
			return flag;
		},
		searchManageAppGrid2: function (y) {
			let grid = HROS.grid.getManageAppGrid();
			let grid2 = [];
			for (let i = 0; i < grid.length; i++) {
				let height = grid[i].endY - grid[i].startY;
				let width = grid[i].endX - grid[i].startX;
				let halfH = height / 2;
				grid2.push({
					startY: grid[i].startY,
					endY: grid[i].startY + halfH
				}, {
						startY: grid[i].startY + halfH,
						endY: grid[i].endY
					});
			}
			let flag = null;
			for (let i = 0; i < grid2.length; i++) {
				if (y >= grid2[i].startY && y <= grid2[i].endY) {
					flag = i;
					break;
				}
			}
			return flag;
		}
	}
})();
HROS.hotkey = (function () {
	return {
		init: function () {
			Mousetrap.bind(['backspace'], function () {
				return false;
			});
			//显示桌面（最小化所有窗口）
			Mousetrap.bind(['alt+d'], function () {
				HROS.window.hideAll();
				return false;
			});
			//显示全局视图
			Mousetrap.bind(['ctrl+up', 'command+up'], function () {
				HROS.appmanage.set();
				return false;
			});
			//调出查询栏
			Mousetrap.bind(['ctrl+f', 'command+f'], function () {
				HROS.searchbar.get();
				return false;
			});
			Mousetrap.bind(['ctrl+1', 'command+1'], function () {
				HROS.dock.switchDesk(1);
				return false;
			});
			Mousetrap.bind(['ctrl+2', 'command+2'], function () {
				HROS.dock.switchDesk(2);
				return false;
			});
			Mousetrap.bind(['ctrl+3', 'command+3'], function () {
				HROS.dock.switchDesk(3);
				return false;
			});
			Mousetrap.bind(['ctrl+4', 'command+4'], function () {
				HROS.dock.switchDesk(4);
				return false;
			});
			Mousetrap.bind(['ctrl+5', 'command+5'], function () {
				HROS.dock.switchDesk(5);
				return false;
			});
			Mousetrap.bind(['ctrl+left', 'command+left'], function () {
				if (parseInt(HROS.CONFIG.desk) - 1 < 1) {
					HROS.dock.switchDesk(5);
				} else {
					HROS.dock.switchDesk(parseInt(HROS.CONFIG.desk) - 1);
				}
				return false;
			});
			Mousetrap.bind(['ctrl+right', 'command+right'], function () {
				if (parseInt(HROS.CONFIG.desk) + 1 > 5) {
					HROS.dock.switchDesk(1);
				} else {
					HROS.dock.switchDesk(parseInt(HROS.CONFIG.desk) + 1);
				}
				return false;
			});
			//锁定
			Mousetrap.bind(['ctrl+l', 'command+l'], function () {
				HROS.lock.show();
				return false;
			});
		}
	}
})();
HROS.lock = (function () {
	return {
		state: 'nolock',
		init: function () {
			Mousetrap.bind(['space'], function () {
				$('#lock').click();
				return false;
			});
			$('body').on('click', '#lock', function () {
				if ($('#lock-info').is(':visible')) {
					$('#lock .title').animate({
						top: '10%'
					}, 500);
					$('#lock .tip').animate({
						top: '80%'
					}, 500);
					$('#lock-info').fadeOut();
					Mousetrap.bind(['space'], function () {
						$('#lock').click();
						return false;
					});
					Mousetrap.unbind('esc');
				} else {
					$('#lock .title').animate({
						top: '-200px'
					}, 500);
					$('#lock .tip').animate({
						top: '100%'
					}, 500);
					$('#lock-info').fadeIn();
					$('#lockpassword').val('').focus();
					$('#lock-info .text-tip').text('');
					Mousetrap.bind(['esc'], function () {
						$('#lock').click();
						return false;
					});
					Mousetrap.unbind('space');
				}
			});
			$('body').on('click', '#lock-info', function () {
				return false;
			});
			$('body').on('click', '#lockbtn', function () {
				if ($('#lockpassword').val() !== '') {
					HROS.request.post('/desk/unlockscreen', { unlockPassword: $('#lockpassword').val() }, function (responseText) {
						if (responseText.IsSuccess) {
							HROS.lock.hide();
						} else {
							$('#lockpassword').val('').focus();
							$('#lock-info .text-tip').text('解锁密码错误');
						}
					})
				} else {
					$('#lock-info .text-tip').text('请输入解锁密码');
				}
			});
			$('body').on('keydown', '#lockpassword', function (e) {
				if (e.keyCode == '13') {
					$('#lockbtn').click();
				}
			});
		},
		show: function () {
			if ($('#lock').length == 0) {
				if (!HROS.base.checkLogin()) {
					$.dialog({
						title: '温馨提示',
						icon: 'warning',
						content: '锁定功能需要登录后才能使用,为了更好的操作,是否登录?',
						ok: function () {
							HROS.base.login();
						}
					});
				} else {
					let lock = function () {
						$('#desktop').hide();
						let userinfo = $.parseJSON($.cookie('User'));
						$('body').append(lockTemp({
							'avatar': userinfo.UserFace,
							'userinfoname': userinfo.Name
						}));
						//时间，日期，星期信息的显示
						let getTimeDateWeek = function () {
							let time = new Date();
							$('#lock .time').text((time.getHours() < 10 ? '0' + time.getHours() : time.getHours()) + ':' + (time.getMinutes() < 10 ? '0' + time.getMinutes() : time.getMinutes()));
							let date = time.getFullYear() + '/' + (time.getMonth() + 1) + '/' + time.getDate() + '，星期';

							switch (time.getDay()) {
								case 1: date += '一'; break;
								case 2: date += '二'; break;
								case 3: date += '三'; break;
								case 4: date += '四'; break;
								case 5: date += '五'; break;
								case 6: date += '六'; break;
								default: date += '日';
							}
							$('#lock .week').text(date);
						};
						getTimeDateWeek();
						lockFunc = setInterval(function () {
							//检查是否有恶意修改源程序绕过锁屏界面
							let iswarning = false;
							if ($('#desktop').is(':visible')) {
								iswarning = true;
							}
							if ($('#lock').length == 0) {
								iswarning = true;
							}
							if ($('#lock').is(':hidden')) {
								iswarning = true;
							}
							//如果有则重新载入锁屏
							if (iswarning) {
								clearInterval(lockFunc);
								$('#lock').remove();
								HROS.lock.show();
							}
							getTimeDateWeek();
						}, 1000);
					};
					if (parseInt(HROS.CONFIG.lockPwdAndLoginPwd)) {
						$.dialog({
							title: '温馨提示',
							icon: 'warning',
							content: '解锁密码默认为登录密码，是否要先进行修改？',
							button: [
								{
									name: '继续锁定',
									callback: function () {
										lock();
									},
									focus: true
								},
								{
									name: '修改解锁密码',
									callback: function () {
										HROS.window.createTemp({
											appid: 'zhsz',
											title: '账号设置',
											url: '/usersetting/index?target=usersafe',
											width: 550,
											height: 580
										});
									}
								}
							]
						});
					} else {
						lock();
					}
				}
			}
		},
		hide: function () {
			clearInterval(lockFunc);
			$('#lock').remove();
			$('#desktop').show();
		}
	}
})();/*
**  透明遮罩层
**  当拖动应用、窗口等一切可拖动的对象时，会加载一个遮罩层
**  避免拖动时触发或选中一些不必要的操作，安全第一
*/
HROS.maskBox = (function () {
	return {
		desk: function () {
			if (!TEMP.maskBoxDesk) {
				TEMP.maskBoxDesk = $('<div id="maskbox"></div>');
				$('body').append(TEMP.maskBoxDesk);
			}
			return TEMP.maskBoxDesk;
		},
		dock: function () {
			if (!TEMP.maskBoxDock) {
				TEMP.maskBoxDock = $('<div id="maskbox-dockdrap"><div id="docktop" class="dock_drap_effect dock_drap_effect_top"></div><div id="dockleft" class="dock_drap_effect dock_drap_effect_left"></div><div id="dockright" class="dock_drap_effect dock_drap_effect_right"></div><div id="dockmask" class="dock_drap_mask"><div class="dock_drop_region_top"><div class="text">拖放至顶部</div></div><div class="dock_drop_region_left"><div class="text">拖放至左侧</div></div><div class="dock_drop_region_right"><div class="text">拖放至右侧</div></div></div></div>');
				$('body').append(TEMP.maskBoxDock);
			}
			return TEMP.maskBoxDock;
		},
		copyright: function () {
			if (!TEMP.maskBoxCopyright) {
				TEMP.maskBoxCopyright = $('<div id="maskbox-copyright"></div>');
				$('body').append(TEMP.maskBoxCopyright);
			}
			return TEMP.maskBoxCopyright;
		}
	}
})();/*
**  右键菜单
*/
HROS.popupMenu = (function () {
	return {
		init: function () {
			$('.popup-menu').on('contextmenu', function () {
				return false;
			});
			//动态控制多级菜单的显示位置
			$('body').on('mouseenter', '.popup-menu li', function () {
				if ($(this).children('.popup-menu').length == 1) {
					$(this).children('a').addClass('focus');
					$(this).children('.popup-menu').show();
					if ($(this).parents('.popup-menu').offset().left + $(this).parents('.popup-menu').width() * 2 + 10 < $(window).width()) {
						$(this).children('.popup-menu').css({
							left: $(this).parents('.popup-menu').width() - 5,
							top: 0
						});
					} else {
						$(this).children('.popup-menu').css({
							left: -1 * $(this).parents('.popup-menu').width(),
							top: 0
						});
					}
					if ($(this).children('.popup-menu').offset().top + $(this).children('.popup-menu').height() + 10 > $(window).height()) {
						$(this).children('.popup-menu').css({
							top: $(window).height() - $(this).children('.popup-menu').height() - $(this).children('.popup-menu').offset().top - 10
						});
					}
				}
			}).on('mouseleave', '.popup-menu li', function () {
				$(this).children('a').removeClass('focus');
				$(this).children('.popup-menu').hide();
			});
		},
        /*
		**  应用右键
		*/
		app: function (obj) {

			HROS.window.show2under();
			if (!TEMP.popupMenuApp) {
				let internalHtml = '';
				internalHtml += '<div class="popup-menu app-menu"><ul>'
				internalHtml += '<li style="border-bottom:1px solid #F0F0F0"><a menu="open" href="###">打开</a></li>'
				internalHtml += '<li>'
				internalHtml += '<a menu="move" href="###">移动到<b class="arrow">»</b></a>'
				internalHtml += '<div class="popup-menu"><ul>'
				for (let i = 1; i <= HROS.CONFIG.deskCount; i++) {
					internalHtml += '<li><a menu="moveto" desk="' + i + '" href="###">桌面' + i + '</a></li>'
				}
				internalHtml += '</ul></div>'
				internalHtml += '</li>'
				internalHtml += '<li><a menu="edit" href="###"><b class="edit"></b>编辑</a></li>'
				internalHtml += '<li><a menu="del" href="###"><b class="uninstall"></b>卸载</a></li>'
				internalHtml += '</ul></div>'
				TEMP.popupMenuApp = $(internalHtml);
				$('body').append(TEMP.popupMenuApp);
			}
			$('.app-menu a[menu="moveto"]').removeClass('disabled');
			if (obj.parent().hasClass('desktop-apps-container')) {
				$('.app-menu a[menu="moveto"]').each(function () {
					if ($(this).attr('desk') == HROS.CONFIG.desk) {
						$(this).addClass('disabled');
					}
				});
			}
			//绑定事件
			$('.app-menu a[menu="moveto"]').off('click').on('click', function () {

				let id = obj.attr('appid'),
					from = obj.index(),
					to = 99999,
					todesk = $(this).attr('desk'),
					fromdesk = HROS.CONFIG.desk,
					fromfolderid = obj.parents('.folder-window').attr('appid') || obj.parents('.quick_view_container').attr('appid');
				if (HROS.base.checkLogin()) {
					if (!HROS.app.checkIsMoving()) {
						let rtn = false;
						if (obj.parent().hasClass('dock-applist')) {
							if (HROS.app.dataDockToOtherdesk(id, from, todesk)) {
								HROS.request.post('/desk/membermove', { model: { MoveType: 'desk-desk', MemberId: id, From: from, To: todesk } }, function (responseText) {
									if (responseText.IsSuccess) {
										HROS.VAR.isAppMoving = false;
									} else {
										NewCrm.msgbox.fail(responseText.Message);
									}
								})
							}
						} else if (obj.parent().hasClass('desktop-apps-container')) {
							if (HROS.app.dataDeskToOtherdesk(id, from, to, 'a', todesk, fromdesk)) {
								HROS.request.post('/desk/membermove', { model: { MoveType: 'desk-desk', MemberId: id, From: from, To: todesk } }, function (responseText) {
									if (responseText.IsSuccess) {
										HROS.VAR.isAppMoving = false;
									} else {
										NewCrm.msgbox.fail(responseText.Message);
									}
								})
							}
						} else {
							if (HROS.app.dataFolderToOtherdesk(id, from, todesk, fromfolderid)) {
								HROS.request.post('/desk/membermove', { model: { MoveType: 'folder-desk', MemberId: id, From: from, To: todesk } }, function (responseText) {
									if (responseText.IsSuccess) {
										HROS.VAR.isAppMoving = false;
									} else {
										NewCrm.msgbox.fail(responseText.Message);
									}
								})
							}
						}
					}
				} else {
					if (obj.parent().hasClass('dock-applist')) {
						HROS.app.dataDockToOtherdesk(id, from, todesk);
					} else if (obj.parent().hasClass('desktop-apps-container')) {
						HROS.app.dataDeskToOtherdesk(id, from, to, 'a', todesk, fromdesk);
					} else {
						HROS.app.dataFolderToOtherdesk(id, from, todesk, fromfolderid);
					}
				}
				$('.popup-menu').hide();
			});
			$('.app-menu a[menu="open"]').off('click').on('click', function () {

				HROS.window.create(obj.attr('realappid'), obj.attr('type'));
				$('.popup-menu').hide();
			});

			$('.app-menu a[menu="edit"]').off('click').on('click', function () {
				if (HROS.base.checkLogin()) {
					$.dialog.open('/desk/configmember?memberId=' + obj.attr('realappid'), {
						id: 'editdialog',
						title: '编辑应用“' + obj.children('span').text() + '”',
						width: 600,
						height: 350
					});
				} else {
					HROS.base.login();
				}
				$('.popup-menu').hide();
			});
			$('.app-menu a[menu="del"]').off('click').on('click', function () {
				HROS.app.dataDeleteByAppid(obj.attr('appid'));
				HROS.widget.removeCookie(obj.attr('realappid'), obj.attr('type'));
				HROS.app.remove(obj.attr('appid'), function () {
					obj.find('img, span').show().animate({
						opacity: 'toggle',
						width: 0,
						height: 0
					}, 500, function () {
						obj.remove();
						HROS.deskTop.resize();
					});
				});
				$('.popup-menu').hide();
			});
			return TEMP.popupMenuApp;
		},
		papp: function (obj) {
			HROS.window.show2under();
			if (!TEMP.popupMenuPapp) {
				let internalHtml = '';
				internalHtml += '<div class="popup-menu papp-menu"><ul>'
				internalHtml += '<li style="border-bottom:1px solid #F0F0F0"><a menu="open" href="###">打开</a></li>'
				internalHtml += '<li>'
				internalHtml += '<a menu="move" href="###">移动到<b class="arrow">»</b></a>'
				internalHtml += '<div class="popup-menu"><ul>'
				for (let i = 1; i <= HROS.CONFIG.deskCount; i++) {
					internalHtml += '<li><a menu="moveto" desk="' + i + '" href="###">桌面' + i + '</a></li>'
				}
				internalHtml += '</ul></div>'
				internalHtml += '</li>'
				internalHtml += '<li><a menu="edit" href="###"><b class="edit"></b>编辑</a></li>'
				internalHtml += '<li><a menu="del" href="###"><b class="del"></b>删除</a></li>'
				internalHtml += '</ul></div>'
				TEMP.popupMenuPapp = $(internalHtml);
				$('body').append(TEMP.popupMenuPapp);
			}
			$('.papp-menu a[menu="moveto"]').removeClass('disabled');
			if (obj.parent().hasClass('desktop-apps-container')) {
				$('.papp-menu a[menu="moveto"]').each(function () {
					if ($(this).attr('desk') == HROS.CONFIG.desk) {
						$(this).addClass('disabled');
					}
				});
			}
			//绑定事件
			$('.papp-menu a[menu="moveto"]').off('click').on('click', function () {
				let id = obj.attr('appid'),
					from = obj.index(),
					to = 99999,
					todesk = $(this).attr('desk'),
					fromdesk = HROS.CONFIG.desk,
					fromfolderid = obj.parents('.folder-window').attr('appid') || obj.parents('.quick_view_container').attr('appid');
				if (HROS.base.checkLogin()) {
					let rtn = false;
					if (obj.parent().hasClass('dock-applist')) {
						if (HROS.app.dataDockToOtherdesk(id, from, todesk)) {
							HROS.request.post('/desk/membermove', { model: { MoveType: 'dock-otherdesk', MemberId: id, From: from, To: todesk } }, function (responseText) {
								if (responseText.IsSuccess) {
									HROS.VAR.isAppMoving = false;
								} else {
									NewCrm.msgbox.fail(responseText.Message);
								}
							})
						}
					} else if (obj.parent().hasClass('desktop-apps-container')) {
						if (HROS.app.dataDeskToOtherdesk(id, from, to, 'a', todesk, fromdesk)) {
							HROS.request.post('/desk/membermove', { model: { MoveType: 'desk-desk', MemberId: id, Trom: from, To: todesk } }, function (responseText) {
								if (responseText.IsSuccess) {
									HROS.VAR.isAppMoving = false;
								} else {
									NewCrm.msgbox.fail(responseText.Message);
								}
							})
						}
					} else {
						if (HROS.app.dataFolderToOtherdesk(id, from, todesk, fromfolderid)) {
							// $.ajax({
							// 	type: 'POST',
							// 	url: ajaxUrl,
							// 	data: 'ac=moveMyApp&movetype=folder-otherdesk&id=' + id + '&from=' + from + '&todesk=' + todesk + '&fromfolderid=' + fromfolderid
							// }).done(function (responseText) {
							// 	HROS.VAR.isAppMoving = false;
							// });
						}
					}
				} else {
					if (obj.parent().hasClass('dock-applist')) {
						HROS.app.dataDockToOtherdesk(id, from, todesk);
					} else if (obj.parent().hasClass('desktop-apps-container')) {
						HROS.app.dataDeskToOtherdesk(id, from, to, 'a', todesk, fromdesk);
					} else {
						HROS.app.dataFolderToOtherdesk(id, from, todesk, fromfolderid);
					}
				}
				$('.popup-menu').hide();
			});
			$('.papp-menu a[menu="open"]').off('click').on('click', function () {

				switch (obj.attr('type')) {
					case 'papp':
						HROS.window.create(obj.attr('realappid'), obj.attr('type'));
						break;
					case 'pwidget':
						HROS.widget.create(obj.attr('realappid'), obj.attr('type'));
						break;
				}
				$('.popup-menu').hide();
			});
			$('.papp-menu a[menu="edit"]').off('click').on('click', function () {
				if (HROS.base.checkLogin()) {
					NewCrm.msgbox.info("正在开发中....")
					// $.dialog.open('sysapp/dialog/papp.php?id=' + obj.attr('appid'), {
					// 	id: 'editdialog',
					// 	title: '编辑私人应用“' + obj.children('span').text() + '”',
					// 	width: 600,
					// 	height: 450
					// });
				} else {
					HROS.base.login();
				}
				$('.popup-menu').hide();
			});
			$('.papp-menu a[menu="del"]').off('click').on('click', function () {
				HROS.app.dataDeleteByAppid(obj.attr('appid'));
				HROS.widget.removeCookie(obj.attr('realappid'), obj.attr('type'));
				HROS.app.remove(obj.attr('appid'), function () {
					obj.find('img, span').show().animate({
						opacity: 'toggle',
						width: 0,
						height: 0
					}, 500, function () {
						obj.remove();
						HROS.deskTop.resize();
					});
				});
				$('.popup-menu').hide();
			});
			return TEMP.popupMenuPapp;
		},
        /*
		**  文件夹右键
		*/
		folder: function (obj) {

			HROS.window.show2under();
			if (!TEMP.popupMenuFolder) {
				let internalHtml = '';
				internalHtml += '<div class="popup-menu folder-menu"><ul><li><a menu="view" href="###">预览</a></li>'
				internalHtml += '<li style="border-bottom:1px solid #F0F0F0"><a menu="open" href="###">打开</a></li>'
				internalHtml += '<li>'
				internalHtml += '<a menu="move" href="###">移动到<b class="arrow">»</b></a>'
				internalHtml += '<div class="popup-menu"><ul>'
				for (let i = 1; i <= HROS.CONFIG.deskCount; i++) {
					internalHtml += '<li><a menu="moveto" desk="' + i + '" href="###">桌面' + i + '</a></li>'
				}
				internalHtml += '</ul></div>'
				internalHtml += '</li>'
				internalHtml += '<li><a menu="rename" href="###"><b class="edit"></b>重命名</a></li>'
				internalHtml += '<li><a menu="del" href="###"><b class="del"></b>删除</a></li>'
				internalHtml += '</ul></div>'
				TEMP.popupMenuFolder = $(internalHtml);
				$('body').append(TEMP.popupMenuFolder);
			}
			$('.folder-menu a[menu="moveto"]').removeClass('disabled');
			if (obj.parent().hasClass('desktop-apps-container')) {
				$('.folder-menu a[menu="moveto"]').each(function () {
					if ($(this).attr('desk') == HROS.CONFIG.desk) {
						$(this).addClass('disabled');
					}
				});
			}
			//绑定事件
			$('.folder-menu a[menu="view"]').off('click').on('click', function () {
				HROS.folderView.get(obj);
				$('.popup-menu').hide();
			});
			$('.folder-menu a[menu="open"]').off('click').on('click', function () {

				HROS.window.create(obj.attr('realappid'), obj.attr('type'));
				$('.popup-menu').hide();
			});
			$('.folder-menu a[menu="moveto"]').off('click').on('click', function () {
				let id = obj.attr('appid'),
					from = obj.index(),
					to = 99999,
					todesk = $(this).attr('desk'),
					fromdesk = HROS.CONFIG.desk,
					fromfolderid = obj.parents('.folder-window').attr('appid') || obj.parents('.quick_view_container').attr('appid');
				if (HROS.base.checkLogin()) {
					let rtn = false;
					if (obj.parent().hasClass('dock-applist')) {
						if (HROS.app.dataDockToOtherdesk(id, from, todesk)) {
							HROS.request.post('/desk/membermove', { model: { MoveType: 'dock-otherdesk', MemberId: id, From: from, To: todesk } }, function (responseText) {
								if (responseText.IsSuccess) {
									HROS.VAR.isAppMoving = false;
								} else {
									NewCrm.msgbox.fail(responseText.Message);
								}
							})
						}
					} else if (obj.parent().hasClass('desktop-apps-container')) {
						if (HROS.app.dataDeskToOtherdesk(id, from, to, 'a', todesk, fromdesk)) {
							HROS.request.post('/desk/membermove', { model: { MoveType: 'desk-desk', MemberId: id, From: from, To: todesk } }, function (responseText) {
								if (responseText.IsSuccess) {
									HROS.VAR.isAppMoving = false;
								} else {
									NewCrm.msgbox.fail(responseText.Message);
								}
							})
						}
					} else {
						if (HROS.app.dataFolderToOtherdesk(id, from, todesk, fromfolderid)) {
							// $.ajax({
							// 	type: 'POST',
							// 	url: ajaxUrl,
							// 	data: 'ac=moveMyApp&movetype=folder-otherdesk&id=' + id + '&from=' + from + '&todesk=' + todesk + '&fromfolderid=' + fromfolderid
							// }).done(function (responseText) {
							// 	HROS.VAR.isAppMoving = false;
							// });
						}
					}
				} else {
					if (obj.parent().hasClass('dock-applist')) {
						HROS.app.dataDockToOtherdesk(id, from, todesk);
					} else if (obj.parent().hasClass('desktop-apps-container')) {
						HROS.app.dataDeskToOtherdesk(id, from, to, 'a', todesk, fromdesk);
					} else {
						HROS.app.dataFolderToOtherdesk(id, from, todesk, fromfolderid);
					}
				}
				$('.popup-menu').hide();
			});
			$('.folder-menu a[menu="rename"]').off('click').on('click', function () {
				if (HROS.base.checkLogin()) {
					$.dialog({
						id: 'addfolder',
						title: '重命名“' + obj.find('span').text() + '”文件夹',
						padding: 0,
						content: editFolderDialogTemp({
							'name': obj.find('span').text(),
							'src': obj.find('img').attr('src')
						}),
						ok: function () {
							if ($('#folderName').val() != '') {
								HROS.request.post('/desk/modifyfolderinfo', { name: $('#folderName').val(), icon: $('.folderSelector img').attr('src'), memberId: parseInt(obj.attr('appid')) }, function (responseText) {
									if (responseText.IsSuccess) {
										HROS.app.get();
									}
								})
							} else {
								$('.folderNameError').show();
								return false;
							}
						},
						cancel: true
					});
					$('.folderSelector').off('click').on('click', function () {
						$('.fcDropdown').show();
					});
					$('.fcDropdown_item').off('click').on('click', function () {
						$('.folderSelector img').attr('src', $(this).children('img').attr('src')).attr('idx', $(this).children('img').attr('idx'));
						$('.fcDropdown').hide();
					});
				} else {
					HROS.base.login();
				}
				$('.popup-menu').hide();
			});
			$('.folder-menu a[menu="del"]').off('click').on('click', function () {
				$.dialog({
					id: 'delfolder',
					title: '删除“' + obj.find('span').text() + '”文件夹',
					content: '删除文件夹会将文件夹内的应用移出到桌面',
					icon: 'warning',
					ok: function () {
						HROS.app.remove(obj.attr('appid'), function () {
							HROS.app.dataDeleteByAppid(obj.attr('appid'));
							obj.find('img, span').show().animate({
								opacity: 'toggle',
								width: 0,
								height: 0
							}, 500, function () {
								obj.remove();
								HROS.deskTop.resize();
							});
						});
					},
					cancel: true
				});
				$('.popup-menu').hide();
			});
			return TEMP.popupMenuFolder;
		},
        /*
		**  文件右键
		*/
		file: function (obj) {
			HROS.window.show2under();
			if (!TEMP.popupMenuFile) {
				TEMP.popupMenuFile = $(
					'<div class="popup-menu file-menu"><ul>' +
					'<li style="border-bottom:1px solid #F0F0F0"><a menu="download" href="###">下载</a></li>' +
					'<li><a menu="del" href="###"><b class="del"></b>删除</a></li>' +
					'</ul></div>'
				);
				$('body').append(TEMP.popupMenuFile);
			}
			//绑定事件
			$('.file-menu a[menu="download"]').off('click').on('click', function () {
				$('body').append(fileDownloadTemp({
					appid: obj.attr('appid')
				}));
				$('.popup-menu').hide();
			});
			$('.file-menu a[menu="del"]').off('click').on('click', function () {
				HROS.app.dataDeleteByAppid(obj.attr('appid'));
				HROS.app.remove(obj.attr('appid'), function () {
					obj.find('img, span').show().animate({
						opacity: 'toggle',
						width: 0,
						height: 0
					}, 500, function () {
						obj.remove();
						HROS.deskTop.resize();
					});
				});
				$('.popup-menu').hide();
			});
			return TEMP.popupMenuFile;
		},
        /*
		**  应用码头右键
		*/
		dock: function () {
			HROS.window.show2under();
			if (!TEMP.popupMenuDock) {
				TEMP.popupMenuDock = $(
					'<div class="popup-menu dock-menu"><ul>' +
					'<li><a menu="dockPos" pos="top" href="###"><b class="hook"></b>向上停靠</a></li>' +
					'<li><a menu="dockPos" pos="left" href="###"><b class="hook"></b>向左停靠</a></li>' +
					'<li><a menu="dockPos" pos="right" href="###"><b class="hook"></b>向右停靠</a></li>' +
					'<li><a menu="dockPos" pos="none" href="###">隐藏</a></li>' +
					'</ul></div>'
				);
				$('body').append(TEMP.popupMenuDock);
				//绑定事件
				$('.dock-menu a[menu="dockPos"]').on('click', function () {
					if ($(this).attr('pos') == 'none') {
						$.dialog({
							title: '温馨提示',
							icon: 'warning',
							content: '<p>如果应用码头存在应用，隐藏后会将应用转移到当前桌面。</p><p>若需要再次开启，可在桌面空白处点击右键，进入「 桌面设置 」里开启。</p>',
							ok: function () {
								HROS.dock.updatePos('none');
							},
							cancel: true
						});
					} else {
						HROS.dock.updatePos($(this).attr('pos'));
					}
					$('.popup-menu').hide();
				});
			}
			$('.dock-menu a[menu="dockPos"]').each(function () {
				$(this).children('.hook').hide();
				if ($(this).attr('pos') == HROS.CONFIG.dockPos.toLowerCase()) {
					$(this).children('.hook').show();
				}
				$('.popup-menu').hide();
			});
			return TEMP.popupMenuDock;
		},
        /*
		**  任务栏右键
		*/
		task: function (obj) {
			HROS.window.show2under();
			if (!TEMP.popupMenuTask) {
				TEMP.popupMenuTask = $(
					'<div class="popup-menu task-menu"><ul>' +
					'<li><a menu="max" href="###">最大化</a></li>' +
					'<li style="border-bottom:1px solid #F0F0F0"><a menu="hide" href="###">最小化</a></li>' +
					'<li><a menu="close" href="###">关闭</a></li>' +
					'</ul></div>'
				);
				$('body').append(TEMP.popupMenuTask);
			}
			//绑定事件
			$('.task-menu a[menu="max"]').off('click').on('click', function () {
				HROS.window.max(obj.attr('appid'), obj.attr('type'));
				$('.popup-menu').hide();
			});
			$('.task-menu a[menu="hide"]').off('click').on('click', function () {
				HROS.window.hide(obj.attr('appid'), obj.attr('type'));
				$('.popup-menu').hide();
			});
			$('.task-menu a[menu="close"]').off('click').on('click', function () {
				HROS.window.close(obj.attr('appid'), obj.attr('type'));
				$('.popup-menu').hide();
			});
			return TEMP.popupMenuTask;
		},
        /*
		**  桌面右键
		*/
		desk: function () {
			HROS.window.show2under();
			if (!TEMP.popupMenuDesk) {
				TEMP.popupMenuDesk = $(
					'<div class="popup-menu desk-menu"><ul>' +
					'<li><a menu="hideall" href="###">显示桌面</a></li>' +
					'<li style="border-bottom:1px solid #F0F0F0"><a menu="closeall" href="###">关闭所有窗口</a></li>' +
					'<li>' +
					'<a href="###">新建<b class="arrow">»</b></a>' +
					'<div class="popup-menu"><ul>' +
					'<li><a menu="addfolder" href="###"><b class="folder"></b>新建文件夹</a></li>' +
					'<li><a menu="addpapp" href="###"><b class="customapp"></b>新建私人应用</a></li>' +
					'</ul></div>' +
					'</li>' +
					'<li style="border-bottom:1px solid #F0F0F0"><b class="upload"></b><a menu="uploadfile" href="###">上传文件</a></li>' +
					'<li><a menu="themes" href="###"><b class="themes"></b>主题设置</a></li>' +
					'<li><a menu="setting" href="###"><b class="setting"></b>桌面设置</a></li>' +
					'<li style="border-bottom:1px solid #F0F0F0">' +
					'<a href="###">图标设置<b class="arrow">»</b></a>' +
					'<div class="popup-menu"><ul>' +
					'<li>' +
					'<a href="###">排列<b class="arrow">»</b></a>' +
					'<div class="popup-menu"><ul>' +
					'<li><a menu="orderby" orderby="x" href="###"><b class="hook"></b>横向排列</a></li>' +
					'<li><a menu="orderby" orderby="y" href="###"><b class="hook"></b>纵向排列</a></li>' +
					'</ul></div>' +
					'</li>' +
					'<li>' +
					'<a href="###">尺寸<b class="arrow">»</b></a>' +
					'<div class="popup-menu"><ul>' +
					'<li><a menu="size" size="32" href="###"><b class="hook"></b>小图标</a></li>' +
					'<li><a menu="size" size="48" href="###"><b class="hook"></b>常规图标</a></li>' +
					'<li><a menu="size" size="64" href="###"><b class="hook"></b>大图标</a></li>' +
					'</ul></div>' +
					'</li>' +
					'</ul></div>' +
					'</li>' +
					'<li><a menu="lock" href="###">锁定</a></li>' +
					'<li><a menu="logout" href="###">注销</a></li>' +
					'</ul></div>'
				);
				$('body').append(TEMP.popupMenuDesk);
				if (!HROS.base.checkLogin()) {
					$('body .desk-menu li a[menu="logout"]').parent().remove();
				}
				//绑定事件
				$('.desk-menu a[menu="orderby"]').on('click', function () {
					HROS.app.updateXY($(this).attr('orderby'));
					$('.popup-menu').hide();
				});
				$('.desk-menu a[menu="size"]').on('click', function () {
					HROS.app.updateSize($(this).attr('size'));
					$('.popup-menu').hide();
				});
				$('.desk-menu a[menu="hideall"]').on('click', function () {
					HROS.window.hideAll();
					$('.popup-menu').hide();
				});
				$('.desk-menu a[menu="closeall"]').on('click', function () {
					HROS.window.closeAll();
					$('.popup-menu').hide();
				});
				$('.desk-menu a[menu="addfolder"]').on('click', function () {
					if (HROS.base.checkLogin()) {
						$.dialog({
							id: 'addfolder',
							title: '新建文件夹',
							padding: 0,
							content: editFolderDialogTemp({
								'name': '新建文件夹',
								'src': '/images/ui/folder_default.png'
							}),
							ok: function () {
								if ($('#folderName').val() != '') {
									HROS.request.post('/desk/createfolder', {
										FolderName: $('#folderName').val(),
										FolderImg: $('.folderSelector img').attr('src'),
										DeskId: HROS.CONFIG.desk
									}, function () {
										HROS.app.get();
									})
								} else {
									$('.folderNameError').show();
									return false;
								}
							},
							cancel: true
						});
						$('.folderSelector').on('click', function () {
							$('#addfolder .fcDropdown').show();
							return false;
						});
						$(document).click(function () {
							$('#addfolder .fcDropdown').hide();
						});
						$('.fcDropdown_item').on('click', function () {
							$('.folderSelector img').attr('src', $(this).children('img').attr('src')).attr('idx', $(this).children('img').attr('idx'));
							$('#addfolder .fcDropdown').hide();
						});
					} else {
						HROS.base.login();
					}
					$('.popup-menu').hide();
				});
				$('.desk-menu a[menu="addpapp"]').on('click', function () {
					if (HROS.base.checkLogin()) {
						NewCrm.msgbox.info("正在开发中....")
						// $.dialog.open('sysapp/dialog/papp.php?desk=' + HROS.CONFIG.desk, {
						// 	id: 'editdialog',
						// 	title: '新建私人应用',
						// 	width: 600,
						// 	height: 450
						// });
					} else {
						HROS.base.login();
					}
					$('.popup-menu').hide();
				});
				$('.desk-menu a[menu="uploadfile"]').on('click', function () {
					NewCrm.msgbox.info("正在开发中....")
					//HROS.window.createTemp({
					//    appid: 'hoorayos-scwj',
					//    title: '上传文件',
					//    url: 'sysapp/upload/index.php',
					//    width: 750,
					//    height: 600,
					//    isflash: false
					//});
					$('.popup-menu').hide();
				});
				$('.desk-menu a[menu="themes"]').on('click', function () {
					if (HROS.base.checkLogin()) {
						HROS.window.createTemp({
							appid: 'hoorayos-ztsz',
							title: '主题设置',
							url: '/Desk/SystemWallPaper',
							width: 580,
							height: 520,
							isflash: false
						});
					} else {
						HROS.base.login();
					}
					$('.popup-menu').hide();
				});
				$('.desk-menu a[menu="setting"]').on('click', function () {
					if (HROS.base.checkLogin()) {
						HROS.window.createTemp({
							appid: 'hoorayos-zmsz',
							title: '桌面设置',
							url: '/Desk/ConfigDesk',
							width: 750,
							height: 450,
							isflash: false
						});
					} else {
						HROS.base.login();
					}
					$('.popup-menu').hide();
				});
				$('.desk-menu a[menu="lock"]').on('click', function () {
					HROS.lock.show();
					$('.popup-menu').hide();
				});
				$('.desk-menu a[menu="logout"]').on('click', function () {
					HROS.base.logout();
					$('.popup-menu').hide();
				});
			}
			$('.desk-menu a[menu="orderby"]').each(function () {
				$(this).children('.hook').hide();

				if ($(this).attr('orderby') == HROS.CONFIG.appXY.toLowerCase()) {
					$(this).children('.hook').show();
				}
				$('.popup-menu').hide();
			});
			$('.desk-menu a[menu="size"]').each(function () {
				$(this).children('.hook').hide();
				if ($(this).attr('size') == HROS.CONFIG.appSize) {
					$(this).children('.hook').show();
				}
				$('.popup-menu').hide();
			});
			return TEMP.popupMenuDesk;
		},
		hide: function () {
			$('.popup-menu').hide();
		}
	}
})();/*
**  搜索栏
*/
HROS.searchbar = (function () {
	return {
        /*
		**  初始化
		*/
		init: function () {
			$('#pageletSearchInput').on('click', function () {
				return false;
			});
			$('#search-suggest .resultBox').on('click', 'li', function () {

				switch ($(this).attr('type')) {
					case 'window':
						HROS.window.create($(this).attr('realappid'), $(this).attr('type'));
						break;
					case 'widget':
						HROS.widget.create($(this).attr('realappid'), $(this).attr('type'));
						break;
				}
			});
			$('#search-suggest .openAppMarket a, #pageletSearchButton').on('click', function () {
				HROS.searchbar.openAppMarket($('#pageletSearchInput').val());
			});
			$('#pageletSearchInput').on('keydown', function (e) {
				if (e.keyCode == '13') {
					if ($('#search-suggest .resultBox .resultList a.selected').length == 0 && $('#search-suggest > .resultList a.selected').length == 0) {

						HROS.searchbar.openAppMarket($(this).val());
					} else {
						$('#search-suggest .resultList a.selected').click();
					}
				}
			});
		},
		get: function () {
			let oldSearchVal = '';
			searchFunc = setInterval(function () {
				let searchVal = $('#pageletSearchInput').val();
				if (searchVal != '') {
					$('#search-suggest').show();
					if (searchVal != oldSearchVal) {
						oldSearchVal = searchVal;
						HROS.searchbar.getSuggest(searchVal);
					}
					$('#search-bar').removeClass('above').addClass('above');
				} else {
					$('#search-suggest').hide();
					$('#search-bar').removeClass('above');
				}
			}, 1000);
			HROS.searchbar.set();
			Mousetrap.bind(['up'], function () {
				if ($('#search-suggest .resultBox .resultList a.selected').length == 0 && $('#search-suggest > .resultList a.selected').length == 0) {
					$('#search-suggest > .resultList:last a').addClass('selected');
				} else {
					if ($('#search-suggest .resultBox .resultList:first a').hasClass('selected')) {
						$('#search-suggest .resultList a').removeClass('selected');
					} else {
						if ($('#search-suggest > .resultList a.selected').length != 0) {
							let i = $('#search-suggest > .resultList a.selected').parent('.resultList').index();
							$('#search-suggest .resultList a').removeClass('selected');
							if (i > 1) {
								$('#search-suggest > .resultList:eq(' + (i - 1) + ') a').addClass('selected');
							} else {
								$('#search-suggest .resultBox .resultList:last a').addClass('selected');
							}
						} else {
							let i = $('#search-suggest .resultBox .resultList a.selected').parent('.resultList').index();
							$('#search-suggest .resultList a').removeClass('selected');
							if (i > 0) {
								$('#search-suggest .resultBox .resultList:eq(' + (i - 1) + ') a').addClass('selected');
							}
						}
					}
				}
				return false;
			});
			Mousetrap.bind(['down'], function () {
				if ($('#search-suggest .resultBox .resultList a.selected').length == 0 && $('#search-suggest > .resultList a.selected').length == 0) {
					if ($('#search-suggest .resultBox .resultList').length == 0) {
						$('#search-suggest > .resultList:first a').addClass('selected');
					} else {
						$('#search-suggest .resultBox .resultList:first a').addClass('selected');
					}
				} else {
					if ($('#search-suggest > .resultList:last a').hasClass('selected')) {
						$('#search-suggest .resultList a').removeClass('selected');
					} else {
						if ($('#search-suggest .resultBox .resultList a.selected').length != 0) {
							let i = $('#search-suggest .resultBox .resultList a.selected').parent('.resultList').index();
							$('#search-suggest .resultList a').removeClass('selected');
							if (i < $('#search-suggest .resultBox .resultList').length - 1) {
								$('#search-suggest .resultBox .resultList:eq(' + (i + 1) + ') a').addClass('selected');
							} else {
								$('#search-suggest > .resultList:first a').addClass('selected');
							}
						} else {
							let i = $('#search-suggest > .resultList a.selected').parent('.resultList').index();
							$('#search-suggest .resultList a').removeClass('selected');
							if (i < $('#search-suggest > .resultList').length - 1) {
								$('#search-suggest > .resultList:eq(' + (i + 1) + ') a').addClass('selected');
							} else {
								$('#search-suggest .resultBox .resultList:first a').addClass('selected');
							}
						}
					}
				}
				return false;
			});
			Mousetrap.bind(['backspace'], function () { });
		},
		set: function () {
			$('#search-bar').show();
			$('#search-suggest .resultList a').removeClass('selected');
			$('#pageletSearchInput').focus();
		},
		getSuggest: function (val) {
			let apps = [];
			$(HROS.VAR.dock).each(function () {
				if ($.inArray(this.type, ['window', 'widget']) >= 0) {
					apps.push(this);
				}
			});
			for (let i = 1; i <= 5; i++) {
				let desk = eval('HROS.VAR.desk' + i);
				$(desk).each(function () {
					if ($.inArray(this.type, ['window', 'widget']) >= 0) {
						apps.push(this);
					}
				});
			}

			$(HROS.VAR.folder).each(function () {
				$(this.apps).each(function () {
					if ($.inArray(this.type, ['window', 'widget']) >= 0) {
						apps.push(this);
					}
				});
			});
			let suggest = '';
			$(apps).each(function () {
				if (this.name.indexOf(val) >= 0) {
					suggest += suggestTemp({
						'name': this.name,
						'appid': this.appid,
						'realappid': this.realappid,
						'type': this.type
					});
				}
			});
			$('#search-suggest .resultBox').html(suggest);
			if (suggest == '') {
				$('#search-suggest .resultBox').hide();
			} else {
				$('#search-suggest .resultBox').show();
			}
			HROS.searchbar.set();
		},
		openAppMarket: function (searchkey) {
			if (searchkey != '') {
				HROS.window.createTemp({
					appid: 'hoorayos-yysc',
					title: '大资本市场',
					url: '/AppMarket/Index?searchText=' + searchkey,
					width: 800,
					height: 484,
					isflash: false,
					refresh: true
				});
			}
			HROS.searchbar.hide();
		},
		hide: function () {
			if (typeof (searchFunc) != 'undefined') {
				clearInterval(searchFunc);
			}
			$('#search-bar').removeClass('above');
			$('#search-bar, #search-suggest').hide();
			$('#pageletSearchInput').val('');
			$('#search-suggest .resultBox').html('');
			Mousetrap.unbind(['up', 'down']);
		}
	}
})();/*
**  开始菜单
*/
HROS.startmenu = (function () {
	return {
        /*
		**	初始化
		*/
		init: function () {
			//HROS.startmenu.getAvatar();
			$('#startmenu-container').on('mousedown', function (e) {
				e.preventDefault();
			});
			$('#startmenu-container .startmenu-nick a, #startmenu-container .startmenu-avatar img').on('click', function () {
				HROS.startmenu.openUser();
			});
			$('#startmenu-container .startmenu-exit a').on('click', function () {
				HROS.base.logout();
			});
			$('#startmenu-container .startmenu-lock').on('click', function () {
				HROS.lock.show();
			});
			$('#startmenu-container .startmenu-feedback').on('click', function () {
				HROS.window.createTemp({
					appid: 'hoorayos-feedback',
					title: '反馈',
					url: 'about:blank',
					width: 700,
					height: 500,
					isflash: false
				});
			});
			$('#startmenu-container .startmenu a').on('click', function () {
				switch ($(this).attr('class')) {
					case 'help':
						HROS.base.help();
						break;
					case 'about':
						//HROS.copyright.show();
						break;
				}
			});
		},
        /*
		**  获取头像
		*/
		getAvatar: function () {
			HROS.request.get('/desk/getuserface', {}, function (responseText) {
				if (responseText.IsSuccess) {
					$('#startmenu-container .startmenu-avatar img').attr('src', responseText.Model);
				}
			});
		},
        /*
		**  账号设置窗口
		*/
		openUser: function () {
			if (HROS.CONFIG.memberID != 0) {
				HROS.window.createTemp({
					appid: 'zhsz',
					title: '账号设置',
					url: '/usersetting/index',
					width: 800,
					height: 600
				});
			} else {
				HROS.base.login();
			}
		},
		show: function () {
			HROS.popupMenu.hide();
			HROS.folderView.hide();
			HROS.searchbar.hide();
			$('#startmenu-container').css({
				top: 'auto',
				left: 'auto',
				right: 'auto',
				bottom: 'auto'
			}).show();
			switch (HROS.CONFIG.dockPos.toLowerCase()) {
				case 'top':
					$('#startmenu-container').css({
						top: $('#dock-container').height() - 1,
						right: $('#dock-container').offset().left
					});
					break;
				case 'left':
					$('#startmenu-container').css({
						bottom: $('#dock-container').offset().top,
						left: $('#dock-container').width() - 1
					});
					break;
				case 'right':
					$('#startmenu-container').css({
						bottom: $('#dock-container').offset().top,
						right: $('#dock-container').width() - 1
					});
					break;
			}
		},
		hide: function () {
			$('#startmenu-container').hide();
		}
	}
})();/*
**  任务栏
*/
HROS.taskbar = (function () {
	return {
        /*
		**  初始化
		*/
		init: function () {
			//当浏览器窗口改变大小时，任务栏的显示也需进行刷新
			$(window).on('resize', function () {
				HROS.taskbar.resize();
			});
			//绑定任务栏点击事件
			HROS.taskbar.click();
			//绑定任务栏前进后退按钮事件
			HROS.taskbar.pageClick();
		},
		click: function () {
			$('#task-content-inner').on('click', 'a.task-item', function () {
				if ($(this).hasClass('task-item-current')) {
					HROS.window.hide($(this).attr('appid'));
				} else {
					HROS.window.show2top($(this).attr('appid'));
				}
			}).on('contextmenu', 'a.task-item', function (e) {
				$('.popup-menu').hide();
				$('.quick_view_container').remove();
				let popupmenu = HROS.popupMenu.task($(this));
				let l = $(window).width() - e.clientX < popupmenu.width() ? e.clientX - popupmenu.width() : e.clientX;
				let t = e.clientY - popupmenu.height();
				popupmenu.css({
					left: l,
					top: t
				}).show();
				return false;
			});
		},
		pageClick: function () {
			$('#task-next-btn').on('click', function () {
				if ($(this).hasClass('disable') == false) {
					let w = $('#task-bar').width(), realW = $('#task-content-inner .task-item').length * 114, showW = w - 112, overW = realW - showW;
					let marginL = parseInt($('#task-content-inner').css('margin-left')) - 114;
					if (marginL <= overW * -1) {
						marginL = overW * -1;
						$('#task-next a').addClass('disable');
					}
					$('#task-pre a').removeClass('disable');
					$('#task-content-inner').animate({
						marginLeft: marginL
					}, 200);
				}
			});
			$('#task-pre-btn').on('click', function () {
				if ($(this).hasClass('disable') == false) {
					let marginL = parseInt($('#task-content-inner').css('margin-left')) + 114;
					if (marginL >= 0) {
						marginL = 0;
						$('#task-pre a').addClass('disable');
					}
					$('#task-next a').removeClass('disable');
					$('#task-content-inner').animate({
						marginLeft: marginL
					}, 200);
				}
			});
		},
		resize: function () {
			$('#task-content-inner').removeClass('fl');
			if (HROS.CONFIG.dockPos.toLowerCase() == 'left') {
				$('#task-bar').css({
					'left': $('#dock-bar').width(),
					'right': 0
				});
			} else if (HROS.CONFIG.dockPos.toLowerCase() == 'right') {
				$('#task-bar').css({
					'left': 0,
					'right': $('#dock-bar').width()
				});
				$('#task-content-inner').addClass('fl');
			} else {
				$('#task-bar').css({
					'left': 0,
					'right': 0
				});
			}
			let w = $('#task-bar').width(), realW = $('#task-content-inner .task-item').length * 114, showW = w - 112;
			$('#task-content-inner').css('width', realW);
			if (realW >= showW) {
				$('#task-next, #task-pre').show();
				$('#task-content').css('width', showW);
				$('#task-content-inner').addClass('fl').stop(true, false).animate({
					marginLeft: 0
				}, 200);
				$('#task-next a').removeClass('disable');
				$('#task-pre a').addClass('disable');
			} else {
				$('#task-next, #task-pre').hide();
				$('#task-content').css('width', '100%');
				$('#task-content-inner').css({
					'margin-left': 0,
					'margin-right': 0
				});
			}
		}
	}
})();/*
**  壁纸
*/
HROS.wallpaper = (function () {
	return {
        /*
		**	初始化
		*/
		init: function () {
			HROS.wallpaper.get(function () {
				HROS.wallpaper.set();
			});
		},
        /*
		**	获得壁纸
		**	通过ajax到后端获取壁纸信息，同时设置壁纸
		*/
		get: function (callback) {
			HROS.request.get('/desk/getwallpaper', {}, function (responseText) {
				if (responseText.IsSuccess) {
					let values = responseText.Model;
					HROS.CONFIG.wallpaperState = values.WallpaperSource;
					switch (HROS.CONFIG.wallpaperState.toLowerCase()) {
						case 'upload':
						case 'system':
							HROS.CONFIG.wallpaper = values.WallpaperUrl;
							HROS.CONFIG.wallpaperType = values.WallpaperMode;
							HROS.CONFIG.wallpaperWidth = values.WallpaperWidth;
							HROS.CONFIG.wallpaperHeight = values.WallpaperHeigth;
							break;
						case 'bing':
						case 'web':
							HROS.CONFIG.wallpaperType = values.WallpaperMode;
							HROS.CONFIG.wallpaper = values.WallpaperUrl;
							break;
					}
					if (typeof (callback) === 'function') {
						callback && callback();
					}
				}
			});
		},
        /*
		**	设置壁纸
		**	平铺和居中可直接用css样式background解决
		**	而填充、适应和拉伸则需要进行模拟
		*/
		set: function (isreload) {
            /*
			**  判断壁纸是否需要重新载入
			**  比如当浏览器尺寸改变时，只需更新壁纸，而无需重新载入
			*/
			isreload = isreload || true;
			if (isreload) {
				$('#zoomWallpaperGrid').attr('id', 'zoomWallpaperGrid-ready2remove').css('zIndex', -11);
				setTimeout(function () {
					$('#zoomWallpaperGrid-ready2remove').remove();
					$('#zoomWallpaperGrid').removeClass('radi');
				}, 1500);
			}
			let w = $(window).width(), h = $(window).height();
			switch (HROS.CONFIG.wallpaperState.toLowerCase()) {
				case 'upload':
				case 'system':
					let t;
					let l;
					switch (HROS.CONFIG.wallpaperType.toLocaleLowerCase()) {
						//平铺
						case 'tile':
							if (isreload) {
								$('body').append('<div id="zoomWallpaperGrid" class="radi" style="position:absolute;z-index:-10;top:0;left:0;height:100%;width:100%;background:#fff url(' + HROS.CONFIG.wallpaper + ') repeat"></div>');
							}
							break;
						//居中
						case 'center':
							if (isreload) {
								$('body').append('<div id="zoomWallpaperGrid" class="radi" style="position:absolute;z-index:-10;top:0;left:0;height:100%;width:100%;background:#fff url(' + HROS.CONFIG.wallpaper + ') no-repeat 50% 50%"></div>');
							}
							break;
						//填充
						case 'fill':
							t = (h - HROS.CONFIG.wallpaperHeight) / 2;
							l = (w - HROS.CONFIG.wallpaperWidth) / 2;
							if (isreload) {
								$('body').append('<div id="zoomWallpaperGrid" class="radi" style="position:absolute;z-index:-10;left:0;top:0;overflow:hidden;height:' + h + 'px;width:' + w + 'px;background:#fff"><img id="zoomWallpaper" src="' + HROS.CONFIG.wallpaper + '" style="position:absolute;height:' + HROS.CONFIG.wallpaperHeight + 'px;width:' + HROS.CONFIG.wallpaperWidth + 'px;top:' + t + 'px;left:' + l + 'px"><div style="position:absolute;height:' + h + 'px;width:' + w + 'px;background:#fff;opacity:0;filter:alpha(opacity=0)"></div></div>');
							} else {
								$('#zoomWallpaperGrid, #zoomWallpaperGrid div').css({
									height: h + 'px',
									width: w + 'px'
								});
								$('#zoomWallpaper').css({
									top: t + 'px',
									left: l + 'px'
								});
							}
							break;
						//适应
						case 'adapted':
							let imgH, imgW;
							if (HROS.CONFIG.wallpaperHeight / HROS.CONFIG.wallpaperWidth > h / w) {
								imgH = h;
								imgW = HROS.CONFIG.wallpaperWidth * (h / HROS.CONFIG.wallpaperHeight);
								t = 0;
								l = (w - imgW) / 2;
							} else if (HROS.CONFIG.wallpaperHeight / HROS.CONFIG.wallpaperWidth < h / w) {
								imgW = w;
								imgH = HROS.CONFIG.wallpaperHeight * (w / HROS.CONFIG.wallpaperWidth);
								l = 0;
								t = (h - imgH) / 2;
							} else {
								imgH = HROS.CONFIG.wallpaperHeight;
								imgW = HROS.CONFIG.wallpaperWidth;
								t = l = 0;
							}
							if (isreload) {
								$('body').append('<div id="zoomWallpaperGrid" class="radi" style="position:absolute;z-index:-10;left:0;top:0;overflow:hidden;height:' + h + 'px;width:' + w + 'px;background:#fff"><img id="zoomWallpaper" src="' + HROS.CONFIG.wallpaper + '" style="position:absolute;height:' + imgH + 'px;width:' + imgW + 'px;top:' + t + 'px;left:' + l + 'px"><div style="position:absolute;height:' + h + 'px;width:' + w + 'px;background:#fff;opacity:0;filter:alpha(opacity=0)"></div></div>');
							} else {
								$('#zoomWallpaperGrid, #zoomWallpaperGrid div').css({
									height: h + 'px',
									width: w + 'px'
								});
								$('#zoomWallpaper').css({
									height: imgH + 'px',
									width: imgW + 'px',
									top: t + 'px',
									left: l + 'px'
								});
							}
							break;
						//拉伸
						case 'draw':
							if (isreload) {
								$('body').append('<div id="zoomWallpaperGrid" class="radi" style="position:absolute;z-index:-10;left:0;top:0;overflow:hidden;height:' + h + 'px;width:' + w + 'px;background:#fff"><img id="zoomWallpaper" src="' + HROS.CONFIG.wallpaper + '" style="position:absolute;height:' + h + 'px;width:' + w + 'px;top:0;left:0"><div style="position:absolute;height:' + h + 'px;width:' + w + 'px;background:#fff;opacity:0;filter:alpha(opacity=0)"></div></div>');
							} else {
								$('#zoomWallpaperGrid').css({
									height: h + 'px',
									width: w + 'px'
								}).children('#zoomWallpaper, div').css({
									height: h + 'px',
									width: w + 'px'
								});
							}
							break;
					}
					break;
				case 'bing':
				case 'web':
					if (isreload) {
						$('body').append('<div id="zoomWallpaperGrid" class="radi" style="position:absolute;z-index:-10;top:0;left:0;height:100%;width:100%;overflow:hidden"><div></div><iframe id="iframeWallpaper" frameborder="no" border="0" scrolling="no" class="iframeWallpaper" style="position:absolute;left:0;top:0;overflow:hidden;width:100%;height:100%" src="' + HROS.CONFIG.wallpaper + '"></iframe></div>');
					}
					break;
			}
		},
        /*
		**	更新壁纸
		**	通过ajax到后端进行更新，同时获得壁纸
		*/
		update: function (wallpaperShowType, wallpaperId) {
			function done() {
				HROS.wallpaper.get(function () {
					HROS.wallpaper.set();
				});
			}
			if (HROS.base.checkLogin()) {
				if (!wallpaperId) {
					HROS.request.post('/desk/modifydisplaymodel', { wallPaperShowType: wallpaperShowType }, function (responseText) {
						if (responseText.IsSuccess) {
							NewCrm.msgbox.success("壁纸显示模式设置成功！")
							done();
						}
					})
				} else {
					HROS.request.post('/desk/modifywallpaper', { wallpaperId: wallpaperId }, function (responseText) {
						if (responseText.IsSuccess) {
							NewCrm.msgbox.success("壁纸设置成功！")
							done();
						}
					})
				}
			} else {
				NewCrm.msgbox.success("壁纸设置成功！")
				done();
			}
		}
	};
})();/*
**  小挂件
*/
HROS.widget = (function () {
	return {
		init: function () {
			//挂件上各个按钮
			HROS.widget.handle();
			//挂件移动
			HROS.widget.move();
			//还原上次退出系统时widget的状态
			HROS.widget.reduction();
			$('#desk').on('mouseover', '.widget', function () {
				$(this).children('.move').show();
			}).on('mouseout', '.widget', function () {
				$(this).children('.move').hide();
			});
		},
        /*
		**  创建挂件
		**  自定义挂件：HROS.widget.createTemp({url,width,height,top,right});
		**       示例：HROS.widget.createTemp({url:"http://www.baidu.com",width:800,height:400,top:100,right:100});
		*/
		createTemp: function (obj) {
			debugger
			let appid = obj.appid == null ? Date.parse(new Date()) : obj.appid;
			//判断窗口是否已打开
			let iswidgetopen = false;
			$('#desk .widget').each(function () {
				if ($(this).attr('appid') == appid) {
					iswidgetopen = true;
					return false;
				}
			});
			//如果没有打开，则进行创建
			if (!iswidgetopen) {
				function nextDo(options) {

					$('#desk').append(widgetWindowTemp({
						'width': options.width,
						'height': options.height,
						'type': 'widgetTemp',
						'id': 'w_' + options.appid,
						'appid': options.appid,
						'realappid': options.appid,
						'top': options.top,
						'right': options.right,
						'url': options.url,
						'zIndex': HROS.CONFIG.widgetIndexid,
						'issetbar': 0
					}));
					HROS.CONFIG.widgetIndexid += 1;
				}
				nextDo({
					appid: appid,
					url: obj.url,
					width: obj.width,
					height: obj.height,
					top: obj.top == null ? 0 : obj.top,
					right: obj.right == null ? 0 : obj.right
				});
			}
		},
		create: function (appid, type, realappid) {
			type = type ? 'widget' : type;
			//判断窗口是否已打开
			let iswidgetopen = false;
			$('#desk .widget').each(function () {
				if ($(this).attr('appid') == appid) {
					iswidgetopen = true;
					return false;
				}
			});
			//如果没有打开，则进行创建
			if (!iswidgetopen && $('#d_' + appid).attr('opening') != 1) {
				$('#d_' + appid).attr('opening', 1);
				function nextDo(options) {
					let widgetId = '#w_' + options.appid;
					if (HROS.widget.checkCookie(appid, type)) {
						let widgetState = $.parseJSON($.cookie('widgetState' + HROS.CONFIG.memberID));
						$(widgetState).each(function () {
							if (this.appid == options.appid && this.type == options.type.toLowerCase()) {
								options.top = this.top;
								options.right = this.right;
							}
						});
					} else {
						HROS.widget.addCookie(options.realappid, options.type.toLowerCase(), 0, 0);
					}

					TEMP.widgetTemp = {
						'title': options.title,
						'width': options.width,
						'height': options.height,
						'type': options.type.toLowerCase(),
						'id': 'w_' + options.appid,
						'appid': options.appid,
						'realappid': options.realappid == 0 ? options.appid : options.realappid,
						'top': !options.top ? 0 : options.top,
						'right': !options.right ? 0 : options.right,
						'url': options.url,
						'zIndex': HROS.CONFIG.widgetIndexid,
						'issetbar': 1,
						'starcount': options.starcount
					};
					$('#desk').append(widgetWindowTemp(TEMP.widgetTemp));
					$(widgetId).data('info', TEMP.widgetTemp);
					HROS.CONFIG.widgetIndexid += 1;
				}
				HROS.request.get('/desk/createwindow', { id: appid, type: type }, function (responseText) {
					if (responseText.IsSuccess) {
						let app = responseText.Model;
						nextDo({
							type: app.type,
							appid: app.appId,
							realappid: app.appId,
							title: app.name,
							imgsrc: app.icon,
							url: app.url,
							width: app.width,
							height: app.height,
							isresize: app.isResize,
							isopenmax: app.isOpenMax,
							issetbar: app.isSetbar,
							starcount: app.starCount
						});
						$('#d_' + appid).attr('opening', 0);
					} else {
						NewCrm.msgbox.fail(responseText.Message)
					}
				})
			}
		},
		//还原上次退出系统时widget的状态
		reduction: function () {
			if (typeof $.cookie('widgetState' + HROS.CONFIG.memberID) !== 'undefined') {
				let widgetState = $.parseJSON($.cookie('widgetState' + HROS.CONFIG.memberID));
				$(widgetState).each(function () {
					HROS.widget.create(this.appid, this.type);
				});
			}
		},
		//根据id验证是否存在cookie中
		checkCookie: function (appid, type) {
			let value = $.cookie('widgetState' + HROS.CONFIG.memberID);
			let flag = false
			if (value) {
				let widgetState = $.parseJSON(value);
				$(widgetState).each(function () {
					if (this.appid == appid && this.type == type) {
						flag = true;
					}
				});
				return flag;
			}
			return flag
		},
        /*
		**  以下2个方法：addCookie、removeCookie
		**  用于记录widget打开状态以及摆放位置
		**  实现用户再次登入系统时，还原上次widget的状态
		*/
		addCookie: function (appid, type, top, right) {
			if (type == 'widget' || type == 'pwidget') {
				let coo = $.cookie('widgetState' + HROS.CONFIG.memberID);
				let widgetState = coo ? $.parseJSON(coo) : null;
				//检查是否存在，如果存在则更新，反之则添加
				if (HROS.widget.checkCookie(appid, type)) {
					$(widgetState).each(function () {
						if (this.appid == appid && this.type == type) {
							this.top = top;
							this.right = right;
						}
					});
				} else {
					if (widgetState == null) {
						widgetState = [];
					}
					widgetState.push({
						appid: appid,
						type: type,
						top: top,
						right: right
					});
				}
				$.cookie('widgetState' + HROS.CONFIG.memberID, $.toJSON(widgetState), { expires: 95 });
			}
		},
		removeCookie: function (appid, type) {
			if (type == 'widget' || type == 'pwidget') {
				if (HROS.widget.checkCookie(appid, type)) {
					let widgetState = $.parseJSON($.cookie('widgetState' + HROS.CONFIG.memberID));
					$(widgetState).each(function (i) {
						if (this.appid == appid && this.type == type) {
							widgetState.splice(i, 1);
							return false;
						}
					});
					$.cookie('widgetState' + HROS.CONFIG.memberID, $.toJSON(widgetState), { expires: 95 });
				}
			}
		},
		move: function () {
			$('#desk').on('mousedown', '.widget .move', function (e) {
				let obj = $(this).parents('.widget');
				HROS.widget.show2top(obj.attr('appid'));
				let x = e.clientX - obj.offset().left;
				let y = e.clientY - obj.offset().top;
				let lay;
				let t;
				let r;
				//绑定鼠标移动事件
				$(document).on('mousemove', function (e) {
					lay = HROS.maskBox.desk();
					lay.show();
					t = e.clientY - y < 0 ? 0 : e.clientY - y;
					r = $(window).width() - obj.width() - (e.clientX - x);
					obj.css({
						top: t,
						right: r
					});
				}).on('mouseup', function () {
					$(this).off('mousemove').off('mouseup');
					if (typeof (lay) !== 'undefined') {
						lay.hide();
					}
					if (obj.attr('type') != 'widgetTemp') {
						HROS.widget.addCookie(obj.attr('appid'), obj.attr('type'), t, r);
					}
				});
			});
		},
		close: function (appid) {
			let widgetId = '#w_' + appid;
			HROS.widget.removeCookie($(widgetId).attr('appid'), $(widgetId).attr('type'));
			$(widgetId).html('').remove();
		},
		show2top: function (appid) {
			let widgetId = '#w_' + appid;
			$(widgetId).css('z-index', HROS.CONFIG.widgetIndexid);
			HROS.CONFIG.widgetIndexid += 1;
		},
		handle: function () {
			$('#desk').on('mousedown', '.widget a', function (e) {
				e.preventDefault();
				e.stopPropagation();
			});
			$('#desk').on('click', '.widget .ha-close', function (e) {
				let obj = $(this).parents('.widget');
				HROS.widget.close(obj.attr('appid'));
			}).on('click', '.widget .ha-star', function () {
				let obj = $(this).parents('.widget');
				let point = parseFloat(obj.data('info').starcount).toFixed(1);
				$.dialog({
					title: '给“' + obj.data('info').title + '”打分',
					width: 250,
					id: 'star',
					content: starDialogTemp({
						'realappid': obj.data('info').realappid,
						'point': point,
						'realpoint': point * 20
					})
				});
			}).on('click', '.widget .ha-share', function () {
				let obj = $(this).parents('.widget');
				$.dialog({
					title: '分享应用',
					width: 370,
					id: 'share',
					content: shareDialogTemp({
						'sinaweiboAppkey': HROS.CONFIG.sinaweiboAppkey == '' ? '1197457869' :
							HROS.CONFIG.sinaweiboAppkey,
						'tweiboAppkey': HROS.CONFIG.tweiboAppkey == '' ? '801356816' : HROS.CONFIG.tweiboAppkey,
						'title': '我正在使用 %23HoorayOS%23 中的 %23' + obj.data('info').title + '%23 应用，很不错哦，推荐你也来试试！',
						'url': HROS.CONFIG.website + '?run=' + obj.data('info').realappid + '%26type=widget'
					})
				});
			});
		}
	}
})();/*
**  应用窗口
*/
HROS.window = (function () {
	return {
		init: function () {
			//窗口上各个按钮
			HROS.window.handle();
			//窗口移动
			HROS.window.move();
			//窗口拉伸
			HROS.window.resize();
			//绑定窗口遮罩层点击事件
			$('#desk').on('click', '.window-container .window-mask, .window-container .folder_body', function () {
				HROS.window.show2top($(this).parents('.window-container').attr('appid'), true);
			});
			//屏蔽窗口右键
			$('#desk').on('contextmenu', '.window-container', function () {
				return false;
			});
			//绑定文件夹内事件
			$('#desk').on('click', '.folder_body li', function () {
				return false;
			}).on('contextmenu', '.folder_body .appbtn', function (e) {
				$('.popup-menu').hide();
				$('.quick_view_container').remove();
				let popupmenu;
				switch ($(this).attr('type')) {
					case 'app':
					case 'window':
					case 'widget':
						 popupmenu = HROS.popupMenu.app($(this));
						break;
					case 'pwindow':
					case 'pwidget':
						 popupmenu = HROS.popupMenu.papp($(this));
						break;
				}
				let l = ($(window).width() - e.clientX) < popupmenu.width() ? (e.clientX - popupmenu.width()) : e.clientX;
				let t = ($(window).height() - e.clientY) < popupmenu.height() ? (e.clientY - popupmenu.height()) : e.clientY;
				popupmenu.css({
					left: l,
					top: t
				}).show();
				return false;
			});
		},
        /*
		**  创建窗口
		**  自定义窗口：HROS.window.createTemp({title,url,width,height,resize,isflash});
		**      后面参数依次为：标题、地址、宽、高、是否可拉伸、是否打开默认最大化、是否为flash
		**      示例：HROS.window.createTemp({title:"百度",url:"http://www.baidu.com",width:800,height:400,isresize:false,isopenmax:false,isflash:false});
		*/
		createTemp: function (obj) {

			let type = 'window', appid = obj.appid == null ? Date.parse(new Date()) : obj.appid;
			//判断窗口是否已打开
			let iswindowopen = false;
			$('#task-content-inner a.task-item').each(function () {

				if ($(this).attr('appid') == appid) {

					iswindowopen = true;
					HROS.window.show2top($(this).attr('appid'));
					return false;
				}
			});
			//如果没有打开，则进行创建
			if (!iswindowopen) {
				function nextDo(options) {
					let windowId = '#w_' + options.appid;
					//新增任务栏
					$('#task-content-inner').prepend(taskTemp({
						'type': options.type.toLowerCase(),
						'id': 't_' + options.appid,
						'appid': options.appid,
						'realappid': options.appid,
						'title': options.title,
						'imgsrc': options.imgsrc
					}));
					HROS.taskbar.resize();
					//新增窗口
					TEMP.windowTemp = {
						'top': ($(window).height() - options.height) / 2 <= 0 ? 0 : ($(window).height() - options.height) / 2,
						'left': ($(window).width() - options.width) / 2 <= 0 ? 0 : ($(window).width() - options.width) / 2,
						'emptyW': $(window).width() - options.width,
						'emptyH': $(window).height() - options.height,
						'width': options.width,
						'height': options.height,
						'zIndex': HROS.CONFIG.windowIndexid,
						'type': options.type.toLowerCase(),
						'id': 'w_' + options.appid,
						'appid': options.appid,
						'realappid': options.appid,
						'title': options.title,
						'url': options.url,
						'imgsrc': options.imgsrc,
						'isresize': options.isresize,
						'isopenmax': options.isopenmax,
						'istitlebar': options.isresize,
						'istitlebarFullscreen': options.isresize ? window.fullScreenApi.supportsFullScreen == true ? true : false : false,
						'issetbar': options.issetbar,
						'isflash': options.isflash
					};

					$('#desk').append(windowTemp(TEMP.windowTemp));
					$(windowId).data('info', TEMP.windowTemp);
					HROS.CONFIG.windowIndexid += 1;
					HROS.window.setPos(false);
					//iframe加载完毕后，隐藏loading遮罩层
					$(windowId + ' iframe').on('load', function () {
						$(windowId + ' .window-frame').children('div').eq(1).fadeOut();
					});
					HROS.window.show2top(options.appid);
				}
				nextDo({
					type: type,
					appid: appid,
					realappid: appid,
					imgsrc: '/images/ui/default_icon.png',
					title: obj.title,
					url: obj.url,
					width: obj.width,
					height: obj.height,
					isresize: obj.isresize,
					isopenmax: obj.isopenmax,
					issetbar: false,
					isflash: obj.isflash
				});
			} else {
				//如果设置强制刷新
				if (obj.refresh) {
					let windowId = '#w_' + appid;
					$(windowId).find('iframe').attr('src', obj.url);
				}
			}
		},
        /*
		**  创建窗口
		**  系统窗口：HROS.window.create(realappid, [type]);
		**      示例：HROS.window.create(12);
		*/
		create: function (realappid, type) {
			type = type == null ? 'window' : type;
			let appid;
			//判断窗口是否已打开
			let iswindowopen = false;
			$('#task-content-inner a.task-item').each(function () {
				if ($(this).attr('realappid') == realappid) {
					iswindowopen = true;
					appid = $(this).attr('appid');
					HROS.window.show2top(appid);
					return false;
				}
			});
			//如果没有打开，则进行创建
			if (!iswindowopen && $('#d_' + realappid).attr('opening') != 1) {
				$('#d_' + appid).attr('opening', 1);
				function nextDo(options) {
					let windowId = '#w_' + options.appid;
					let top = ($(window).height() - options.height) / 2 <= 0 ? 0 : ($(window).height() - options.height) / 2;
					let left = ($(window).width() - options.width) / 2 <= 0 ? 0 : ($(window).width() - options.width) / 2;
					switch (options.type.toLowerCase()) {
						case 'app':
						case 'pwindow':
							//新增任务栏
							$('#task-content-inner').prepend(taskTemp({
								'type': options.type.toLowerCase(),
								'id': 't_' + options.appid,
								'appid': options.appid,
								'realappid': options.realappid,
								'title': options.title,
								'imgsrc': options.imgsrc
							}));
							HROS.taskbar.resize();
							//新增窗口
							TEMP.windowTemp = {
								'top': top,
								'left': left,
								'emptyW': $(window).width() - options.width,
								'emptyH': $(window).height() - options.height,
								'width': options.width,
								'height': options.height,
								'zIndex': HROS.CONFIG.windowIndexid,
								'type': options.type.toLowerCase(),
								'id': 'w_' + options.appid,
								'appid': options.appid,
								'realappid': options.realappid,
								'title': options.title,
								'url': options.url,
								'imgsrc': options.imgsrc,
								'isresize': options.isresize,
								'isopenmax': options.isresize ? options.isopenmax : false,
								'istitlebar': options.isresize,
								'istitlebarFullscreen': options.isresize ? window.fullScreenApi.supportsFullScreen == true ? true : false : false,
								'issetbar': options.issetbar,
								'isflash': options.isflash,
								'starcount': options.starcount
							};
							$('#desk').append(windowTemp(TEMP.windowTemp));
							$(windowId).data('info', TEMP.windowTemp);
							HROS.CONFIG.windowIndexid += 1;
							HROS.window.setPos(false);
							//iframe加载完毕后，隐藏loading遮罩层
							$(windowId + ' iframe').on('load', function () {
								$(windowId + ' .window-frame').children('div').fadeOut();
							});

							HROS.window.show2top(options.appid);
							break;
						case 'folder':
							//新增任务栏
							$('#task-content-inner').prepend(taskTemp({
								'type': options.type.toLowerCase(),
								'id': 't_' + options.appid,
								'appid': options.appid,
								'realappid': options.realappid,
								'title': options.title,
								'imgsrc': options.imgsrc
							}));
							HROS.taskbar.resize();
							//新增窗口
							TEMP.folderWindowTemp = {
								'top': top,
								'left': left,
								'emptyW': $(window).width() - options.width,
								'emptyH': $(window).height() - options.height,
								'width': options.width,
								'height': options.height,
								'zIndex': HROS.CONFIG.windowIndexid,
								'type': options.type.toLowerCase(),
								'id': 'w_' + options.appid,
								'appid': options.appid,
								'realappid': options.realappid,
								'title': options.title,
								'imgsrc': options.imgsrc
							};
							$('#desk').append(folderWindowTemp(TEMP.folderWindowTemp));
							$(windowId).data('info', TEMP.folderWindowTemp);
							HROS.CONFIG.windowIndexid += 1;
							HROS.window.setPos(false);
							//载入文件夹内容
							let sc = '';
							$(HROS.VAR.folder).each(function () {
								if (this.memberId == options.appid) {
									sc = this.apps;
									return false;
								}
							});
							if (sc != '') {
								let folder_append = '';
								$(sc).each(function () {
									folder_append += appbtnTemp({
										'title': this.name,
										'type': this.type,
										'id': 'd_' + this.memberId,
										'appid': this.memberId,
										'realappid': this.appId == 0 ? this.memberId : this.appId,
										'imgsrc': this.icon
									});
								});
								$(windowId).find('.folder_body').append(folder_append);
							}

							HROS.window.show2top(options.appid);
							break;
						case 'file':
							TEMP.fileWindowTemp = {
								'top': top,
								'left': left,
								'emptyW': $(window).width() - options.width,
								'emptyH': $(window).height() - options.height,
								'width': options.width,
								'height': options.height,
								'zIndex': HROS.CONFIG.windowIndexid,
								'type': options.type.toLowerCase(),
								'id': 'w_' + options.appid,
								'appid': options.appid,
								'realappid': options.realappid,
								'title': options.title,
								'imgsrc': options.imgsrc
							};
							$('body').append(fileDownloadTemp(TEMP.fileWindowTemp));
							break;
					}
				}

				HROS.request.get('/desk/createwindow', { id: realappid, type: type }, function (responseText) {
					if (responseText.IsSuccess) {
						let app = responseText.Model;
						nextDo({
							type: app.type,
							appid: app.memberId,
							realappid: app.appId,
							title: app.name,
							imgsrc: app.icon,
							url: app.url,
							width: app.width,
							height: app.height,
							isresize: app.isResize,
							isopenmax: app.isOpenMax,
							issetbar: app.isSetbar,
							starcount: app.starCount
						});
						$('#d_' + appid).attr('opening', 0);
					} else {
						NewCrm.msgbox.fail(responseText.Message)
					}
				})
			}
		},
		setPos: function (isAnimate) {
			isAnimate = isAnimate == null ? true : isAnimate;
			$('#desk .window-container').each(function () {
				let windowdata = $(this).data('info');
				let currentW = $(window).width() - $(this).width();
				let currentH = $(window).height() - $(this).height();
				let left = windowdata['left'] / windowdata['emptyW'] * currentW >= currentW ? currentW : windowdata['left'] / windowdata['emptyW'] * currentW;
				left = left <= 0 ? 0 : left;
				let top = windowdata['top'] / windowdata['emptyH'] * currentH >= currentH ? currentH : windowdata['top'] / windowdata['emptyH'] * currentH;
				top = top <= 0 ? 0 : top;
				if ($(this).attr('state') != 'hide') {
					$(this).stop(true, false).animate({
						'left': left,
						'top': top
					}, isAnimate ? 500 : 0, function () {
						windowdata['left'] = left;
						windowdata['top'] = top;
						windowdata['emptyW'] = $(window).width() - $(this).width();
						windowdata['emptyH'] = $(window).height() - $(this).height();
					});
				} else {
					windowdata['left'] = left;
					windowdata['top'] = top;
					windowdata['emptyW'] = $(window).width() - $(this).width();
					windowdata['emptyH'] = $(window).height() - $(this).height();
				}
			});
		},
		close: function (appid) {
			let windowId = '#w_' + appid, taskId = '#t_' + appid;
			$(windowId).removeData('info').html('').remove();
			$('#task-content-inner ' + taskId).html('').remove();
			$('#task-content-inner').css('width', $('#task-content-inner .task-item').length * 114);
			$('#task-bar, #nav-bar').removeClass('min-zIndex');
			HROS.taskbar.resize();
		},
		closeAll: function () {
			$('#desk .window-container').each(function () {
				HROS.window.close($(this).attr('appid'));
			});
		},
		hide: function (appid) {
			let windowId = '#w_' + appid, taskId = '#t_' + appid;
			$(windowId).css('left', -10000).attr('state', 'hide');
			$('#task-content-inner ' + taskId).removeClass('task-item-current');
			if ($(windowId).attr('ismax') == 1) {
				$('#task-bar, #nav-bar').removeClass('min-zIndex');
			}
		},
		hideAll: function () {
			$('#task-content-inner a.task-item').removeClass('task-item-current');
			$('#desk-' + HROS.CONFIG.desk).nextAll('div.window-container').css('left', -10000).attr('state', 'hide');
		},
		max: function (appid) {
			HROS.window.show2top(appid);
			let windowId = '#w_' + appid, taskId = '#t_' + appid;
			$(windowId + ' .title-handle .ha-max').hide().next(".ha-revert").show();
			$(windowId).addClass('window-maximize').attr('ismax', 1).animate({
				width: '100%',
				height: '100%',
				top: 0,
				left: 0
			}, 200);
			$('#task-bar, #nav-bar').addClass('min-zIndex');
		},
		revert: function (appid) {
			HROS.window.show2top(appid);
			let windowId = '#w_' + appid, taskId = '#t_' + appid;
			$(windowId + ' .title-handle .ha-revert').hide().prev('.ha-max').show();
			let obj = $(windowId), windowdata = obj.data('info');
			obj.removeClass('window-maximize').attr('ismax', 0).animate({
				width: windowdata['width'],
				height: windowdata['height'],
				left: windowdata['left'],
				top: windowdata['top']
			}, 500);
			$('#task-bar, #nav-bar').removeClass('min-zIndex');
		},
		refresh: function (appid) {
			let windowId = '#w_' + appid, taskId = '#t_' + appid;
			//判断是应用窗口，还是文件夹窗口
			if ($(windowId + '_iframe').length != 0) {
				$(windowId + '_iframe').attr('src', $(windowId + '_iframe').attr('src'));
			} else {
				HROS.window.updateFolder(appid);
			}
		},
		show2top: function (appid, isAnimate) {
			isAnimate = isAnimate == null ? false : isAnimate;
			let windowId = '#w_' + appid, taskId = '#t_' + appid;
			let windowdata = $(windowId).data('info');
			let arr = [];
			function show() {
				HROS.window.show2under();
				//改变当前任务栏样式
				$('#task-content-inner ' + taskId).addClass('task-item-current');
				if ($(windowId).attr('ismax') == 1) {
					$('#task-bar, #nav-bar').addClass('min-zIndex');
				}
				//改变当前窗口样式
				$(windowId).addClass('window-current').css({
					'z-index': HROS.CONFIG.windowIndexid,
					'left': windowdata['left'],
					'top': windowdata['top']
				}).attr('state', 'show');
				//如果窗口最小化前是最大化状态的，则坐标位置设为0
				if ($(windowId).attr('ismax') == 1) {
					$(windowId).css({
						'left': 0,
						'top': 0
					});
				}
				//改变当前窗口遮罩层样式
				$(windowId + ' .window-mask').hide();
				//改变当前iframe显示
				$(windowId + ' iframe').show();
				HROS.CONFIG.windowIndexid += 1;
			}
			if (isAnimate) {
				let baseStartX = $(windowId).offset().left, baseEndX = baseStartX + $(windowId).width();
				let baseStartY = $(windowId).offset().top, baseEndY = baseStartY + $(windowId).height();
				let baseCenterX = baseStartX + ($(windowId).width() / 2), baseCenterY = baseStartY + ($(windowId).height() / 2);
				let baseZIndex = parseInt($(windowId).css('zIndex'));
				$('#desk .window-container:not(' + windowId + ')').each(function () {
					let thisStartX = $(this).offset().left, thisEndX = thisStartX + $(this).width();
					let thisStartY = $(this).offset().top, thisEndY = thisStartY + $(this).height();
					let thisCenterX = thisStartX + ($(this).width() / 2), thisCenterY = thisStartY + ($(this).height() / 2);
					let thisZIndex = parseInt($(this).css('zIndex'));
					let flag = '';
					if (thisZIndex > baseZIndex) {
						//  常规情况，只要有一个角处于区域内，则可以判断窗口有覆盖
						//   _______            _______        _______    _______
						//  |    ___|___    ___|       |   ___|___    |  |       |___
						//  |   |       |  |   |       |  |       |   |  |       |   |
						//  |___|       |  |   |_______|  |       |___|  |_______|   |
						//      |_______|  |_______|      |_______|          |_______|
						if (
							(thisStartX >= baseStartX && thisStartX <= baseEndX && thisStartY >= baseStartY && thisStartY <= baseEndY)
							||
							(thisStartX >= baseStartX && thisStartX <= baseEndX && thisEndY >= baseStartY && thisEndY <= baseEndY)
							||
							(thisEndX >= baseStartX && thisEndX <= baseEndX && thisStartY >= baseStartY && thisStartY <= baseEndY)
							||
							(thisEndX >= baseStartX && thisEndX <= baseEndX && thisEndY >= baseStartY && thisEndY <= baseEndY)
						) {
							flag = 'x';
						}
						//  非常规情况
						//       _______    _______          _____
						//   ___|       |  |       |___    _|     |___
						//  |   |       |  |       |   |  | |     |   |
						//  |___|       |  |       |___|  |_|     |___|
						//      |_______|  |_______|        |_____|
						if (
							(thisStartX >= baseStartX && thisStartX <= baseEndX && thisStartY < baseStartY && thisEndY > baseEndY)
							||
							(thisEndX >= baseStartX && thisEndX <= baseEndX && thisStartY < baseStartY && thisEndY > baseEndY)
						) {
							flag = 'x';
						}
						//      _____       ___________      _____
						//   __|_____|__   |           |   _|_____|___
						//  |           |  |           |  |           |
						//  |           |  |___________|  |___________|
						//  |___________|     |_____|       |_____|
						if (
							(thisStartY >= baseStartY && thisStartY <= baseEndY && thisStartX < baseStartX && thisEndX > baseEndX)
							||
							(thisEndY >= baseStartY && thisEndY <= baseEndY && thisStartX < baseStartX && thisEndX > baseEndX)
						) {
							flag = 'y';
						}
						//  两个角处于区域内，另外两种情况不用处理，因为这两种情况下，被移动的窗口是需要进行上下滑动，而非左右
						//      _____       ___________
						//   __|     |__   |   _____   |
						//  |  |     |  |  |  |     |  |
						//  |  |_____|  |  |__|     |__|
						//  |___________|     |_____|
						if (
							(thisStartX >= baseStartX && thisStartX <= baseEndX && thisEndY >= baseStartY && thisEndY <= baseEndY)
							&&
							(thisEndX >= baseStartX && thisEndX <= baseEndX && thisEndY >= baseStartY && thisEndY <= baseEndY)
							||
							(thisStartX >= baseStartX && thisStartX <= baseEndX && thisStartY >= baseStartY && thisStartY <= baseEndY)
							&&
							(thisEndX >= baseStartX && thisEndX <= baseEndX && thisStartY >= baseStartY && thisStartY <= baseEndY)
						) {
							flag = 'y';
						}
					}
					if (flag != '') {
						let direction, distance;
						if (flag == 'x') {
							if (thisCenterX > baseCenterX) {
								direction = 'right';
								distance = baseEndX - thisStartX + 30;
							} else {
								direction = 'left';
								distance = thisEndX - baseStartX + 30;
							}
						} else {
							if (thisCenterY > baseCenterY) {
								direction = 'bottom';
								distance = baseEndY - thisStartY + 30;
							} else {
								direction = 'top';
								distance = thisEndY - baseStartY + 30;
							}
						}
						arr.push({
							id: $(this).attr('id'),
							direction: direction, //移动方向
							distance: distance //移动距离
						});
					}
				});
				//开始移动
				let delayTime = 0;
				for (let i = 0; i < arr.length; i++) {
					let baseLeft = $('#' + arr[i].id).offset().left, baseTop = $('#' + arr[i].id).offset().top;
					if (arr[i].direction == 'left') {
						$('#' + arr[i].id).delay(delayTime).animate({
							left: baseLeft - arr[i].distance
						}, 300).animate({
							left: baseLeft
						}, 300);
					} else if (arr[i].direction == 'right') {
						$('#' + arr[i].id).delay(delayTime).animate({
							left: baseLeft + arr[i].distance
						}, 300).animate({
							left: baseLeft
						}, 300);
					} else if (arr[i].direction == 'top') {
						$('#' + arr[i].id).delay(delayTime).animate({
							top: baseTop - arr[i].distance
						}, 300).animate({
							top: baseTop
						}, 300);
					} else if (arr[i].direction == 'bottom') {
						$('#' + arr[i].id).delay(delayTime).animate({
							top: baseTop + arr[i].distance
						}, 300).animate({
							top: baseTop
						}, 300);
					}
					delayTime += 100;
				}
				setTimeout(show, delayTime + 100);
			} else {
				show();
			}
		},
		show2under: function () {
			//改变任务栏样式
			$('#task-content-inner a.task-item').removeClass('task-item-current');
			//改变窗口样式
			$('#desk .window-container').removeClass('window-current');
			//改变窗口遮罩层样式
			$('#desk .window-container .window-mask').show();
			//改变iframe显示
			$('#desk .window-container-flash iframe').hide();
		},
		updateFolder: function (appid) {
			let windowId = '#w_' + appid, taskId = '#t_' + appid;
			let sc = '';

			$(HROS.VAR.folder).each(function () {
				if (this.memberId == parseInt(appid)) {
					sc = this.apps;
					return false;
				}
			});

			if (sc != null) {
				let folder_append = '';
				for (let i = 0; i < sc.length; i++) {
					folder_append += appbtnTemp({
						'top': 0,
						'left': 0,
						'title': sc[i]['name'],
						'type': sc[i]['type'],
						'id': 'd_' + sc[i]['memberId'],
						'appid': sc[i]['memberId'],
						'realappid': sc[i]['appId'],
						'imgsrc': sc[i]['icon']
					});
				}
				$(windowId).find('.folder_body').html('').append(folder_append).on('contextmenu', '.appbtn', function (e) {
					$('.popup-menu').hide();
					$('.quick_view_container').remove();
					TEMP.AppRight = HROS.popupMenu.app($(this));
					let l = ($(window).width() - e.clientX) < TEMP.AppRight.width() ? (e.clientX - TEMP.AppRight.width()) : e.clientX;
					let t = ($(window).height() - e.clientY) < TEMP.AppRight.height() ? (e.clientY - TEMP.AppRight.height()) : e.clientY;
					TEMP.AppRight.css({
						left: l,
						top: t
					}).show();
					return false;
				});
			}
		},
		handle: function () {
			$('#desk').on('mousedown', '.window-container .title-bar .title-handle a', function (e) {
				e.preventDefault();
				e.stopPropagation();
			});
			$('#desk').on('dblclick', '.window-container .title-bar', function (e) {
				let obj = $(this).parents('.window-container');
				//判断当前窗口是否已经是最大化
				if (obj.find('.ha-max').is(':hidden')) {
					obj.find('.ha-revert').click();
				} else {
					obj.find('.ha-max').click();
				}
			}).on('click', '.window-container .ha-hide', function () {
				let obj = $(this).parents('.window-container');
				HROS.window.hide(obj.attr('appid'));
			}).on('click', '.window-container .ha-max', function () {
				let obj = $(this).parents('.window-container');
				HROS.window.max(obj.attr('appid'));
			}).on('click', '.window-container .ha-revert', function () {
				let obj = $(this).parents('.window-container');
				HROS.window.revert(obj.attr('appid'));
			}).on('click', '.window-container .ha-fullscreen', function () {
				let obj = $(this).parents('.window-container');
				window.fullScreenApi.requestFullScreen(document.getElementById(obj.find('iframe').attr('id')));
			}).on('click', '.window-container .ha-close', function () {
				let obj = $(this).parents('.window-container');
				HROS.window.close(obj.attr('appid'));
			}).on('click', '.window-container .refresh', function () {
				let obj = $(this).parents('.window-container');
				HROS.window.refresh(obj.attr('appid'));
			}).on('click', '.window-container .detail', function () {
				let obj = $(this).parents('.window-container');
				if (obj.attr('realappid') !== 0) {
					HROS.window.createTemp({
						appid: 'hoorayos-yysc',
						title: '应用市场',
						url: '/AppMarket/AppDetail?appId=' + obj.attr('realappid'),
						width: 800,
						height: 484,
						isflash: false,
						refresh: true
					});
				} else {
					NewCrm.msgbox.info('对不起，该应用没有任何详细介绍');
				}
			}).on('click', '.window-container .star', function () {
				let obj = $(this).parents('.window-container');
				let point = parseFloat(obj.data('info').starcount).toFixed(1);
				$.dialog({
					title: '给“' + obj.data('info').title + '”打分',
					width: 250,
					id: 'star',
					content: starDialogTemp({
						'realappid': obj.data('info').realappid,
						'point': point,
						'realpoint': point * 20
					})
				});
			}).on('click', '.window-container .share', function () {
				let obj = $(this).parents('.window-container');
				$.dialog({
					title: '分享应用',
					width: 370,
					id: 'share',
					content: shareDialogTemp({
						'sinaweiboAppkey': HROS.CONFIG.sinaweiboAppkey == '' ? '1197457869' : HROS.CONFIG.sinaweiboAppkey,
						'tweiboAppkey': HROS.CONFIG.tweiboAppkey == '' ? '801356816' : HROS.CONFIG.tweiboAppkey,
						'title': '我正在使用 %23HoorayOS%23 中的 %23' + obj.data('info').title + '%23 应用，很不错哦，推荐你也来试试！',
						'url': HROS.CONFIG.website + '?run=' + obj.data('info').realappid + '%26type=app'
					})
				});
			}).on('contextmenu', '.window-container', function () {
				$('.popup-menu').hide();
				$('.quick_view_container').remove();
				return false;
			});
		},
		move: function () {
			$('#desk').on('mousedown', '.window-container .title-bar', function (e) {
				let obj = $(this).parents('.window-container');
				if (obj.attr('ismax') == 1) {
					return false;
				}
				HROS.window.show2top(obj.attr('appid'));
				let windowdata = obj.data('info');
				let x = e.clientX - obj.offset().left;
				let y = e.clientY - obj.offset().top;
				let lay;
				//绑定鼠标移动事件
				$(document).on('mousemove', function (e) {
					lay = HROS.maskBox.desk();
					lay.show();
					//强制把右上角还原按钮隐藏，最大化按钮显示
					obj.find('.ha-revert').hide().prev('.ha-max').show();
					obj.css({
						width: windowdata['width'],
						height: windowdata['height'],
						left: e.clientX - x,
						top: e.clientY - y <= 10 ? 0 : e.clientY - y >= lay.height() - 30 ? lay.height() - 30 : e.clientY - y
					});
					obj.data('info').left = obj.offset().left;
					obj.data('info').top = obj.offset().top;
				}).on('mouseup', function () {
					$(this).off('mousemove').off('mouseup');
					if (typeof (lay) !== 'undefined') {
						lay.hide();
					}
				});
			});
		},
		resize: function (obj) {
			$('#desk').on('mousedown', '.window-container .window-resize', function (e) {
				let obj = $(this).parents('.window-container');
				let resizeobj = $(this);
				let lay;
				let x = e.clientX;
				let y = e.clientY;
				let w = obj.width();
				let h = obj.height();
				$(document).on('mousemove', function (e) {
					lay = HROS.maskBox.desk();
					lay.show();
					//当拖动到屏幕边缘时，自动贴屏
					let _x = e.clientX <= 10 ? 0 : e.clientX >= (lay.width() - 12) ? (lay.width() - 2) : e.clientX;
					let _y = e.clientY <= 10 ? 0 : e.clientY >= (lay.height() - 12) ? lay.height() : e.clientY;
					switch (resizeobj.attr('resize')) {
						case 't':
							h + y - _y > HROS.CONFIG.windowMinHeight ? obj.css({
								height: h + y - _y,
								top: _y
							}) : obj.css({
								height: HROS.CONFIG.windowMinHeight
							});
							break;
						case 'r':
							w - x + _x > HROS.CONFIG.windowMinWidth ? obj.css({
								width: w - x + _x
							}) : obj.css({
								width: HROS.CONFIG.windowMinWidth
							});
							break;
						case 'b':
							h - y + _y > HROS.CONFIG.windowMinHeight ? obj.css({
								height: h - y + _y
							}) : obj.css({
								height: HROS.CONFIG.windowMinHeight
							});
							break;
						case 'l':
							w + x - _x > HROS.CONFIG.windowMinWidth ? obj.css({
								width: w + x - _x,
								left: _x
							}) : obj.css({
								width: HROS.CONFIG.windowMinWidth
							});
							break;
						case 'rt':
							h + y - _y > HROS.CONFIG.windowMinHeight ? obj.css({
								height: h + y - _y,
								top: _y
							}) : obj.css({
								height: HROS.CONFIG.windowMinHeight
							});
							w - x + _x > HROS.CONFIG.windowMinWidth ? obj.css({
								width: w - x + _x
							}) : obj.css({
								width: HROS.CONFIG.windowMinWidth
							});
							break;
						case 'rb':
							w - x + _x > HROS.CONFIG.windowMinWidth ? obj.css({
								width: w - x + _x
							}) : obj.css({
								width: HROS.CONFIG.windowMinWidth
							});
							h - y + _y > HROS.CONFIG.windowMinHeight ? obj.css({
								height: h - y + _y
							}) : obj.css({
								height: HROS.CONFIG.windowMinHeight
							});
							break;
						case 'lt':
							w + x - _x > HROS.CONFIG.windowMinWidth ? obj.css({
								width: w + x - _x,
								left: _x
							}) : obj.css({
								width: HROS.CONFIG.windowMinWidth
							});
							h + y - _y > HROS.CONFIG.windowMinHeight ? obj.css({
								height: h + y - _y,
								top: _y
							}) : obj.css({
								height: HROS.CONFIG.windowMinHeight
							});
							break;
						case 'lb':
							w + x - _x > HROS.CONFIG.windowMinWidth ? obj.css({
								width: w + x - _x,
								left: _x
							}) : obj.css({
								width: HROS.CONFIG.windowMinWidth
							});
							h - y + _y > HROS.CONFIG.windowMinHeight ? obj.css({
								height: h - y + _y
							}) : obj.css({
								height: HROS.CONFIG.windowMinHeight
							});
							break;
					}
				}).on('mouseup', function () {
					if (typeof (lay) !== 'undefined') {
						lay.hide();
					}
					obj.data('info').width = obj.width();
					obj.data('info').height = obj.height();
					obj.data('info').left = obj.offset().left;
					obj.data('info').top = obj.offset().top;
					obj.data('info').emptyW = $(window).width() - obj.width();
					obj.data('info').emptyH = $(window).height() - obj.height();
					$(this).off('mousemove').off('mouseup');
				});
			});
		}
	}
})();/*
**  该功能是从QQ空间里提取出来的
**  用于判断页面是否处于缩放状态中，并给予提示
**  可在浏览页时按住ctrl+鼠标滚轮进行测试预览
*/
HROS.zoom = (function () {
	return {
        /*
		**  初始化
		**  其实也不用初始化，可以直接把object代码写在页面上
		**  需要注意的是onchange参数，调用的是HROS.zoom.check方法
		*/
		init: function () {
			$('body').append('<div id="zoombox"></div>');
            /*
			**  使用SWFObject.js插入flash
			**  http://www.cnblogs.com/wuxinxi007/archive/2009/10/27/1590709.html
			*/
			swfobject.embedSWF('/js/hooray/zoom.swf?onchange=HROS.zoom.check', 'zoombox', '10', '10', '6.0.0', 'expressInstall.swf', '', { allowScriptAccess: 'always', wmode: 'transparent', scale: 'noScale' }, { id: 'accessory_zoom', name: 'zoom_detect' });
		},
        /*
		**  为什么会有个参数o？其实我也不知道
		**  o.scale的值是数字，当o.scale大于1时，页面处于放大状态，反之则为缩小状态
		*/
		check: function (o) {
			let s = o.scale, m = s > 1 ? '放大' : '缩小';
			if (s != 1) {
				HROS.VAR.zoomLevel = s;
				$('#zoom-tip').show().find('span').text('您的浏览器目前处于' + m + '状态，会导致显示不正常，您可以键盘按“ctrl+数字0”组合键恢复初始状态！');
			} else {
				if (s != HROS.VAR.zoomLevel) {
					$('#zoom-tip').fadeOut();
				}
			}
		},
        /*
		**  关闭，其实是删除，如果想做关闭，把代码改成hide()即可
		*/
		close: function () {
			$('#zoom-tip').remove();
		}
	}
})();

HROS.signalR = (function () {
	return {
		init: function () {
			let connection = new signalR.HubConnectionBuilder().withUrl("/hubs?userId=" + HROS.CONFIG.memberID).configureLogging(signalR.LogLevel.Information).build();
			connection.on("Message", (responseText) => {
				let message = JSON.parse(responseText)
				let Notification = window.Notification || window.mozNotification || window.webKitNotification;
				if (Notification && Notification.permission !== "granted") {
					Notification.requestPermission(function (status) {
						if (Notification.permission !== status) {
							Notification.permission = status;
						}
					});
				} else if (Notification && Notification.permission === "granted") {
					let options = {
						dir: "rtl",
						lang: "zh-CN",
						body: message.Content
					};
					let not = new Notification(message.Title, options);
				}
			});
			connection.start().then(() => {
				connection.invoke('RegisterConnection').then((result) => {
					connectionId = result;
				}).catch(err => NewCrm.msgbox.fail('推送服务注册失败:' + err));
			}).catch(err => NewCrm.msgbox.fail('推送服务连接失败'));

			HROS.signalR.instance = connection;
		},
		stop: function (callback) {
			HROS.signalR.instance.stop();
			HROS.signalR.instance.onclose(function (err) {
				if (callback) {
					callback && callback();
				}
			})
		}
	}
})();

HROS.request = (function () {
	return {
		get: function (url, parameter, callback) {
			return HROS.request.internalRequset(url, 'GET', parameter, callback)
		},
		post: function (url, parameter, callback) {
			if (HROS.request.state === 'posting') {
				NewCrm.msgbox.fail(HROS.CONFIG.postOnce)
			} else {
				return HROS.request.internalRequset(url, 'POST', parameter, callback)
			}
		},
		internalRequset: function (url, method, parameter, callback) {
			let cookie = $.cookie('User');
			if (cookie || HROS.request.noCheckUrls.includes(url.toLowerCase())) {
				$.ajax({
					type: method,
					url: url,
					data: Object.keys(parameter).length ? parameter : null,
					beforeSend: function () {
						NewCrm.msgbox.loading(HROS.CONFIG.loadingPrompt)
						HROS.request.state = 'posting'
					},
					success: function (responseText) {
						NewCrm.msgbox.close()
						if (callback) {
							if (responseText.IsSuccess) {
								HROS.request.state = 'posted'
							} else {
								HROS.request.state = 'normal'
							}
							callback && callback(responseText)
						}
					},
					error: function (responseText) {
						NewCrm.msgbox.fail(responseText.statusText);
						HROS.request.state = 'normal'
						responseText.abort()
					}
				});
			} else {
				NewCrm.msgbox.fail(HROS.CONFIG.timeOutPrompt);
			}
		},
		noCheckUrls: (function () {
			return ['/desk/landing']
		})()
	}
})();

/*
    通用表单验证方法
    Validform version 5.3.2
	By sean during April 7, 2010 - March 26, 2013
	For more information, please visit http://validform.rjboy.cn
	Validform is available under the terms of the MIT license.
	
	Demo:
	$(".demoform").Validform({//$(".demoform")指明是哪一表单需要验证,名称需加在form表单上;
		btnSubmit:"#btn_sub", //#btn_sub是该表单下要绑定点击提交表单事件的按钮;如果form内含有submit按钮该参数可省略;
		btnReset:".btn_reset",//可选项 .btn_reset是该表单下要绑定点击重置表单事件的按钮;
		tiptype:1, //可选项 1=>pop box,2=>side tip(parent.next.find; with default pop),3=>side tip(siblings; with default pop),4=>side tip(siblings; none pop)，默认为1，也可以传入一个function函数，自定义提示信息的显示方式（可以实现你想要的任何效果，具体参见demo页）;
		ignoreHidden:false,//可选项 true | false 默认为false，当为true时对:hidden的表单元素将不做验证;
		dragonfly:false,//可选项 true | false 默认false，当为true时，值为空时不做验证；
		tipSweep:true,//可选项 true | false 默认为false，只在表单提交时触发检测，blur事件将不会触发检测（实时验证会在后台进行，不会显示检测结果）;
		label:".label",//可选项 选择符，在没有绑定nullmsg时查找要显示的提示文字，默认查找".Validform_label"下的文字;
		showAllError:false,//可选项 true | false，true：提交表单时所有错误提示信息都会显示，false：一碰到验证不通过的就停止检测后面的元素，只显示该元素的错误信息;
		postonce:true, //可选项 表单是否只能提交一次，true开启，不填则默认关闭;
		ajaxPost:true, //使用ajax方式提交表单数据，默认false，提交地址就是action指定地址;
		datatype:{//传入自定义datatype类型，可以是正则，也可以是函数（函数内会传入一个参数）;
			"*6-20": /^[^\s]{6,20}$/,
			"z2-4" : /^[\u4E00-\u9FA5\uf900-\ufa2d]{2,4}$/,
			"username":function(gets,obj,curform,regxp){
				//参数gets是获取到的表单元素值，obj为当前表单元素，curform为当前验证的表单，regxp为内置的一些正则表达式的引用;
				var reg1=/^[\w\.]{4,16}$/,
					reg2=/^[\u4E00-\u9FA5\uf900-\ufa2d]{2,8}$/;
				
				if(reg1.test(gets)){return true;}
				if(reg2.test(gets)){return true;}
				return false;
				
				//注意return可以返回true 或 false 或 字符串文字，true表示验证通过，返回字符串表示验证失败，字符串作为错误提示显示，返回false则用errmsg或默认的错误提示;
			},
			"phone":function(){
				// 5.0 版本之后，要实现二选一的验证效果，datatype 的名称 不 需要以 "option_" 开头;	
			}
		},
		usePlugin:{
			swfupload:{},
			datepicker:{},
			passwordstrength:{},
			jqtransform:{
				selector:"select,input"
			}
		},
		beforeCheck:function(curform){
			//在表单提交执行验证之前执行的函数，curform参数是当前表单对象。
			//这里明确return false的话将不会继续执行验证操作;	
		},
		beforeSubmit:function(curform){
			//在验证成功后，表单提交前执行的函数，curform参数是当前表单对象。
			//这里明确return false的话表单将不会提交;	
		},
		callback:function(data){
			//返回数据data是json格式，{"info":"demo info","status":"y"}
			//info: 输出提示信息;
			//status: 返回提交数据的状态,是否提交成功。如可以用"y"表示提交成功，"n"表示提交失败，在ajax_post.php文件返回数据里自定字符，主要用在callback函数里根据该值执行相应的回调操作;
			//你也可以在ajax_post.php文件返回更多信息在这里获取，进行相应操作；
			//ajax遇到服务端错误时也会执行回调，这时的data是{ status:**, statusText:**, readyState:**, responseText:** }；
			
			//这里执行回调操作;
			//注意：如果不是ajax方式提交表单，传入callback，这时data参数是当前表单对象，回调函数会在表单验证全部通过后执行，然后判断是否提交表单，如果callback里明确return false，则表单不会提交，如果return true或没有return，则会提交表单。
		}
	});
	
	Validform对象的方法和属性：
	tipmsg：自定义提示信息，通过修改Validform对象的这个属性值来让同一个页面的不同表单使用不同的提示文字；
	dataType：获取内置的一些正则；
	eq(n)：获取Validform对象的第n个元素;
	ajaxPost(flag,sync,url)：以ajax方式提交表单。flag为true时，跳过验证直接提交，sync为true时将以同步的方式进行ajax提交，传入了url地址时，表单会提交到这个地址；
	abort()：终止ajax的提交；
	submitForm(flag,url)：以参数里设置的方式提交表单，flag为true时，跳过验证直接提交，传入了url地址时，表单会提交到这个地址；
	resetForm()：重置表单；
	resetStatus()：重置表单的提交状态。传入了postonce参数的话，表单成功提交后状态会设置为"posted"，重置提交状态可以让表单继续可以提交；
	getStatus()：获取表单的提交状态，normal：未提交，posting：正在提交，posted：已成功提交过；
	setStatus(status)：设置表单的提交状态，可以设置normal，posting，posted三种状态，不传参则设置状态为posting，这个状态表单可以验证，但不能提交；
	ignore(selector)：忽略对所选择对象的验证；
	unignore(selector)：将ignore方法所忽略验证的对象重新获取验证效果；
	addRule(rule)：可以通过Validform对象的这个方法来给表单元素绑定验证规则；
	check(bool,selector):对指定对象进行验证(默认验证当前整个表单)，通过返回true，否则返回false（绑定实时验证的对象，格式符合要求时返回true，而不会等ajax的返回结果），bool为true时则只验证不显示提示信息；
	config(setup):可以通过这个方法来修改初始化参数，指定表单的提交地址，给表单ajax和实时验证的ajax里设置参数；
*/

(function ($, win, undef) {
	var errorobj = null,//指示当前验证失败的表单元素;
		msgobj = null,//pop box object 
		msghidden = true;//msgbox hidden?

	var tipmsg = {//默认提示文字;
		tit: "提示信息",
		w: {
			"*": "不能为空！",
			"*6-16": "请填写6到16位任意字符！",
			"n": "请填写数字！",
			"n6-16": "请填写6到16位数字！",
			"s": "不能输入特殊字符！",
			"s6-18": "请填写6到18位字符！",
			"p": "请填写邮政编码！",
			"m": "请填写手机号码！",
			"e": "邮箱地址格式不对！",
			"url": "请填写网址！"
		},
		def: "请填写正确信息！",
		undef: "datatype未定义！",
		reck: "两次输入的内容不一致！",
		r: "通过信息验证！",
		c: "正在检测信息…",
		s: "请{填写|选择}{0|信息}！",
		v: "所填信息没有经过验证，请稍后…",
		p: "正在提交数据…"
	}
	$.Tipmsg = tipmsg;

	var Validform = function (forms, settings, inited) {
		var settings = $.extend({}, Validform.defaults, settings);
		settings.datatype && $.extend(Validform.util.dataType, settings.datatype);

		var brothers = this;
		brothers.tipmsg = { w: {} };
		brothers.forms = forms;
		brothers.objects = [];

		//创建子对象时不再绑定事件;
		if (inited === true) {
			return false;
		}

		forms.each(function () {
			//已经绑定事件时跳过，避免事件重复绑定;
			if (this.validform_inited == "inited") { return true; }
			this.validform_inited = "inited";

			var curform = this;
			curform.settings = $.extend({}, settings);

			var $this = $(curform);

			//防止表单按钮双击提交两次;
			curform.validform_status = "normal"; //normal | posting | posted;

			//让每个Validform对象都能自定义tipmsg;	
			$this.data("tipmsg", brothers.tipmsg);

			//bind the blur event;
			$this.delegate("[datatype]", "blur", function () {
				//判断是否是在提交表单操作时触发的验证请求；
				var subpost = arguments[1];
				Validform.util.check.call(this, $this, subpost);
			});

			$this.delegate(":text", "keypress", function (event) {
				if (event.keyCode == 13 && $this.find(":submit").length == 0) {
					$this.submit();
				}
			});

			//点击表单元素，默认文字消失效果;
			//表单元素值比较时的信息提示增强;
			//radio、checkbox提示信息增强;
			//外调插件初始化;
			Validform.util.enhance.call($this, curform.settings.tiptype, curform.settings.usePlugin, curform.settings.tipSweep);

			curform.settings.btnSubmit && $this.find(curform.settings.btnSubmit).bind("click", function () {
				$this.trigger("submit");
				return false;
			});

			$this.submit(function () {
				var subflag = Validform.util.submitForm.call($this, curform.settings);
				subflag === undef && (subflag = true);
				return subflag;
			});

			$this.find("[type='reset']").add($this.find(curform.settings.btnReset)).bind("click", function () {
				Validform.util.resetForm.call($this);
			});

		});

		//预创建pop box;
		if (settings.tiptype == 1 || (settings.tiptype == 2 || settings.tiptype == 3) && settings.ajaxPost) {
			creatMsgbox();
		}
	}

	Validform.defaults = {
		tiptype: 1,
		tipSweep: false,
		showAllError: false,
		postonce: false,
		ajaxPost: false
	}

	Validform.util = {
		dataType: {
			"*": /[\w\W]+/,
			"*6-16": /^[\w\W]{6,16}$/,
			"n": /^\d+$/,
			"n6-16": /^\d{6,16}$/,
			"s": /^[\u4E00-\u9FA5\uf900-\ufa2d\w\.\s]+$/,
			"s6-18": /^[\u4E00-\u9FA5\uf900-\ufa2d\w\.\s]{6,18}$/,
			"p": /^[0-9]{6}$/,
			"m": /^13[0-9]{9}$|14[0-9]{9}|15[0-9]{9}$|18[0-9]{9}$/,
			"e": /^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,
			"url": /^(\w+:\/\/)?\w+(\.\w+)+.*$/
		},

		toString: Object.prototype.toString,

		isEmpty: function (val) {
			return val === "" || val === $.trim(this.attr("tip"));
		},

		getValue: function (obj) {
			var inputval,
				curform = this;

			if (obj.is(":radio")) {
				inputval = curform.find(":radio[name='" + obj.attr("name") + "']:checked").val();
				inputval = inputval === undef ? "" : inputval;
			} else if (obj.is(":checkbox")) {
				inputval = "";
				curform.find(":checkbox[name='" + obj.attr("name") + "']:checked").each(function () {
					inputval += $(this).val() + ',';
				})
				inputval = inputval === undef ? "" : inputval;
			} else {
				inputval = obj.val();
			}
			inputval = $.trim(inputval);

			return Validform.util.isEmpty.call(obj, inputval) ? "" : inputval;
		},

		enhance: function (tiptype, usePlugin, tipSweep, addRule) {
			var curform = this;

			//页面上不存在提示信息的标签时，自动创建;
			curform.find("[datatype]").each(function () {
				if (tiptype == 2) {
					if ($(this).parent().next().find(".Validform_checktip").length == 0) {
						$(this).parent().next().append("<span class='Validform_checktip' />");
						$(this).siblings(".Validform_checktip").remove();
					}
				} else if (tiptype == 3 || tiptype == 4) {
					if ($(this).siblings(".Validform_checktip").length == 0) {
						$(this).parent().append("<span class='Validform_checktip' />");
						$(this).parent().next().find(".Validform_checktip").remove();
					}
				}
			})

			//表单元素值比较时的信息提示增强;
			curform.find("input[recheck]").each(function () {
				//已经绑定事件时跳过;
				if (this.validform_inited == "inited") { return true; }
				this.validform_inited = "inited";

				var _this = $(this);
				var recheckinput = curform.find("input[name='" + $(this).attr("recheck") + "']");
				recheckinput.bind("keyup", function () {
					if (recheckinput.val() == _this.val() && recheckinput.val() != "") {
						if (recheckinput.attr("tip")) {
							if (recheckinput.attr("tip") == recheckinput.val()) { return false; }
						}
						_this.trigger("blur");
					}
				}).bind("blur", function () {
					if (recheckinput.val() != _this.val() && _this.val() != "") {
						if (_this.attr("tip")) {
							if (_this.attr("tip") == _this.val()) { return false; }
						}
						_this.trigger("blur");
					}
				});
			});

			//hasDefaultText;
			curform.find("[tip]").each(function () {//tip是表单元素的默认提示信息,这是点击清空效果;
				//已经绑定事件时跳过;
				if (this.validform_inited == "inited") { return true; }
				this.validform_inited = "inited";

				var defaultvalue = $(this).attr("tip");
				var altercss = $(this).attr("altercss");
				$(this).focus(function () {
					if ($(this).val() == defaultvalue) {
						$(this).val('');
						if (altercss) { $(this).removeClass(altercss); }
					}
				}).blur(function () {
					if ($.trim($(this).val()) === '') {
						$(this).val(defaultvalue);
						if (altercss) { $(this).addClass(altercss); }
					}
				});
			});

			//enhance info feedback for checkbox & radio;
			curform.find(":checkbox[datatype],:radio[datatype]").each(function () {
				//已经绑定事件时跳过;
				if (this.validform_inited == "inited") { return true; }
				this.validform_inited = "inited";

				var _this = $(this);
				var name = _this.attr("name");
				curform.find("[name='" + name + "']").filter(":checkbox,:radio").bind("click", function () {
					//避免多个事件绑定时的取值滞后问题;
					setTimeout(function () {
						_this.trigger("blur");
					}, 0);
				});

			});

			//select multiple;
			curform.find("select[datatype][multiple]").bind("click", function () {
				var _this = $(this);
				setTimeout(function () {
					_this.trigger("blur");
				}, 0);
			});

			//plugins here to start;
			Validform.util.usePlugin.call(curform, usePlugin, tiptype, tipSweep, addRule);
		},

		usePlugin: function (plugin, tiptype, tipSweep, addRule) {
			/*
				plugin:settings.usePlugin;
				tiptype:settings.tiptype;
				tipSweep:settings.tipSweep;
				addRule:是否在addRule时触发;
			*/

			var curform = this,
				plugin = plugin || {};
			//swfupload;
			if (curform.find("input[plugin='swfupload']").length && typeof (swfuploadhandler) != "undefined") {

				var custom = {
					custom_settings: {
						form: curform,
						showmsg: function (msg, type, obj) {
							Validform.util.showmsg.call(curform, msg, tiptype, { obj: curform.find("input[plugin='swfupload']"), type: type, sweep: tipSweep });
						}
					}
				};

				custom = $.extend(true, {}, plugin.swfupload, custom);

				curform.find("input[plugin='swfupload']").each(function (n) {
					if (this.validform_inited == "inited") { return true; }
					this.validform_inited = "inited";

					$(this).val("");
					swfuploadhandler.init(custom, n);
				});

			}

			//datepicker;
			if (curform.find("input[plugin='datepicker']").length && $.fn.datePicker) {
				plugin.datepicker = plugin.datepicker || {};

				if (plugin.datepicker.format) {
					Date.format = plugin.datepicker.format;
					delete plugin.datepicker.format;
				}
				if (plugin.datepicker.firstDayOfWeek) {
					Date.firstDayOfWeek = plugin.datepicker.firstDayOfWeek;
					delete plugin.datepicker.firstDayOfWeek;
				}

				curform.find("input[plugin='datepicker']").each(function (n) {
					if (this.validform_inited == "inited") { return true; }
					this.validform_inited = "inited";

					plugin.datepicker.callback && $(this).bind("dateSelected", function () {
						var d = new Date($.event._dpCache[this._dpId].getSelected()[0]).asString(Date.format);
						plugin.datepicker.callback(d, this);
					});
					$(this).datePicker(plugin.datepicker);
				});
			}

			//passwordstrength;
			if (curform.find("input[plugin*='passwordStrength']").length && $.fn.passwordStrength) {
				plugin.passwordstrength = plugin.passwordstrength || {};
				plugin.passwordstrength.showmsg = function (obj, msg, type) {
					Validform.util.showmsg.call(curform, msg, tiptype, { obj: obj, type: type, sweep: tipSweep });
				};

				curform.find("input[plugin='passwordStrength']").each(function (n) {
					if (this.validform_inited == "inited") { return true; }
					this.validform_inited = "inited";

					$(this).passwordStrength(plugin.passwordstrength);
				});
			}

			//jqtransform;
			if (addRule != "addRule" && plugin.jqtransform && $.fn.jqTransSelect) {
				if (curform[0].jqTransSelected == "true") { return; };
				curform[0].jqTransSelected = "true";

				var jqTransformHideSelect = function (oTarget) {
					var ulVisible = $('.jqTransformSelectWrapper ul:visible');
					ulVisible.each(function () {
						var oSelect = $(this).parents(".jqTransformSelectWrapper:first").find("select").get(0);
						//do not hide if click on the label object associated to the select
						if (!(oTarget && oSelect.oLabel && oSelect.oLabel.get(0) == oTarget.get(0))) { $(this).hide(); }
					});
				};

				/* Check for an external click */
				var jqTransformCheckExternalClick = function (event) {
					if ($(event.target).parents('.jqTransformSelectWrapper').length === 0) { jqTransformHideSelect($(event.target)); }
				};

				var jqTransformAddDocumentListener = function () {
					$(document).mousedown(jqTransformCheckExternalClick);
				};

				if (plugin.jqtransform.selector) {
					curform.find(plugin.jqtransform.selector).filter('input:submit, input:reset, input[type="button"]').jqTransInputButton();
					curform.find(plugin.jqtransform.selector).filter('input:text, input:password').jqTransInputText();
					curform.find(plugin.jqtransform.selector).filter('input:checkbox').jqTransCheckBox();
					curform.find(plugin.jqtransform.selector).filter('input:radio').jqTransRadio();
					curform.find(plugin.jqtransform.selector).filter('textarea').jqTransTextarea();
					if (curform.find(plugin.jqtransform.selector).filter("select").length > 0) {
						curform.find(plugin.jqtransform.selector).filter("select").jqTransSelect();
						jqTransformAddDocumentListener();
					}

				} else {
					curform.jqTransform();
				}

				curform.find(".jqTransformSelectWrapper").find("li a").click(function () {
					$(this).parents(".jqTransformSelectWrapper").find("select").trigger("blur");
				});
			}

		},

		getNullmsg: function (curform) {
			var obj = this;
			var reg = /[\u4E00-\u9FA5\uf900-\ufa2da-zA-Z\s]+/g;
			var nullmsg;

			var label = curform[0].settings.label || ".Validform_label";
			label = obj.siblings(label).eq(0).text() || obj.siblings().find(label).eq(0).text() || obj.parent().siblings(label).eq(0).text() || obj.parent().siblings().find(label).eq(0).text();
			label = label.replace(/\s(?![a-zA-Z])/g, "").match(reg);
			label = label ? label.join("") : [""];

			reg = /\{(.+)\|(.+)\}/;
			nullmsg = curform.data("tipmsg").s || tipmsg.s;

			if (label != "") {
				nullmsg = nullmsg.replace(/\{0\|(.+)\}/, label);
				if (obj.attr("recheck")) {
					nullmsg = nullmsg.replace(/\{(.+)\}/, "");
					obj.attr("nullmsg", nullmsg);
					return nullmsg;
				}
			} else {
				nullmsg = obj.is(":checkbox,:radio,select") ? nullmsg.replace(/\{0\|(.+)\}/, "") : nullmsg.replace(/\{0\|(.+)\}/, "$1");
			}
			nullmsg = obj.is(":checkbox,:radio,select") ? nullmsg.replace(reg, "$2") : nullmsg.replace(reg, "$1");

			obj.attr("nullmsg", nullmsg);
			return nullmsg;
		},

		getErrormsg: function (curform, datatype, recheck) {
			var regxp = /^(.+?)((\d+)-(\d+))?$/,
				regxp2 = /^(.+?)(\d+)-(\d+)$/,
				regxp3 = /(.*?)\d+(.+?)\d+(.*)/,
				mac = datatype.match(regxp),
				temp, str;

			//如果是值不一样而报错;
			if (recheck == "recheck") {
				str = curform.data("tipmsg").reck || tipmsg.reck;
				return str;
			}

			var tipmsg_w_ex = $.extend({}, tipmsg.w, curform.data("tipmsg").w);

			//如果原来就有，直接显示该项的提示信息;
			if (mac[0] in tipmsg_w_ex) {
				return curform.data("tipmsg").w[mac[0]] || tipmsg.w[mac[0]];
			}

			//没有的话在提示对象里查找相似;
			for (var name in tipmsg_w_ex) {
				if (name.indexOf(mac[1]) != -1 && regxp2.test(name)) {
					str = (curform.data("tipmsg").w[name] || tipmsg.w[name]).replace(regxp3, "$1" + mac[3] + "$2" + mac[4] + "$3");
					curform.data("tipmsg").w[mac[0]] = str;

					return str;
				}

			}

			return curform.data("tipmsg").def || tipmsg.def;
		},

		_regcheck: function (datatype, gets, obj, curform) {
			var curform = curform,
				info = null,
				passed = false,
				reg = /\/.+\//g,
				regex = /^(.+?)(\d+)-(\d+)$/,
				type = 3;//default set to wrong type, 2,3,4;

			//datatype有三种情况：正则，函数和直接绑定的正则;

			//直接是正则;
			if (reg.test(datatype)) {
				var regstr = datatype.match(reg)[0].slice(1, -1);
				var param = datatype.replace(reg, "");
				var rexp = RegExp(regstr, param);

				passed = rexp.test(gets);

				//function;
			} else if (Validform.util.toString.call(Validform.util.dataType[datatype]) == "[object Function]") {
				passed = Validform.util.dataType[datatype](gets, obj, curform, Validform.util.dataType);
				if (passed === true || passed === undef) {
					passed = true;
				} else {
					info = passed;
					passed = false;
				}

				//自定义正则;	
			} else {
				//自动扩展datatype;
				if (!(datatype in Validform.util.dataType)) {
					var mac = datatype.match(regex),
						temp;

					if (!mac) {
						passed = false;
						info = curform.data("tipmsg").undef || tipmsg.undef;
					} else {
						for (var name in Validform.util.dataType) {
							temp = name.match(regex);
							if (!temp) { continue; }
							if (mac[1] === temp[1]) {
								var str = Validform.util.dataType[name].toString(),
									param = str.match(/\/[mgi]*/g)[1].replace("\/", ""),
									regxp = new RegExp("\\{" + temp[2] + "," + temp[3] + "\\}", "g");
								str = str.replace(/\/[mgi]*/g, "\/").replace(regxp, "{" + mac[2] + "," + mac[3] + "}").replace(/^\//, "").replace(/\/$/, "");
								Validform.util.dataType[datatype] = new RegExp(str, param);
								break;
							}
						}
					}
				}

				if (Validform.util.toString.call(Validform.util.dataType[datatype]) == "[object RegExp]") {
					passed = Validform.util.dataType[datatype].test(gets);
				}

			}


			if (passed) {
				type = 2;
				info = obj.attr("sucmsg") || curform.data("tipmsg").r || tipmsg.r;

				//规则验证通过后，还需要对绑定recheck的对象进行值比较;
				if (obj.attr("recheck")) {
					var theother = curform.find("input[name='" + obj.attr("recheck") + "']:first");
					if (gets != theother.val()) {
						passed = false;
						type = 3;
						info = obj.attr("errormsg") || Validform.util.getErrormsg.call(obj, curform, datatype, "recheck");
					}
				}
			} else {
				info = info || obj.attr("errormsg") || Validform.util.getErrormsg.call(obj, curform, datatype);

				//验证不通过且为空时;
				if (Validform.util.isEmpty.call(obj, gets)) {
					info = obj.attr("nullmsg") || Validform.util.getNullmsg.call(obj, curform);
				}
			}

			return {
				passed: passed,
				type: type,
				info: info
			};

		},

		regcheck: function (datatype, gets, obj) {
			/*
				datatype:datatype;
				gets:inputvalue;
				obj:input object;
			*/
			var curform = this,
				info = null,
				passed = false,
				type = 3;//default set to wrong type, 2,3,4;

			//ignore;
			if (obj.attr("ignore") === "ignore" && Validform.util.isEmpty.call(obj, gets)) {
				if (obj.data("cked")) {
					info = "";
				}

				return {
					passed: true,
					type: 4,
					info: info
				};
			}

			obj.data("cked", "cked");//do nothing if is the first time validation triggered;

			var dtype = Validform.util.parseDatatype(datatype);
			var res;
			for (var eithor = 0; eithor < dtype.length; eithor++) {
				for (var dtp = 0; dtp < dtype[eithor].length; dtp++) {
					res = Validform.util._regcheck(dtype[eithor][dtp], gets, obj, curform);
					if (!res.passed) {
						break;
					}
				}
				if (res.passed) {
					break;
				}
			}
			return res;

		},

		parseDatatype: function (datatype) {
			/*
				字符串里面只能含有一个正则表达式;
				Datatype名称必须是字母，数字、下划线或*号组成;
				datatype="/regexp/|phone|tel,s,e|f,e";
				==>[["/regexp/"],["phone"],["tel","s","e"],["f","e"]];
			*/

			var reg = /\/.+?\/[mgi]*(?=(,|$|\||\s))|[\w\*-]+/g,
				dtype = datatype.match(reg),
				sepor = datatype.replace(reg, "").replace(/\s*/g, "").split(""),
				arr = [],
				m = 0;

			arr[0] = [];
			arr[0].push(dtype[0]);
			for (var n = 0; n < sepor.length; n++) {
				if (sepor[n] == "|") {
					m++;
					arr[m] = [];
				}
				arr[m].push(dtype[n + 1]);
			}

			return arr;
		},

		showmsg: function (msg, type, o, triggered) {
			/*
				msg:提示文字;
				type:提示信息显示方式;
				o:{obj:当前对象, type:1=>正在检测 | 2=>通过, sweep:true | false}, 
				triggered:在blur或提交表单触发的验证中，有些情况不需要显示提示文字，如自定义弹出提示框的显示方式，不需要每次blur时就马上弹出提示;
				
				tiptype:1\2\3时都有坑能会弹出自定义提示框
				tiptype:1时在triggered bycheck时不弹框
				tiptype:2\3时在ajax时弹框
				tipSweep为true时在triggered bycheck时不触发showmsg，但ajax出错的情况下要提示
			*/

			//如果msg为undefined，那么就没必要执行后面的操作，ignore有可能会出现这情况;
			if (msg == undef) { return; }

			//tipSweep为true，且当前不是处于错误状态时，blur事件不触发信息显示;
			if (triggered == "bycheck" && o.sweep && (o.obj && !o.obj.is(".Validform_error") || typeof type == "function")) { return; }

			$.extend(o, { curform: this });

			if (typeof type == "function") {
				type(msg, o, Validform.util.cssctl);
				return;
			}

			if (type == 1 || triggered == "byajax" && type != 4) {
				msgobj.find(".Validform_info").html(msg);
			}

			//tiptypt=1时，blur触发showmsg，验证是否通过都不弹框，提交表单触发的话，只要验证出错，就弹框;
			if (type == 1 && triggered != "bycheck" && o.type != 2 || triggered == "byajax" && type != 4) {
				msghidden = false;
				msgobj.find(".iframe").css("height", msgobj.outerHeight());
				msgobj.show();
				setCenter(msgobj, 100);
			}

			if (type == 2 && o.obj) {
				o.obj.parent().next().find(".Validform_checktip").html(msg);
				Validform.util.cssctl(o.obj.parent().next().find(".Validform_checktip"), o.type);
			}

			if ((type == 3 || type == 4) && o.obj) {
				o.obj.siblings(".Validform_checktip").html(msg);
				Validform.util.cssctl(o.obj.siblings(".Validform_checktip"), o.type);
			}

		},

		cssctl: function (obj, status) {
			switch (status) {
				case 1:
					obj.removeClass("Validform_right Validform_wrong").addClass("Validform_checktip Validform_loading");//checking;
					break;
				case 2:
					obj.removeClass("Validform_wrong Validform_loading").addClass("Validform_checktip Validform_right");//passed;
					break;
				case 4:
					obj.removeClass("Validform_right Validform_wrong Validform_loading").addClass("Validform_checktip");//for ignore;
					break;
				default:
					obj.removeClass("Validform_right Validform_loading").addClass("Validform_checktip Validform_wrong");//wrong;
			}
		},

		check: function (curform, subpost, bool) {
			/*
				检测单个表单元素;
				验证通过返回true，否则返回false、实时验证返回值为ajax;
				bool，传入true则只检测不显示提示信息;
			*/
			var settings = curform[0].settings;
			var subpost = subpost || "";
			var inputval = Validform.util.getValue.call(curform, $(this));

			//隐藏或绑定dataIgnore的表单对象不做验证;
			if (settings.ignoreHidden && $(this).is(":hidden") || $(this).data("dataIgnore") === "dataIgnore") {
				return true;
			}

			//dragonfly=true时，没有绑定ignore，值为空不做验证，但验证不通过;
			if (settings.dragonfly && !$(this).data("cked") && Validform.util.isEmpty.call($(this), inputval) && $(this).attr("ignore") != "ignore") {
				return false;
			}

			var flag = Validform.util.regcheck.call(curform, $(this).attr("datatype"), inputval, $(this));

			//值没变化不做检测，这时要考虑recheck情况;
			//不是在提交表单时触发的ajax验证;
			if (inputval == this.validform_lastval && !$(this).attr("recheck") && subpost == "") {
				return flag.passed ? true : false;
			}

			this.validform_lastval = inputval;//存储当前值;

			var _this;
			errorobj = _this = $(this);

			if (!flag.passed) {
				//取消正在进行的ajax验证;
				Validform.util.abort.call(_this[0]);

				if (!bool) {
					//传入"bycheck"，指示当前是check方法里调用的，当tiptype=1时，blur事件不让触发错误信息显示;
					Validform.util.showmsg.call(curform, flag.info, settings.tiptype, { obj: $(this), type: flag.type, sweep: settings.tipSweep }, "bycheck");

					!settings.tipSweep && _this.addClass("Validform_error");
				}
				return false;
			}

			//验证通过的话，如果绑定有ajaxurl，要执行ajax检测;
			//当ignore="ignore"时，为空值可以通过验证，这时不需要ajax检测;
			var ajaxurl = $(this).attr("ajaxurl");
			if (ajaxurl && !Validform.util.isEmpty.call($(this), inputval) && !bool) {
				var inputobj = $(this);

				//当提交表单时，表单中的某项已经在执行ajax检测，这时需要让该项ajax结束后继续提交表单;
				if (subpost == "postform") {
					inputobj[0].validform_subpost = "postform";
				} else {
					inputobj[0].validform_subpost = "";
				}

				if (inputobj[0].validform_valid === "posting" && inputval == inputobj[0].validform_ckvalue) { return "ajax"; }

				inputobj[0].validform_valid = "posting";
				inputobj[0].validform_ckvalue = inputval;
				Validform.util.showmsg.call(curform, curform.data("tipmsg").c || tipmsg.c, settings.tiptype, { obj: inputobj, type: 1, sweep: settings.tipSweep }, "bycheck");

				Validform.util.abort.call(_this[0]);

				var ajaxsetup = $.extend(true, {}, settings.ajaxurl || {});

				var localconfig = {
					type: "POST",
					cache: false,
					url: ajaxurl,
					data: "param=" + encodeURIComponent(inputval) + "&name=" + encodeURIComponent($(this).attr("name")),
					success: function (data) {
						if ($.trim(data.status) === "y") {
							inputobj[0].validform_valid = "true";
							data.info && inputobj.attr("sucmsg", data.info);
							Validform.util.showmsg.call(curform, inputobj.attr("sucmsg") || curform.data("tipmsg").r || tipmsg.r, settings.tiptype, { obj: inputobj, type: 2, sweep: settings.tipSweep }, "bycheck");
							_this.removeClass("Validform_error");
							errorobj = null;
							if (inputobj[0].validform_subpost == "postform") {
								curform.trigger("submit");
							}
						} else {
							inputobj[0].validform_valid = data.info;
							Validform.util.showmsg.call(curform, data.info, settings.tiptype, { obj: inputobj, type: 3, sweep: settings.tipSweep });
							_this.addClass("Validform_error");
						}
						_this[0].validform_ajax = null;
					},
					error: function (data) {
						if (data.status == "200") {
							if (data.responseText == "y") {
								ajaxsetup.success({ "status": "y" });
							} else {
								ajaxsetup.success({ "status": "n", "info": data.responseText });
							}
							return false;
						}

						//正在检测时，要检测的数据发生改变，这时要终止当前的ajax。不是这种情况引起的ajax错误，那么显示相关错误信息;
						if (data.statusText !== "abort") {
							var msg = "status: " + data.status + "; statusText: " + data.statusText;

							Validform.util.showmsg.call(curform, msg, settings.tiptype, { obj: inputobj, type: 3, sweep: settings.tipSweep });
							_this.addClass("Validform_error");
						}

						inputobj[0].validform_valid = data.statusText;
						_this[0].validform_ajax = null;

						//localconfig.error返回true表示还需要执行temp_err;
						return true;
					}
				}

				if (ajaxsetup.success) {
					var temp_suc = ajaxsetup.success;
					ajaxsetup.success = function (data) {
						localconfig.success(data);
						temp_suc(data, inputobj);
					}
				}

				if (ajaxsetup.error) {
					var temp_err = ajaxsetup.error;
					ajaxsetup.error = function (data) {
						//localconfig.error返回false表示不需要执行temp_err;
						localconfig.error(data) && temp_err(data, inputobj);
					}
				}

				ajaxsetup = $.extend({}, localconfig, ajaxsetup, { dataType: "json" });
				_this[0].validform_ajax = $.ajax(ajaxsetup);

				return "ajax";
			} else if (ajaxurl && Validform.util.isEmpty.call($(this), inputval)) {
				Validform.util.abort.call(_this[0]);
				_this[0].validform_valid = "true";
			}

			if (!bool) {
				Validform.util.showmsg.call(curform, flag.info, settings.tiptype, { obj: $(this), type: flag.type, sweep: settings.tipSweep }, "bycheck");
				_this.removeClass("Validform_error");
			}
			errorobj = null;

			return true;

		},

		submitForm: function (settings, flg, url, ajaxPost, sync) {
			/*
				flg===true时跳过验证直接提交;
				ajaxPost==="ajaxPost"指示当前表单以ajax方式提交;
			*/
			var curform = this;

			//表单正在提交时点击提交按钮不做反应;
			if (curform[0].validform_status === "posting") {
				settings.postonceTip();
				return false;
			}

			//要求只能提交一次时;
			if (settings.postonce && curform[0].validform_status === "posted") {
				settings.postonceTip();
				return false;
			}

			var beforeCheck = settings.beforeCheck && settings.beforeCheck(curform);
			if (beforeCheck === false) {
				return false;
			}

			var flag = true,
				inflag;

			curform.find("[datatype]").each(function () {
				//跳过验证;
				if (flg) {
					return false;
				}

				//隐藏或绑定dataIgnore的表单对象不做验证;
				if (settings.ignoreHidden && $(this).is(":hidden") || $(this).data("dataIgnore") === "dataIgnore") {
					return true;
				}

				var inputval = Validform.util.getValue.call(curform, $(this)),
					_this;
				errorobj = _this = $(this);

				inflag = Validform.util.regcheck.call(curform, $(this).attr("datatype"), inputval, $(this));

				if (!inflag.passed) {
					Validform.util.showmsg.call(curform, inflag.info, settings.tiptype, { obj: $(this), type: inflag.type, sweep: settings.tipSweep });
					_this.addClass("Validform_error");

					if (!settings.showAllError) {
						_this.focus();
						flag = false;
						return false;
					}

					flag && (flag = false);
					return true;
				}

				//当ignore="ignore"时，为空值可以通过验证，这时不需要ajax检测;
				if ($(this).attr("ajaxurl") && !Validform.util.isEmpty.call($(this), inputval)) {
					if (this.validform_valid !== "true") {
						var thisobj = $(this);
						Validform.util.showmsg.call(curform, curform.data("tipmsg").v || tipmsg.v, settings.tiptype, { obj: thisobj, type: 3, sweep: settings.tipSweep });
						_this.addClass("Validform_error");

						thisobj.trigger("blur", ["postform"]);//continue the form post;

						if (!settings.showAllError) {
							flag = false;
							return false;
						}

						flag && (flag = false);
						return true;
					}
				} else if ($(this).attr("ajaxurl") && Validform.util.isEmpty.call($(this), inputval)) {
					Validform.util.abort.call(this);
					this.validform_valid = "true";
				}

				Validform.util.showmsg.call(curform, inflag.info, settings.tiptype, { obj: $(this), type: inflag.type, sweep: settings.tipSweep });
				_this.removeClass("Validform_error");
				errorobj = null;
			});

			if (settings.showAllError) {
				curform.find(".Validform_error:first").focus();
			}

			if (flag) {

				var beforeSubmit = settings.beforeSubmit && settings.beforeSubmit(curform);
				if (beforeSubmit === false) { return false; }

				curform[0].validform_status = "posting";

				if (settings.ajaxPost || ajaxPost === "ajaxPost") {
					//获取配置参数;
					var ajaxsetup = $.extend(true, {}, settings.ajaxpost || {});
					//有可能需要动态的改变提交地址，所以把action所指定的url层级设为最低;
					ajaxsetup.url = url || ajaxsetup.url || settings.url || curform.attr("action");

					//byajax：ajax时，tiptye为1、2或3需要弹出提示框;
					Validform.util.showmsg.call(curform, curform.data("tipmsg").p || tipmsg.p, settings.tiptype, { obj: curform, type: 1, sweep: settings.tipSweep }, "byajax");

					//方法里的优先级要高;
					//有undefined情况;
					if (sync) {
						ajaxsetup.async = false;
					} else if (sync === false) {
						ajaxsetup.async = true;
					}

					if (ajaxsetup.success) {
						var temp_suc = ajaxsetup.success;
						ajaxsetup.success = function (data) {
							settings.callback && settings.callback(data);
							curform[0].validform_ajax = null;
							if ($.trim(data.status) === "y") {
								curform[0].validform_status = "posted";
							} else {
								curform[0].validform_status = "normal";
							}

							temp_suc(data, curform);
						}
					}

					if (ajaxsetup.error) {
						var temp_err = ajaxsetup.error;
						ajaxsetup.error = function (data) {
							settings.callback && settings.callback(data);
							curform[0].validform_status = "normal";
							curform[0].validform_ajax = null;

							temp_err(data, curform);
						}
					}

					var localconfig = {
						type: "POST",
						async: true,
						data: curform.serializeArray(),
						success: function (data) {
							if ($.trim(data.status) === "y") {
								//成功提交;
								curform[0].validform_status = "posted";
								Validform.util.showmsg.call(curform, data.info, settings.tiptype, { obj: curform, type: 2, sweep: settings.tipSweep }, "byajax");
							} else {
								//提交出错;
								curform[0].validform_status = "normal";
								Validform.util.showmsg.call(curform, data.info, settings.tiptype, { obj: curform, type: 3, sweep: settings.tipSweep }, "byajax");
							}

							settings.callback && settings.callback(data);
							curform[0].validform_ajax = null;
						},
						error: function (data) {
							var msg = "status: " + data.status + "; statusText: " + data.statusText;

							Validform.util.showmsg.call(curform, msg, settings.tiptype, { obj: curform, type: 3, sweep: settings.tipSweep }, "byajax");

							settings.callback && settings.callback(data);
							curform[0].validform_status = "normal";
							curform[0].validform_ajax = null;
						}
					}

					ajaxsetup = $.extend({}, localconfig, ajaxsetup, { dataType: "json" });

					curform[0].validform_ajax = $.ajax(ajaxsetup);

				} else {
					if (!settings.postonce) {
						curform[0].validform_status = "normal";
					}

					var url = url || settings.url;
					if (url) {
						curform.attr("action", url);
					}

					return settings.callback && settings.callback(curform);
				}
			}

			return false;

		},

		resetForm: function () {
			var brothers = this;
			brothers.each(function () {
				this.reset && this.reset();
				this.validform_status = "normal";
			});

			brothers.find(".Validform_right").text("");
			brothers.find(".passwordStrength").children().removeClass("bgStrength");
			brothers.find(".Validform_checktip").removeClass("Validform_wrong Validform_right Validform_loading");
			brothers.find(".Validform_error").removeClass("Validform_error");
			brothers.find("[datatype]").removeData("cked").removeData("dataIgnore").each(function () {
				this.validform_lastval = null;
			});
			brothers.eq(0).find("input:first").focus();
		},

		abort: function () {
			if (this.validform_ajax) {
				this.validform_ajax.abort();
			}
		}

	}

	$.Datatype = Validform.util.dataType;

	Validform.prototype = {
		dataType: Validform.util.dataType,

		eq: function (n) {
			var obj = this;

			if (n >= obj.forms.length) {
				return null;
			}

			if (!(n in obj.objects)) {
				obj.objects[n] = new Validform($(obj.forms[n]).get(), {}, true);
			}

			return obj.objects[n];

		},

		resetStatus: function () {
			var obj = this;
			$(obj.forms).each(function () {
				this.validform_status = "normal";
			});

			return this;
		},

		setStatus: function (status) {
			var obj = this;
			$(obj.forms).each(function () {
				this.validform_status = status || "posting";
			});

			return this;
		},

		getStatus: function () {
			var obj = this;
			var status = $(obj.forms)[0].validform_status;

			return status;
		},

		ignore: function (selector) {
			var obj = this;
			var selector = selector || "[datatype]"

			$(obj.forms).find(selector).each(function () {
				$(this).data("dataIgnore", "dataIgnore").removeClass("Validform_error");
			});

			return this;
		},

		unignore: function (selector) {
			var obj = this;
			var selector = selector || "[datatype]"

			$(obj.forms).find(selector).each(function () {
				$(this).removeData("dataIgnore");
			});

			return this;
		},

		addRule: function (rule) {
			/*
				rule => [{
					ele:"#id",
					datatype:"*",
					errormsg:"出错提示文字！",
					nullmsg:"为空时的提示文字！",
					tip:"默认显示的提示文字",
					altercss:"gray",
					ignore:"ignore",
					ajaxurl:"valid.php",
					recheck:"password",
					plugin:"passwordStrength"
				},{},{},...]
			*/
			var obj = this;
			var rule = rule || [];

			for (var index = 0; index < rule.length; index++) {
				var o = $(obj.forms).find(rule[index].ele);
				for (var attr in rule[index]) {
					attr !== "ele" && o.attr(attr, rule[index][attr]);
				}
			}

			$(obj.forms).each(function () {
				var $this = $(this);
				Validform.util.enhance.call($this, this.settings.tiptype, this.settings.usePlugin, this.settings.tipSweep, "addRule");
			});

			return this;
		},

		ajaxPost: function (flag, sync, url) {
			var obj = this;

			$(obj.forms).each(function () {
				//创建pop box;
				if (this.settings.tiptype == 1 || this.settings.tiptype == 2 || this.settings.tiptype == 3) {
					creatMsgbox();
				}

				Validform.util.submitForm.call($(obj.forms[0]), this.settings, flag, url, "ajaxPost", sync);
			});

			return this;
		},

		submitForm: function (flag, url) {
			/*flag===true时不做验证直接提交*/


			var obj = this;

			$(obj.forms).each(function () {
				var subflag = Validform.util.submitForm.call($(this), this.settings, flag, url);
				subflag === undef && (subflag = true);
				if (subflag === true) {
					this.submit();
				}
			});

			return this;
		},

		resetForm: function () {
			var obj = this;
			Validform.util.resetForm.call($(obj.forms));

			return this;
		},

		abort: function () {
			var obj = this;
			$(obj.forms).each(function () {
				Validform.util.abort.call(this);
			});

			return this;
		},

		check: function (bool, selector) {
			/*
				bool：传入true，只检测不显示提示信息;
			*/

			var selector = selector || "[datatype]",
				obj = this,
				curform = $(obj.forms),
				flag = true;

			curform.find(selector).each(function () {
				Validform.util.check.call(this, curform, "", bool) || (flag = false);
			});

			return flag;
		},

		config: function (setup) {
			/*
				config={
					url:"ajaxpost.php",//指定了url后，数据会提交到这个地址;
					ajaxurl:{
						timeout:1000,
						...
					},
					ajaxpost:{
						timeout:1000,
						...
					}
				}
			*/
			var obj = this;
			setup = setup || {};
			$(obj.forms).each(function () {
				var $this = $(this);
				this.settings = $.extend(true, this.settings, setup);
				Validform.util.enhance.call($this, this.settings.tiptype, this.settings.usePlugin, this.settings.tipSweep);
			});

			return this;
		}
	}

	$.fn.Validform = function (settings) {
		return new Validform(this, settings);
	};

	function setCenter(obj, time) {
		var left = ($(window).width() - obj.outerWidth()) / 2,
			top = ($(window).height() - obj.outerHeight()) / 2,

			top = (document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + (top > 0 ? top : 0);

		obj.css({
			left: left
		}).animate({
			top: top
		}, { duration: time, queue: false });
	}

	function creatMsgbox() {
		if ($("#Validform_msg").length !== 0) { return false; }
		msgobj = $('<div id="Validform_msg"><div class="Validform_title">' + tipmsg.tit + '<a class="Validform_close" href="javascript:void(0);">&chi;</a></div><div class="Validform_info"></div><div class="iframe"><iframe frameborder="0" scrolling="no" height="100%" width="100%"></iframe></div></div>').appendTo("body");//提示信息框;
		msgobj.find("a.Validform_close").click(function () {
			msgobj.hide();
			msghidden = true;
			if (errorobj) {
				errorobj.focus().addClass("Validform_error");
			}
			return false;
		}).focus(function () { this.blur(); });

		$(window).bind("scroll resize", function () {
			!msghidden && setCenter(msgobj, 400);
		});
	};

	//公用方法显示&关闭信息提示框;
	$.Showmsg = function (msg) {
		creatMsgbox();
		Validform.util.showmsg.call(win, msg, 1, {});
	};

	$.Hidemsg = function () {
		msgobj.hide();
		msghidden = true;
	};

})(jQuery, window);
/* WebUploader 0.1.5 */
!
function (a, b) {
    var c, d = {},
    e = function (a, b) {
        var c, d, e;
        if ("string" == typeof a) return h(a);
        for (c = [], d = a.length, e = 0; d > e; e++) c.push(h(a[e]));
        return b.apply(null, c)
    },
    f = function (a, b, c) {
        2 === arguments.length && (c = b, b = null),
        e(b || [],
        function () {
            g(a, c, arguments)
        })
    },
    g = function (a, b, c) {
        var f, g = {
            exports: b
        };
        "function" == typeof b && (c.length || (c = [e, g.exports, g]), f = b.apply(null, c), void 0 !== f && (g.exports = f)),
        d[a] = g.exports
    },
    h = function (b) {
        var c = d[b] || a[b];
        if (!c) throw new Error("`" + b + "` is undefined");
        return c
    },
    i = function (a) {
        var b, c, e, f, g, h;
        h = function (a) {
            return a && a.charAt(0).toUpperCase() + a.substr(1)
        };
        for (b in d) if (c = a, d.hasOwnProperty(b)) {
            for (e = b.split("/"), g = h(e.pop()) ; f = h(e.shift()) ;) c[f] = c[f] || {},
            c = c[f];
            c[g] = d[b]
        }
        return a
    },
    j = function (c) {
        return a.__dollar = c,
        i(b(a, f, e))
    };
    "object" == typeof module && "object" == typeof module.exports ? module.exports = j() : "function" == typeof define && define.amd ? define(["jquery"], j) : (c = a.WebUploader, a.WebUploader = j(), a.WebUploader.noConflict = function () {
        a.WebUploader = c
    })
}(window,
function (a, b, c) {
    return b("dollar-third", [],
    function () {
        var b = a.__dollar || a.jQuery || a.Zepto;
        if (!b) throw new Error("jQuery or Zepto not found!");
        return b
    }),
    b("dollar", ["dollar-third"],
    function (a) {
        return a
    }),
    b("promise-third", ["dollar"],
    function (a) {
        return {
            Deferred: a.Deferred,
            when: a.when,
            isPromise: function (a) {
                return a && "function" == typeof a.then
            }
        }
    }),
    b("promise", ["promise-third"],
    function (a) {
        return a
    }),
    b("base", ["dollar", "promise"],
    function (b, c) {
        function d(a) {
            return function () {
                return h.apply(a, arguments)
            }
        }
        function e(a, b) {
            return function () {
                return a.apply(b, arguments)
            }
        }
        function f(a) {
            var b;
            return Object.create ? Object.create(a) : (b = function () { },
            b.prototype = a, new b)
        }
        var g = function () { },
        h = Function.call;
        return {
            version: "0.1.5",
            $: b,
            Deferred: c.Deferred,
            isPromise: c.isPromise,
            when: c.when,
            browser: function (a) {
                var b = {},
                c = a.match(/WebKit\/([\d.]+)/),
                d = a.match(/Chrome\/([\d.]+)/) || a.match(/CriOS\/([\d.]+)/),
                e = a.match(/MSIE\s([\d\.]+)/) || a.match(/(?:trident)(?:.*rv:([\w.]+))?/i),
                f = a.match(/Firefox\/([\d.]+)/),
                g = a.match(/Safari\/([\d.]+)/),
                h = a.match(/OPR\/([\d.]+)/);
                return c && (b.webkit = parseFloat(c[1])),
                d && (b.chrome = parseFloat(d[1])),
                e && (b.ie = parseFloat(e[1])),
                f && (b.firefox = parseFloat(f[1])),
                g && (b.safari = parseFloat(g[1])),
                h && (b.opera = parseFloat(h[1])),
                b
            }(navigator.userAgent),
            os: function (a) {
                var b = {},
                c = a.match(/(?:Android);?[\s\/]+([\d.]+)?/),
                d = a.match(/(?:iPad|iPod|iPhone).*OS\s([\d_]+)/);
                return c && (b.android = parseFloat(c[1])),
                d && (b.ios = parseFloat(d[1].replace(/_/g, "."))),
                b
            }(navigator.userAgent),
            inherits: function (a, c, d) {
                var e;
                return "function" == typeof c ? (e = c, c = null) : e = c && c.hasOwnProperty("constructor") ? c.constructor : function () {
                    return a.apply(this, arguments)
                },
                b.extend(!0, e, a, d || {}),
                e.__super__ = a.prototype,
                e.prototype = f(a.prototype),
                c && b.extend(!0, e.prototype, c),
                e
            },
            noop: g,
            bindFn: e,
            log: function () {
                return a.console ? e(console.log, console) : g
            }(),
            nextTick: function () {
                return function (a) {
                    setTimeout(a, 1)
                }
            }(),
            slice: d([].slice),
            guid: function () {
                var a = 0;
                return function (b) {
                    for (var c = (+new Date).toString(32), d = 0; 5 > d; d++) c += Math.floor(65535 * Math.random()).toString(32);
                    return (b || "wu_") + c + (a++).toString(32)
                }
            }(),
            formatSize: function (a, b, c) {
                var d;
                for (c = c || ["B", "K", "M", "G", "TB"]; (d = c.shift()) && a > 1024;) a /= 1024;
                return ("B" === d ? a : a.toFixed(b || 2)) + d
            }
        }
    }),
    b("mediator", ["base"],
    function (a) {
        function b(a, b, c, d) {
            return f.grep(a,
            function (a) {
                return !(!a || b && a.e !== b || c && a.cb !== c && a.cb._cb !== c || d && a.ctx !== d)
            })
        }
        function c(a, b, c) {
            f.each((a || "").split(h),
            function (a, d) {
                c(d, b)
            })
        }
        function d(a, b) {
            for (var c, d = !1,
            e = -1,
            f = a.length; ++e < f;) if (c = a[e], c.cb.apply(c.ctx2, b) === !1) {
                d = !0;
                break
            }
            return !d
        }
        var e, f = a.$,
        g = [].slice,
        h = /\s+/;
        return e = {
            on: function (a, b, d) {
                var e, f = this;
                return b ? (e = this._events || (this._events = []), c(a, b,
                function (a, b) {
                    var c = {
                        e: a
                    };
                    c.cb = b,
                    c.ctx = d,
                    c.ctx2 = d || f,
                    c.id = e.length,
                    e.push(c)
                }), this) : this
            },
            once: function (a, b, d) {
                var e = this;
                return b ? (c(a, b,
                function (a, b) {
                    var c = function () {
                        return e.off(a, c),
                        b.apply(d || e, arguments)
                    };
                    c._cb = b,
                    e.on(a, c, d)
                }), e) : e
            },
            off: function (a, d, e) {
                var g = this._events;
                return g ? a || d || e ? (c(a, d,
                function (a, c) {
                    f.each(b(g, a, c, e),
                    function () {
                        delete g[this.id]
                    })
                }), this) : (this._events = [], this) : this
            },
            trigger: function (a) {
                var c, e, f;
                return this._events && a ? (c = g.call(arguments, 1), e = b(this._events, a), f = b(this._events, "all"), d(e, c) && d(f, arguments)) : this
            }
        },
        f.extend({
            installTo: function (a) {
                return f.extend(a, e)
            }
        },
        e)
    }),
    b("uploader", ["base", "mediator"],
    function (a, b) {
        function c(a) {
            this.options = d.extend(!0, {},
            c.options, a),
            this._init(this.options)
        }
        var d = a.$;
        return c.options = {},
        b.installTo(c.prototype),
        d.each({
            upload: "start-upload",
            stop: "stop-upload",
            getFile: "get-file",
            getFiles: "get-files",
            addFile: "add-file",
            addFiles: "add-file",
            sort: "sort-files",
            removeFile: "remove-file",
            cancelFile: "cancel-file",
            skipFile: "skip-file",
            retry: "retry",
            isInProgress: "is-in-progress",
            makeThumb: "make-thumb",
            md5File: "md5-file",
            getDimension: "get-dimension",
            addButton: "add-btn",
            predictRuntimeType: "predict-runtime-type",
            refresh: "refresh",
            disable: "disable",
            enable: "enable",
            reset: "reset"
        },
        function (a, b) {
            c.prototype[a] = function () {
                return this.request(b, arguments)
            }
        }),
        d.extend(c.prototype, {
            state: "pending",
            _init: function (a) {
                var b = this;
                b.request("init", a,
                function () {
                    b.state = "ready",
                    b.trigger("ready")
                })
            },
            option: function (a, b) {
                var c = this.options;
                return arguments.length > 1 ? void (d.isPlainObject(b) && d.isPlainObject(c[a]) ? d.extend(c[a], b) : c[a] = b) : a ? c[a] : c
            },
            getStats: function () {
                var a = this.request("get-stats");
                return a ? {
                    successNum: a.numOfSuccess,
                    progressNum: a.numOfProgress,
                    cancelNum: a.numOfCancel,
                    invalidNum: a.numOfInvalid,
                    uploadFailNum: a.numOfUploadFailed,
                    queueNum: a.numOfQueue,
                    interruptNum: a.numofInterrupt
                } : {}
            },
            trigger: function (a) {
                var c = [].slice.call(arguments, 1),
                e = this.options,
                f = "on" + a.substring(0, 1).toUpperCase() + a.substring(1);
                return b.trigger.apply(this, arguments) === !1 || d.isFunction(e[f]) && e[f].apply(this, c) === !1 || d.isFunction(this[f]) && this[f].apply(this, c) === !1 || b.trigger.apply(b, [this, a].concat(c)) === !1 ? !1 : !0
            },
            destroy: function () {
                this.request("destroy", arguments),
                this.off()
            },
            request: a.noop
        }),
        a.create = c.create = function (a) {
            return new c(a)
        },
        a.Uploader = c,
        c
    }),
    b("runtime/runtime", ["base", "mediator"],
    function (a, b) {
        function c(b) {
            this.options = d.extend({
                container: document.body
            },
            b),
            this.uid = a.guid("rt_")
        }
        var d = a.$,
        e = {},
        f = function (a) {
            for (var b in a) if (a.hasOwnProperty(b)) return b;
            return null
        };
        return d.extend(c.prototype, {
            getContainer: function () {
                var a, b, c = this.options;
                return this._container ? this._container : (a = d(c.container || document.body), b = d(document.createElement("div")), b.attr("id", "rt_" + this.uid), b.css({
                    position: "absolute",
                    top: "0px",
                    left: "0px",
                    width: "1px",
                    height: "1px",
                    overflow: "hidden"
                }), a.append(b), a.addClass("webuploader-container"), this._container = b, this._parent = a, b)
            },
            init: a.noop,
            exec: a.noop,
            destroy: function () {
                this._container && this._container.remove(),
                this._parent && this._parent.removeClass("webuploader-container"),
                this.off()
            }
        }),
        c.orders = "html5,flash",
        c.addRuntime = function (a, b) {
            e[a] = b
        },
        c.hasRuntime = function (a) {
            return !!(a ? e[a] : f(e))
        },
        c.create = function (a, b) {
            var g, h;
            if (b = b || c.orders, d.each(b.split(/\s*,\s*/g),
            function () {
                return e[this] ? (g = this, !1) : void 0
            }), g = g || f(e), !g) throw new Error("Runtime Error");
            return h = new e[g](a)
        },
        b.installTo(c.prototype),
        c
    }),
    b("runtime/client", ["base", "mediator", "runtime/runtime"],
    function (a, b, c) {
        function d(b, d) {
            var f, g = a.Deferred();
            this.uid = a.guid("client_"),
            this.runtimeReady = function (a) {
                return g.done(a)
            },
            this.connectRuntime = function (b, h) {
                if (f) throw new Error("already connected!");
                return g.done(h),
                "string" == typeof b && e.get(b) && (f = e.get(b)),
                f = f || e.get(null, d),
                f ? (a.$.extend(f.options, b), f.__promise.then(g.resolve), f.__client++) : (f = c.create(b, b.runtimeOrder), f.__promise = g.promise(), f.once("ready", g.resolve), f.init(), e.add(f), f.__client = 1),
                d && (f.__standalone = d),
                f
            },
            this.getRuntime = function () {
                return f
            },
            this.disconnectRuntime = function () {
                f && (f.__client--, f.__client <= 0 && (e.remove(f), delete f.__promise, f.destroy()), f = null)
            },
            this.exec = function () {
                if (f) {
                    var c = a.slice(arguments);
                    return b && c.unshift(b),
                    f.exec.apply(this, c)
                }
            },
            this.getRuid = function () {
                return f && f.uid
            },
            this.destroy = function (a) {
                return function () {
                    a && a.apply(this, arguments),
                    this.trigger("destroy"),
                    this.off(),
                    this.exec("destroy"),
                    this.disconnectRuntime()
                }
            }(this.destroy)
        }
        var e;
        return e = function () {
            var a = {};
            return {
                add: function (b) {
                    a[b.uid] = b
                },
                get: function (b, c) {
                    var d;
                    if (b) return a[b];
                    for (d in a) if (!c || !a[d].__standalone) return a[d];
                    return null
                },
                remove: function (b) {
                    delete a[b.uid]
                }
            }
        }(),
        b.installTo(d.prototype),
        d
    }),
    b("lib/dnd", ["base", "mediator", "runtime/client"],
    function (a, b, c) {
        function d(a) {
            a = this.options = e.extend({},
            d.options, a),
            a.container = e(a.container),
            a.container.length && c.call(this, "DragAndDrop")
        }
        var e = a.$;
        return d.options = {
            accept: null,
            disableGlobalDnd: !1
        },
        a.inherits(c, {
            constructor: d,
            init: function () {
                var a = this;
                a.connectRuntime(a.options,
                function () {
                    a.exec("init"),
                    a.trigger("ready")
                })
            }
        }),
        b.installTo(d.prototype),
        d
    }),
    b("widgets/widget", ["base", "uploader"],
    function (a, b) {
        function c(a) {
            if (!a) return !1;
            var b = a.length,
            c = e.type(a);
            return 1 === a.nodeType && b ? !0 : "array" === c || "function" !== c && "string" !== c && (0 === b || "number" == typeof b && b > 0 && b - 1 in a)
        }
        function d(a) {
            this.owner = a,
            this.options = a.options
        }
        var e = a.$,
        f = b.prototype._init,
        g = b.prototype.destroy,
        h = {},
        i = [];
        return e.extend(d.prototype, {
            init: a.noop,
            invoke: function (a, b) {
                var c = this.responseMap;
                return c && a in c && c[a] in this && e.isFunction(this[c[a]]) ? this[c[a]].apply(this, b) : h
            },
            request: function () {
                return this.owner.request.apply(this.owner, arguments)
            }
        }),
        e.extend(b.prototype, {
            _init: function () {
                var a = this,
                b = a._widgets = [],
                c = a.options.disableWidgets || "";
                return e.each(i,
                function (d, e) {
                    (!c || !~c.indexOf(e._name)) && b.push(new e(a))
                }),
                f.apply(a, arguments)
            },
            request: function (b, d, e) {
                var f, g, i, j, k = 0,
                l = this._widgets,
                m = l && l.length,
                n = [],
                o = [];
                for (d = c(d) ? d : [d]; m > k; k++) f = l[k],
                g = f.invoke(b, d),
                g !== h && (a.isPromise(g) ? o.push(g) : n.push(g));
                return e || o.length ? (i = a.when.apply(a, o), j = i.pipe ? "pipe" : "then", i[j](function () {
                    var b = a.Deferred(),
                    c = arguments;
                    return 1 === c.length && (c = c[0]),
                    setTimeout(function () {
                        b.resolve(c)
                    },
                    1),
                    b.promise()
                })[e ? j : "done"](e || a.noop)) : n[0]
            },
            destroy: function () {
                g.apply(this, arguments),
                this._widgets = null
            }
        }),
        b.register = d.register = function (b, c) {
            var f, g = {
                init: "init",
                destroy: "destroy",
                name: "anonymous"
            };
            return 1 === arguments.length ? (c = b, e.each(c,
            function (a) {
                return "_" === a[0] || "name" === a ? void ("name" === a && (g.name = c.name)) : void (g[a.replace(/[A-Z]/g, "-$&").toLowerCase()] = a)
            })) : g = e.extend(g, b),
            c.responseMap = g,
            f = a.inherits(d, c),
            f._name = g.name,
            i.push(f),
            f
        },
        b.unRegister = d.unRegister = function (a) {
            if (a && "anonymous" !== a) for (var b = i.length; b--;) i[b]._name === a && i.splice(b, 1)
        },
        d
    }),
    b("widgets/filednd", ["base", "uploader", "lib/dnd", "widgets/widget"],
    function (a, b, c) {
        var d = a.$;
        return b.options.dnd = "",
        b.register({
            name: "dnd",
            init: function (b) {
                if (b.dnd && "html5" === this.request("predict-runtime-type")) {
                    var e, f = this,
                    g = a.Deferred(),
                    h = d.extend({},
                    {
                        disableGlobalDnd: b.disableGlobalDnd,
                        container: b.dnd,
                        accept: b.accept
                    });
                    return this.dnd = e = new c(h),
                    e.once("ready", g.resolve),
                    e.on("drop",
                    function (a) {
                        f.request("add-file", [a])
                    }),
                    e.on("accept",
                    function (a) {
                        return f.owner.trigger("dndAccept", a)
                    }),
                    e.init(),
                    g.promise()
                }
            },
            destroy: function () {
                this.dnd && this.dnd.destroy()
            }
        })
    }),
    b("lib/filepaste", ["base", "mediator", "runtime/client"],
    function (a, b, c) {
        function d(a) {
            a = this.options = e.extend({},
            a),
            a.container = e(a.container || document.body),
            c.call(this, "FilePaste")
        }
        var e = a.$;
        return a.inherits(c, {
            constructor: d,
            init: function () {
                var a = this;
                a.connectRuntime(a.options,
                function () {
                    a.exec("init"),
                    a.trigger("ready")
                })
            }
        }),
        b.installTo(d.prototype),
        d
    }),
    b("widgets/filepaste", ["base", "uploader", "lib/filepaste", "widgets/widget"],
    function (a, b, c) {
        var d = a.$;
        return b.register({
            name: "paste",
            init: function (b) {
                if (b.paste && "html5" === this.request("predict-runtime-type")) {
                    var e, f = this,
                    g = a.Deferred(),
                    h = d.extend({},
                    {
                        container: b.paste,
                        accept: b.accept
                    });
                    return this.paste = e = new c(h),
                    e.once("ready", g.resolve),
                    e.on("paste",
                    function (a) {
                        f.owner.request("add-file", [a])
                    }),
                    e.init(),
                    g.promise()
                }
            },
            destroy: function () {
                this.paste && this.paste.destroy()
            }
        })
    }),
    b("lib/blob", ["base", "runtime/client"],
    function (a, b) {
        function c(a, c) {
            var d = this;
            d.source = c,
            d.ruid = a,
            this.size = c.size || 0,
            this.type = !c.type && this.ext && ~"jpg,jpeg,png,gif,bmp".indexOf(this.ext) ? "image/" + ("jpg" === this.ext ? "jpeg" : this.ext) : c.type || "application/octet-stream",
            b.call(d, "Blob"),
            this.uid = c.uid || this.uid,
            a && d.connectRuntime(a)
        }
        return a.inherits(b, {
            constructor: c,
            slice: function (a, b) {
                return this.exec("slice", a, b)
            },
            getSource: function () {
                return this.source
            }
        }),
        c
    }),
    b("lib/file", ["base", "lib/blob"],
    function (a, b) {
        function c(a, c) {
            var f;
            this.name = c.name || "untitled" + d++,
            f = e.exec(c.name) ? RegExp.$1.toLowerCase() : "",
            !f && c.type && (f = /\/(jpg|jpeg|png|gif|bmp)$/i.exec(c.type) ? RegExp.$1.toLowerCase() : "", this.name += "." + f),
            this.ext = f,
            this.lastModifiedDate = c.lastModifiedDate || (new Date).toLocaleString(),
            b.apply(this, arguments)
        }
        var d = 1,
        e = /\.([^.]+)$/;
        return a.inherits(b, c)
    }),
    b("lib/filepicker", ["base", "runtime/client", "lib/file"],
    function (b, c, d) {
        function e(a) {
            if (a = this.options = f.extend({},
            e.options, a), a.container = f(a.id), !a.container.length) throw new Error("按钮指定错误");
            a.innerHTML = a.innerHTML || a.label || a.container.html() || "",
            a.button = f(a.button || document.createElement("div")),
            a.button.html(a.innerHTML),
            a.container.html(a.button),
            c.call(this, "FilePicker", !0)
        }
        var f = b.$;
        return e.options = {
            button: null,
            container: null,
            label: null,
            innerHTML: null,
            multiple: !0,
            accept: null,
            name: "file"
        },
        b.inherits(c, {
            constructor: e,
            init: function () {
                var c = this,
                e = c.options,
                g = e.button;
                g.addClass("webuploader-pick"),
                c.on("all",
                function (a) {
                    var b;
                    switch (a) {
                        case "mouseenter":
                            g.addClass("webuploader-pick-hover");
                            break;
                        case "mouseleave":
                            g.removeClass("webuploader-pick-hover");
                            break;
                        case "change":
                            b = c.exec("getFiles"),
                            c.trigger("select", f.map(b,
                            function (a) {
                                return a = new d(c.getRuid(), a),
                                a._refer = e.container,
                                a
                            }), e.container)
                    }
                }),
                c.connectRuntime(e,
                function () {
                    c.refresh(),
                    c.exec("init", e),
                    c.trigger("ready")
                }),
                this._resizeHandler = b.bindFn(this.refresh, this),
                f(a).on("resize", this._resizeHandler)
            },
            refresh: function () {
                var a = this.getRuntime().getContainer(),
                b = this.options.button,
                c = b.outerWidth ? b.outerWidth() : b.width(),
                d = b.outerHeight ? b.outerHeight() : b.height(),
                e = b.offset();
                c && d && a.css({
                    bottom: "auto",
                    right: "auto",
                    width: c + "px",
                    height: d + "px"
                }).offset(e)
            },
            enable: function () {
                var a = this.options.button;
                a.removeClass("webuploader-pick-disable"),
                this.refresh()
            },
            disable: function () {
                var a = this.options.button;
                this.getRuntime().getContainer().css({
                    top: "-99999px"
                }),
                a.addClass("webuploader-pick-disable")
            },
            destroy: function () {
                var b = this.options.button;
                f(a).off("resize", this._resizeHandler),
                b.removeClass("webuploader-pick-disable webuploader-pick-hover webuploader-pick")
            }
        }),
        e
    }),
    b("widgets/filepicker", ["base", "uploader", "lib/filepicker", "widgets/widget"],
    function (a, b, c) {
        var d = a.$;
        return d.extend(b.options, {
            pick: null,
            accept: null
        }),
        b.register({
            name: "picker",
            init: function (a) {
                return this.pickers = [],
                a.pick && this.addBtn(a.pick)
            },
            refresh: function () {
                d.each(this.pickers,
                function () {
                    this.refresh()
                })
            },
            addBtn: function (b) {
                var e = this,
                f = e.options,
                g = f.accept,
                h = [];
                if (b) return d.isPlainObject(b) || (b = {
                    id: b
                }),
                d(b.id).each(function () {
                    var i, j, k;
                    k = a.Deferred(),
                    i = d.extend({},
                    b, {
                        accept: d.isPlainObject(g) ? [g] : g,
                        swf: f.swf,
                        runtimeOrder: f.runtimeOrder,
                        id: this
                    }),
                    j = new c(i),
                    j.once("ready", k.resolve),
                    j.on("select",
                    function (a) {
                        e.owner.request("add-file", [a])
                    }),
                    j.init(),
                    e.pickers.push(j),
                    h.push(k.promise())
                }),
                a.when.apply(a, h)
            },
            disable: function () {
                d.each(this.pickers,
                function () {
                    this.disable()
                })
            },
            enable: function () {
                d.each(this.pickers,
                function () {
                    this.enable()
                })
            },
            destroy: function () {
                d.each(this.pickers,
                function () {
                    this.destroy()
                }),
                this.pickers = null
            }
        })
    }),
    b("lib/image", ["base", "runtime/client", "lib/blob"],
    function (a, b, c) {
        function d(a) {
            this.options = e.extend({},
            d.options, a),
            b.call(this, "Image"),
            this.on("load",
            function () {
                this._info = this.exec("info"),
                this._meta = this.exec("meta")
            })
        }
        var e = a.$;
        return d.options = {
            quality: 90,
            crop: !1,
            preserveHeaders: !1,
            allowMagnify: !1
        },
        a.inherits(b, {
            constructor: d,
            info: function (a) {
                return a ? (this._info = a, this) : this._info
            },
            meta: function (a) {
                return a ? (this._meta = a, this) : this._meta
            },
            loadFromBlob: function (a) {
                var b = this,
                c = a.getRuid();
                this.connectRuntime(c,
                function () {
                    b.exec("init", b.options),
                    b.exec("loadFromBlob", a)
                })
            },
            resize: function () {
                var b = a.slice(arguments);
                return this.exec.apply(this, ["resize"].concat(b))
            },
            crop: function () {
                var b = a.slice(arguments);
                return this.exec.apply(this, ["crop"].concat(b))
            },
            getAsDataUrl: function (a) {
                return this.exec("getAsDataUrl", a)
            },
            getAsBlob: function (a) {
                var b = this.exec("getAsBlob", a);
                return new c(this.getRuid(), b)
            }
        }),
        d
    }),
    b("widgets/image", ["base", "uploader", "lib/image", "widgets/widget"],
    function (a, b, c) {
        var d, e = a.$;
        return d = function (a) {
            var b = 0,
            c = [],
            d = function () {
                for (var d; c.length && a > b;) d = c.shift(),
                b += d[0],
                d[1]()
            };
            return function (a, e, f) {
                c.push([e, f]),
                a.once("destroy",
                function () {
                    b -= e,
                    setTimeout(d, 1)
                }),
                setTimeout(d, 1)
            }
        }(5242880),
        e.extend(b.options, {
            thumb: {
                width: 110,
                height: 110,
                quality: 70,
                allowMagnify: !0,
                crop: !0,
                preserveHeaders: !1,
                type: "image/jpeg"
            },
            compress: {
                width: 1600,
                height: 1600,
                quality: 90,
                allowMagnify: !1,
                crop: !1,
                preserveHeaders: !0
            }
        }),
        b.register({
            name: "image",
            makeThumb: function (a, b, f, g) {
                var h, i;
                return a = this.request("get-file", a),
                a.type.match(/^image/) ? (h = e.extend({},
                this.options.thumb), e.isPlainObject(f) && (h = e.extend(h, f), f = null), f = f || h.width, g = g || h.height, i = new c(h), i.once("load",
                function () {
                    a._info = a._info || i.info(),
                    a._meta = a._meta || i.meta(),
                    1 >= f && f > 0 && (f = a._info.width * f),
                    1 >= g && g > 0 && (g = a._info.height * g),
                    i.resize(f, g)
                }), i.once("complete",
                function () {
                    b(!1, i.getAsDataUrl(h.type)),
                    i.destroy()
                }), i.once("error",
                function (a) {
                    b(a || !0),
                    i.destroy()
                }), void d(i, a.source.size,
                function () {
                    a._info && i.info(a._info),
                    a._meta && i.meta(a._meta),
                    i.loadFromBlob(a.source)
                })) : void b(!0)
            },
            beforeSendFile: function (b) {
                var d, f, g = this.options.compress || this.options.resize,
                h = g && g.compressSize || 0,
                i = g && g.noCompressIfLarger || !1;
                return b = this.request("get-file", b),
                !g || !~"image/jpeg,image/jpg".indexOf(b.type) || b.size < h || b._compressed ? void 0 : (g = e.extend({},
                g), f = a.Deferred(), d = new c(g), f.always(function () {
                    d.destroy(),
                    d = null
                }), d.once("error", f.reject), d.once("load",
                function () {
                    var a = g.width,
                    c = g.height;
                    b._info = b._info || d.info(),
                    b._meta = b._meta || d.meta(),
                    1 >= a && a > 0 && (a = b._info.width * a),
                    1 >= c && c > 0 && (c = b._info.height * c),
                    d.resize(a, c)
                }), d.once("complete",
                function () {
                    var a, c;
                    try {
                        a = d.getAsBlob(g.type),
                        c = b.size,
                        (!i || a.size < c) && (b.source = a, b.size = a.size, b.trigger("resize", a.size, c)),
                        b._compressed = !0,
                        f.resolve()
                    } catch (e) {
                        f.resolve()
                    }
                }), b._info && d.info(b._info), b._meta && d.meta(b._meta), d.loadFromBlob(b.source), f.promise())
            }
        })
    }),
    b("file", ["base", "mediator"],
    function (a, b) {
        function c() {
            return f + g++
        }
        function d(a) {
            this.name = a.name || "Untitled",
            this.size = a.size || 0,
            this.type = a.type || "application/octet-stream",
            this.lastModifiedDate = a.lastModifiedDate || 1 * new Date,
            this.id = c(),
            this.ext = h.exec(this.name) ? RegExp.$1 : "",
            this.statusText = "",
            i[this.id] = d.Status.INITED,
            this.source = a,
            this.loaded = 0,
            this.on("error",
            function (a) {
                this.setStatus(d.Status.ERROR, a)
            })
        }
        var e = a.$,
        f = "WU_FILE_",
        g = 0,
        h = /\.([^.]+)$/,
        i = {};
        return e.extend(d.prototype, {
            setStatus: function (a, b) {
                var c = i[this.id];
                "undefined" != typeof b && (this.statusText = b),
                a !== c && (i[this.id] = a, this.trigger("statuschange", a, c))
            },
            getStatus: function () {
                return i[this.id]
            },
            getSource: function () {
                return this.source
            },
            destroy: function () {
                this.off(),
                delete i[this.id]
            }
        }),
        b.installTo(d.prototype),
        d.Status = {
            INITED: "inited",
            QUEUED: "queued",
            PROGRESS: "progress",
            ERROR: "error",
            COMPLETE: "complete",
            CANCELLED: "cancelled",
            INTERRUPT: "interrupt",
            INVALID: "invalid"
        },
        d
    }),
    b("queue", ["base", "mediator", "file"],
    function (a, b, c) {
        function d() {
            this.stats = {
                numOfQueue: 0,
                numOfSuccess: 0,
                numOfCancel: 0,
                numOfProgress: 0,
                numOfUploadFailed: 0,
                numOfInvalid: 0,
                numofDeleted: 0,
                numofInterrupt: 0
            },
            this._queue = [],
            this._map = {}
        }
        var e = a.$,
        f = c.Status;
        return e.extend(d.prototype, {
            append: function (a) {
                return this._queue.push(a),
                this._fileAdded(a),
                this
            },
            prepend: function (a) {
                return this._queue.unshift(a),
                this._fileAdded(a),
                this
            },
            getFile: function (a) {
                return "string" != typeof a ? a : this._map[a]
            },
            fetch: function (a) {
                var b, c, d = this._queue.length;
                for (a = a || f.QUEUED, b = 0; d > b; b++) if (c = this._queue[b], a === c.getStatus()) return c;
                return null
            },
            sort: function (a) {
                "function" == typeof a && this._queue.sort(a)
            },
            getFiles: function () {
                for (var a, b = [].slice.call(arguments, 0), c = [], d = 0, f = this._queue.length; f > d; d++) a = this._queue[d],
                (!b.length || ~e.inArray(a.getStatus(), b)) && c.push(a);
                return c
            },
            removeFile: function (a) {
                var b = this._map[a.id];
                b && (delete this._map[a.id], a.destroy(), this.stats.numofDeleted++)
            },
            _fileAdded: function (a) {
                var b = this,
                c = this._map[a.id];
                c || (this._map[a.id] = a, a.on("statuschange",
                function (a, c) {
                    b._onFileStatusChange(a, c)
                }))
            },
            _onFileStatusChange: function (a, b) {
                var c = this.stats;
                switch (b) {
                    case f.PROGRESS:
                        c.numOfProgress--;
                        break;
                    case f.QUEUED:
                        c.numOfQueue--;
                        break;
                    case f.ERROR:
                        c.numOfUploadFailed--;
                        break;
                    case f.INVALID:
                        c.numOfInvalid--;
                        break;
                    case f.INTERRUPT:
                        c.numofInterrupt--
                }
                switch (a) {
                    case f.QUEUED:
                        c.numOfQueue++;
                        break;
                    case f.PROGRESS:
                        c.numOfProgress++;
                        break;
                    case f.ERROR:
                        c.numOfUploadFailed++;
                        break;
                    case f.COMPLETE:
                        c.numOfSuccess++;
                        break;
                    case f.CANCELLED:
                        c.numOfCancel++;
                        break;
                    case f.INVALID:
                        c.numOfInvalid++;
                        break;
                    case f.INTERRUPT:
                        c.numofInterrupt++
                }
            }
        }),
        b.installTo(d.prototype),
        d
    }),
    b("widgets/queue", ["base", "uploader", "queue", "file", "lib/file", "runtime/client", "widgets/widget"],
    function (a, b, c, d, e, f) {
        var g = a.$,
        h = /\.\w+$/,
        i = d.Status;
        return b.register({
            name: "queue",
            init: function (b) {
                var d, e, h, i, j, k, l, m = this;
                if (g.isPlainObject(b.accept) && (b.accept = [b.accept]), b.accept) {
                    for (j = [], h = 0, e = b.accept.length; e > h; h++) i = b.accept[h].extensions,
                    i && j.push(i);
                    j.length && (k = "\\." + j.join(",").replace(/,/g, "$|\\.").replace(/\*/g, ".*") + "$"),
                    m.accept = new RegExp(k, "i")
                }
                return m.queue = new c,
                m.stats = m.queue.stats,
                "html5" === this.request("predict-runtime-type") ? (d = a.Deferred(), this.placeholder = l = new f("Placeholder"), l.connectRuntime({
                    runtimeOrder: "html5"
                },
                function () {
                    m._ruid = l.getRuid(),
                    d.resolve()
                }), d.promise()) : void 0
            },
            _wrapFile: function (a) {
                if (!(a instanceof d)) {
                    if (!(a instanceof e)) {
                        if (!this._ruid) throw new Error("Can't add external files.");
                        a = new e(this._ruid, a)
                    }
                    a = new d(a)
                }
                return a
            },
            acceptFile: function (a) {
                var b = !a || !a.size || this.accept && h.exec(a.name) && !this.accept.test(a.name);
                return !b
            },
            _addFile: function (a) {
                var b = this;
                return a = b._wrapFile(a),
                b.owner.trigger("beforeFileQueued", a) ? b.acceptFile(a) ? (b.queue.append(a), b.owner.trigger("fileQueued", a), a) : void b.owner.trigger("error", "Q_TYPE_DENIED", a) : void 0
            },
            getFile: function (a) {
                return this.queue.getFile(a)
            },
            addFile: function (a) {
                var b = this;
                a.length || (a = [a]),
                a = g.map(a,
                function (a) {
                    return b._addFile(a)
                }),
                b.owner.trigger("filesQueued", a),
                b.options.auto && setTimeout(function () {
                    b.request("start-upload")
                },
                20)
            },
            getStats: function () {
                return this.stats
            },
            removeFile: function (a, b) {
                var c = this;
                a = a.id ? a : c.queue.getFile(a),
                this.request("cancel-file", a),
                b && this.queue.removeFile(a)
            },
            getFiles: function () {
                return this.queue.getFiles.apply(this.queue, arguments)
            },
            fetchFile: function () {
                return this.queue.fetch.apply(this.queue, arguments)
            },
            retry: function (a, b) {
                var c, d, e, f = this;
                if (a) return a = a.id ? a : f.queue.getFile(a),
                a.setStatus(i.QUEUED),
                void (b || f.request("start-upload"));
                for (c = f.queue.getFiles(i.ERROR), d = 0, e = c.length; e > d; d++) a = c[d],
                a.setStatus(i.QUEUED);
                f.request("start-upload")
            },
            sortFiles: function () {
                return this.queue.sort.apply(this.queue, arguments)
            },
            reset: function () {
                this.owner.trigger("reset"),
                this.queue = new c,
                this.stats = this.queue.stats
            },
            destroy: function () {
                this.reset(),
                this.placeholder && this.placeholder.destroy()
            }
        })
    }),
    b("widgets/runtime", ["uploader", "runtime/runtime", "widgets/widget"],
    function (a, b) {
        return a.support = function () {
            return b.hasRuntime.apply(b, arguments)
        },
        a.register({
            name: "runtime",
            init: function () {
                if (!this.predictRuntimeType()) throw Error("Runtime Error")
            },
            predictRuntimeType: function () {
                var a, c, d = this.options.runtimeOrder || b.orders,
                e = this.type;
                if (!e) for (d = d.split(/\s*,\s*/g), a = 0, c = d.length; c > a; a++) if (b.hasRuntime(d[a])) {
                    this.type = e = d[a];
                    break
                }
                return e
            }
        })
    }),
    b("lib/transport", ["base", "runtime/client", "mediator"],
    function (a, b, c) {
        function d(a) {
            var c = this;
            a = c.options = e.extend(!0, {},
            d.options, a || {}),
            b.call(this, "Transport"),
            this._blob = null,
            this._formData = a.formData || {},
            this._headers = a.headers || {},
            this.on("progress", this._timeout),
            this.on("load error",
            function () {
                c.trigger("progress", 1),
                clearTimeout(c._timer)
            })
        }
        var e = a.$;
        return d.options = {
            server: "",
            method: "POST",
            withCredentials: !1,
            fileVal: "file",
            timeout: 12e4,
            formData: {},
            headers: {},
            sendAsBinary: !1
        },
        e.extend(d.prototype, {
            appendBlob: function (a, b, c) {
                var d = this,
                e = d.options;
                d.getRuid() && d.disconnectRuntime(),
                d.connectRuntime(b.ruid,
                function () {
                    d.exec("init")
                }),
                d._blob = b,
                e.fileVal = a || e.fileVal,
                e.filename = c || e.filename
            },
            append: function (a, b) {
                "object" == typeof a ? e.extend(this._formData, a) : this._formData[a] = b
            },
            setRequestHeader: function (a, b) {
                "object" == typeof a ? e.extend(this._headers, a) : this._headers[a] = b
            },
            send: function (a) {
                this.exec("send", a),
                this._timeout()
            },
            abort: function () {
                return clearTimeout(this._timer),
                this.exec("abort")
            },
            destroy: function () {
                this.trigger("destroy"),
                this.off(),
                this.exec("destroy"),
                this.disconnectRuntime()
            },
            getResponse: function () {
                return this.exec("getResponse")
            },
            getResponseAsJson: function () {
                return this.exec("getResponseAsJson")
            },
            getStatus: function () {
                return this.exec("getStatus")
            },
            _timeout: function () {
                var a = this,
                b = a.options.timeout;
                b && (clearTimeout(a._timer), a._timer = setTimeout(function () {
                    a.abort(),
                    a.trigger("error", "timeout")
                },
                b))
            }
        }),
        c.installTo(d.prototype),
        d
    }),
    b("widgets/upload", ["base", "uploader", "file", "lib/transport", "widgets/widget"],
    function (a, b, c, d) {
        function e(a, b) {
            var c, d, e = [],
            f = a.source,
            g = f.size,
            h = b ? Math.ceil(g / b) : 1,
            i = 0,
            j = 0;
            for (d = {
                file: a,
                has: function () {
                    return !!e.length
            },
                shift: function () {
                    return e.shift()
            },
                unshift: function (a) {
                    e.unshift(a)
            }
            }; h > j;) c = Math.min(b, g - i),
            e.push({
                file: a,
                start: i,
                end: b ? i + c : g,
                total: g,
                chunks: h,
                chunk: j++,
                cuted: d
            }),
            i += c;
            return a.blocks = e.concat(),
            a.remaning = e.length,
            d
        }
        var f = a.$,
        g = a.isPromise,
        h = c.Status;
        f.extend(b.options, {
            prepareNextFile: !1,
            chunked: !1,
            chunkSize: 5242880,
            chunkRetry: 2,
            threads: 3,
            formData: {}
        }),
        b.register({
            name: "upload",
            init: function () {
                var b = this.owner,
                c = this;
                this.runing = !1,
                this.progress = !1,
                b.on("startUpload",
                function () {
                    c.progress = !0
                }).on("uploadFinished",
                function () {
                    c.progress = !1
                }),
                this.pool = [],
                this.stack = [],
                this.pending = [],
                this.remaning = 0,
                this.__tick = a.bindFn(this._tick, this),
                b.on("uploadComplete",
                function (a) {
                    a.blocks && f.each(a.blocks,
                    function (a, b) {
                        b.transport && (b.transport.abort(), b.transport.destroy()),
                        delete b.transport
                    }),
                    delete a.blocks,
                    delete a.remaning
                })
            },
            reset: function () {
                this.request("stop-upload", !0),
                this.runing = !1,
                this.pool = [],
                this.stack = [],
                this.pending = [],
                this.remaning = 0,
                this._trigged = !1,
                this._promise = null
            },
            startUpload: function (b) {
                var c = this;
                if (f.each(c.request("get-files", h.INVALID),
                function () {
                    c.request("remove-file", this)
                }), b) if (b = b.id ? b : c.request("get-file", b), b.getStatus() === h.INTERRUPT) f.each(c.pool,
                function (a, c) {
                    c.file === b && c.transport && c.transport.send()
                }),
                b.setStatus(h.QUEUED);
                else {
                    if (b.getStatus() === h.PROGRESS) return;
                    b.setStatus(h.QUEUED)
                } else f.each(c.request("get-files", [h.INITED]),
                function () {
                    this.setStatus(h.QUEUED)
                });
                if (!c.runing) {
                    c.runing = !0;
                    var d = [];
                    f.each(c.pool,
                    function (a, b) {
                        var e = b.file;
                        e.getStatus() === h.INTERRUPT && (d.push(e), c._trigged = !1, b.transport && b.transport.send())
                    });
                    for (var b; b = d.shift() ;) b.setStatus(h.PROGRESS);
                    b || f.each(c.request("get-files", h.INTERRUPT),
                    function () {
                        this.setStatus(h.PROGRESS)
                    }),
                    c._trigged = !1,
                    a.nextTick(c.__tick),
                    c.owner.trigger("startUpload")
                }
            },
            stopUpload: function (b, c) {
                var d = this;
                if (b === !0 && (c = b, b = null), d.runing !== !1) {
                    if (b) {
                        if (b = b.id ? b : d.request("get-file", b), b.getStatus() !== h.PROGRESS && b.getStatus() !== h.QUEUED) return;
                        return b.setStatus(h.INTERRUPT),
                        f.each(d.pool,
                        function (a, c) {
                            c.file === b && (c.transport && c.transport.abort(), d._putback(c), d._popBlock(c))
                        }),
                        a.nextTick(d.__tick)
                    }
                    d.runing = !1,
                    this._promise && this._promise.file && this._promise.file.setStatus(h.INTERRUPT),
                    c && f.each(d.pool,
                    function (a, b) {
                        b.transport && b.transport.abort(),
                        b.file.setStatus(h.INTERRUPT)
                    }),
                    d.owner.trigger("stopUpload")
                }
            },
            cancelFile: function (a) {
                a = a.id ? a : this.request("get-file", a),
                a.blocks && f.each(a.blocks,
                function (a, b) {
                    var c = b.transport;
                    c && (c.abort(), c.destroy(), delete b.transport)
                }),
                a.setStatus(h.CANCELLED),
                this.owner.trigger("fileDequeued", a)
            },
            isInProgress: function () {
                return !!this.progress
            },
            _getStats: function () {
                return this.request("get-stats")
            },
            skipFile: function (a, b) {
                a = a.id ? a : this.request("get-file", a),
                a.setStatus(b || h.COMPLETE),
                a.skipped = !0,
                a.blocks && f.each(a.blocks,
                function (a, b) {
                    var c = b.transport;
                    c && (c.abort(), c.destroy(), delete b.transport)
                }),
                this.owner.trigger("uploadSkip", a)
            },
            _tick: function () {
                var b, c, d = this,
                e = d.options;
                return d._promise ? d._promise.always(d.__tick) : void (d.pool.length < e.threads && (c = d._nextBlock()) ? (d._trigged = !1, b = function (b) {
                    d._promise = null,
                    b && b.file && d._startSend(b),
                    a.nextTick(d.__tick)
                },
                d._promise = g(c) ? c.always(b) : b(c)) : d.remaning || d._getStats().numOfQueue || d._getStats().numofInterrupt || (d.runing = !1, d._trigged || a.nextTick(function () {
                    d.owner.trigger("uploadFinished")
                }), d._trigged = !0))
            },
            _putback: function (a) {
                var b;
                a.cuted.unshift(a),
                b = this.stack.indexOf(a.cuted),
                ~b || this.stack.unshift(a.cuted)
            },
            _getStack: function () {
                for (var a, b = 0; a = this.stack[b++];) {
                    if (a.has() && a.file.getStatus() === h.PROGRESS) return a; (!a.has() || a.file.getStatus() !== h.PROGRESS && a.file.getStatus() !== h.INTERRUPT) && this.stack.splice(--b, 1)
                }
                return null
            },
            _nextBlock: function () {
                var a, b, c, d, f = this,
                h = f.options;
                return (a = this._getStack()) ? (h.prepareNextFile && !f.pending.length && f._prepareNextFile(), a.shift()) : f.runing ? (!f.pending.length && f._getStats().numOfQueue && f._prepareNextFile(), b = f.pending.shift(), c = function (b) {
                    return b ? (a = e(b, h.chunked ? h.chunkSize : 0), f.stack.push(a), a.shift()) : null
                },
                g(b) ? (d = b.file, b = b[b.pipe ? "pipe" : "then"](c), b.file = d, b) : c(b)) : void 0
            },
            _prepareNextFile: function () {
                var a, b = this,
                c = b.request("fetch-file"),
                d = b.pending;
                c && (a = b.request("before-send-file", c,
                function () {
                    return c.getStatus() === h.PROGRESS || c.getStatus() === h.INTERRUPT ? c : b._finishFile(c)
                }), b.owner.trigger("uploadStart", c), c.setStatus(h.PROGRESS), a.file = c, a.done(function () {
                    var b = f.inArray(a, d); ~b && d.splice(b, 1, c)
                }), a.fail(function (a) {
                    c.setStatus(h.ERROR, a),
                    b.owner.trigger("uploadError", c, a),
                    b.owner.trigger("uploadComplete", c)
                }), d.push(a))
            },
            _popBlock: function (a) {
                var b = f.inArray(a, this.pool);
                this.pool.splice(b, 1),
                a.file.remaning--,
                this.remaning--
            },
            _startSend: function (b) {
                var c, d = this,
                e = b.file;
                return e.getStatus() !== h.PROGRESS ? void (e.getStatus() === h.INTERRUPT && d._putback(b)) : (d.pool.push(b), d.remaning++, b.blob = 1 === b.chunks ? e.source : e.source.slice(b.start, b.end), c = d.request("before-send", b,
                function () {
                    e.getStatus() === h.PROGRESS ? d._doSend(b) : (d._popBlock(b), a.nextTick(d.__tick))
                }), void c.fail(function () {
                    1 === e.remaning ? d._finishFile(e).always(function () {
                        b.percentage = 1,
                        d._popBlock(b),
                        d.owner.trigger("uploadComplete", e),
                        a.nextTick(d.__tick)
                    }) : (b.percentage = 1, d.updateFileProgress(e), d._popBlock(b), a.nextTick(d.__tick))
                }))
            },
            _doSend: function (b) {
                var c, e, g = this,
                i = g.owner,
                j = g.options,
                k = b.file,
                l = new d(j),
                m = f.extend({},
                j.formData),
                n = f.extend({},
                j.headers);
                b.transport = l,
                l.on("destroy",
                function () {
                    delete b.transport,
                    g._popBlock(b),
                    a.nextTick(g.__tick)
                }),
                l.on("progress",
                function (a) {
                    b.percentage = a,
                    g.updateFileProgress(k)
                }),
                c = function (a) {
                    var c;
                    return e = l.getResponseAsJson() || {},
                    e._raw = l.getResponse(),
                    c = function (b) {
                        a = b
                    },
                    i.trigger("uploadAccept", b, e, c) || (a = a || "server"),
                    a
                },
                l.on("error",
                function (a, d) {
                    b.retried = b.retried || 0,
                    b.chunks > 1 && ~"http,abort".indexOf(a) && b.retried < j.chunkRetry ? (b.retried++, l.send()) : (d || "server" !== a || (a = c(a)), k.setStatus(h.ERROR, a), i.trigger("uploadError", k, a), i.trigger("uploadComplete", k))
                }),
                l.on("load",
                function () {
                    var a;
                    return (a = c()) ? void l.trigger("error", a, !0) : void (1 === k.remaning ? g._finishFile(k, e) : l.destroy())
                }),
                m = f.extend(m, {
                    id: k.id,
                    name: k.name,
                    type: k.type,
                    lastModifiedDate: k.lastModifiedDate,
                    size: k.size
                }),
                b.chunks > 1 && f.extend(m, {
                    chunks: b.chunks,
                    chunk: b.chunk
                }),
                i.trigger("uploadBeforeSend", b, m, n),
                l.appendBlob(j.fileVal, b.blob, k.name),
                l.append(m),
                l.setRequestHeader(n),
                l.send()
            },
            _finishFile: function (a, b, c) {
                var d = this.owner;
                return d.request("after-send-file", arguments,
                function () {
                    a.setStatus(h.COMPLETE),
                    d.trigger("uploadSuccess", a, b, c)
                }).fail(function (b) {
                    a.getStatus() === h.PROGRESS && a.setStatus(h.ERROR, b),
                    d.trigger("uploadError", a, b)
                }).always(function () {
                    d.trigger("uploadComplete", a)
                })
            },
            updateFileProgress: function (a) {
                var b = 0,
                c = 0;
                a.blocks && (f.each(a.blocks,
                function (a, b) {
                    c += (b.percentage || 0) * (b.end - b.start)
                }), b = c / a.size, this.owner.trigger("uploadProgress", a, b || 0))
            }
        })
    }),
    b("widgets/validator", ["base", "uploader", "file", "widgets/widget"],
    function (a, b, c) {
        var d, e = a.$,
        f = {};
        return d = {
            addValidator: function (a, b) {
                f[a] = b
            },
            removeValidator: function (a) {
                delete f[a]
            }
        },
        b.register({
            name: "validator",
            init: function () {
                var b = this;
                a.nextTick(function () {
                    e.each(f,
                    function () {
                        this.call(b.owner)
                    })
                })
            }
        }),
        d.addValidator("fileNumLimit",
        function () {
            var a = this,
            b = a.options,
            c = 0,
            d = parseInt(b.fileNumLimit, 10),
            e = !0;
            d && (a.on("beforeFileQueued",
            function (a) {
                return c >= d && e && (e = !1, this.trigger("error", "Q_EXCEED_NUM_LIMIT", d, a), setTimeout(function () {
                    e = !0
                },
                1)),
                c >= d ? !1 : !0
            }), a.on("fileQueued",
            function () {
                c++
            }), a.on("fileDequeued",
            function () {
                c--
            }), a.on("reset",
            function () {
                c = 0
            }))
        }),
        d.addValidator("fileSizeLimit",
        function () {
            var a = this,
            b = a.options,
            c = 0,
            d = parseInt(b.fileSizeLimit, 10),
            e = !0;
            d && (a.on("beforeFileQueued",
            function (a) {
                var b = c + a.size > d;
                return b && e && (e = !1, this.trigger("error", "Q_EXCEED_SIZE_LIMIT", d, a), setTimeout(function () {
                    e = !0
                },
                1)),
                b ? !1 : !0
            }), a.on("fileQueued",
            function (a) {
                c += a.size
            }), a.on("fileDequeued",
            function (a) {
                c -= a.size
            }), a.on("reset",
            function () {
                c = 0
            }))
        }),
        d.addValidator("fileSingleSizeLimit",
        function () {
            var a = this,
            b = a.options,
            d = b.fileSingleSizeLimit;
            d && a.on("beforeFileQueued",
            function (a) {
                return a.size > d ? (a.setStatus(c.Status.INVALID, "exceed_size"), this.trigger("error", "F_EXCEED_SIZE", d, a), !1) : void 0
            })
        }),
        d.addValidator("duplicate",
        function () {
            function a(a) {
                for (var b, c = 0,
                d = 0,
                e = a.length; e > d; d++) b = a.charCodeAt(d),
                c = b + (c << 6) + (c << 16) - c;
                return c
            }
            var b = this,
            c = b.options,
            d = {};
            c.duplicate || (b.on("beforeFileQueued",
            function (b) {
                var c = b.__hash || (b.__hash = a(b.name + b.size + b.lastModifiedDate));
                return d[c] ? (this.trigger("error", "F_DUPLICATE", b), !1) : void 0
            }), b.on("fileQueued",
            function (a) {
                var b = a.__hash;
                b && (d[b] = !0)
            }), b.on("fileDequeued",
            function (a) {
                var b = a.__hash;
                b && delete d[b]
            }), b.on("reset",
            function () {
                d = {}
            }))
        }),
        d
    }),
    b("lib/md5", ["runtime/client", "mediator"],
    function (a, b) {
        function c() {
            a.call(this, "Md5")
        }
        return b.installTo(c.prototype),
        c.prototype.loadFromBlob = function (a) {
            var b = this;
            b.getRuid() && b.disconnectRuntime(),
            b.connectRuntime(a.ruid,
            function () {
                b.exec("init"),
                b.exec("loadFromBlob", a)
            })
        },
        c.prototype.getResult = function () {
            return this.exec("getResult")
        },
        c
    }),
    b("widgets/md5", ["base", "uploader", "lib/md5", "lib/blob", "widgets/widget"],
    function (a, b, c, d) {
        return b.register({
            name: "md5",
            md5File: function (b, e, f) {
                var g = new c,
                h = a.Deferred(),
                i = b instanceof d ? b : this.request("get-file", b).source;
                return g.on("progress load",
                function (a) {
                    a = a || {},
                    h.notify(a.total ? a.loaded / a.total : 1)
                }),
                g.on("complete",
                function () {
                    h.resolve(g.getResult())
                }),
                g.on("error",
                function (a) {
                    h.reject(a)
                }),
                arguments.length > 1 && (e = e || 0, f = f || 0, 0 > e && (e = i.size + e), 0 > f && (f = i.size + f), f = Math.min(f, i.size), i = i.slice(e, f)),
                g.loadFromBlob(i),
                h.promise()
            }
        })
    }),
    b("runtime/compbase", [],
    function () {
        function a(a, b) {
            this.owner = a,
            this.options = a.options,
            this.getRuntime = function () {
                return b
            },
            this.getRuid = function () {
                return b.uid
            },
            this.trigger = function () {
                return a.trigger.apply(a, arguments)
            }
        }
        return a
    }),
    b("runtime/html5/runtime", ["base", "runtime/runtime", "runtime/compbase"],
    function (b, c, d) {
        function e() {
            var a = {},
            d = this,
            e = this.destroy;
            c.apply(d, arguments),
            d.type = f,
            d.exec = function (c, e) {
                var f, h = this,
                i = h.uid,
                j = b.slice(arguments, 2);
                return g[c] && (f = a[i] = a[i] || new g[c](h, d), f[e]) ? f[e].apply(f, j) : void 0
            },
            d.destroy = function () {
                return e && e.apply(this, arguments)
            }
        }
        var f = "html5",
        g = {};
        return b.inherits(c, {
            constructor: e,
            init: function () {
                var a = this;
                setTimeout(function () {
                    a.trigger("ready")
                },
                1)
            }
        }),
        e.register = function (a, c) {
            var e = g[a] = b.inherits(d, c);
            return e
        },
        a.Blob && a.FileReader && a.DataView && c.addRuntime(f, e),
        e
    }),
    b("runtime/html5/blob", ["runtime/html5/runtime", "lib/blob"],
    function (a, b) {
        return a.register("Blob", {
            slice: function (a, c) {
                var d = this.owner.source,
                e = d.slice || d.webkitSlice || d.mozSlice;
                return d = e.call(d, a, c),
                new b(this.getRuid(), d)
            }
        })
    }),
    b("runtime/html5/dnd", ["base", "runtime/html5/runtime", "lib/file"],
    function (a, b, c) {
        var d = a.$,
        e = "webuploader-dnd-";
        return b.register("DragAndDrop", {
            init: function () {
                var b = this.elem = this.options.container;
                this.dragEnterHandler = a.bindFn(this._dragEnterHandler, this),
                this.dragOverHandler = a.bindFn(this._dragOverHandler, this),
                this.dragLeaveHandler = a.bindFn(this._dragLeaveHandler, this),
                this.dropHandler = a.bindFn(this._dropHandler, this),
                this.dndOver = !1,
                b.on("dragenter", this.dragEnterHandler),
                b.on("dragover", this.dragOverHandler),
                b.on("dragleave", this.dragLeaveHandler),
                b.on("drop", this.dropHandler),
                this.options.disableGlobalDnd && (d(document).on("dragover", this.dragOverHandler), d(document).on("drop", this.dropHandler))
            },
            _dragEnterHandler: function (a) {
                var b, c = this,
                d = c._denied || !1;
                return a = a.originalEvent || a,
                c.dndOver || (c.dndOver = !0, b = a.dataTransfer.items, b && b.length && (c._denied = d = !c.trigger("accept", b)), c.elem.addClass(e + "over"), c.elem[d ? "addClass" : "removeClass"](e + "denied")),
                a.dataTransfer.dropEffect = d ? "none" : "copy",
                !1
            },
            _dragOverHandler: function (a) {
                var b = this.elem.parent().get(0);
                return b && !d.contains(b, a.currentTarget) ? !1 : (clearTimeout(this._leaveTimer), this._dragEnterHandler.call(this, a), !1)
            },
            _dragLeaveHandler: function () {
                var a, b = this;
                return a = function () {
                    b.dndOver = !1,
                    b.elem.removeClass(e + "over " + e + "denied")
                },
                clearTimeout(b._leaveTimer),
                b._leaveTimer = setTimeout(a, 100),
                !1
            },
            _dropHandler: function (a) {
                var b, f, g = this,
                h = g.getRuid(),
                i = g.elem.parent().get(0);
                if (i && !d.contains(i, a.currentTarget)) return !1;
                a = a.originalEvent || a,
                b = a.dataTransfer;
                try {
                    f = b.getData("text/html")
                } catch (j) { }
                return f ? void 0 : (g._getTansferFiles(b,
                function (a) {
                    g.trigger("drop", d.map(a,
                    function (a) {
                        return new c(h, a)
                    }))
                }), g.dndOver = !1, g.elem.removeClass(e + "over"), !1)
            },
            _getTansferFiles: function (b, c) {
                var d, e, f, g, h, i, j, k = [],
                l = [];
                for (d = b.items, e = b.files, j = !(!d || !d[0].webkitGetAsEntry), h = 0, i = e.length; i > h; h++) f = e[h],
                g = d && d[h],
                j && g.webkitGetAsEntry().isDirectory ? l.push(this._traverseDirectoryTree(g.webkitGetAsEntry(), k)) : k.push(f);
                a.when.apply(a, l).done(function () {
                    k.length && c(k)
                })
            },
            _traverseDirectoryTree: function (b, c) {
                var d = a.Deferred(),
                e = this;
                return b.isFile ? b.file(function (a) {
                    c.push(a),
                    d.resolve()
                }) : b.isDirectory && b.createReader().readEntries(function (b) {
                    var f, g = b.length,
                    h = [],
                    i = [];
                    for (f = 0; g > f; f++) h.push(e._traverseDirectoryTree(b[f], i));
                    a.when.apply(a, h).then(function () {
                        c.push.apply(c, i),
                        d.resolve()
                    },
                    d.reject)
                }),
                d.promise()
            },
            destroy: function () {
                var a = this.elem;
                a && (a.off("dragenter", this.dragEnterHandler), a.off("dragover", this.dragOverHandler), a.off("dragleave", this.dragLeaveHandler), a.off("drop", this.dropHandler), this.options.disableGlobalDnd && (d(document).off("dragover", this.dragOverHandler), d(document).off("drop", this.dropHandler)))
            }
        })
    }),
    b("runtime/html5/filepaste", ["base", "runtime/html5/runtime", "lib/file"],
    function (a, b, c) {
        return b.register("FilePaste", {
            init: function () {
                var b, c, d, e, f = this.options,
                g = this.elem = f.container,
                h = ".*";
                if (f.accept) {
                    for (b = [], c = 0, d = f.accept.length; d > c; c++) e = f.accept[c].mimeTypes,
                    e && b.push(e);
                    b.length && (h = b.join(","), h = h.replace(/,/g, "|").replace(/\*/g, ".*"))
                }
                this.accept = h = new RegExp(h, "i"),
                this.hander = a.bindFn(this._pasteHander, this),
                g.on("paste", this.hander)
            },
            _pasteHander: function (a) {
                var b, d, e, f, g, h = [],
                i = this.getRuid();
                for (a = a.originalEvent || a, b = a.clipboardData.items, f = 0, g = b.length; g > f; f++) d = b[f],
                "file" === d.kind && (e = d.getAsFile()) && h.push(new c(i, e));
                h.length && (a.preventDefault(), a.stopPropagation(), this.trigger("paste", h))
            },
            destroy: function () {
                this.elem.off("paste", this.hander)
            }
        })
    }),
    b("runtime/html5/filepicker", ["base", "runtime/html5/runtime"],
    function (a, b) {
        var c = a.$;
        return b.register("FilePicker", {
            init: function () {
                var a, b, d, e, f = this.getRuntime().getContainer(),
                g = this,
                h = g.owner,
                i = g.options,
                j = this.label = c(document.createElement("label")),
                k = this.input = c(document.createElement("input"));
                if (k.attr("type", "file"), k.attr("name", i.name), k.addClass("webuploader-element-invisible"), j.on("click",
                function () {
                    k.trigger("click")
                }), j.css({
                    opacity: 0,
                    width: "100%",
                    height: "100%",
                    display: "block",
                    cursor: "pointer",
                    background: "#ffffff"
                }), i.multiple && k.attr("multiple", "multiple"), i.accept && i.accept.length > 0) {
                    for (a = [], b = 0, d = i.accept.length; d > b; b++) a.push(i.accept[b].mimeTypes);
                    k.attr("accept", a.join(","))
                }
                f.append(k),
                f.append(j),
                e = function (a) {
                    h.trigger(a.type)
                },
                k.on("change",
                function (a) {
                    var b, d = arguments.callee;
                    g.files = a.target.files,
                    b = this.cloneNode(!0),
                    b.value = null,
                    this.parentNode.replaceChild(b, this),
                    k.off(),
                    k = c(b).on("change", d).on("mouseenter mouseleave", e),
                    h.trigger("change")
                }),
                j.on("mouseenter mouseleave", e)
            },
            getFiles: function () {
                return this.files
            },
            destroy: function () {
                this.input.off(),
                this.label.off()
            }
        })
    }),
    b("runtime/html5/util", ["base"],
    function (b) {
        var c = a.createObjectURL && a || a.URL && URL.revokeObjectURL && URL || a.webkitURL,
        d = b.noop,
        e = d;
        return c && (d = function () {
            return c.createObjectURL.apply(c, arguments)
        },
        e = function () {
            return c.revokeObjectURL.apply(c, arguments)
        }),
        {
            createObjectURL: d,
            revokeObjectURL: e,
            dataURL2Blob: function (a) {
                var b, c, d, e, f, g;
                for (g = a.split(","), b = ~g[0].indexOf("base64") ? atob(g[1]) : decodeURIComponent(g[1]), d = new ArrayBuffer(b.length), c = new Uint8Array(d), e = 0; e < b.length; e++) c[e] = b.charCodeAt(e);
                return f = g[0].split(":")[1].split(";")[0],
                this.arrayBufferToBlob(d, f)
            },
            dataURL2ArrayBuffer: function (a) {
                var b, c, d, e;
                for (e = a.split(","), b = ~e[0].indexOf("base64") ? atob(e[1]) : decodeURIComponent(e[1]), c = new Uint8Array(b.length), d = 0; d < b.length; d++) c[d] = b.charCodeAt(d);
                return c.buffer
            },
            arrayBufferToBlob: function (b, c) {
                var d, e = a.BlobBuilder || a.WebKitBlobBuilder;
                return e ? (d = new e, d.append(b), d.getBlob(c)) : new Blob([b], c ? {
                    type: c
                } : {})
            },
            canvasToDataUrl: function (a, b, c) {
                return a.toDataURL(b, c / 100)
            },
            parseMeta: function (a, b) {
                b(!1, {})
            },
            updateImageHead: function (a) {
                return a
            }
        }
    }),
    b("runtime/html5/imagemeta", ["runtime/html5/util"],
    function (a) {
        var b;
        return b = {
            parsers: {
                65505: []
            },
            maxMetaDataSize: 262144,
            parse: function (a, b) {
                var c = this,
                d = new FileReader;
                d.onload = function () {
                    b(!1, c._parse(this.result)),
                    d = d.onload = d.onerror = null
                },
                d.onerror = function (a) {
                    b(a.message),
                    d = d.onload = d.onerror = null
                },
                a = a.slice(0, c.maxMetaDataSize),
                d.readAsArrayBuffer(a.getSource())
            },
            _parse: function (a, c) {
                if (!(a.byteLength < 6)) {
                    var d, e, f, g, h = new DataView(a),
                    i = 2,
                    j = h.byteLength - 4,
                    k = i,
                    l = {};
                    if (65496 === h.getUint16(0)) {
                        for (; j > i && (d = h.getUint16(i), d >= 65504 && 65519 >= d || 65534 === d) && (e = h.getUint16(i + 2) + 2, !(i + e > h.byteLength)) ;) {
                            if (f = b.parsers[d], !c && f) for (g = 0; g < f.length; g += 1) f[g].call(b, h, i, e, l);
                            i += e,
                            k = i
                        }
                        k > 6 && (l.imageHead = a.slice ? a.slice(2, k) : new Uint8Array(a).subarray(2, k))
                    }
                    return l
                }
            },
            updateImageHead: function (a, b) {
                var c, d, e, f = this._parse(a, !0);
                return e = 2,
                f.imageHead && (e = 2 + f.imageHead.byteLength),
                d = a.slice ? a.slice(e) : new Uint8Array(a).subarray(e),
                c = new Uint8Array(b.byteLength + 2 + d.byteLength),
                c[0] = 255,
                c[1] = 216,
                c.set(new Uint8Array(b), 2),
                c.set(new Uint8Array(d), b.byteLength + 2),
                c.buffer
            }
        },
        a.parseMeta = function () {
            return b.parse.apply(b, arguments)
        },
        a.updateImageHead = function () {
            return b.updateImageHead.apply(b, arguments)
        },
        b
    }),
    b("runtime/html5/imagemeta/exif", ["base", "runtime/html5/imagemeta"],
    function (a, b) {
        var c = {};
        return c.ExifMap = function () {
            return this
        },
        c.ExifMap.prototype.map = {
            Orientation: 274
        },
        c.ExifMap.prototype.get = function (a) {
            return this[a] || this[this.map[a]]
        },
        c.exifTagTypes = {
            1: {
                getValue: function (a, b) {
                    return a.getUint8(b)
                },
                size: 1
            },
            2: {
                getValue: function (a, b) {
                    return String.fromCharCode(a.getUint8(b))
                },
                size: 1,
                ascii: !0
            },
            3: {
                getValue: function (a, b, c) {
                    return a.getUint16(b, c)
                },
                size: 2
            },
            4: {
                getValue: function (a, b, c) {
                    return a.getUint32(b, c)
                },
                size: 4
            },
            5: {
                getValue: function (a, b, c) {
                    return a.getUint32(b, c) / a.getUint32(b + 4, c)
                },
                size: 8
            },
            9: {
                getValue: function (a, b, c) {
                    return a.getInt32(b, c)
                },
                size: 4
            },
            10: {
                getValue: function (a, b, c) {
                    return a.getInt32(b, c) / a.getInt32(b + 4, c)
                },
                size: 8
            }
        },
        c.exifTagTypes[7] = c.exifTagTypes[1],
        c.getExifValue = function (b, d, e, f, g, h) {
            var i, j, k, l, m, n, o = c.exifTagTypes[f];
            if (!o) return void a.log("Invalid Exif data: Invalid tag type.");
            if (i = o.size * g, j = i > 4 ? d + b.getUint32(e + 8, h) : e + 8, j + i > b.byteLength) return void a.log("Invalid Exif data: Invalid data offset.");
            if (1 === g) return o.getValue(b, j, h);
            for (k = [], l = 0; g > l; l += 1) k[l] = o.getValue(b, j + l * o.size, h);
            if (o.ascii) {
                for (m = "", l = 0; l < k.length && (n = k[l], "\x00" !== n) ; l += 1) m += n;
                return m
            }
            return k
        },
        c.parseExifTag = function (a, b, d, e, f) {
            var g = a.getUint16(d, e);
            f.exif[g] = c.getExifValue(a, b, d, a.getUint16(d + 2, e), a.getUint32(d + 4, e), e)
        },
        c.parseExifTags = function (b, c, d, e, f) {
            var g, h, i;
            if (d + 6 > b.byteLength) return void a.log("Invalid Exif data: Invalid directory offset.");
            if (g = b.getUint16(d, e), h = d + 2 + 12 * g, h + 4 > b.byteLength) return void a.log("Invalid Exif data: Invalid directory size.");
            for (i = 0; g > i; i += 1) this.parseExifTag(b, c, d + 2 + 12 * i, e, f);
            return b.getUint32(h, e)
        },
        c.parseExifData = function (b, d, e, f) {
            var g, h, i = d + 10;
            if (1165519206 === b.getUint32(d + 4)) {
                if (i + 8 > b.byteLength) return void a.log("Invalid Exif data: Invalid segment size.");
                if (0 !== b.getUint16(d + 8)) return void a.log("Invalid Exif data: Missing byte alignment offset.");
                switch (b.getUint16(i)) {
                    case 18761:
                        g = !0;
                        break;
                    case 19789:
                        g = !1;
                        break;
                    default:
                        return void a.log("Invalid Exif data: Invalid byte alignment marker.")
                }
                if (42 !== b.getUint16(i + 2, g)) return void a.log("Invalid Exif data: Missing TIFF marker.");
                h = b.getUint32(i + 4, g),
                f.exif = new c.ExifMap,
                h = c.parseExifTags(b, i, i + h, g, f)
            }
        },
        b.parsers[65505].push(c.parseExifData),
        c
    }),
    b("runtime/html5/jpegencoder", [],
    function () {
        function a(a) {
            function b(a) {
                for (var b = [16, 11, 10, 16, 24, 40, 51, 61, 12, 12, 14, 19, 26, 58, 60, 55, 14, 13, 16, 24, 40, 57, 69, 56, 14, 17, 22, 29, 51, 87, 80, 62, 18, 22, 37, 56, 68, 109, 103, 77, 24, 35, 55, 64, 81, 104, 113, 92, 49, 64, 78, 87, 103, 121, 120, 101, 72, 92, 95, 98, 112, 100, 103, 99], c = 0; 64 > c; c++) {
                    var d = y((b[c] * a + 50) / 100);
                    1 > d ? d = 1 : d > 255 && (d = 255),
                    z[P[c]] = d
                }
                for (var e = [17, 18, 24, 47, 99, 99, 99, 99, 18, 21, 26, 66, 99, 99, 99, 99, 24, 26, 56, 99, 99, 99, 99, 99, 47, 66, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99], f = 0; 64 > f; f++) {
                    var g = y((e[f] * a + 50) / 100);
                    1 > g ? g = 1 : g > 255 && (g = 255),
                    A[P[f]] = g
                }
                for (var h = [1, 1.387039845, 1.306562965, 1.175875602, 1, .785694958, .5411961, .275899379], i = 0, j = 0; 8 > j; j++) for (var k = 0; 8 > k; k++) B[i] = 1 / (z[P[i]] * h[j] * h[k] * 8),
                C[i] = 1 / (A[P[i]] * h[j] * h[k] * 8),
                i++
            }
            function c(a, b) {
                for (var c = 0,
                d = 0,
                e = new Array,
                f = 1; 16 >= f; f++) {
                    for (var g = 1; g <= a[f]; g++) e[b[d]] = [],
                    e[b[d]][0] = c,
                    e[b[d]][1] = f,
                    d++,
                    c++;
                    c *= 2
                }
                return e
            }
            function d() {
                t = c(Q, R),
                u = c(U, V),
                v = c(S, T),
                w = c(W, X)
            }
            function e() {
                for (var a = 1,
                b = 2,
                c = 1; 15 >= c; c++) {
                    for (var d = a; b > d; d++) E[32767 + d] = c,
                    D[32767 + d] = [],
                    D[32767 + d][1] = c,
                    D[32767 + d][0] = d;
                    for (var e = -(b - 1) ; -a >= e; e++) E[32767 + e] = c,
                    D[32767 + e] = [],
                    D[32767 + e][1] = c,
                    D[32767 + e][0] = b - 1 + e;
                    a <<= 1,
                    b <<= 1
                }
            }
            function f() {
                for (var a = 0; 256 > a; a++) O[a] = 19595 * a,
                O[a + 256 >> 0] = 38470 * a,
                O[a + 512 >> 0] = 7471 * a + 32768,
                O[a + 768 >> 0] = -11059 * a,
                O[a + 1024 >> 0] = -21709 * a,
                O[a + 1280 >> 0] = 32768 * a + 8421375,
                O[a + 1536 >> 0] = -27439 * a,
                O[a + 1792 >> 0] = -5329 * a
            }
            function g(a) {
                for (var b = a[0], c = a[1] - 1; c >= 0;) b & 1 << c && (I |= 1 << J),
                c--,
                J--,
                0 > J && (255 == I ? (h(255), h(0)) : h(I), J = 7, I = 0)
            }
            function h(a) {
                H.push(N[a])
            }
            function i(a) {
                h(a >> 8 & 255),
                h(255 & a)
            }
            function j(a, b) {
                var c, d, e, f, g, h, i, j, k, l = 0,
                m = 8,
                n = 64;
                for (k = 0; m > k; ++k) {
                    c = a[l],
                    d = a[l + 1],
                    e = a[l + 2],
                    f = a[l + 3],
                    g = a[l + 4],
                    h = a[l + 5],
                    i = a[l + 6],
                    j = a[l + 7];
                    var o = c + j,
                    p = c - j,
                    q = d + i,
                    r = d - i,
                    s = e + h,
                    t = e - h,
                    u = f + g,
                    v = f - g,
                    w = o + u,
                    x = o - u,
                    y = q + s,
                    z = q - s;
                    a[l] = w + y,
                    a[l + 4] = w - y;
                    var A = .707106781 * (z + x);
                    a[l + 2] = x + A,
                    a[l + 6] = x - A,
                    w = v + t,
                    y = t + r,
                    z = r + p;
                    var B = .382683433 * (w - z),
                    C = .5411961 * w + B,
                    D = 1.306562965 * z + B,
                    E = .707106781 * y,
                    G = p + E,
                    H = p - E;
                    a[l + 5] = H + C,
                    a[l + 3] = H - C,
                    a[l + 1] = G + D,
                    a[l + 7] = G - D,
                    l += 8
                }
                for (l = 0, k = 0; m > k; ++k) {
                    c = a[l],
                    d = a[l + 8],
                    e = a[l + 16],
                    f = a[l + 24],
                    g = a[l + 32],
                    h = a[l + 40],
                    i = a[l + 48],
                    j = a[l + 56];
                    var I = c + j,
                    J = c - j,
                    K = d + i,
                    L = d - i,
                    M = e + h,
                    N = e - h,
                    O = f + g,
                    P = f - g,
                    Q = I + O,
                    R = I - O,
                    S = K + M,
                    T = K - M;
                    a[l] = Q + S,
                    a[l + 32] = Q - S;
                    var U = .707106781 * (T + R);
                    a[l + 16] = R + U,
                    a[l + 48] = R - U,
                    Q = P + N,
                    S = N + L,
                    T = L + J;
                    var V = .382683433 * (Q - T),
                    W = .5411961 * Q + V,
                    X = 1.306562965 * T + V,
                    Y = .707106781 * S,
                    Z = J + Y,
                    $ = J - Y;
                    a[l + 40] = $ + W,
                    a[l + 24] = $ - W,
                    a[l + 8] = Z + X,
                    a[l + 56] = Z - X,
                    l++
                }
                var _;
                for (k = 0; n > k; ++k) _ = a[k] * b[k],
                F[k] = _ > 0 ? _ + .5 | 0 : _ - .5 | 0;
                return F
            }
            function k() {
                i(65504),
                i(16),
                h(74),
                h(70),
                h(73),
                h(70),
                h(0),
                h(1),
                h(1),
                h(0),
                i(1),
                i(1),
                h(0),
                h(0)
            }
            function l(a, b) {
                i(65472),
                i(17),
                h(8),
                i(b),
                i(a),
                h(3),
                h(1),
                h(17),
                h(0),
                h(2),
                h(17),
                h(1),
                h(3),
                h(17),
                h(1)
            }
            function m() {
                i(65499),
                i(132),
                h(0);
                for (var a = 0; 64 > a; a++) h(z[a]);
                h(1);
                for (var b = 0; 64 > b; b++) h(A[b])
            }
            function n() {
                i(65476),
                i(418),
                h(0);
                for (var a = 0; 16 > a; a++) h(Q[a + 1]);
                for (var b = 0; 11 >= b; b++) h(R[b]);
                h(16);
                for (var c = 0; 16 > c; c++) h(S[c + 1]);
                for (var d = 0; 161 >= d; d++) h(T[d]);
                h(1);
                for (var e = 0; 16 > e; e++) h(U[e + 1]);
                for (var f = 0; 11 >= f; f++) h(V[f]);
                h(17);
                for (var g = 0; 16 > g; g++) h(W[g + 1]);
                for (var j = 0; 161 >= j; j++) h(X[j])
            }
            function o() {
                i(65498),
                i(12),
                h(3),
                h(1),
                h(0),
                h(2),
                h(17),
                h(3),
                h(17),
                h(0),
                h(63),
                h(0)
            }
            function p(a, b, c, d, e) {
                for (var f, h = e[0], i = e[240], k = 16, l = 63, m = 64, n = j(a, b), o = 0; m > o; ++o) G[P[o]] = n[o];
                var p = G[0] - c;
                c = G[0],
                0 == p ? g(d[0]) : (f = 32767 + p, g(d[E[f]]), g(D[f]));
                for (var q = 63; q > 0 && 0 == G[q]; q--);
                if (0 == q) return g(h),
                c;
                for (var r, s = 1; q >= s;) {
                    for (var t = s; 0 == G[s] && q >= s; ++s);
                    var u = s - t;
                    if (u >= k) {
                        r = u >> 4;
                        for (var v = 1; r >= v; ++v) g(i);
                        u = 15 & u
                    }
                    f = 32767 + G[s],
                    g(e[(u << 4) + E[f]]),
                    g(D[f]),
                    s++
                }
                return q != l && g(h),
                c
            }
            function q() {
                for (var a = String.fromCharCode,
                b = 0; 256 > b; b++) N[b] = a(b)
            }
            function r(a) {
                if (0 >= a && (a = 1), a > 100 && (a = 100), x != a) {
                    var c = 0;
                    c = Math.floor(50 > a ? 5e3 / a : 200 - 2 * a),
                    b(c),
                    x = a
                }
            }
            function s() {
                a || (a = 50),
                q(),
                d(),
                e(),
                f(),
                r(a)
            }
            var t, u, v, w, x, y = (Math.round, Math.floor),
            z = new Array(64),
            A = new Array(64),
            B = new Array(64),
            C = new Array(64),
            D = new Array(65535),
            E = new Array(65535),
            F = new Array(64),
            G = new Array(64),
            H = [],
            I = 0,
            J = 7,
            K = new Array(64),
            L = new Array(64),
            M = new Array(64),
            N = new Array(256),
            O = new Array(2048),
            P = [0, 1, 5, 6, 14, 15, 27, 28, 2, 4, 7, 13, 16, 26, 29, 42, 3, 8, 12, 17, 25, 30, 41, 43, 9, 11, 18, 24, 31, 40, 44, 53, 10, 19, 23, 32, 39, 45, 52, 54, 20, 22, 33, 38, 46, 51, 55, 60, 21, 34, 37, 47, 50, 56, 59, 61, 35, 36, 48, 49, 57, 58, 62, 63],
            Q = [0, 0, 1, 5, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0],
            R = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
            S = [0, 0, 2, 1, 3, 3, 2, 4, 3, 5, 5, 4, 4, 0, 0, 1, 125],
            T = [1, 2, 3, 0, 4, 17, 5, 18, 33, 49, 65, 6, 19, 81, 97, 7, 34, 113, 20, 50, 129, 145, 161, 8, 35, 66, 177, 193, 21, 82, 209, 240, 36, 51, 98, 114, 130, 9, 10, 22, 23, 24, 25, 26, 37, 38, 39, 40, 41, 42, 52, 53, 54, 55, 56, 57, 58, 67, 68, 69, 70, 71, 72, 73, 74, 83, 84, 85, 86, 87, 88, 89, 90, 99, 100, 101, 102, 103, 104, 105, 106, 115, 116, 117, 118, 119, 120, 121, 122, 131, 132, 133, 134, 135, 136, 137, 138, 146, 147, 148, 149, 150, 151, 152, 153, 154, 162, 163, 164, 165, 166, 167, 168, 169, 170, 178, 179, 180, 181, 182, 183, 184, 185, 186, 194, 195, 196, 197, 198, 199, 200, 201, 202, 210, 211, 212, 213, 214, 215, 216, 217, 218, 225, 226, 227, 228, 229, 230, 231, 232, 233, 234, 241, 242, 243, 244, 245, 246, 247, 248, 249, 250],
            U = [0, 0, 3, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0],
            V = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
            W = [0, 0, 2, 1, 2, 4, 4, 3, 4, 7, 5, 4, 4, 0, 1, 2, 119],
            X = [0, 1, 2, 3, 17, 4, 5, 33, 49, 6, 18, 65, 81, 7, 97, 113, 19, 34, 50, 129, 8, 20, 66, 145, 161, 177, 193, 9, 35, 51, 82, 240, 21, 98, 114, 209, 10, 22, 36, 52, 225, 37, 241, 23, 24, 25, 26, 38, 39, 40, 41, 42, 53, 54, 55, 56, 57, 58, 67, 68, 69, 70, 71, 72, 73, 74, 83, 84, 85, 86, 87, 88, 89, 90, 99, 100, 101, 102, 103, 104, 105, 106, 115, 116, 117, 118, 119, 120, 121, 122, 130, 131, 132, 133, 134, 135, 136, 137, 138, 146, 147, 148, 149, 150, 151, 152, 153, 154, 162, 163, 164, 165, 166, 167, 168, 169, 170, 178, 179, 180, 181, 182, 183, 184, 185, 186, 194, 195, 196, 197, 198, 199, 200, 201, 202, 210, 211, 212, 213, 214, 215, 216, 217, 218, 226, 227, 228, 229, 230, 231, 232, 233, 234, 242, 243, 244, 245, 246, 247, 248, 249, 250];
            this.encode = function (a, b) {
                b && r(b),
                H = new Array,
                I = 0,
                J = 7,
                i(65496),
                k(),
                m(),
                l(a.width, a.height),
                n(),
                o();
                var c = 0,
                d = 0,
                e = 0;
                I = 0,
                J = 7,
                this.encode.displayName = "_encode_";
                for (var f, h, j, q, s, x, y, z, A, D = a.data,
                E = a.width,
                F = a.height,
                G = 4 * E,
                N = 0; F > N;) {
                    for (f = 0; G > f;) {
                        for (s = G * N + f, x = s, y = -1, z = 0, A = 0; 64 > A; A++) z = A >> 3,
                        y = 4 * (7 & A),
                        x = s + z * G + y,
                        N + z >= F && (x -= G * (N + 1 + z - F)),
                        f + y >= G && (x -= f + y - G + 4),
                        h = D[x++],
                        j = D[x++],
                        q = D[x++],
                        K[A] = (O[h] + O[j + 256 >> 0] + O[q + 512 >> 0] >> 16) - 128,
                        L[A] = (O[h + 768 >> 0] + O[j + 1024 >> 0] + O[q + 1280 >> 0] >> 16) - 128,
                        M[A] = (O[h + 1280 >> 0] + O[j + 1536 >> 0] + O[q + 1792 >> 0] >> 16) - 128;
                        c = p(K, B, c, t, v),
                        d = p(L, C, d, u, w),
                        e = p(M, C, e, u, w),
                        f += 32
                    }
                    N += 8
                }
                if (J >= 0) {
                    var P = [];
                    P[1] = J + 1,
                    P[0] = (1 << J + 1) - 1,
                    g(P)
                }
                i(65497);
                var Q = "data:image/jpeg;base64," + btoa(H.join(""));
                return H = [],
                Q
            },
            s()
        }
        return a.encode = function (b, c) {
            var d = new a(c);
            return d.encode(b)
        },
        a
    }),
    b("runtime/html5/androidpatch", ["runtime/html5/util", "runtime/html5/jpegencoder", "base"],
    function (a, b, c) {
        var d, e = a.canvasToDataUrl;
        a.canvasToDataUrl = function (a, f, g) {
            var h, i, j, k, l;
            return c.os.android ? ("image/jpeg" === f && "undefined" == typeof d && (k = e.apply(null, arguments), l = k.split(","), k = ~l[0].indexOf("base64") ? atob(l[1]) : decodeURIComponent(l[1]), k = k.substring(0, 2), d = 255 === k.charCodeAt(0) && 216 === k.charCodeAt(1)), "image/jpeg" !== f || d ? e.apply(null, arguments) : (i = a.width, j = a.height, h = a.getContext("2d"), b.encode(h.getImageData(0, 0, i, j), g))) : e.apply(null, arguments)
        }
    }),
    b("runtime/html5/image", ["base", "runtime/html5/runtime", "runtime/html5/util"],
    function (a, b, c) {
        var d = "data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D";
        return b.register("Image", {
            modified: !1,
            init: function () {
                var a = this,
                b = new Image;
                b.onload = function () {
                    a._info = {
                        type: a.type,
                        width: this.width,
                        height: this.height
                    },
                    a._metas || "image/jpeg" !== a.type ? a.owner.trigger("load") : c.parseMeta(a._blob,
                    function (b, c) {
                        a._metas = c,
                        a.owner.trigger("load")
                    })
                },
                b.onerror = function () {
                    a.owner.trigger("error")
                },
                a._img = b
            },
            loadFromBlob: function (a) {
                var b = this,
                d = b._img;
                b._blob = a,
                b.type = a.type,
                d.src = c.createObjectURL(a.getSource()),
                b.owner.once("load",
                function () {
                    c.revokeObjectURL(d.src)
                })
            },
            resize: function (a, b) {
                var c = this._canvas || (this._canvas = document.createElement("canvas"));
                this._resize(this._img, c, a, b),
                this._blob = null,
                this.modified = !0,
                this.owner.trigger("complete", "resize")
            },
            crop: function (a, b, c, d, e) {
                var f = this._canvas || (this._canvas = document.createElement("canvas")),
                g = this.options,
                h = this._img,
                i = h.naturalWidth,
                j = h.naturalHeight,
                k = this.getOrientation();
                e = e || 1,
                f.width = c,
                f.height = d,
                g.preserveHeaders || this._rotate2Orientaion(f, k),
                this._renderImageToCanvas(f, h, -a, -b, i * e, j * e),
                this._blob = null,
                this.modified = !0,
                this.owner.trigger("complete", "crop")
            },
            getAsBlob: function (a) {
                var b, d = this._blob,
                e = this.options;
                if (a = a || this.type, this.modified || this.type !== a) {
                    if (b = this._canvas, "image/jpeg" === a) {
                        if (d = c.canvasToDataUrl(b, a, e.quality), e.preserveHeaders && this._metas && this._metas.imageHead) return d = c.dataURL2ArrayBuffer(d),
                        d = c.updateImageHead(d, this._metas.imageHead),
                        d = c.arrayBufferToBlob(d, a)
                    } else d = c.canvasToDataUrl(b, a);
                    d = c.dataURL2Blob(d)
                }
                return d
            },
            getAsDataUrl: function (a) {
                var b = this.options;
                return a = a || this.type,
                "image/jpeg" === a ? c.canvasToDataUrl(this._canvas, a, b.quality) : this._canvas.toDataURL(a)
            },
            getOrientation: function () {
                return this._metas && this._metas.exif && this._metas.exif.get("Orientation") || 1
            },
            info: function (a) {
                return a ? (this._info = a, this) : this._info
            },
            meta: function (a) {
                return a ? (this._meta = a, this) : this._meta
            },
            destroy: function () {
                var a = this._canvas;
                this._img.onload = null,
                a && (a.getContext("2d").clearRect(0, 0, a.width, a.height), a.width = a.height = 0, this._canvas = null),
                this._img.src = d,
                this._img = this._blob = null
            },
            _resize: function (a, b, c, d) {
                var e, f, g, h, i, j = this.options,
                k = a.width,
                l = a.height,
                m = this.getOrientation(); ~[5, 6, 7, 8].indexOf(m) && (c ^= d, d ^= c, c ^= d),
                e = Math[j.crop ? "max" : "min"](c / k, d / l),
                j.allowMagnify || (e = Math.min(1, e)),
                f = k * e,
                g = l * e,
                j.crop ? (b.width = c, b.height = d) : (b.width = f, b.height = g),
                h = (b.width - f) / 2,
                i = (b.height - g) / 2,
                j.preserveHeaders || this._rotate2Orientaion(b, m),
                this._renderImageToCanvas(b, a, h, i, f, g)
            },
            _rotate2Orientaion: function (a, b) {
                var c = a.width,
                d = a.height,
                e = a.getContext("2d");
                switch (b) {
                    case 5:
                    case 6:
                    case 7:
                    case 8:
                        a.width = d,
                        a.height = c
                }
                switch (b) {
                    case 2:
                        e.translate(c, 0),
                        e.scale(-1, 1);
                        break;
                    case 3:
                        e.translate(c, d),
                        e.rotate(Math.PI);
                        break;
                    case 4:
                        e.translate(0, d),
                        e.scale(1, -1);
                        break;
                    case 5:
                        e.rotate(.5 * Math.PI),
                        e.scale(1, -1);
                        break;
                    case 6:
                        e.rotate(.5 * Math.PI),
                        e.translate(0, -d);
                        break;
                    case 7:
                        e.rotate(.5 * Math.PI),
                        e.translate(c, -d),
                        e.scale(-1, 1);
                        break;
                    case 8:
                        e.rotate(-.5 * Math.PI),
                        e.translate(-c, 0)
                }
            },
            _renderImageToCanvas: function () {
                function b(a, b, c) {
                    var d, e, f, g = document.createElement("canvas"),
                    h = g.getContext("2d"),
                    i = 0,
                    j = c,
                    k = c;
                    for (g.width = 1, g.height = c, h.drawImage(a, 0, 0), d = h.getImageData(0, 0, 1, c).data; k > i;) e = d[4 * (k - 1) + 3],
                    0 === e ? j = k : i = k,
                    k = j + i >> 1;
                    return f = k / c,
                    0 === f ? 1 : f
                }
                function c(a) {
                    var b, c, d = a.naturalWidth,
                    e = a.naturalHeight;
                    return d * e > 1048576 ? (b = document.createElement("canvas"), b.width = b.height = 1, c = b.getContext("2d"), c.drawImage(a, -d + 1, 0), 0 === c.getImageData(0, 0, 1, 1).data[3]) : !1
                }
                return a.os.ios ? a.os.ios >= 7 ?
                function (a, c, d, e, f, g) {
                    var h = c.naturalWidth,
                    i = c.naturalHeight,
                    j = b(c, h, i);
                    return a.getContext("2d").drawImage(c, 0, 0, h * j, i * j, d, e, f, g)
                } : function (a, d, e, f, g, h) {
                    var i, j, k, l, m, n, o, p = d.naturalWidth,
                    q = d.naturalHeight,
                    r = a.getContext("2d"),
                    s = c(d),
                    t = "image/jpeg" === this.type,
                    u = 1024,
                    v = 0,
                    w = 0;
                    for (s && (p /= 2, q /= 2), r.save(), i = document.createElement("canvas"), i.width = i.height = u, j = i.getContext("2d"), k = t ? b(d, p, q) : 1, l = Math.ceil(u * g / p), m = Math.ceil(u * h / q / k) ; q > v;) {
                        for (n = 0, o = 0; p > n;) j.clearRect(0, 0, u, u),
                        j.drawImage(d, -n, -v),
                        r.drawImage(i, 0, 0, u, u, e + o, f + w, l, m),
                        n += u,
                        o += l;
                        v += u,
                        w += m
                    }
                    r.restore(),
                    i = j = null
                } : function (b) {
                    var c = a.slice(arguments, 1),
                    d = b.getContext("2d");
                    d.drawImage.apply(d, c)
                }
            }()
        })
    }),
    b("runtime/html5/transport", ["base", "runtime/html5/runtime"],
    function (a, b) {
        var c = a.noop,
        d = a.$;
        return b.register("Transport", {
            init: function () {
                this._status = 0,
                this._response = null
            },
            send: function () {
                var b, c, e, f = this.owner,
                g = this.options,
                h = this._initAjax(),
                i = f._blob,
                j = g.server;
                g.sendAsBinary ? (j += (/\?/.test(j) ? "&" : "?") + d.param(f._formData), c = i.getSource()) : (b = new FormData, d.each(f._formData,
                function (a, c) {
                    b.append(a, c)
                }), b.append(g.fileVal, i.getSource(), g.filename || f._formData.name || "")),
                g.withCredentials && "withCredentials" in h ? (h.open(g.method, j, !0), h.withCredentials = !0) : h.open(g.method, j),
                this._setRequestHeader(h, g.headers),
                c ? (h.overrideMimeType && h.overrideMimeType("application/octet-stream"), a.os.android ? (e = new FileReader, e.onload = function () {
                    h.send(this.result),
                    e = e.onload = null
                },
                e.readAsArrayBuffer(c)) : h.send(c)) : h.send(b)
            },
            getResponse: function () {
                return this._response
            },
            getResponseAsJson: function () {
                return this._parseJson(this._response)
            },
            getStatus: function () {
                return this._status
            },
            abort: function () {
                var a = this._xhr;
                a && (a.upload.onprogress = c, a.onreadystatechange = c, a.abort(), this._xhr = a = null)
            },
            destroy: function () {
                this.abort()
            },
            _initAjax: function () {
                var a = this,
                b = new XMLHttpRequest,
                d = this.options;
                return !d.withCredentials || "withCredentials" in b || "undefined" == typeof XDomainRequest || (b = new XDomainRequest),
                b.upload.onprogress = function (b) {
                    var c = 0;
                    return b.lengthComputable && (c = b.loaded / b.total),
                    a.trigger("progress", c)
                },
                b.onreadystatechange = function () {
                    return 4 === b.readyState ? (b.upload.onprogress = c, b.onreadystatechange = c, a._xhr = null, a._status = b.status, b.status >= 200 && b.status < 300 ? (a._response = b.responseText, a.trigger("load")) : b.status >= 500 && b.status < 600 ? (a._response = b.responseText, a.trigger("error", "server")) : a.trigger("error", a._status ? "http" : "abort")) : void 0
                },
                a._xhr = b,
                b
            },
            _setRequestHeader: function (a, b) {
                d.each(b,
                function (b, c) {
                    a.setRequestHeader(b, c)
                })
            },
            _parseJson: function (a) {
                var b;
                try {
                    b = JSON.parse(a)
                } catch (c) {
                    b = {}
                }
                return b
            }
        })
    }),
    b("runtime/html5/md5", ["runtime/html5/runtime"],
    function (a) {
        var b = function (a, b) {
            return a + b & 4294967295
        },
        c = function (a, c, d, e, f, g) {
            return c = b(b(c, a), b(e, g)),
            b(c << f | c >>> 32 - f, d)
        },
        d = function (a, b, d, e, f, g, h) {
            return c(b & d | ~b & e, a, b, f, g, h)
        },
        e = function (a, b, d, e, f, g, h) {
            return c(b & e | d & ~e, a, b, f, g, h)
        },
        f = function (a, b, d, e, f, g, h) {
            return c(b ^ d ^ e, a, b, f, g, h)
        },
        g = function (a, b, d, e, f, g, h) {
            return c(d ^ (b | ~e), a, b, f, g, h)
        },
        h = function (a, c) {
            var h = a[0],
            i = a[1],
            j = a[2],
            k = a[3];
            h = d(h, i, j, k, c[0], 7, -680876936),
            k = d(k, h, i, j, c[1], 12, -389564586),
            j = d(j, k, h, i, c[2], 17, 606105819),
            i = d(i, j, k, h, c[3], 22, -1044525330),
            h = d(h, i, j, k, c[4], 7, -176418897),
            k = d(k, h, i, j, c[5], 12, 1200080426),
            j = d(j, k, h, i, c[6], 17, -1473231341),
            i = d(i, j, k, h, c[7], 22, -45705983),
            h = d(h, i, j, k, c[8], 7, 1770035416),
            k = d(k, h, i, j, c[9], 12, -1958414417),
            j = d(j, k, h, i, c[10], 17, -42063),
            i = d(i, j, k, h, c[11], 22, -1990404162),
            h = d(h, i, j, k, c[12], 7, 1804603682),
            k = d(k, h, i, j, c[13], 12, -40341101),
            j = d(j, k, h, i, c[14], 17, -1502002290),
            i = d(i, j, k, h, c[15], 22, 1236535329),
            h = e(h, i, j, k, c[1], 5, -165796510),
            k = e(k, h, i, j, c[6], 9, -1069501632),
            j = e(j, k, h, i, c[11], 14, 643717713),
            i = e(i, j, k, h, c[0], 20, -373897302),
            h = e(h, i, j, k, c[5], 5, -701558691),
            k = e(k, h, i, j, c[10], 9, 38016083),
            j = e(j, k, h, i, c[15], 14, -660478335),
            i = e(i, j, k, h, c[4], 20, -405537848),
            h = e(h, i, j, k, c[9], 5, 568446438),
            k = e(k, h, i, j, c[14], 9, -1019803690),
            j = e(j, k, h, i, c[3], 14, -187363961),
            i = e(i, j, k, h, c[8], 20, 1163531501),
            h = e(h, i, j, k, c[13], 5, -1444681467),
            k = e(k, h, i, j, c[2], 9, -51403784),
            j = e(j, k, h, i, c[7], 14, 1735328473),
            i = e(i, j, k, h, c[12], 20, -1926607734),
            h = f(h, i, j, k, c[5], 4, -378558),
            k = f(k, h, i, j, c[8], 11, -2022574463),
            j = f(j, k, h, i, c[11], 16, 1839030562),
            i = f(i, j, k, h, c[14], 23, -35309556),
            h = f(h, i, j, k, c[1], 4, -1530992060),
            k = f(k, h, i, j, c[4], 11, 1272893353),
            j = f(j, k, h, i, c[7], 16, -155497632),
            i = f(i, j, k, h, c[10], 23, -1094730640),
            h = f(h, i, j, k, c[13], 4, 681279174),
            k = f(k, h, i, j, c[0], 11, -358537222),
            j = f(j, k, h, i, c[3], 16, -722521979),
            i = f(i, j, k, h, c[6], 23, 76029189),
            h = f(h, i, j, k, c[9], 4, -640364487),
            k = f(k, h, i, j, c[12], 11, -421815835),
            j = f(j, k, h, i, c[15], 16, 530742520),
            i = f(i, j, k, h, c[2], 23, -995338651),
            h = g(h, i, j, k, c[0], 6, -198630844),
            k = g(k, h, i, j, c[7], 10, 1126891415),
            j = g(j, k, h, i, c[14], 15, -1416354905),
            i = g(i, j, k, h, c[5], 21, -57434055),
            h = g(h, i, j, k, c[12], 6, 1700485571),
            k = g(k, h, i, j, c[3], 10, -1894986606),
            j = g(j, k, h, i, c[10], 15, -1051523),
            i = g(i, j, k, h, c[1], 21, -2054922799),
            h = g(h, i, j, k, c[8], 6, 1873313359),
            k = g(k, h, i, j, c[15], 10, -30611744),
            j = g(j, k, h, i, c[6], 15, -1560198380),
            i = g(i, j, k, h, c[13], 21, 1309151649),
            h = g(h, i, j, k, c[4], 6, -145523070),
            k = g(k, h, i, j, c[11], 10, -1120210379),
            j = g(j, k, h, i, c[2], 15, 718787259),
            i = g(i, j, k, h, c[9], 21, -343485551),
            a[0] = b(h, a[0]),
            a[1] = b(i, a[1]),
            a[2] = b(j, a[2]),
            a[3] = b(k, a[3])
        },
        i = function (a) {
            var b, c = [];
            for (b = 0; 64 > b; b += 4) c[b >> 2] = a.charCodeAt(b) + (a.charCodeAt(b + 1) << 8) + (a.charCodeAt(b + 2) << 16) + (a.charCodeAt(b + 3) << 24);
            return c
        },
        j = function (a) {
            var b, c = [];
            for (b = 0; 64 > b; b += 4) c[b >> 2] = a[b] + (a[b + 1] << 8) + (a[b + 2] << 16) + (a[b + 3] << 24);
            return c
        },
        k = function (a) {
            var b, c, d, e, f, g, j = a.length,
            k = [1732584193, -271733879, -1732584194, 271733878];
            for (b = 64; j >= b; b += 64) h(k, i(a.substring(b - 64, b)));
            for (a = a.substring(b - 64), c = a.length, d = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], b = 0; c > b; b += 1) d[b >> 2] |= a.charCodeAt(b) << (b % 4 << 3);
            if (d[b >> 2] |= 128 << (b % 4 << 3), b > 55) for (h(k, d), b = 0; 16 > b; b += 1) d[b] = 0;
            return e = 8 * j,
            e = e.toString(16).match(/(.*?)(.{0,8})$/),
            f = parseInt(e[2], 16),
            g = parseInt(e[1], 16) || 0,
            d[14] = f,
            d[15] = g,
            h(k, d),
            k
        },
        l = function (a) {
            var b, c, d, e, f, g, i = a.length,
            k = [1732584193, -271733879, -1732584194, 271733878];
            for (b = 64; i >= b; b += 64) h(k, j(a.subarray(b - 64, b)));
            for (a = i > b - 64 ? a.subarray(b - 64) : new Uint8Array(0), c = a.length, d = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], b = 0; c > b; b += 1) d[b >> 2] |= a[b] << (b % 4 << 3);
            if (d[b >> 2] |= 128 << (b % 4 << 3), b > 55) for (h(k, d), b = 0; 16 > b; b += 1) d[b] = 0;
            return e = 8 * i,
            e = e.toString(16).match(/(.*?)(.{0,8})$/),
            f = parseInt(e[2], 16),
            g = parseInt(e[1], 16) || 0,
            d[14] = f,
            d[15] = g,
            h(k, d),
            k
        },
        m = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "a", "b", "c", "d", "e", "f"],
        n = function (a) {
            var b, c = "";
            for (b = 0; 4 > b; b += 1) c += m[a >> 8 * b + 4 & 15] + m[a >> 8 * b & 15];
            return c
        },
        o = function (a) {
            var b;
            for (b = 0; b < a.length; b += 1) a[b] = n(a[b]);
            return a.join("")
        },
        p = function (a) {
            return o(k(a))
        },
        q = function () {
            this.reset()
        };
        return "5d41402abc4b2a76b9719d911017c592" !== p("hello") && (b = function (a, b) {
            var c = (65535 & a) + (65535 & b),
            d = (a >> 16) + (b >> 16) + (c >> 16);
            return d << 16 | 65535 & c
        }),
        q.prototype.append = function (a) {
            return /[\u0080-\uFFFF]/.test(a) && (a = unescape(encodeURIComponent(a))),
            this.appendBinary(a),
            this
        },
        q.prototype.appendBinary = function (a) {
            this._buff += a,
            this._length += a.length;
            var b, c = this._buff.length;
            for (b = 64; c >= b; b += 64) h(this._state, i(this._buff.substring(b - 64, b)));
            return this._buff = this._buff.substr(b - 64),
            this
        },
        q.prototype.end = function (a) {
            var b, c, d = this._buff,
            e = d.length,
            f = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
            for (b = 0; e > b; b += 1) f[b >> 2] |= d.charCodeAt(b) << (b % 4 << 3);
            return this._finish(f, e),
            c = a ? this._state : o(this._state),
            this.reset(),
            c
        },
        q.prototype._finish = function (a, b) {
            var c, d, e, f = b;
            if (a[f >> 2] |= 128 << (f % 4 << 3), f > 55) for (h(this._state, a), f = 0; 16 > f; f += 1) a[f] = 0;
            c = 8 * this._length,
            c = c.toString(16).match(/(.*?)(.{0,8})$/),
            d = parseInt(c[2], 16),
            e = parseInt(c[1], 16) || 0,
            a[14] = d,
            a[15] = e,
            h(this._state, a)
        },
        q.prototype.reset = function () {
            return this._buff = "",
            this._length = 0,
            this._state = [1732584193, -271733879, -1732584194, 271733878],
            this
        },
        q.prototype.destroy = function () {
            delete this._state,
            delete this._buff,
            delete this._length
        },
        q.hash = function (a, b) {
            / [\u0080 - \uFFFF] /.test(a) && (a = unescape(encodeURIComponent(a)));
            var c = k(a);
            return b ? c : o(c)
        },
        q.hashBinary = function (a, b) {
            var c = k(a);
            return b ? c : o(c)
        },
        q.ArrayBuffer = function () {
            this.reset()
        },
        q.ArrayBuffer.prototype.append = function (a) {
            var b, c = this._concatArrayBuffer(this._buff, a),
            d = c.length;
            for (this._length += a.byteLength, b = 64; d >= b; b += 64) h(this._state, j(c.subarray(b - 64, b)));
            return this._buff = d > b - 64 ? c.subarray(b - 64) : new Uint8Array(0),
            this
        },
        q.ArrayBuffer.prototype.end = function (a) {
            var b, c, d = this._buff,
            e = d.length,
            f = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
            for (b = 0; e > b; b += 1) f[b >> 2] |= d[b] << (b % 4 << 3);
            return this._finish(f, e),
            c = a ? this._state : o(this._state),
            this.reset(),
            c
        },
        q.ArrayBuffer.prototype._finish = q.prototype._finish,
        q.ArrayBuffer.prototype.reset = function () {
            return this._buff = new Uint8Array(0),
            this._length = 0,
            this._state = [1732584193, -271733879, -1732584194, 271733878],
            this
        },
        q.ArrayBuffer.prototype.destroy = q.prototype.destroy,
        q.ArrayBuffer.prototype._concatArrayBuffer = function (a, b) {
            var c = a.length,
            d = new Uint8Array(c + b.byteLength);
            return d.set(a),
            d.set(new Uint8Array(b), c),
            d
        },
        q.ArrayBuffer.hash = function (a, b) {
            var c = l(new Uint8Array(a));
            return b ? c : o(c)
        },
        a.register("Md5", {
            init: function () { },
            loadFromBlob: function (a) {
                var b, c, d = a.getSource(),
                e = 2097152,
                f = Math.ceil(d.size / e),
                g = 0,
                h = this.owner,
                i = new q.ArrayBuffer,
                j = this,
                k = d.mozSlice || d.webkitSlice || d.slice;
                c = new FileReader,
                (b = function () {
                    var l, m;
                    l = g * e,
                    m = Math.min(l + e, d.size),
                    c.onload = function (b) {
                        i.append(b.target.result),
                        h.trigger("progress", {
                            total: a.size,
                            loaded: m
                        })
                    },
                    c.onloadend = function () {
                        c.onloadend = c.onload = null,
                        ++g < f ? setTimeout(b, 1) : setTimeout(function () {
                            h.trigger("load"),
                            j.result = i.end(),
                            b = a = d = i = null,
                            h.trigger("complete")
                        },
                        50)
                    },
                    c.readAsArrayBuffer(k.call(d, l, m))
                })()
            },
            getResult: function () {
                return this.result
            }
        })
    }),
    b("runtime/flash/runtime", ["base", "runtime/runtime", "runtime/compbase"],
    function (b, c, d) {
        function e() {
            var a;
            try {
                a = navigator.plugins["Shockwave Flash"],
                a = a.description
            } catch (b) {
                try {
                    a = new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")
                } catch (c) {
                    a = "0.0"
                }
            }
            return a = a.match(/\d+/g),
            parseFloat(a[0] + "." + a[1], 10)
        }
        function f() {
            function d(a, b) {
                var c, d, e = a.type || a;
                c = e.split("::"),
                d = c[0],
                e = c[1],
                "Ready" === e && d === j.uid ? j.trigger("ready") : f[d] && f[d].trigger(e.toLowerCase(), a, b)
            }
            var e = {},
            f = {},
            g = this.destroy,
            j = this,
            k = b.guid("webuploader_");
            c.apply(j, arguments),
            j.type = h,
            j.exec = function (a, c) {
                var d, g = this,
                h = g.uid,
                k = b.slice(arguments, 2);
                return f[h] = g,
                i[a] && (e[h] || (e[h] = new i[a](g, j)), d = e[h], d[c]) ? d[c].apply(d, k) : j.flashExec.apply(g, arguments)
            },
            a[k] = function () {
                var a = arguments;
                setTimeout(function () {
                    d.apply(null, a)
                },
                1)
            },
            this.jsreciver = k,
            this.destroy = function () {
                return g && g.apply(this, arguments)
            },
            this.flashExec = function (a, c) {
                var d = j.getFlash(),
                e = b.slice(arguments, 2);
                return d.exec(this.uid, a, c, e)
            }
        }
        var g = b.$,
        h = "flash",
        i = {};
        return b.inherits(c, {
            constructor: f,
            init: function () {
                var a, c = this.getContainer(),
                d = this.options;
                c.css({
                    position: "absolute",
                    top: "-8px",
                    left: "-8px",
                    width: "9px",
                    height: "9px",
                    overflow: "hidden"
                }),
                a = '<object id="' + this.uid + '" type="application/x-shockwave-flash" data="' + d.swf + '" ',
                b.browser.ie && (a += 'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),
                a += 'width="100%" height="100%" style="outline:0"><param name="movie" value="' + d.swf + '" /><param name="flashvars" value="uid=' + this.uid + "&jsreciver=" + this.jsreciver + '" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>',
                c.html(a)
            },
            getFlash: function () {
                return this._flash ? this._flash : (this._flash = g("#" + this.uid).get(0), this._flash)
            }
        }),
        f.register = function (a, c) {
            return c = i[a] = b.inherits(d, g.extend({
                flashExec: function () {
                    var a = this.owner,
                    b = this.getRuntime();
                    return b.flashExec.apply(a, arguments)
                }
            },
            c))
        },
        e() >= 11.4 && c.addRuntime(h, f),
        f
    }),
    b("runtime/flash/filepicker", ["base", "runtime/flash/runtime"],
    function (a, b) {
        var c = a.$;
        return b.register("FilePicker", {
            init: function (a) {
                var b, d, e = c.extend({},
                a);
                for (b = e.accept && e.accept.length, d = 0; b > d; d++) e.accept[d].title || (e.accept[d].title = "Files");
                delete e.button,
                delete e.id,
                delete e.container,
                this.flashExec("FilePicker", "init", e)
            },
            destroy: function () {
                this.flashExec("FilePicker", "destroy")
            }
        })
    }),
    b("runtime/flash/image", ["runtime/flash/runtime"],
    function (a) {
        return a.register("Image", {
            loadFromBlob: function (a) {
                var b = this.owner;
                b.info() && this.flashExec("Image", "info", b.info()),
                b.meta() && this.flashExec("Image", "meta", b.meta()),
                this.flashExec("Image", "loadFromBlob", a.uid)
            }
        })
    }),
    b("runtime/flash/transport", ["base", "runtime/flash/runtime", "runtime/client"],
    function (b, c, d) {
        var e = b.$;
        return c.register("Transport", {
            init: function () {
                this._status = 0,
                this._response = null,
                this._responseJson = null
            },
            send: function () {
                var a, b = this.owner,
                c = this.options,
                d = this._initAjax(),
                f = b._blob,
                g = c.server;
                d.connectRuntime(f.ruid),
                c.sendAsBinary ? (g += (/\?/.test(g) ? "&" : "?") + e.param(b._formData), a = f.uid) : (e.each(b._formData,
                function (a, b) {
                    d.exec("append", a, b)
                }), d.exec("appendBlob", c.fileVal, f.uid, c.filename || b._formData.name || "")),
                this._setRequestHeader(d, c.headers),
                d.exec("send", {
                    method: c.method,
                    url: g,
                    forceURLStream: c.forceURLStream,
                    mimeType: "application/octet-stream"
                },
                a)
            },
            getStatus: function () {
                return this._status
            },
            getResponse: function () {
                return this._response || ""
            },
            getResponseAsJson: function () {
                return this._responseJson
            },
            abort: function () {
                var a = this._xhr;
                a && (a.exec("abort"), a.destroy(), this._xhr = a = null)
            },
            destroy: function () {
                this.abort()
            },
            _initAjax: function () {
                var b = this,
                c = new d("XMLHttpRequest");
                return c.on("uploadprogress progress",
                function (a) {
                    var c = a.loaded / a.total;
                    return c = Math.min(1, Math.max(0, c)),
                    b.trigger("progress", c)
                }),
                c.on("load",
                function () {
                    var d, e = c.exec("getStatus"),
                    f = !1,
                    g = "";
                    return c.off(),
                    b._xhr = null,
                    e >= 200 && 300 > e ? f = !0 : e >= 500 && 600 > e ? (f = !0, g = "server") : g = "http",
                    f && (b._response = c.exec("getResponse"), b._response = decodeURIComponent(b._response), d = a.JSON && a.JSON.parse ||
                    function (a) {
                        try {
                            return new Function("return " + a).call()
                        } catch (b) {
                            return {}
                        }
                    },
                    b._responseJson = b._response ? d(b._response) : {}),
                    c.destroy(),
                    c = null,
                    g ? b.trigger("error", g) : b.trigger("load")
                }),
                c.on("error",
                function () {
                    c.off(),
                    b._xhr = null,
                    b.trigger("error", "http")
                }),
                b._xhr = c,
                c
            },
            _setRequestHeader: function (a, b) {
                e.each(b,
                function (b, c) {
                    a.exec("setRequestHeader", b, c)
                })
            }
        })
    }),
    b("runtime/flash/blob", ["runtime/flash/runtime", "lib/blob"],
    function (a, b) {
        return a.register("Blob", {
            slice: function (a, c) {
                var d = this.flashExec("Blob", "slice", a, c);
                return new b(d.uid, d)
            }
        })
    }),
    b("runtime/flash/md5", ["runtime/flash/runtime"],
    function (a) {
        return a.register("Md5", {
            init: function () { },
            loadFromBlob: function (a) {
                return this.flashExec("Md5", "loadFromBlob", a.uid)
            }
        })
    }),
    b("preset/all", ["base", "widgets/filednd", "widgets/filepaste", "widgets/filepicker", "widgets/image", "widgets/queue", "widgets/runtime", "widgets/upload", "widgets/validator", "widgets/md5", "runtime/html5/blob", "runtime/html5/dnd", "runtime/html5/filepaste", "runtime/html5/filepicker", "runtime/html5/imagemeta/exif", "runtime/html5/androidpatch", "runtime/html5/image", "runtime/html5/transport", "runtime/html5/md5", "runtime/flash/filepicker", "runtime/flash/image", "runtime/flash/transport", "runtime/flash/blob", "runtime/flash/md5"],
    function (a) {
        return a
    }),
    b("widgets/log", ["base", "uploader", "widgets/widget"],
    function (a, b) {
        function c(a) {
            var b = e.extend({},
            d, a),
            c = f.replace(/^(.*)\?/, "$1" + e.param(b)),
            g = new Image;
            g.src = c
        }
        var d, e = a.$,
        f = " http://static.tieba.baidu.com/tb/pms/img/st.gif??",
        g = (location.hostname || location.host || "protected").toLowerCase(),
        h = g && /baidu/i.exec(g);
        if (h) return d = {
            dv: 3,
            master: "webuploader",
            online: /test/.exec(g) ? 0 : 1,
            module: "",
            product: g,
            type: 0
        },
        b.register({
            name: "log",
            init: function () {
                var a = this.owner,
                b = 0,
                d = 0;
                a.on("error",
                function (a) {
                    c({
                        type: 2,
                        c_error_code: a
                    })
                }).on("uploadError",
                function (a, b) {
                    c({
                        type: 2,
                        c_error_code: "UPLOAD_ERROR",
                        c_reason: "" + b
                    })
                }).on("uploadComplete",
                function (a) {
                    b++,
                    d += a.size
                }).on("uploadFinished",
                function () {
                    c({
                        c_count: b,
                        c_size: d
                    }),
                    b = d = 0
                }),
                c({
                    c_usage: 1
                })
            }
        })
    }),
    b("webuploader", ["preset/all", "widgets/log"],
    function (a) {
        return a
    }),
    c("webuploader")
});
!function (a, b, c) { var d, e, f, g, h, i, j, k, l, m, n, o, p; a.noop = a.noop || function () { }, h = 0, i = a(b), j = a(document), k = a("html"), l = document.documentElement, m = b.VBArray && !b.XMLHttpRequest, n = "createTouch" in document && !("onmousemove" in l) || /(iPhone|iPad|iPod)/i.test(navigator.userAgent), o = "artDialog" + +new Date, p = function (b, e, f) { var g, i, j, k; b = b || {}, ("string" == typeof b || 1 === b.nodeType) && (b = { content: b, fixed: !n }), i = p.defaults, j = b.follow = 1 === this.nodeType && this || b.follow; for (k in i) b[k] === c && (b[k] = i[k]); return a.each({ ok: "yesFn", cancel: "noFn", close: "closeFn", init: "initFn", okVal: "yesText", cancelVal: "noText" }, function (a, d) { b[a] = b[a] !== c ? b[a] : b[d] }), "string" == typeof j && (j = a(j)[0]), b.id = j && j[o + "follow"] || b.id || o + h, g = p.list[b.id], j && g ? g.follow(j).zIndex().focus() : g ? g.zIndex().focus() : (n && (b.fixed = !1), a.isArray(b.button) || (b.button = b.button ? [b.button] : []), e !== c && (b.ok = e), f !== c && (b.cancel = f), b.ok && b.button.push({ name: b.okVal, callback: b.ok, focus: !0 }), b.cancel && b.button.push({ name: b.cancelVal, callback: b.cancel }), p.defaults.zIndex = b.zIndex, h++ , p.list[b.id] = d ? d._init(b) : new p.fn._init(b)) }, p.fn = p.prototype = { version: "4.1.7", closed: !0, _init: function (a) { var c, e = this, f = a.icon, g = f && (m ? { png: "icons/" + f + ".png" } : { backgroundImage: "url('" + a.path + "/skins/icons/" + f + ".png')" }); return e.closed = !1, e.config = a, e.DOM = c = e.DOM || e._getDOM(), c.wrap.addClass(a.skin), c.close[a.cancel === !1 ? "hide" : "show"](), c.icon[0].style.display = f ? "" : "none", c.iconBg.css(g || { background: "none" }), c.se.css("cursor", a.resize ? "se-resize" : "auto"), c.title.css("cursor", a.drag ? "move" : "auto"), c.content.css("padding", a.padding), e[a.show ? "show" : "hide"](!0), e.button(a.button).title(a.title).content(a.content, !0).size(a.width, a.height).time(a.time), a.follow ? e.follow(a.follow) : e.position(a.left, a.top), e.zIndex().focus(), a.lock && e.lock(), e._addEvent(), e._ie6PngFix(), d = null, a.init && a.init.call(e, b), e }, content: function (a) { var b, d, e, f, g = this, h = g.DOM, i = h.wrap[0], j = i.offsetWidth, k = i.offsetHeight, l = parseInt(i.style.left), m = parseInt(i.style.top), n = i.style.width, o = h.content, p = o[0]; return g._elemBack && g._elemBack(), i.style.width = "auto", a === c ? p : ("string" == typeof a ? o.html(a) : a && 1 === a.nodeType && (f = a.style.display, b = a.previousSibling, d = a.nextSibling, e = a.parentNode, g._elemBack = function () { b && b.parentNode ? b.parentNode.insertBefore(a, b.nextSibling) : d && d.parentNode ? d.parentNode.insertBefore(a, d) : e && e.appendChild(a), a.style.display = f, g._elemBack = null }, o.html(""), p.appendChild(a), a.style.display = "block"), arguments[1] || (g.config.follow ? g.follow(g.config.follow) : (j = i.offsetWidth - j, k = i.offsetHeight - k, l -= j / 2, m -= k / 2, i.style.left = Math.max(l, 0) + "px", i.style.top = Math.max(m, 0) + "px"), n && "auto" !== n && (i.style.width = i.offsetWidth + "px"), g._autoPositionType()), g._ie6SelectFix(), g._runScript(p), g) }, title: function (a) { var b = this.DOM, d = b.wrap, e = b.title, f = "aui_state_noTitle"; return a === c ? e[0] : (a === !1 ? (e.hide().html(""), d.addClass(f)) : (e.show().html(a || ""), d.removeClass(f)), this) }, position: function (a, b) { var d = this, e = d.config, f = d.DOM.wrap[0], g = m ? !1 : e.fixed, h = m && d.config.fixed, k = j.scrollLeft(), l = j.scrollTop(), n = g ? 0 : k, o = g ? 0 : l, p = i.width(), q = i.height(), r = f.offsetWidth, s = f.offsetHeight, t = f.style; return (a || 0 === a) && (d._left = -1 !== a.toString().indexOf("%") ? a : null, a = d._toNumber(a, p - r), "number" == typeof a ? (a = h ? a += k : a + n, t.left = Math.max(a, n) + "px") : "string" == typeof a && (t.left = a)), (b || 0 === b) && (d._top = -1 !== b.toString().indexOf("%") ? b : null, b = d._toNumber(b, q - s), "number" == typeof b ? (b = h ? b += l : b + o, t.top = Math.max(b, o) + "px") : "string" == typeof b && (t.top = b)), a !== c && b !== c && (d._follow = null, d._autoPositionType()), d }, size: function (a, b) { var c, d, e, f, g = this, h = (g.config, g.DOM), j = h.wrap, k = h.main, l = j[0].style, m = k[0].style; return a && (g._width = -1 !== a.toString().indexOf("%") ? a : null, c = i.width() - j[0].offsetWidth + k[0].offsetWidth, e = g._toNumber(a, c), a = e, "number" == typeof a ? (l.width = "auto", m.width = Math.max(g.config.minWidth, a) + "px", l.width = j[0].offsetWidth + "px") : "string" == typeof a && (m.width = a, "auto" === a && j.css("width", "auto"))), b && (g._height = -1 !== b.toString().indexOf("%") ? b : null, d = i.height() - j[0].offsetHeight + k[0].offsetHeight, f = g._toNumber(b, d), b = f, "number" == typeof b ? m.height = Math.max(g.config.minHeight, b) + "px" : "string" == typeof b && (m.height = b)), g._ie6SelectFix(), g }, follow: function (b) { var c, d, e, f, g, h, k, l, n, p, q, r, s, t, u, v, w, x, y, z, A = this, B = A.config; return ("string" == typeof b || b && 1 === b.nodeType) && (c = a(b), b = c[0]), b && (b.offsetWidth || b.offsetHeight) ? (d = o + "follow", e = i.width(), f = i.height(), g = j.scrollLeft(), h = j.scrollTop(), k = c.offset(), l = b.offsetWidth, n = b.offsetHeight, p = m ? !1 : B.fixed, q = p ? k.left - g : k.left, r = p ? k.top - h : k.top, s = A.DOM.wrap[0], t = s.style, u = s.offsetWidth, v = s.offsetHeight, w = q - (u - l) / 2, x = r + n, y = p ? 0 : g, z = p ? 0 : h, w = y > w ? q : w + u > e && q - u > y ? q - u + l : w, x = x + v > f + z && r - v > z ? r - v : x, t.left = w + "px", t.top = x + "px", A._follow && A._follow.removeAttribute(d), A._follow = b, b[d] = B.id, A._autoPositionType(), A) : A.position(A._left, A._top) }, button: function () { var b = this, d = arguments, e = b.DOM, f = e.buttons, g = f[0], h = "aui_state_highlight", i = b._listeners = b._listeners || {}, j = a.isArray(d[0]) ? d[0] : [].slice.call(d); return d[0] === c ? g : (a.each(j, function (c, d) { var e = d.name, f = !i[e], j = f ? document.createElement("button") : i[e].elem; i[e] || (i[e] = {}), d.callback && (i[e].callback = d.callback), d.className && (j.className = d.className), d.focus && (b._focus && b._focus.removeClass(h), b._focus = a(j).addClass(h), b.focus()), j.setAttribute("type", "button"), j[o + "callback"] = e, j.disabled = !!d.disabled, f && (j.innerHTML = e, i[e].elem = j, g.appendChild(j)) }), f[0].style.display = j.length ? "" : "none", b._ie6SelectFix(), b) }, show: function () { return this.DOM.wrap.show(), !arguments[0] && this._lockMaskWrap && this._lockMaskWrap.show(), this }, hide: function () { return this.DOM.wrap.hide(), !arguments[0] && this._lockMaskWrap && this._lockMaskWrap.hide(), this }, close: function () { var a, c, e, f, g, h, i; if (this.closed) return this; if (a = this, c = a.DOM, e = c.wrap, f = p.list, g = a.config.close, h = a.config.follow, a.time(), "function" == typeof g && g.call(a, b) === !1) return a; a.unlock(), a._elemBack && a._elemBack(), e[0].className = e[0].style.cssText = "", c.title.html(""), c.content.html(""), c.buttons.html(""), p.focus === a && (p.focus = null), h && h.removeAttribute(o + "follow"), delete f[a.config.id], a._removeEvent(), a.hide(!0)._setAbsolute(); for (i in a) a.hasOwnProperty(i) && "DOM" !== i && delete a[i]; return d ? e.remove() : d = a, a }, time: function (a) { var b = this, c = b.config.cancelVal, d = b._timer; return d && clearTimeout(d), a && (b._timer = setTimeout(function () { b._click(c) }, 1e3 * a)), b }, focus: function () { try { if (this.config.focus) { var a = this._focus && this._focus[0] || this.DOM.close[0]; a && a.focus() } } catch (b) { } return this }, zIndex: function () { var a = this, b = a.DOM, c = b.wrap, d = p.focus, e = p.defaults.zIndex++; return c.css("zIndex", e), a._lockMask && a._lockMask.css("zIndex", e - 1), d && d.DOM.wrap.removeClass("aui_state_focus"), p.focus = a, c.addClass("aui_state_focus"), a }, lock: function () { if (this._lock) return this; var b = this, c = p.defaults.zIndex - 1, d = b.DOM.wrap, e = b.config, f = j.width(), g = j.height(), h = b._lockMaskWrap || a(document.body.appendChild(document.createElement("div"))), i = b._lockMask || a(h[0].appendChild(document.createElement("div"))), k = "(document).documentElement", l = n ? "width:" + f + "px;height:" + g + "px" : "width:100%;height:100%", o = m ? "position:absolute;left:expression(" + k + ".scrollLeft);top:expression(" + k + ".scrollTop);width:expression(" + k + ".clientWidth);height:expression(" + k + ".clientHeight)" : ""; return b.zIndex(), d.addClass("aui_state_lock"), h[0].style.cssText = l + ";position:fixed;z-index:" + c + ";top:0;left:0;overflow:hidden;" + o, i[0].style.cssText = "height:100%;background:" + e.background + ";filter:alpha(opacity=0);opacity:0", m && i.html('<iframe src="about:blank" style="width:100%;height:100%;position:absolute;top:0;left:0;z-index:-1;filter:alpha(opacity=0)"></iframe>'), i.stop(), i.bind("click", function () { b._reset() }).bind("dblclick", function () { b._click(b.config.cancelVal) }), 0 === e.duration ? i.css({ opacity: e.opacity }) : i.animate({ opacity: e.opacity }, e.duration), b._lockMaskWrap = h, b._lockMask = i, b._lock = !0, b }, unlock: function () { var a, b, c = this, e = c._lockMaskWrap, f = c._lockMask; return c._lock ? (a = e[0].style, b = function () { m && (a.removeExpression("width"), a.removeExpression("height"), a.removeExpression("left"), a.removeExpression("top")), a.cssText = "display:none", d && e.remove() }, f.stop().unbind(), c.DOM.wrap.removeClass("aui_state_lock"), c.config.duration ? f.animate({ opacity: 0 }, c.config.duration, b) : b(), c._lock = !1, c) : c }, _getDOM: function () { var b, c, d, e, f, g = document.createElement("div"), h = document.body; for (g.style.cssText = "position:absolute;left:0;top:0", g.innerHTML = p._templates, h.insertBefore(g, h.firstChild), c = 0, d = { wrap: a(g) }, e = g.getElementsByTagName("*"), f = e.length; f > c; c++)b = e[c].className.split("aui_")[1], b && (d[b] = a(e[c])); return d }, _toNumber: function (a, b) { if (!a && 0 !== a || "number" == typeof a) return a; var c = a.length - 1; return a.lastIndexOf("px") === c ? a = parseInt(a) : a.lastIndexOf("%") === c && (a = parseInt(b * a.split("%")[0] / 100)), a }, _ie6PngFix: m ? function () { for (var a, b, c, d, e = 0, f = p.defaults.path + "/skins/", g = this.DOM.wrap[0].getElementsByTagName("*"); e < g.length; e++)a = g[e], b = a.currentStyle["png"], b && (c = f + b, d = a.runtimeStyle, d.backgroundImage = "none", d.filter = "progid:DXImageTransform.Microsoft.AlphaImageLoader(src='" + c + "',sizingMethod='crop')") } : a.noop, _ie6SelectFix: m ? function () { var a = this.DOM.wrap, b = a[0], c = o + "iframeMask", d = a[c], e = b.offsetWidth, f = b.offsetHeight; e += "px", f += "px", d ? (d.style.width = e, d.style.height = f) : (d = b.appendChild(document.createElement("iframe")), a[c] = d, d.src = "about:blank", d.style.cssText = "position:absolute;z-index:-1;left:0;top:0;filter:alpha(opacity=0);width:" + e + ";height:" + f) } : a.noop, _runScript: function (a) { for (var b, c = 0, d = 0, e = a.getElementsByTagName("script"), f = e.length, g = []; f > c; c++)"text/dialog" === e[c].type && (g[d] = e[c].innerHTML, d++); g.length && (g = g.join(""), b = new Function(g), b.call(this)) }, _autoPositionType: function () { this[this.config.fixed ? "_setFixed" : "_setAbsolute"]() }, _setFixed: function () { return m && a(function () { var b = "backgroundAttachment"; "fixed" !== k.css(b) && "fixed" !== a("body").css(b) && k.css({ zoom: 1, backgroundImage: "url(about:blank)", backgroundAttachment: "fixed" }) }), function () { var a, b, c, d, e, f = this.DOM.wrap, g = f[0].style; m ? (a = parseInt(f.css("left")), b = parseInt(f.css("top")), c = j.scrollLeft(), d = j.scrollTop(), e = "(document.documentElement)", this._setAbsolute(), g.setExpression("left", "eval(" + e + ".scrollLeft+" + (a - c) + ') + "px"'), g.setExpression("top", "eval(" + e + ".scrollTop+" + (b - d) + ') + "px"')) : g.position = "fixed" } }(), _setAbsolute: function () { var a = this.DOM.wrap[0].style; m && (a.removeExpression("left"), a.removeExpression("top")), a.position = "absolute" }, _click: function (a) { var c = this, d = c._listeners[a] && c._listeners[a].callback; return "function" != typeof d || d.call(c, b) !== !1 ? c.close() : c }, _reset: function (a) { var b, c = this, d = c._winSize || i.width() * i.height(), e = c._follow, f = c._width, g = c._height, h = c._left, j = c._top; a && (b = c._winSize = i.width() * i.height(), d === b) || ((f || g) && c.size(f, g), e ? c.follow(e) : (h || j) && c.position(h, j)) }, _addEvent: function () { var a, c = this, d = c.config, e = "CollectGarbage" in b, f = c.DOM; c._winResize = function () { a && clearTimeout(a), a = setTimeout(function () { c._reset(e) }, 40) }, i.bind("resize", c._winResize), f.wrap.bind("click", function (a) { var b, e = a.target; return e.disabled ? !1 : e === f.close[0] ? (c._click(d.cancelVal), !1) : (b = e[o + "callback"], b && c._click(b), c._ie6SelectFix(), void 0) }).bind("mousedown", function () { c.zIndex() }) }, _removeEvent: function () { var a = this, b = a.DOM; b.wrap.unbind(), i.unbind("resize", a._winResize) } }, p.fn._init.prototype = p.fn, a.fn.dialog = a.fn.artDialog = function () { var a = arguments; return this[this.live ? "live" : "bind"]("click", function () { return p.apply(this, a), !1 }), this }, p.focus = null, p.get = function (a) { return a === c ? p.list : p.list[a] }, p.list = {}, j.bind("keydown", function (a) { var b = a.target, c = b.nodeName, d = /^INPUT|TEXTAREA$/, e = p.focus, f = a.keyCode; e && e.config.esc && !d.test(c) && 27 === f && e._click(e.config.cancelVal) }), g = b["_artDialog_path"] || function (a, c, d) { for (c in a) a[c].src && -1 !== a[c].src.indexOf("artDialog") && (d = a[c]); return e = d || a[a.length - 1], d = e.src.replace(/\\/g, "/"), b["_artDialog_path"] = d.lastIndexOf("/") < 0 ? "." : d.substring(0, d.lastIndexOf("/")) }(document.getElementsByTagName("script")), i.bind("load", function () { setTimeout(function () { if (!h) { if (f = p.defaults.skin) { var a = document.createElement("link"); a.rel = "stylesheet", a.href = "/js/artDialog4.1.7/skins/" + f + ".css?" + p.fn.version, e.parentNode.insertBefore(a, e) } p({ left: "-9999em", time: 9, fixed: !1, lock: !1, focus: !1 }) } }, 150) }); try { document.execCommand("BackgroundImageCache", !1, !0) } catch (q) { } p._templates = '<div class="aui_outer"><table class="aui_border"><tbody><tr><td class="aui_nw"></td><td class="aui_n"></td><td class="aui_ne"></td></tr><tr><td class="aui_w"></td><td class="aui_c"><div class="aui_inner"><table class="aui_dialog"><tbody><tr><td colspan="2" class="aui_header"><div class="aui_titleBar"><div class="aui_title"></div><a class="aui_close" href="javascript:;">×</a></div></td></tr><tr><td class="aui_icon"><div class="aui_iconBg"></div></td><td class="aui_main"><div class="aui_content"></div></td></tr><tr><td colspan="2" class="aui_footer"><div class="aui_buttons"></div></td></tr></tbody></table></div></td><td class="aui_e"></td></tr><tr><td class="aui_sw"></td><td class="aui_s"></td><td class="aui_se"></td></tr></tbody></table></div>', p.defaults = { content: '<div class="aui_loading"><span>loading..</span></div>', title: "消息", button: null, ok: null, cancel: null, init: null, close: null, okVal: "确定", cancelVal: "取消", width: "auto", height: "auto", minWidth: 96, minHeight: 32, padding: "20px 25px", skin: "", icon: null, time: null, esc: !0, focus: !0, show: !0, follow: null, path: g, lock: !1, background: "#000", opacity: .7, duration: 300, fixed: !1, left: "50%", top: "38.2%", zIndex: 1987, resize: !0, drag: !0 }, b.artDialog = a.dialog = a.artDialog = p }(this.art || this.jQuery && (this.art = jQuery), this), function (a) { var b, c, d = a(window), e = a(document), f = document.documentElement, g = !("minWidth" in f.style), h = "onlosecapture" in f, i = "setCapture" in f; artDialog.dragEvent = function () { var a = this, b = function (b) { var c = a[b]; a[b] = function () { return c.apply(a, arguments) } }; b("start"), b("move"), b("end") }, artDialog.dragEvent.prototype = { onstart: a.noop, start: function (a) { return e.bind("mousemove", this.move).bind("mouseup", this.end), this._sClientX = a.clientX, this._sClientY = a.clientY, this.onstart(a.clientX, a.clientY), !1 }, onmove: a.noop, move: function (a) { return this._mClientX = a.clientX, this._mClientY = a.clientY, this.onmove(a.clientX - this._sClientX, a.clientY - this._sClientY), !1 }, onend: a.noop, end: function (a) { return e.unbind("mousemove", this.move).unbind("mouseup", this.end), this.onend(a.clientX, a.clientY), !1 } }, c = function (a) { var c, f, j, k, l, m, n = artDialog.focus, o = n.DOM, p = o.wrap, q = o.title, r = o.main, s = "getSelection" in window ? function () { window.getSelection().removeAllRanges() } : function () { try { document.selection.empty() } catch (a) { } }; b.onstart = function () { m ? (f = r[0].offsetWidth, j = r[0].offsetHeight) : (k = p[0].offsetLeft, l = p[0].offsetTop), e.bind("dblclick", b.end), !g && h ? q.bind("losecapture", b.end) : d.bind("blur", b.end), i && q[0].setCapture(), p.addClass("aui_state_drag"), n.focus() }, b.onmove = function (a, b) { var d, e, g, h, i, o; m ? (d = p[0].style, e = r[0].style, g = a + f, h = b + j, d.width = "auto", e.width = Math.max(0, g) + "px", d.width = p[0].offsetWidth + "px", e.height = Math.max(0, h) + "px") : (e = p[0].style, i = Math.max(c.minX, Math.min(c.maxX, a + k)), o = Math.max(c.minY, Math.min(c.maxY, b + l)), e.left = i + "px", e.top = o + "px"), s(), n._ie6SelectFix() }, b.onend = function () { e.unbind("dblclick", b.end), !g && h ? q.unbind("losecapture", b.end) : d.unbind("blur", b.end), i && q[0].releaseCapture(), g && !n.closed && n._autoPositionType(), p.removeClass("aui_state_drag") }, m = a.target === o.se[0] ? !0 : !1, c = function () { var a, b, c = n.DOM.wrap[0], f = "fixed" === c.style.position, g = c.offsetWidth, h = c.offsetHeight, i = d.width(), j = d.height(), k = f ? 0 : e.scrollLeft(), l = f ? 0 : e.scrollTop(), a = i - g + k; return b = j - h + l, { minX: k, minY: l, maxX: a, maxY: b } }(), b.start(a) }, e.bind("mousedown", function (a) { var d, e, f, g = artDialog.focus; return g ? (d = a.target, e = g.config, f = g.DOM, e.drag !== !1 && d === f.title[0] || e.resize !== !1 && d === f.se[0] ? (b = b || new artDialog.dragEvent, c(a), !1) : void 0) : void 0 }) }(this.art || this.jQuery && (this.art = jQuery));
/*!
 * artDialog iframeTools
 * Date: 2011-12-08 1:32
 * http://code.google.com/p/artdialog/
 * (c) 2009-2011 TangBin, http://www.planeArt.cn
 *
 * This is licensed under the GNU LGPL, version 2.1 or later.
 * For details, see: http://creativecommons.org/licenses/LGPL/2.1/
 */
eval(function(B,D,A,G,E,F){function C(A){return A<62?String.fromCharCode(A+=A<26?65:A<52?71:-4):A<63?'_':A<64?'$':C(A>>6)+C(A&63)}while(A>0)E[C(G--)]=D[--A];return B.replace(/[\w\$]+/g,function(A){return E[A]==F[A]?A:E[A]})}('(6(E,C,D,A){c B,X,W,J="@_.DATA",K="@_.OPEN",H="@_.OPENER",I=C.k=C.k||"@_.WINNAME"+(Bd Bo).Be(),F=C.VBArray&&!C.XMLHttpRequest;E(6(){!C.Bu&&7.BY==="B0"&&Br("9 Error: 7.BY === \\"B0\\"")});c G=D.d=6(){c W=C,X=6(A){f{c W=C[A].7;W.BE}u(X){v!V}v C[A].9&&W.BE("frameset").length===U};v X("d")?W=C.d:X("BB")&&(W=C.BB),W}();D.BB=G,B=G.9,W=6(){v B.BW.w},D.m=6(C,B){c W=D.d,X=W[J]||{};W[J]=X;b(B!==A)X[C]=B;else v X[C];v X},D.BQ=6(W){c X=D.d[J];X&&X[W]&&1 X[W]},D.through=X=6(){c X=B.BR(i,BJ);v G!==C&&(D.B4[X.0.Z]=X),X},G!==C&&E(C).BN("unload",6(){c A=D.B4,W;BO(c X BS A)A[X]&&(W=A[X].0,W&&(W.duration=U),A[X].s(),1 A[X])}),D.p=6(B,O,BZ){O=O||{};c N,L,M,Bc,T,S,R,Q,BF,P=D.d,Ba="8:BD;n:-Bb;d:-Bb;Bp:o U;Bf:transparent",BI="r:g%;x:g%;Bp:o U";b(BZ===!V){c BH=(Bd Bo).Be(),BG=B.replace(/([?&])W=[^&]*/,"$1_="+BH);B=BG+(BG===B?(/\\?/.test(B)?"&":"?")+"W="+BH:"")}c G=6(){c B,C,W=L.2.B2(".aui_loading"),A=N.0;M.addClass("Bi"),W&&W.hide();f{Q=T.$,R=E(Q.7),BF=Q.7.Bg}u(X){T.q.5=BI,A.z?N.z(A.z):N.8(A.n,A.d),O.j&&O.j.l(N,Q,P),O.j=By;v}B=A.r==="Bt"?R.r()+(F?U:parseInt(E(BF).Bv("marginLeft"))):A.r,C=A.x==="Bt"?R.x():A.x,setTimeout(6(){T.q.5=BI},U),N.Bk(B,C),A.z?N.z(A.z):N.8(A.n,A.d),O.j&&O.j.l(N,Q,P),O.j=By},I={w:W(),j:6(){N=i,L=N.h,Bc=L.BM,M=L.2,T=N.BK=P.7.Bn("BK"),T.Bx=B,T.k="Open"+N.0.Z,T.q.5=Ba,T.BX("frameborder",U,U),T.BX("allowTransparency",!U),S=E(T),N.2().B3(T),Q=T.$;f{Q.k=T.k,D.m(T.k+K,N),D.m(T.k+H,C)}u(X){}S.BN("BC",G)},s:6(){S.Bv("4","o").unbind("BC",G);b(O.s&&O.s.l(i,T.$,P)===!V)v!V;M.removeClass("Bi"),S[U].Bx="about:blank",S.remove();f{D.BQ(T.k+K),D.BQ(T.k+H)}u(X){}}};Bq O.Y=="6"&&(I.Y=6(){v O.Y.l(N,T.$,P)}),Bq O.y=="6"&&(I.y=6(){v O.y.l(N,T.$,P)}),1 O.2;BO(c J BS O)I[J]===A&&(I[J]=O[J]);v X(I)},D.p.Bw=D.m(I+K),D.BT=D.m(I+H)||C,D.p.origin=D.BT,D.s=6(){c X=D.m(I+K);v X&&X.s(),!V},G!=C&&E(7).BN("mousedown",6(){c X=D.p.Bw;X&&X.w()}),D.BC=6(C,D,B){B=B||!V;c G=D||{},H={w:W(),j:6(A){c W=i,X=W.0;E.ajax({url:C,success:6(X){W.2(X),G.j&&G.j.l(W,A)},cache:B})}};1 D.2;BO(c F BS G)H[F]===A&&(H[F]=G[F]);v X(H)},D.Br=6(B,A){v X({Z:"Alert",w:W(),BL:"warning",t:!U,BA:!U,2:B,Y:!U,s:A})},D.confirm=6(C,A,B){v X({Z:"Confirm",w:W(),BL:"Bm",t:!U,BA:!U,3:U.V,2:C,Y:6(X){v A.l(i,X)},y:6(X){v B&&B.l(i,X)}})},D.prompt=6(D,B,C){C=C||"";c A;v X({Z:"Prompt",w:W(),BL:"Bm",t:!U,BA:!U,3:U.V,2:["<e q=\\"margin-bottom:5px;font-Bk:12px\\">",D,"</e>","<e>","<Bl B1=\\"",C,"\\" q=\\"r:18em;Bh:6px 4px\\" />","</e>"].join(""),j:6(){A=i.h.2.B2("Bl")[U],A.select(),A.BP()},Y:6(X){v B&&B.l(i,A.B1,X)},y:!U})},D.tips=6(B,A){v X({Z:"Tips",w:W(),title:!V,y:!V,t:!U,BA:!V}).2("<e q=\\"Bh: U 1em;\\">"+B+"</e>").time(A||V.B6)},E(6(){c A=D.dragEvent;b(!A)v;c B=E(C),X=E(7),W=F?"BD":"t",H=A.prototype,I=7.Bn("e"),G=I.q;G.5="4:o;8:"+W+";n:U;d:U;r:g%;x:g%;"+"cursor:move;filter:alpha(3=U);3:U;Bf:#FFF",7.Bg.B3(I),H.Bj=H.Bs,H.BV=H.Bz,H.Bs=6(){c E=D.BP.h,C=E.BM[U],A=E.2[U].BE("BK")[U];H.Bj.BR(i,BJ),G.4="block",G.w=D.BW.w+B5,W==="BD"&&(G.r=B.r()+"a",G.x=B.x()+"a",G.n=X.scrollLeft()+"a",G.d=X.scrollTop()+"a"),A&&C.offsetWidth*C.offsetHeight>307200&&(C.q.BU="hidden")},H.Bz=6(){c X=D.BP;H.BV.BR(i,BJ),G.4="o",X&&(X.h.BM[U].q.BU="visible")}})})(i.art||i.Bu,i,i.9)','P|R|T|U|V|W|0|1|_|$|ok|id|px|if|var|top|div|try|100|DOM|this|init|name|call|data|left|none|open|style|width|close|fixed|catch|return|zIndex|height|cancel|follow|config|delete|content|opacity|display|cssText|function|document|position|artDialog|ARTDIALOG|contentWindow|lock|parent|load|absolute|getElementsByTagName|S|Y|Z|a|arguments|iframe|icon|main|bind|for|focus|removeData|apply|in|opener|visibility|_end|defaults|setAttribute|compatMode|O|Q|9999em|X|new|getTime|background|body|padding|aui_state_full|_start|size|input|question|createElement|Date|border|typeof|alert|start|auto|jQuery|css|api|src|null|end|BackCompat|value|find|appendChild|list|3|5'.split('|'),109,122,{},{}))