let version="3.2.0",ajaxUrl="",TEMP={};var HROS={};HROS.CONFIG={website:"http://"+location.hostname+location.pathname,sinaweiboAppkey:"",tweiboAppkey:"",memberID:0,lockPwdAndLoginPwd:!1,desk:1,dockPos:"",appXY:"",appSize:"",appButtonTop:20,appButtonLeft:20,windowIndexid:1e4,widgetIndexid:1,windowMinWidth:215,windowMinHeight:59,wallpaperState:1,wallpaper:"",wallpaperType:"",wallpaperWidth:0,wallpaperHeight:0,appVerticalSpacing:0,appHorizontalSpacing:0,deskCount:0,timeOutPrompt:"会话过期,请重新登陆!",loadingPrompt:"正在载入中，请稍后...",postOnce:"不要重复提交!"};HROS.VAR={zoomLevel:1,isAppMoving:!1,dock:[],desk1:[],desk2:[],desk3:[],desk4:[],desk5:[],folder:[]};let appbtnTemp=template.compile('<div id="<%=id%>" class="appbtn" title="<%=title%>" appid="<%=appid%>" realappid="<%=realappid%>" type="<%=type%>">'+'<img src="<%=imgsrc%>" alt="<%=title%>" style="width:<%=appsize%>px;height:<%=appsize%>px;">'+'<span style="width:<%=appsize+10%>px;"><%=title%><\/span>'+"<\/div>"),addbtnTemp=template.compile('<div class="appbtn add"><div><img src="/images/ui/addicon.png"><\/div>'+'<span style="width:<%=appsize+10%>px;">添加应用<\/span>'+"<\/div>"),taskTemp=template.compile('<a id="<%=id%>" class="task-item task-item-current" title="<%=title%>" appid="<%=appid%>" realappid="<%=realappid%>" type="<%=type%>">'+'<div class="task-item-icon">'+'<img src="<%=imgsrc%>" alt="<%=title%>">'+"<\/div>"+'<div class="task-item-txt"><%=title%><\/div>'+"<\/a>"),widgetWindowTemp=template.compile('<div id="<%=id%>" class="widget" appid="<%=appid%>" realappid="<%=realappid%>" type="<%=type%>" style="z-index:<%=zIndex%>;width:<%=width%>px;height:<%=height%>px;top:<%=top%>px;right:<%=right%>px">'+'<div class="move"><a class="ha-close" href="###" title="关闭"><\/a>'+"<% if(issetbar){ %>"+'<a class="ha-star" href="###" title="评分"><\/a><a class="ha-share" href="###" title="分享"><\/a>'+"<% } %>"+'<\/div><div class="frame">'+'<iframe src="<%=url%>" frameborder="0" allowtransparency="true"><\/iframe>'+"<\/div><\/div>"),windowTemp=template.compile('<div id="<%=id%>" class="window-container window-current<% if(isflash){ %> window-container-flash<% } %>" starcount="<%=starcount%>" appid="<%=appid%>" realappid="<%=realappid%>" type="<%=type%>" state="show" style="<% if(isopenmax){ %>width:100%;height:100%;<% }else{ %>width:<%=width%>px;height:<%=height%>px;<% } %>z-index:<%=zIndex%>" ismax="<% if(isopenmax){ %>1<% }else{ %>0<% } %>">'+'<div style="height:100%"><div class="title-bar">'+'<img class="icon" src="<%=imgsrc%>" alt="<%=title%>"><span class="title"><%=title%><\/span>'+'<div class="title-handle"><a class="ha-hide" btn="hide" href="###" title="最小化"><b class="hide-b"><\/b><\/a>'+"<% if(istitlebar){ %>"+'<a class="ha-max" btn="max" href="###" title="最大化" <% if(isopenmax){ %>style="display:none"<% } %>><b class="max-b"><\/b><\/a>'+'<a class="ha-revert" btn="revert" href="###" title="还原" <% if(!isopenmax){ %>style="display:none"<% } %>><b class="revert-b"><\/b><b class="revert-t"><\/b><\/a>'+"<% } %>"+"<% if(istitlebarFullscreen){ %>"+'<a class="ha-fullscreen" btn="fullscreen" href="###" title="全屏">+<\/a>'+"<% } %>"+'<a class="ha-close" btn="close" href="###" title="关闭">×<\/a><\/div><\/div><div class="window-frame">'+"<% if(isflash){ %>"+'<div class="window-mask"><div class="maskbg"><\/div><div>运行中，点击恢复显示 :)<\/div><\/div>'+"<% }else{ %>"+'<div class="window-mask window-mask-noflash"><\/div>'+"<% } %>"+'<div class="window-loading"><\/div>'+'<iframe id="<%=id%>_iframe" frameborder="0" src="<%=url%>"><\/iframe>'+'<\/div><div class="set-bar"><div class="fr">'+"<% if(issetbar){ %>"+'<a class="btn share"><i class="icon icon104"><\/i><span class="btn-con">分享<\/span><\/a><a class="btn star"><i class="icon icon177"><\/i><span class="btn-con">评分<\/span><\/a><a class="btn detail"><i class="icon icon120"><\/i><span class="btn-con">详情<\/span><\/a>'+"<% } %>"+'<a class="btn refresh"><i class="icon icon158"><\/i><span class="btn-con">刷新<\/span><\/a><\/div><\/div><\/div>'+"<% if(isresize){ %>"+'<div class="window-resize window-resize-t" resize="t"><\/div><div class="window-resize window-resize-r" resize="r"><\/div><div class="window-resize window-resize-b" resize="b"><\/div><div class="window-resize window-resize-l" resize="l"><\/div><div class="window-resize window-resize-rt" resize="rt"><\/div><div class="window-resize window-resize-rb" resize="rb"><\/div><div class="window-resize window-resize-lt" resize="lt"><\/div><div class="window-resize window-resize-lb" resize="lb"><\/div>'+"<% } %>"+"<\/div>"),folderWindowTemp=template.compile('<div id="<%=id%>" class="folder-window window-container window-current" appid="<%=appid%>" realappid="<%=realappid%>" type="<%=type%>" state="show" style="width:<%=width%>px;height:<%=height%>px;z-index:<%=zIndex%>">'+'<div style="height:100%"><div class="title-bar">'+'<img class="icon" src="<%=imgsrc%>" alt="<%=title%>"><span class="title"><%=title%><\/span>'+'<div class="title-handle"><a class="ha-hide" btn="hide" href="###" title="最小化"><b class="hide-b"><\/b><\/a>'+"<% if(istitlebar){ %>"+'<a class="ha-max" btn="max" href="###" title="最大化"><b class="max-b"><\/b><\/a><a class="ha-revert" btn="revert" href="###" title="还原" style="display:none"><b class="revert-b"><\/b><b class="revert-t"><\/b><\/a>'+"<% } %>"+'<a class="ha-close" btn="close" href="###" title="关闭">×<\/a><\/div><\/div><div class="window-frame"><div class="folder_body"><\/div><\/div><div class="set-bar"><div class="fr"><a class="btn refresh"><i class="icon icon158"><\/i><span class="btn-con">刷新<\/span><\/a><\/div><\/div><\/div>'+"<% if(isresize){ %>"+'<div class="window-resize window-resize-t" resize="t"><\/div><div class="window-resize window-resize-r" resize="r"><\/div><div class="window-resize window-resize-b" resize="b"><\/div><div class="window-resize window-resize-l" resize="l"><\/div><div class="window-resize window-resize-rt" resize="rt"><\/div><div class="window-resize window-resize-rb" resize="rb"><\/div><div class="window-resize window-resize-lt" resize="lt"><\/div><div class="window-resize window-resize-lb" resize="lb"><\/div>'+"<% } %>"+"<\/div>"),folderViewTemp=template.compile('<div id="<%=id%>" class="quick_view_container" appid="<%=appid%>" realappid="<%=realappid%>" style="top:<%=top%>px;left:<%=left%>px">'+'<div class="perfect_nine_box"><div class="perfect_nine_t"><div class="perfect_nine_t_m"><\/div><\/div><span class="perfect_nine_t_l"><\/span><span class="perfect_nine_t_r"><\/span><div class="perfect_nine_middle"><span class="perfect_nine_m_l">'+'<div class="perfect_nine_m_l_t" style="top:0px;height:<%=mlt%>px"><\/div>'+'<div class="perfect_nine_m_l_m" style="top:<%=mlt%>px;height:20px;display:<% if(mlm){ %>block<% }else{ %>none<% } %>"><\/div>'+'<div class="perfect_nine_m_l_b" style="top:<% if(mlm){ %><%=mlt+20%><% }else{ %><%=mlt%><% } %>px;height:<%=mlb%>px"><\/div>'+'<\/span><span class="perfect_nine_m_r">'+'<div class="perfect_nine_m_r_t" style="top:0px;height:<%=mrt%>px"><\/div>'+'<div class="perfect_nine_m_r_m" style="top:<%=mrt%>px;height:20px;display:<% if(mrm){ %>block<% }else{ %>none<% } %>"><\/div>'+'<div class="perfect_nine_m_r_b" style="top:<% if(mrm){ %><%=mrt+20%><% }else{ %><%=mrt%><% } %>px;height:<%=mrb%>px"><\/div>'+'<\/span><div class="perfect_nine_context"><div class="quick_view_container_control"><a href="###" class="quick_view_container_open">打开<\/a><\/div>'+'<div class="quick_view_container_list" id="quick_view_container_list_<%=appid%>" realid="<%=appid%>">'+'<div class="quick_view_container_list_in" id="quick_view_container_list_in_<%=appid%>" style="height:<%=height%>px">'+"<%==apps%>"+'<\/div><div class="scrollBar"><\/div><div class="scrollBar_bgc"><\/div><\/div><\/div><\/div><div class="perfect_nine_b"><div class="perfect_nine_b_m"><\/div><\/div><span class="perfect_nine_b_l"><\/span><span class="perfect_nine_b_r"><\/span><\/div><\/div>'),fileDownloadTemp=template.compile('<iframe src="filedownload.php?appid=<%=appid%>" frameborder="0" style="display:none"><\/iframe>'),suggestTemp=template.compile('<li class="resultList" appid="<%=appid%>" realappid="<%=realappid%>" type="<%=type%>">'+'<a href="###"><div><%=name%><\/div><\/a>'+"<\/li>"),editFolderDialogTemp=template.compile('<div id="addfolder">'+'<a class="folderSelector"><img src="<%=src%>"><\/a>'+'<div class="folderNameTxt">请输入文件夹名称：<\/div>'+'<div class="folderInput"><input type="text" class="folderName" id="folderName" value="<%=name%>"><\/div>'+'<div class="folderNameError">文件夹名称不能只包含空字符<\/div><div class="fcDropdown"><a class="fcDropdown_item" title="默认"><img class="fcDropdown_img" src="/images/ui/folder_default.png"><\/a><a class="fcDropdown_item" title="文本"><img class="fcDropdown_img" src="/images/ui/folder_doc.png"><\/a><a class="fcDropdown_item" title="游戏"><img class="fcDropdown_img" src="/images/ui/folder_game.png"><\/a><a class="fcDropdown_item" title="生活"><img class="fcDropdown_img" src="/images/ui/folder_life.png"><\/a><a class="fcDropdown_item" title="音乐"><img class="fcDropdown_img" src="/images/ui/folder_music.png"><\/a><a class="fcDropdown_item" title="工具"><img class="fcDropdown_img" src="/images/ui/folder_tool.png"><\/a><a class="fcDropdown_item" title="视频"><img class="fcDropdown_img" src="/images/ui/folder_video.png"><\/a><\/div><\/div>'),starDialogTemp=template.compile('<div id="star" realappid="<%=realappid%>">'+'<div class="grade-box">'+'<div class="star-num"><%=point%><\/div>'+'<div class="star-box"><div>打分：<\/div>'+'<i style="width:<%=realpoint%>%"><\/i>'+'<ul><li class="grade-1" num="1"><a href="###"><em>很不好用<\/em><\/a><\/li><li class="grade-2" num="2"><a href="###"><em>体验一般般<\/em><\/a><\/li><li class="grade-3" num="3"><a href="###"><em>比较好用<\/em><\/a><\/li><li class="grade-4" num="4"><a href="###"><em>很好用<\/em><\/a><\/li><li class="grade-5" num="5"><a href="###"><em>棒极了，推荐<\/em><\/a><\/li><\/ul><\/div><\/div><\/div>'),lockTemp=template.compile('<div id="lock"><div class="title"><div class="time"><\/div><div class="week"><\/div><\/div><div id="lock-info">'+'<div class="img"><img src="<%=avatar%>" title="<%=username%>" alt="<%=username%>"><\/img><\/div>'+'<div class="text"><input type="password" class="mousetrap" id="lockpassword" placeholder="请输入解锁密码"><\/div><div class="text-tip"><\/div><div class="text"><input type="button" id="lockbtn" value="解 锁"><\/div><\/div><div class="tip">点击屏幕，开启解锁<\/div><\/div>');HROS.app=function(){return{init:function(){$("#desk").on("click",".add",function(){HROS.window.createTemp({appid:"hoorayos-yysc",title:"应用市场",url:"/AppMarket/Index",width:800,height:484,isflash:!1})});HROS.app.move();HROS.app.moveScrollbar();$("body").on("contextmenu",".appbtn:not(.add)",function(e){HROS.popupMenu.hide();let popupmenu;switch($(this).attr("type")){case"app":case"widget":popupmenu=HROS.popupMenu.app($(this));break;case"pwindow":case"pwidget":popupmenu=HROS.popupMenu.papp($(this));break;case"folder":popupmenu=HROS.popupMenu.folder($(this));break;case"file":popupmenu=HROS.popupMenu.file($(this))}let l=$(window).width()-e.clientX<popupmenu.width()?e.clientX-popupmenu.width():e.clientX,t=$(window).height()-e.clientY<popupmenu.height()?e.clientY-popupmenu.height():e.clientY;return popupmenu.css({left:l,top:t}).show(),!1});$("body").on("click","#star ul li",function(){let num=$(this).attr("num");!isNaN(num)&&/^[1-5]$/.test(num)&&(HROS.base.checkLogin()?HROS.request.post("/appmarket/modifystar",{AppId:$("#star").attr("realappid"),StarCount:num},function(responseText){responseText.IsSuccess?responseText.IsSuccess?NewCrm.msgbox.success("打分成功！"):NewCrm.msgbox.fail("你已经打过分了！"):NewCrm.msgbox.fail(responseText.Message);$.dialog.list.star.close()}):HROS.base.login())}).on("click","#share a",function(){$.dialog.list.share.close()});HROS.app.get()},updateXY:function(i){HROS.CONFIG.appXY.toLowerCase()!==i&&HROS.base.checkLogin()&&HROS.request.post("/desk/modifyxy",{appXy:i},function(responseText){responseText.IsSuccess?(HROS.CONFIG.appXY=i.toLowerCase(),HROS.deskTop.resize(),NewCrm.msgbox.success("图标排列方向更新成功")):NewCrm.msgbox.fail("图标排列方向更新失败")})},updateSize:function(i){HROS.CONFIG.appSize!==i&&(HROS.CONFIG.appSize=i,HROS.deskTop.resize(),HROS.base.checkLogin()&&HROS.request.post("/desk/modifysize",{appSize:i},function(responseText){responseText.IsSuccess?NewCrm.msgbox.success("更新应用显示尺寸成功"):NewCrm.msgbox.fail("更新应用显示尺寸失败")}))},updateVertical:function(i){HROS.CONFIG.appVerticalSpacing!=i&&(HROS.CONFIG.appVerticalSpacing=i,HROS.deskTop.resize(),HROS.base.checkLogin()&&HROS.request.post("/desk/modifyverticalspace",{appVertical:i},function(responseText){responseText.IsSuccess?NewCrm.msgbox.success("更新应用垂直间距成功"):NewCrm.msgbox.fail("更新应用垂直间距失败")}))},updateHorizontal:function(i){HROS.CONFIG.appHorizontalSpacing!=i&&(HROS.CONFIG.appHorizontalSpacing=i,HROS.deskTop.resize(),HROS.base.checkLogin()&&HROS.request.post("/desk/modifyhorizontalspace",{appHorizontal:i},function(responseText){responseText.IsSuccess?NewCrm.msgbox.success("更新应用水平间距成功"):NewCrm.msgbox.fail("更新应用水平间距失败")}))},get:function(){HROS.VAR.isAppMoving=!0;HROS.request.get("/desk/getuserdeskmembers",{},function(responseText){if(responseText.IsSuccess){if(HROS.VAR.isAppMoving=!1,typeof responseText=="object"){let folders=[],docks=[];$.each(responseText.Model,function(k,v){let apps=[];$.each(v,function(a,b){b.type==="folder"&&folders.push(b);b.isOnDock?docks.push(b):apps.push(b)});eval("HROS.VAR.desk"+k+"=apps")});HROS.VAR.folder=folders;HROS.VAR.dock=docks}HROS.app.set()}})},set:function(){let dock_append="";HROS.VAR.dock!=null&&HROS.VAR.dock!==""&&$(HROS.VAR.dock).each(function(){dock_append+=appbtnTemp({title:this.name,type:this.type,id:"d_"+this.memberId,appid:this.memberId,realappid:this.appId==0?this.memberId:this.appId,imgsrc:this.icon,appsize:48})});$("#dock-bar .dock-applist .appbtn").remove();$("#dock-bar .dock-applist").append(dock_append);for(let j=1;j<=HROS.CONFIG.deskCount;j++){let desk_append="",desk=eval("HROS.VAR.desk"+j);typeof desk!="undefined"&&desk!==""&&$(desk).each(function(){desk_append+=appbtnTemp({title:this.name,type:this.type,id:"d_"+this.memberId,appid:this.memberId,realappid:this.appId==0?this.memberId:this.appId,imgsrc:this.icon,appsize:HROS.CONFIG.appSize})});desk_append+=addbtnTemp({appsize:HROS.CONFIG.appSize});$("#desk-"+j+" .desktop-apps-container .appbtn").remove();$("#desk-"+j+" .desktop-apps-container").append(desk_append)}HROS.app.setPos(!1);$("body .quick_view_container").each(function(){HROS.folderView.get($("#d_"+$(this).attr("appid")))});$("#desk .folder-window").each(function(){HROS.window.updateFolder($(this).attr("appid"))});HROS.app.getScrollbar()},setPos:function(isAnimate){$("i.addicon").width(HROS.CONFIG.appSize).height(HROS.CONFIG.appSize);$("#desk .desktop-container .appbtn img ").width(HROS.CONFIG.appSize).height(HROS.CONFIG.appSize);$("#desk .desktop-container .appbtn span").width(Number(HROS.CONFIG.appSize)+10);isAnimate=isAnimate==null?!0:isAnimate;let grid=HROS.grid.getAppGrid(),dockGrid=HROS.grid.getDockAppGrid();$("#dock-bar .dock-applist .appbtn").each(function(i){$(this).css({top:HROS.CONFIG.dockPos.toLowerCase()==="top"?dockGrid[i].startY:dockGrid[i].startY+5,left:HROS.CONFIG.dockPos.toLowerCase()==="top"?dockGrid[i].startX+5:dockGrid[i].startX}).attr("top",$(this).offset().top).attr("left",$(this).offset().left)});for(let j=1;j<=5;j++)$("#desk-"+j+" .appbtn").each(function(i){let offsetTop=HROS.CONFIG.appVerticalSpacing/2,offsetLeft=HROS.CONFIG.appHorizontalSpacing/2,top=grid[i].startY+offsetTop,left=grid[i].startX+offsetLeft;$(this).stop(!0,!1).animate({top:top,left:left},isAnimate?500:0);switch(HROS.CONFIG.dockPos.toLowerCase()){case"top":$(this).attr("left",left).attr("top",top+$("#dock-bar").height());break;case"left":$(this).attr("left",left+$("#dock-bar").width()).attr("top",top);break;default:$(this).attr("left",left).attr("top",top)}});HROS.app.getScrollbar()},add:function(id,callback){function done(){callback&&callback()}HROS.base.checkLogin()?HROS.request.post("/appmarket/install",{AppId:id,DeskNum:HROS.CONFIG.desk},function(responseText){responseText.IsSuccess?done():NewCrm.msgbox.fail(responseText.Message)}):done()},remove:function(id,callback){function done(){HROS.widget.removeCookie(id);callback&&callback()}HROS.base.checkLogin()?HROS.request.post("/desk/uninstall",{memberId:parseInt(id)},function(responseText){responseText.IsSuccess?(done(),NewCrm.msgbox.success("移除成功，刷新后查看")):NewCrm.msgbox.fail(responseText.Message)}):done()},move:function(){$("#dock-bar .dock-applist").on("mousedown",".appbtn",function(e){if(e.preventDefault(),e.stopPropagation(),e.button===0||e.button===1){let oldobj=$(this),obj=$('<div id="shortcut_shadow">'+oldobj.html()+"<\/div>"),dx=e.clientX,dy=e.clientY,cx=e.clientX,cy=e.clientY,x=dx-oldobj.offset().left,y=dy-oldobj.offset().top,lay=HROS.maskBox.desk();$(document).on("mousemove",function(e){$("body").append(obj);lay.show();cx=e.clientX<=0?0:e.clientX>=$(window).width()?$(window).width():e.clientX;cy=e.clientY<=0?0:e.clientY>=$(window).height()?$(window).height():e.clientY;(dx!==cx||dy!==cy)&&obj.css({left:cx-x,top:cy-y}).show()}).on("mouseup",function(){if($(document).off("mousemove").off("mouseup"),obj.remove(),lay.hide(),dx===cx&&dy===cy){switch(oldobj.attr("type")){case"window":case"pwindow":case"file":HROS.window.create(oldobj.attr("realappid"),oldobj.attr("type"));break;case"widget":case"pwidget":HROS.widget.create(oldobj.attr("realappid"),oldobj.attr("type"));break;case"folder":HROS.folderView.get(oldobj)}return!1}let movegrid=HROS.grid.searchFolderGrid(cx,cy);if(movegrid!==null){if(oldobj.hasClass("folder")===!1){let id=oldobj.attr("appid"),from=oldobj.index(),to=movegrid;HROS.base.checkLogin()?HROS.app.checkIsMoving()||HROS.app.dataDockToFolder(id,from,to)&&HROS.request.post("/desk/membermove",{model:{MoveType:"dock-folder",MemberId:id,From:from,To:to}},function(responseText){responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.msgbox.fail(responseText.Message)}):HROS.app.dataDockToFolder(id,from,to)}}else{let dock_w=HROS.CONFIG.dockPos.toLowerCase()==="left"?0:HROS.CONFIG.dockPos.toLowerCase()==="top"?($(window).width()-$("#dock-container").width()+20)/2:$(window).width()-$("#dock-container").width(),dock_h=HROS.CONFIG.dockPos.toLowerCase()==="top"?0:($(window).height()-$("#dock-container").height()+20)/2,movegrid=HROS.grid.searchDockAppGrid(cx-dock_w,cy-dock_h);if(movegrid!==null){if(movegrid!==oldobj.index()){let movegrid2=HROS.grid.searchDockAppGrid2(cx-dock_w,cy-dock_h),id=oldobj.attr("appid"),from=oldobj.index(),to=movegrid,boa=movegrid2%2==0?"b":"a";HROS.base.checkLogin()?HROS.app.checkIsMoving()||HROS.app.dataDockToDock(id,from,to,boa):HROS.app.dataDockToDock(id,from,to,boa)}}else{let dock_w=HROS.CONFIG.dockPos.toLowerCase()==="left"?$("#dock-bar").width():0,dock_h=HROS.CONFIG.dockPos.toLowerCase()==="top"?$("#dock-bar").height():0,deskScrollLeft=$("#desk-"+HROS.CONFIG.desk+" .desktop-apps-container").scrollLeft(),deskScrollTop=$("#desk-"+HROS.CONFIG.desk+" .desktop-apps-container").scrollTop(),movegrid=HROS.grid.searchAppGrid(cx-dock_w+deskScrollLeft,cy-dock_h+deskScrollTop);if(movegrid!==null){let movegrid2=HROS.grid.searchAppGrid2(cx-dock_w+deskScrollLeft,cy-dock_h+deskScrollTop),id=oldobj.attr("appid"),from=oldobj.index(),to=movegrid,boa=movegrid2%2==0?"b":"a",desk=HROS.CONFIG.desk;HROS.base.checkLogin()?HROS.app.checkIsMoving()||HROS.app.dataDockToDesk(id,from,to,boa,desk)&&HROS.request.post("/desk/membermove",{model:{MoveType:"dock-desk",MemberId:id,From:from,To:desk}},function(responseText){responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.msgbox.fail(responseText.Message)}):HROS.app.dataDockToDesk(id,from,to,boa,desk)}}}})}});$("#desktop .desktop-apps-container").on("mousedown",".appbtn:not(.add)",function(e){if(e.preventDefault(),e.stopPropagation(),e.button===0||e.button===1){let oldobj=$(this),obj=$('<div id="shortcut_shadow">'+oldobj.html()+"<\/div>"),dx=e.clientX,dy=e.clientY,cx=e.clientX,cy=e.clientY,x=dx-oldobj.offset().left,y=dy-oldobj.offset().top,lay=HROS.maskBox.desk();$(document).on("mousemove",function(e){$("body").append(obj);lay.show();cx=e.clientX<=0?0:e.clientX>=$(window).width()?$(window).width():e.clientX;cy=e.clientY<=0?0:e.clientY>=$(window).height()?$(window).height():e.clientY;(dx!==cx||dy!==cy)&&obj.css({left:cx-x,top:cy-y}).show()}).on("mouseup",function(){if($(document).off("mousemove").off("mouseup"),obj.remove(),lay.hide(),dx===cx&&dy===cy){switch(oldobj.attr("type")){case"app":case"pwindow":case"file":HROS.window.create(oldobj.attr("realappid"),oldobj.attr("type"));break;case"widget":case"pwidget":HROS.widget.create(oldobj.attr("realappid"),oldobj.attr("type"));break;case"folder":HROS.folderView.get(oldobj)}return!1}let movegrid=HROS.grid.searchFolderGrid(cx,cy);if(movegrid!==null){if(oldobj.attr("type")!=="folder"){let id=oldobj.attr("appid"),from=oldobj.index(),to=movegrid,desk=HROS.CONFIG.desk;HROS.base.checkLogin()?HROS.app.checkIsMoving()||HROS.app.dataDeskToFolder(id,from,to,desk)&&HROS.request.post("/desk/membermove",{model:{MoveType:"desk-folder",MemberId:id,From:from,To:to}},function(responseText){responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.msgbox.fail(responseText.Message)}):HROS.app.dataDeskToFolder(id,from,to,desk)}}else{let dock_w=HROS.CONFIG.dockPos.toLowerCase()==="left"?0:HROS.CONFIG.dockPos.toLowerCase()==="top"?($(window).width()-$("#dock-container").width()+20)/2:$(window).width()-$("#dock-container").width(),dock_h=HROS.CONFIG.dockPos.toLowerCase()==="top"?0:($(window).height()-$("#dock-container").height()+20)/2,movegrid=HROS.grid.searchDockAppGrid(cx-dock_w,cy-dock_h);if(movegrid!==null){let movegrid2=HROS.grid.searchDockAppGrid2(cx-dock_w,cy-dock_h),id=oldobj.attr("appid"),from=oldobj.index(),to=movegrid,boa=movegrid2%2==0?"b":"a",desk=HROS.CONFIG.desk;HROS.base.checkLogin()?HROS.app.checkIsMoving()||HROS.app.dataDeskToDock(id,from,to,boa,desk)&&HROS.request.post("/desk/membermove",{model:{MoveType:"desk-dock",MemberId:id,From:from,To:to}},function(responseText){responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.msgbox.fail(responseText.Message)}):HROS.app.dataDeskToDock(id,from,to,boa,desk)}else{let dock_w=HROS.CONFIG.dockPos.toLowerCase()==="left"?$("#dock-bar").width():0,dock_h=HROS.CONFIG.dockPos.toLowerCase()==="top"?$("#dock-bar").height():0,deskScrollLeft=$("#desk-"+HROS.CONFIG.desk+" .desktop-apps-container").scrollLeft(),deskScrollTop=$("#desk-"+HROS.CONFIG.desk+" .desktop-apps-container").scrollTop(),movegrid=HROS.grid.searchAppGrid(cx-dock_w+deskScrollLeft,cy-dock_h+deskScrollTop);if(movegrid!==null&&movegrid!==oldobj.index()){let movegrid2=HROS.grid.searchAppGrid2(cx-dock_w+deskScrollLeft,cy-dock_h+deskScrollTop),id=oldobj.attr("appid"),from=oldobj.index(),to=movegrid,boa=movegrid2%2==0?"b":"a",desk=HROS.CONFIG.desk;HROS.base.checkLogin()?HROS.app.checkIsMoving()||HROS.app.dataDeskToDesk(id,from,to,boa,desk):HROS.app.dataDeskToDesk(id,from,to,boa,desk)}}}})}});$("body").on("mousedown",".folder_body .appbtn, .quick_view_container .appbtn",function(e){if(e.preventDefault(),e.stopPropagation(),e.button===0||e.button===1){let oldobj=$(this),obj=$('<div id="shortcut_shadow">'+oldobj.html()+"<\/div>"),dx=e.clientX,dy=e.clientY,cx=e.clientX,cy=e.clientY,x=dx-oldobj.offset().left,y=dy-oldobj.offset().top,lay=HROS.maskBox.desk();$(document).on("mousemove",function(e){$("body").append(obj);lay.show();cx=e.clientX<=0?0:e.clientX>=$(window).width()?$(window).width():e.clientX;cy=e.clientY<=0?0:e.clientY>=$(window).height()?$(window).height():e.clientY;(dx!==cx||dy!==cy)&&obj.css({left:cx-x,top:cy-y}).show()}).on("mouseup",function(){if($(document).off("mousemove").off("mouseup"),obj.remove(),lay.hide(),dx===cx&&dy===cy){switch(oldobj.attr("type")){case"app":case"window":case"pwindow":case"file":HROS.window.create(oldobj.attr("realappid"),oldobj.attr("type"));break;case"widget":case"pwidget":HROS.widget.create(oldobj.attr("realappid"),oldobj.attr("type"))}return!1}let movegrid=HROS.grid.searchFolderGrid(cx,cy);if(movegrid!==null){if(oldobj.parents(".folder-window").attr("appid")!==movegrid){let id=oldobj.attr("appid"),from=oldobj.index(),to=movegrid,fromFolderId=oldobj.parents(".folder-window").attr("appid")||oldobj.parents(".quick_view_container").attr("appid");HROS.base.checkLogin()?HROS.app.checkIsMoving()||HROS.app.dataFolderToFolder(id,from,to,fromFolderId)&&HROS.request.post("/desk/membermove",{model:{MoveType:"folder-folder",MemberId:id,From:from,To:to}},function(responseText){responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.msgbox.fail(responseText.Message)}):HROS.app.dataFolderToFolder(id,from,to,fromFolderId)}}else{let dock_w=HROS.CONFIG.dockPos.toLowerCase()==="left"?0:HROS.CONFIG.dockPos.toLowerCase()==="top"?($(window).width()-$("#dock-container").width()+20)/2:$(window).width()-$("#dock-container").width(),dock_h=HROS.CONFIG.dockPos.toLowerCase()==="top"?0:($(window).height()-$("#dock-container").height()+20)/2,movegrid=HROS.grid.searchDockAppGrid(cx-dock_w,cy-dock_h);if(movegrid!==null){let movegrid2=HROS.grid.searchDockAppGrid2(cx-dock_w,cy-dock_h),id=oldobj.attr("appid"),from=oldobj.index(),to=movegrid,fromFolderId=oldobj.parents(".folder-window").attr("appid")||oldobj.parents(".quick_view_container").attr("appid"),boa=movegrid2%2==0?"b":"a",desk=HROS.CONFIG.desk;HROS.base.checkLogin()?HROS.app.checkIsMoving()||HROS.app.dataFolderToDock(id,from,to,fromFolderId,boa,desk)&&HROS.request.post("/desk/membermove",{model:{MoveType:"folder-dock",MemberId:id,From:from,To:to}},function(responseText){responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.msgbox.fail(responseText.Message)}):HROS.app.dataFolderToDock(id,from,to,fromFolderId,boa,desk)}else{let dock_w=HROS.CONFIG.dockPos.toLowerCase()==="left"?$("#dock-bar").width():0,dock_h=HROS.CONFIG.dockPos.toLowerCase()==="top"?$("#dock-bar").height():0,deskScrollLeft=$("#desk-"+HROS.CONFIG.desk+" .desktop-apps-container").scrollLeft(),deskScrollTop=$("#desk-"+HROS.CONFIG.desk+" .desktop-apps-container").scrollTop(),movegrid=HROS.grid.searchAppGrid(cx-dock_w+deskScrollLeft,cy-dock_h+deskScrollTop);if(movegrid!==null){let movegrid2=HROS.grid.searchAppGrid2(cx-dock_w+deskScrollLeft,cy-dock_h+deskScrollTop),id=oldobj.attr("appid"),from=oldobj.index(),to=movegrid,fromFolderId=oldobj.parents(".folder-window").attr("appid")||oldobj.parents(".quick_view_container").attr("appid"),boa=movegrid2%2==0?"b":"a",desk=HROS.CONFIG.desk;HROS.base.checkLogin()?HROS.app.checkIsMoving()||HROS.app.dataFolderToDesk(id,from,to,fromFolderId,boa,desk)&&HROS.request.post("/desk/membermove",{model:{MoveType:"folder-desk",MemberId:id,From:from,To:desk}},function(responseText){responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.msgbox.fail(responseText.Message)}):HROS.app.dataFolderToDesk(id,from,to,fromFolderId,boa,desk)}}}})}})},getScrollbar:function(){setTimeout(function(){$("#desk .desktop-container").each(function(){let desk=$(this).children(".desktop-apps-container"),scrollbar=$(this).children(".scrollbar"),scrollbarLeft=desk.nextAll(".scrollbar-x").position().left,scrollbarTop=desk.nextAll(".scrollbar-y").position().top;if(scrollbar.hide(),desk.scrollLeft(0).scrollTop(0),HROS.CONFIG.appXY.toLowerCase()==="x"){let deskH=parseInt(desk.children(".add").css("top"))+108;desk.height()/deskH<1&&(desk.nextAll(".scrollbar-y").height(desk.height()/deskH*desk.height()),scrollbarTop=scrollbarTop+desk.nextAll(".scrollbar-y").height()>desk.height()?desk.height()-desk.nextAll(".scrollbar-y").height():scrollbarTop,desk.nextAll(".scrollbar-y").css("top",scrollbarTop).show(),desk.scrollTop(scrollbarTop/desk.height()*deskH))}else{let deskW=parseInt(desk.children(".add").css("left"))+106;desk.width()/deskW<1&&(desk.nextAll(".scrollbar-x").width(desk.width()/deskW*desk.width()),scrollbarLeft=scrollbarLeft+desk.nextAll(".scrollbar-x").width()>desk.width()?desk.width()-desk.nextAll(".scrollbar-w").width():scrollbarLeft,desk.nextAll(".scrollbar-x").css("left",scrollbarLeft).show(),desk.scrollLeft(scrollbarLeft/desk.width()*deskW))}})},500)},moveScrollbar:function(){$("#desk .scrollbar").on("mousedown",function(e){let x,y,cx,cy,deskrealw,deskrealh,movew,moveh,scrollbar=$(this),desk=scrollbar.prevAll(".desktop-apps-container");deskrealw=parseInt(desk.children(".add").css("left"))+106;deskrealh=parseInt(desk.children(".add").css("top"))+108;movew=desk.width()-scrollbar.width();moveh=desk.height()-scrollbar.height();scrollbar.hasClass("scrollbar-x")?x=e.clientX-scrollbar.position().left:y=e.clientY-scrollbar.position().top;$(document).on("mousemove",function(e){scrollbar.hasClass("scrollbar-x")?(cx=e.clientX-x<0?0:e.clientX-x>movew?movew:e.clientX-x,scrollbar.css("left",cx),desk.scrollLeft(cx/desk.width()*deskrealw)):(cy=e.clientY-y<0?0:e.clientY-y>moveh?moveh:e.clientY-y,scrollbar.css("top",cy),desk.scrollTop(cy/desk.height()*deskrealh))}).on("mouseup",function(){$(this).off("mousemove").off("mouseup")})});for(let i=1;i<=5;i++)$("#desk-"+i).on("mousewheel",function(event,delta){let desk=$(this).find(".desktop-apps-container");if(HROS.CONFIG.appXY.toLowerCase()==="x"){let deskrealh=parseInt(desk.find(".add").css("top"))+108,scrollupdown;scrollupdown=delta<0?desk.scrollTop()+200>deskrealh-desk.height()?deskrealh-desk.height():desk.scrollTop()+200:desk.scrollTop()-200<0?0:desk.scrollTop()-200;desk.stop(!1,!0).animate({scrollTop:scrollupdown},300);desk.nextAll(".scrollbar-y").stop(!1,!0).animate({top:scrollupdown/deskrealh*desk.height()},300)}else{let deskrealw=parseInt(desk.find(".add").css("left"))+106,scrollleftright;scrollleftright=delta<0?desk.scrollLeft()+200>deskrealw-desk.width()?deskrealw-desk.width():desk.scrollLeft()+200:desk.scrollLeft()-200<0?0:desk.scrollLeft()-200;desk.stop(!1,!0).animate({scrollLeft:scrollleftright},300);desk.nextAll(".scrollbar-x").stop(!1,!0).animate({left:scrollleftright/deskrealw*desk.width()},300)}})},checkIsMoving:function(){let rtn=!1;return HROS.VAR.isAppMoving?($.dialog({title:"温馨提示",icon:"warning",content:"数据正在处理中，请稍后。",ok:!0}),rtn=!0):HROS.VAR.isAppMoving=!0,rtn},dataWarning:function(){$.dialog({title:"温馨提示",icon:"warning",content:"数据错误，请刷新后重试。",ok:!0})},dataDockToFolder:function(id,from,to){let rtn=!1;return $(HROS.VAR.dock).each(function(i){if(this.memberId===parseInt(id))return $(HROS.VAR.folder).each(function(j){if(this.memberId===parseInt(to))return HROS.VAR.folder[j].apps.push(HROS.VAR.dock[i]),HROS.VAR.folder[j].apps=HROS.VAR.folder[j].apps.sortBy(function(n){return n.memberId},!0),HROS.VAR.dock.splice(i,1),rtn=!0,!1}),!1}),rtn?$("#desktop").is(":visible")?HROS.app.set():HROS.appmanage.set():HROS.app.dataWarning(),rtn},dataDockToDock:function(id,from,to,boa){let rtn=!1;return HROS.VAR.dock[from]!==null&&(to===0?boa==="b"?HROS.VAR.dock.splice(0,0,HROS.VAR.dock[from]):HROS.VAR.dock.splice(1,0,HROS.VAR.dock[from]):boa==="b"?HROS.VAR.dock.splice(to,0,HROS.VAR.dock[from]):HROS.VAR.dock.splice(to+1,0,HROS.VAR.dock[from]),from>to?HROS.VAR.dock.splice(from+1,1):HROS.VAR.dock.splice(from,1),rtn=!0),rtn?$("#desktop").is(":visible")?HROS.app.set():HROS.appmanage.set():HROS.app.dataWarning(),rtn},dataDockToDesk:function(id,from,to,boa,desk){let rtn=!1;return desk=eval("HROS.VAR.desk"+desk),HROS.VAR.dock[from]!==null&&(to===0?boa==="b"?desk.splice(0,0,HROS.VAR.dock[from]):desk.splice(1,0,HROS.VAR.dock[from]):boa==="b"?desk.splice(to,0,HROS.VAR.dock[from]):desk.splice(to+1,0,HROS.VAR.dock[from]),HROS.VAR.dock.splice(from,1),rtn=!0),rtn?$("#desktop").is(":visible")?HROS.app.set():HROS.appmanage.set():HROS.app.dataWarning(),rtn},dataDockToOtherdesk:function(id,from,todesk){let rtn=!1;return todesk=eval("HROS.VAR.desk"+todesk),HROS.VAR.dock[from]!==null&&(todesk.push(HROS.VAR.dock[from]),HROS.VAR.dock.splice(from,1),rtn=!0),rtn?$("#desktop").is(":visible")?HROS.app.set():HROS.appmanage.set():HROS.app.dataWarning(),rtn},dataDockToDelete:function(id,from){let rtn=!1;return HROS.VAR.dock[from]!==null&&(HROS.VAR.dock.splice(from,1),rtn=!0),rtn?$("#desktop").is(":visible")?HROS.app.set():HROS.appmanage.set():HROS.app.dataWarning(),rtn},dataDeskToFolder:function(id,from,to,desk){let rtn=!1;return desk=eval("HROS.VAR.desk"+desk),$(HROS.VAR.folder).each(function(i){if(this.memberId===parseInt(to)&&desk[from]!==null)return HROS.VAR.folder[i].apps.push(desk[from]),HROS.VAR.folder[i].apps=HROS.VAR.folder[i].apps.sortBy(function(n){return n.memberId},!0),desk.splice(from,1),rtn=!0,!1}),rtn?$("#desktop").is(":visible")?HROS.app.set():HROS.appmanage.set():HROS.app.dataWarning(),rtn},dataDeskToDock:function(id,from,to,boa,desk){let rtn=!1;return desk=eval("HROS.VAR.desk"+desk),desk[from]!==null&&(to===0?boa==="b"?HROS.VAR.dock.splice(0,0,desk[from]):HROS.VAR.dock.splice(1,0,desk[from]):boa==="b"?HROS.VAR.dock.splice(to,0,desk[from]):HROS.VAR.dock.splice(to+1,0,desk[from]),desk.splice(from,1),HROS.VAR.dock.length>7&&(desk.push(HROS.VAR.dock[7]),HROS.VAR.dock.splice(7,1)),rtn=!0),rtn?$("#desktop").is(":visible")?HROS.app.set():HROS.appmanage.set():HROS.app.dataWarning(),rtn},dataDeskToDesk:function(id,from,to,boa,desk){let rtn=!1;return desk=eval("HROS.VAR.desk"+desk),desk[from]!==null&&(to===0?boa==="b"?desk.splice(0,0,desk[from]):desk.splice(1,0,desk[from]):boa==="b"?desk.splice(to,0,desk[from]):desk.splice(to+1,0,desk[from]),from>to?desk.splice(from+1,1):desk.splice(from,1),rtn=!0),rtn?$("#desktop").is(":visible")?HROS.app.set():HROS.appmanage.set():HROS.app.dataWarning(),rtn},dataDeskToOtherdesk:function(id,from,to,boa,todesk,fromdesk){let rtn=!1;return fromdesk=eval("HROS.VAR.desk"+fromdesk),todesk=eval("HROS.VAR.desk"+todesk),fromdesk[from]!==null&&(to===0?boa==="b"?todesk.splice(0,0,fromdesk[from]):todesk.splice(1,0,fromdesk[from]):boa==="b"?todesk.splice(to,0,fromdesk[from]):todesk.splice(to+1,0,fromdesk[from]),fromdesk.splice(from,1),rtn=!0),rtn?$("#desktop").is(":visible")?HROS.app.set():HROS.appmanage.set():HROS.app.dataWarning(),rtn},dataFolderToFolder:function(id,from,to,fromFolderId){let rtn=!1,flags=0,fromKey,toKey;return $(HROS.VAR.folder).each(function(i){this.memberId===parseInt(fromFolderId)&&HROS.VAR.folder[i].apps[from]!==null&&(fromKey=i,flags+=1);this.memberId===parseInt(to)&&(toKey=i,flags+=1)}),flags===2&&(HROS.VAR.folder[toKey].apps.push(HROS.VAR.folder[fromKey].apps[from]),HROS.VAR.folder[toKey].apps=HROS.VAR.folder[toKey].apps.sortBy(function(n){return n.appid},!0),HROS.VAR.folder[fromKey].apps.splice(from,1),rtn=!0),rtn?$("#desktop").is(":visible")?HROS.app.set():HROS.appmanage.set():HROS.app.dataWarning(),rtn},dataFolderToDock:function(id,from,to,fromFolderId,boa,desk){let rtn=!1;return desk=eval("HROS.VAR.desk"+desk),$(HROS.VAR.folder).each(function(i){if(this.memberId===parseInt(fromFolderId)&&HROS.VAR.folder[i].apps[from]!==null)return to===0?boa==="b"?HROS.VAR.dock.splice(0,0,HROS.VAR.folder[i].apps[from]):HROS.VAR.dock.splice(1,0,HROS.VAR.folder[i].apps[from]):boa==="b"?HROS.VAR.dock.splice(to,0,HROS.VAR.folder[i].apps[from]):HROS.VAR.dock.splice(to+1,0,HROS.VAR.folder[i].apps[from]),HROS.VAR.folder[i].apps.splice(from,1),HROS.VAR.dock.length>7&&(desk.push(HROS.VAR.dock[7]),HROS.VAR.dock.splice(7,1)),rtn=!0,!1}),rtn?$("#desktop").is(":visible")?HROS.app.set():HROS.appmanage.set():HROS.app.dataWarning(),rtn},dataFolderToDesk:function(id,from,to,fromFolderId,boa,desk){let rtn=!1;return desk=eval("HROS.VAR.desk"+desk),$(HROS.VAR.folder).each(function(i){if(this.memberId===parseInt(fromFolderId)&&HROS.VAR.folder[i].apps[from]!==null)return to===0?boa==="b"?desk.splice(0,0,HROS.VAR.folder[i].apps[from]):desk.splice(1,0,HROS.VAR.folder[i].apps[from]):boa==="b"?desk.splice(to,0,HROS.VAR.folder[i].apps[from]):desk.splice(to+1,0,HROS.VAR.folder[i].apps[from]),HROS.VAR.folder[i].apps.splice(from,1),rtn=!0,!1}),rtn?$("#desktop").is(":visible")?HROS.app.set():HROS.appmanage.set():HROS.app.dataWarning(),rtn},dataFolderToOtherdesk:function(id,from,todesk,fromFolderId){let rtn=!1;return todesk=eval("HROS.VAR.desk"+todesk),$(HROS.VAR.folder).each(function(i){if(this.memberId===parseInt(fromFolderId)&&HROS.VAR.folder[i].apps[from]!==null)return todesk.push(HROS.VAR.folder[i].apps[from]),HROS.VAR.folder[i].apps.splice(from,1),rtn=!0,!1}),rtn?$("#desktop").is(":visible")?HROS.app.set():HROS.appmanage.set():HROS.app.dataWarning(),rtn},dataAllDockToDesk:function(desk){desk=eval("HROS.VAR.desk"+desk);$(HROS.VAR.dock).each(function(i){desk.push(HROS.VAR.dock[i])});HROS.VAR.dock.splice(0,HROS.VAR.dock.length)},dataDeleteByAppid:function(appid){$(HROS.VAR.dock).each(function(i){if(this.appid===appid)return HROS.VAR.dock.splice(i,1),!1});for(let i=1;i<=5;i++){let desk=eval("HROS.VAR.desk"+i);$(desk).each(function(j){if(this.appid===appid)return desk.splice(j,1),this.type==="folder"&&$(HROS.VAR.folder).each(function(k){if(this.appid===appid)return HROS.VAR.folder.splice(k,1),!1}),!1})}$(HROS.VAR.folder).each(function(i){$(this.apps).each(function(j){if(this.appid===appid)return HROS.VAR.folder[i].apps.splice(j,1),!1})})}}}();HROS.appmanage=function(){return{init:function(){$("#appmanage .amg_close").off("click").on("click",function(){HROS.appmanage.close()});$("#amg_folder_container").on("contextmenu",".appbtn",function(){return!1});HROS.appmanage.move();HROS.appmanage.moveScrollbar()},set:function(){$("#desktop").hide();$("#appmanage").show();$("#amg_folder_container .folderItem").show().addClass("folderItem_turn");$("#amg_folder_container .folderInner").height($(window).height()-80);let dockAppend="";HROS.VAR.dock!==""&&$(HROS.VAR.dock).each(function(){dockAppend+=appbtnTemp({title:this.name,type:this.type,id:"d_"+this.memberId,appid:this.memberId,realappid:this.appId==0?this.memberId:this.appId,imgsrc:this.icon})});$("#amg_dock_container").html(dockAppend);for(let j=0;j<HROS.CONFIG.deskCount;j++){let desk_append="",desk=eval("HROS.VAR.desk"+(j+1));desk!==""&&$(desk).each(function(){desk_append+=appbtnTemp({title:this.name,type:this.type,id:"d_"+this.memberId,appid:this.memberId,realappid:this.appId==0?this.memberId:this.appId,imgsrc:this.icon,appsize:26})});$("#amg_folder_container .folderItem:eq("+j+") .folderInner .appbtn").remove();$("#amg_folder_container .folderItem:eq("+j+") .folderInner").append(desk_append)}HROS.appmanage.setPos();HROS.appmanage.getScrollbar()},setPos:function(){let manageDockGrid=HROS.grid.getManageDockAppGrid(),manageAppGrid=HROS.grid.getManageAppGrid();$("#amg_dock_container .appbtn").each(function(i){$(this).css({top:10,left:manageDockGrid[i].startX+6})});for(let j=0;j<5;j++)$("#amg_folder_container .folderItem:eq("+j+") .folderInner .appbtn").each(function(i){$(this).css({top:manageAppGrid[i].startY+5,left:0})})},move:function(){$("#amg_dock_container").on("mousedown",".appbtn",function(e){if(e.preventDefault(),e.stopPropagation(),e.button===0||e.button===1){let oldobj=$(this),obj=$('<div id="shortcut_shadow">'+oldobj.html()+"<\/div>"),dx=e.clientX,dy=e.clientY,cx=e.clientX,cy=e.clientY,x=dx-oldobj.offset().left,y=dy-oldobj.offset().top,lay=HROS.maskBox.desk();$(document).on("mousemove",function(e){$("body").append(obj);lay.show();cx=e.clientX<=0?0:e.clientX>=$(window).width()?$(window).width():e.clientX;cy=e.clientY<=0?0:e.clientY>=$(window).height()?$(window).height():e.clientY;(dx!==cx||dy!==cy)&&obj.css({left:cx-x,top:cy-y}).show()}).on("mouseup",function(){if($(document).off("mousemove").off("mouseup"),obj.remove(),lay.hide(),dx===cx&&dy===cy){HROS.appmanage.close();switch(oldobj.attr("type")){case"widget":case"pwidget":HROS.widget.create(oldobj.attr("realappid"),oldobj.attr("type"));break;case"window":case"pwindow":case"folder":HROS.window.create(oldobj.attr("realappid"),oldobj.attr("type"))}return!1}if(cy<=80){let movegrid=HROS.grid.searchManageDockAppGrid(cx);if(movegrid!=null&&movegrid!=oldobj.index()){let movegrid2=HROS.grid.searchManageDockAppGrid2(cx),id=oldobj.attr("appid"),from=oldobj.index(),to=movegrid,boa=movegrid2%2==0?"b":"a";HROS.base.checkLogin()?HROS.app.checkIsMoving()||HROS.app.dataDockToDock(id,from,to,boa):HROS.app.dataDockToDock(id,from,to,boa)}}else{let movedesk=parseInt(cx/($(window).width()/5)),movegrid=HROS.grid.searchManageAppGrid(cy-80+$("#amg_folder_container .folderItem:eq("+movedesk+") .folderInner").scrollTop());if(movegrid!=null){let movegrid2=HROS.grid.searchManageAppGrid2(cy-80+$("#amg_folder_container .folderItem:eq("+movedesk+") .folderInner").scrollTop()),id=oldobj.attr("appid"),from=oldobj.index(),to=movegrid,boa=movegrid2%2==0?"b":"a",desk=movedesk+1;HROS.base.checkLogin()?HROS.app.checkIsMoving()||HROS.app.dataDockToDesk(id,from,to,boa,desk)&&HROS.request.post("/desk/membermove",{model:{MoveType:"dock-desk",MemberId:id,From:from,To:desk}},function(responseText){responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.msgbox.fail(responseText.Message)}):HROS.app.dataDockToDesk(id,from,to,boa,desk)}}})}return!1});$("#amg_folder_container").on("mousedown",".appbtn:not(.add)",function(e){if(e.preventDefault(),e.stopPropagation(),e.button==0||e.button==1){let oldobj=$(this),obj=$('<div id="shortcut_shadow2">'+oldobj.html()+"<\/div>"),dx=e.clientX,dy=e.clientY,cx=e.clientX,cy=e.clientY,x=dx-oldobj.offset().left,y=dy-oldobj.offset().top,lay=HROS.maskBox.desk();$(document).on("mousemove",function(e){$("body").append(obj);lay.show();cx=e.clientX<=0?0:e.clientX>=$(window).width()?$(window).width():e.clientX;cy=e.clientY<=0?0:e.clientY>=$(window).height()?$(window).height():e.clientY;(dx!=cx||dy!=cy)&&obj.css({left:cx-x,top:cy-y}).show()}).on("mouseup",function(){if($(document).off("mousemove").off("mouseup"),obj.remove(),lay.hide(),dx==cx&&dy==cy){HROS.appmanage.close();switch(oldobj.attr("type")){case"app":HROS.window.create(oldobj.attr("realappid"),oldobj.attr("type"));break;case"widget":case"pwidget":HROS.widget.create(oldobj.attr("realappid"),oldobj.attr("type"));break;case"window":case"pwindow":case"folder":HROS.window.create(oldobj.attr("realappid"),oldobj.attr("type"))}return!1}if(cy<=80){function next(){let movegrid=HROS.grid.searchManageDockAppGrid(cx);if(movegrid!=null){let movegrid2=HROS.grid.searchManageDockAppGrid2(cx),id=oldobj.attr("appid"),from=oldobj.index(),to=movegrid,boa=movegrid2%2==0?"b":"a",desk=oldobj.parent().attr("desk");HROS.base.checkLogin()?HROS.app.checkIsMoving()||HROS.app.dataDeskToDock(id,from,to,boa,desk):HROS.app.dataDeskToDock(id,from,to,boa,desk)}}HROS.CONFIG.dockPos.toLowerCase()=="none"?$.dialog({title:"温馨提示",icon:"warning",content:"当前应用码头处于停用状态，是否开启？",ok:function(){HROS.dock.updatePos("top");next()},cancel:!0}):next()}else{let movedesk=parseInt(cx/($(window).width()/5)),movegrid=HROS.grid.searchManageAppGrid(cy-80+$("#amg_folder_container .folderItem:eq("+movedesk+") .folderInner").scrollTop());if(movedesk+1==oldobj.parent().attr("desk")){if(movegrid!=null&&movegrid!=oldobj.index()){let movegrid2=HROS.grid.searchManageAppGrid2(cy-80+$("#amg_folder_container .folderItem:eq("+movedesk+") .folderInner").scrollTop()),id=oldobj.attr("appid"),from=oldobj.index(),to=movegrid,boa=movegrid2%2==0?"b":"a",desk=movedesk+1;HROS.base.checkLogin()?HROS.app.checkIsMoving()||HROS.app.dataDeskToDesk(id,from,to,boa,desk):HROS.app.dataDeskToDesk(id,from,to,boa,desk)}}else if(movegrid!=null){let movegrid2=HROS.grid.searchManageAppGrid2(cy-80+$("#amg_folder_container .folderItem:eq("+movedesk+") .folderInner").scrollTop()),id=oldobj.attr("appid"),from=oldobj.index(),to=movegrid,boa=movegrid2%2==0?"b":"a",todesk=movedesk+1,fromdesk=oldobj.parent().attr("desk");HROS.base.checkLogin()?HROS.app.checkIsMoving()||HROS.app.dataDeskToOtherdesk(id,from,to,boa,todesk,fromdesk)&&HROS.request.post("/desk/membermove",{model:{MoveType:"desk-desk",MemberId:id,From:from,To:todesk}},function(responseText){responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.msgbox.fail(responseText.Message)}):HROS.app.dataDeskToOtherdesk(id,from,to,boa,todesk,fromdesk)}}})}return!1})},getScrollbar:function(){$("#amg_folder_container .folderInner").height($(window).height()-80);$("#amg_folder_container .folderItem").each(function(){let desk=$(this).find(".folderInner"),deskrealh=parseInt(desk.children(".appbtn:last").css("top"))+41,scrollbar=desk.next(".scrollBar"),scrollbarTop=scrollbar.position().top;scrollbar.hide();desk.scrollTop(0);desk.height()/deskrealh<1&&(scrollbar.height(desk.height()/deskrealh*desk.height()),scrollbarTop=scrollbarTop+scrollbar.height()>desk.height()?desk.height()-scrollbar.height():scrollbarTop,scrollbar.css("top",scrollbarTop).show(),desk.scrollTop(scrollbarTop/desk.height()*deskrealh))})},moveScrollbar:function(){$(".scrollBar").on("mousedown",function(e){let y,cy,deskrealh,moveh,scrollbar=$(this),desk=scrollbar.prev(".folderInner");deskrealh=parseInt(desk.children(".appbtn:last").css("top"))+41;moveh=desk.height()-scrollbar.height();y=e.clientY-scrollbar.offset().top;$(document).on("mousemove",function(e){cy=e.clientY-y-80<0?0:e.clientY-y-80>moveh?moveh:e.clientY-y-80;scrollbar.css("top",cy);desk.scrollTop(cy/desk.height()*deskrealh)}).on("mouseup",function(){$(this).off("mousemove").off("mouseup")})});$("#amg_folder_container .folderInner").on("mousewheel",function(event,delta){let desk=$(this),deskrealh=parseInt(desk.children(".appbtn:last").css("top"))+41,scrollupdown;scrollupdown=delta<0?desk.scrollTop()+120>deskrealh-desk.height()?deskrealh-desk.height():desk.scrollTop()+120:desk.scrollTop()-120<0?0:desk.scrollTop()-120;desk.stop(!1,!0).animate({scrollTop:scrollupdown},300);desk.next(".scrollBar").stop(!1,!0).animate({top:scrollupdown/deskrealh*desk.height()},300)})},resize:function(){HROS.appmanage.getScrollbar()},close:function(){$("#amg_dock_container").html("");$("#amg_folder_container .folderInner").html("");$("#desktop").show();$("#appmanage").hide();$("#amg_folder_container .folderItem").removeClass("folderItem_turn");HROS.app.set();HROS.deskTop.resize()}}}();HROS.base=function(){return{init:function(){HROS.CONFIG.memberID=JSON.parse($.cookie("User")).Id;$("body").on("contextmenu",function(){return!1});HROS.signalR.init();HROS.base.getSkin(undefined,function(arg){HROS.base.setSkin(arg,null)});HROS.zoom.init();HROS.deskTop.init();HROS.wallpaper.init();HROS.searchbar.init();HROS.startmenu.init();HROS.taskbar.init();HROS.dock.init();HROS.app.init();HROS.widget.init();HROS.window.init();HROS.folderView.init();HROS.appmanage.init();HROS.popupMenu.init();HROS.lock.init();HROS.hotkey.init();HROS.base.run()},login:function(){$(".login").animate({top:0},500,function(){changeTabindex("login")})},logout:function(){HROS.signalR.stop(function(){HROS.request.get("/desk/logout",{},function(){location.reload()})})},checkLogin:function(){return parseInt(HROS.CONFIG.memberID)!==0?!0:!1},getSkin:function(objSkin,callback){objSkin===undefined?HROS.request.get("/desk/getskin",{},function(responseText){responseText.IsSuccess&&typeof callback=="function"&&callback&&callback(responseText.Model)}):this.setSkin(objSkin,callback)},setSkin:function(skin,callback){function styleOnload(node,callback){node.attachEvent?node.attachEvent("onload",callback):setTimeout(function(){poll(node,callback)},0)}function poll(node,callback){if(!callback.isCalled){let isLoaded=!1;if(/webkit/i.test(navigator.userAgent))node.sheet&&(isLoaded=!0);else if(node.sheet)try{node.sheet.cssRules&&(isLoaded=!0)}catch(ex){ex.code===1e3&&(isLoaded=!0)}isLoaded?setTimeout(function(){callback()},1):setTimeout(function(){poll(node,callback)},1)}}$("#window-skin").attr("id","window-skin-ready2remove");let css=document.createElement("link");css.href="/images/skins/"+skin+".css?"+version;css.rel="stylesheet";css.id="window-skin";$("head").append(css);styleOnload(css,function(){$("#window-skin-ready2remove").remove();HROS.CONFIG.skin=skin;callback&&callback()})},run:function(){let url=location.search,request={};if(url.indexOf("?")!==-1){let str=url.substr(1),strs=str.split("&");for(let i=0;i<strs.length;i++)request[strs[i].split("=")[0]]=unescape(strs[i].split("=")[1])}typeof request.run!="undefined"&&typeof request.type!="undefined"&&(request.type==="app"?HROS.window.create(request.run):HROS.widget.checkCookie(request.run,request.type)||HROS.widget.create(request.run))}}}();HROS.deskTop=function(){return{init:function(){$(window).on("resize",function(){HROS.deskTop.resize()});$("body").on("click","#desktop",function(){HROS.popupMenu.hide();HROS.folderView.hide();HROS.searchbar.hide();HROS.startmenu.hide()}).on("contextmenu","#desktop",function(e){HROS.popupMenu.hide();HROS.folderView.hide();HROS.searchbar.hide();HROS.startmenu.hide();let popupmenu=HROS.popupMenu.desk(),l=$(window).width()-e.clientX<popupmenu.width()?e.clientX-popupmenu.width():e.clientX,t=$(window).height()-e.clientY<popupmenu.height()?e.clientY-popupmenu.height():e.clientY;return popupmenu.css({left:l,top:t}).show(),!1})},resize:function(){$("#desktop").is(":visible")?(HROS.dock.setPos(),HROS.app.setPos(),HROS.window.setPos(),HROS.folderView.setPos()):HROS.appmanage.resize();HROS.wallpaper.set(!1)},updateDefaultDesk:function(i){HROS.base.checkLogin()&&HROS.request.post("/desk/modifydefaultdesk",{deskNum:i},function(responseText){responseText.IsSuccess?(NewCrm.msgbox.success("默认桌面更新成功"),$(".dock-pagination").find("a").each(function(k){parseInt(i)===k+1&&$(this).trigger("click")})):NewCrm.msgbox.fail("默认桌面更新失败")})},modifyWallpaperSource:function(value){HROS.base.checkLogin()&&HROS.request.post("/desk/modifywallpapersource",{source:value},function(responseText){responseText.IsSuccess?HROS.wallpaper.get(function(){HROS.wallpaper.set()}):NewCrm.msgbox.fail(responseText.Message)})}}}();HROS.dock=function(){return{init:function(){HROS.dock.getPos(function(){HROS.dock.setPos()});HROS.dock.move();let dockShowtopFunc;$("#dock-container").on("mouseenter",function(){dockShowtopFunc=setTimeout(function(){$("#dock-container").addClass("showtop")},300)}).on("mouseleave",function(){clearInterval(dockShowtopFunc);$(this).removeClass("showtop")});$("body").on("contextmenu","#dock-container",function(e){HROS.popupMenu.hide();HROS.folderView.hide();HROS.searchbar.hide();HROS.startmenu.hide();let popupmenu=HROS.popupMenu.dock(),l=$(window).width()-e.clientX<popupmenu.width()?e.clientX-popupmenu.width():e.clientX,t=$(window).height()-e.clientY<popupmenu.height()?e.clientY-popupmenu.height():e.clientY;return popupmenu.css({left:l,top:t}).show(),!1});$("#dock-bar .dock-tool-setting").on("mousedown",function(){return!1}).on("click",function(){HROS.base.checkLogin()?HROS.window.createTemp({appid:"hoorayos-zmsz",title:"桌面设置",url:"/Desk/ConfigDesk",width:750,height:450,isflash:!1}):HROS.base.login()});$("#dock-bar .dock-tool-style").on("mousedown",function(){return!1}).on("click",function(){HROS.base.checkLogin()?HROS.window.createTemp({appid:"hoorayos-ztsz",title:"主题设置",url:"/Desk/SystemWallPaper",width:580,height:520,isflash:!1}):HROS.base.login()});$("#dock-bar .dock-tool-appmanage").on("mousedown",function(){return!1}).on("click",function(){HROS.appmanage.set()});$("#dock-bar .dock-tool-search").on("mousedown",function(){return!1}).on("click",function(e){e.stopPropagation();HROS.searchbar.get()});$("#dock-bar .pagination").on("mousedown",function(){return!1}).on("click",function(){HROS.dock.switchDesk($(this).attr("index"))});$("#dock-bar .dock-tool-start").on("mousedown",function(){return!1}).on("click",function(){return HROS.startmenu.show(),!1})},setPos:function(){HROS.dock.switchDesk(HROS.CONFIG.desk);let desktop=$("#desk-"+HROS.CONFIG.desk),desktops=$("#desk .desktop-container"),deskW=desktop.css("width","100%").width(),deskH=desktop.css("height","100%").height();$("#dock-container").removeClass("dock-top dock-left dock-right");$("#dock-bar").removeClass("top-bar left-bar right-bar").hide();HROS.CONFIG.dockPos.toLowerCase()==="top"?($("#dock-bar").addClass("top-bar").children("#dock-container").addClass("dock-top"),desktops.css({width:deskW,height:deskH-$("#task-bar").height()-$("#dock-bar").height(),left:deskW,top:$("#dock-bar").height()}),desktop.css({left:0}),$("#dock-bar").show()):HROS.CONFIG.dockPos.toLowerCase()==="left"?($("#dock-bar").addClass("left-bar").children("#dock-container").addClass("dock-left"),desktops.css({width:deskW-$("#dock-bar").width(),height:deskH-$("#task-bar").height(),left:deskW+$("#dock-bar").width(),top:0}),desktop.css({left:$("#dock-bar").width()}),$("#dock-bar").show()):HROS.CONFIG.dockPos.toLowerCase()==="right"?($("#dock-bar").addClass("right-bar").children("#dock-container").addClass("dock-right"),desktops.css({width:deskW-$("#dock-bar").width(),height:deskH-$("#task-bar").height(),left:deskW,top:0}),desktop.css({left:0}),$("#dock-bar").show()):HROS.CONFIG.dockPos.toLowerCase()==="none"&&(desktops.css({width:deskW,height:deskH-$("#task-bar").height(),left:deskW,top:0}),desktop.css({left:0}));HROS.taskbar.resize();HROS.folderView.setPos()},updatePos:function(pos){pos!==HROS.CONFIG.dockPos.toLowerCase()&&typeof pos!="undefined"&&(HROS.CONFIG.dockPos=pos.toLowerCase(),pos==="none"&&HROS.app.dataAllDockToDesk(HROS.CONFIG.desk),HROS.base.checkLogin()&&HROS.request.post("/desk/modifydockposition",{Pos:pos,DeskNum:HROS.CONFIG.desk},function(responseText){responseText.IsSuccess?(NewCrm.msgbox.success("应用码头位置更新成功"),HROS.dock.setPos(),HROS.app.set()):NewCrm.msgbox.fail("应用码头位置更新失败")}))},move:function(){$("#dock-container").on("mousedown",function(e){if(e.button===0||e.button===1){let lay=HROS.maskBox.dock(),location;$(document).on("mousemove",function(e){lay.show();location=e.clientY<lay.height()*.2?"top":e.clientX<lay.width()*.5?"left":"right";$(".dock_drap_effect").removeClass("hover");$(".dock_drap_effect_"+location).addClass("hover")}).on("mouseup",function(){$(document).off("mousemove").off("mouseup");lay.hide();HROS.dock.updatePos(location)})}})},switchDesk:function(deskNumber){deskNumber=/^\+?[1-5]*$/.test(deskNumber)?deskNumber:1;let pagination=$("#dock-bar .dock-pagination"),currindex=HROS.CONFIG.desk,switchindex=deskNumber,currleft=$("#desk-"+currindex).offset().left,switchleft=$("#desk-"+switchindex).offset().left;currindex!==switchindex?$("#desk-"+switchindex).hasClass("animated")||$("#desk-"+currindex).hasClass("animated")||($("#desk-"+currindex).addClass("animated").animate({left:switchleft},500,"easeInOutCirc",function(){$(this).removeClass("animated")}),$("#desk-"+switchindex).addClass("animated").animate({left:currleft},500,"easeInOutCirc",function(){$(this).removeClass("animated");pagination.removeClass("current-pagination-"+currindex).addClass("current-pagination-"+switchindex);HROS.CONFIG.desk=switchindex})):pagination.removeClass("current-pagination-"+currindex).addClass("current-pagination-"+switchindex)},getPos:function(callback){HROS.request.get("/desk/getdockpos",{},function(responseText){responseText.IsSuccess&&(HROS.CONFIG.dockPos=responseText.Model.toLowerCase(),typeof callback=="function"&&callback&&callback())})}}}();HROS.folderView=function(){return{init:function(){$("body").on("click",".quick_view_container",function(){HROS.popupMenu.hide()}).on("click",".quick_view_container_open",function(){HROS.window.create($(this).parents(".quick_view_container").attr("appid"),"folder");HROS.folderView.hide()}).on("click",".appbtn",function(){HROS.popupMenu.hide();HROS.folderView.hide();HROS.searchbar.hide();HROS.startmenu.hide()});HROS.folderView.moveScrollbar()},get:function(obj){setTimeout(function(){let iswindowopen=!1;$("body .quick_view_container").each(function(){if($(this).attr("realappid")==obj.attr("realappid"))return iswindowopen=!0,!1});let folderViewId=null;iswindowopen?folderViewId="#qv_"+obj.attr("appid"):HROS.folderView.hide();let sc="";$(HROS.VAR.folder).each(function(){if(this.memberId==parseInt(obj.attr("appid")))return sc=this.apps,!1});let folderViewHtml="",height=0;sc!=""?($(sc).each(function(){folderViewHtml+=appbtnTemp({title:this.name,type:this.type,id:"d_"+this.memberId,appid:this.memberId,realappid:this.appId==0?this.memberId:this.appId,imgsrc:this.icon})}),height+=sc.length%4==0?Math.floor(sc.length/4)*60:(Math.floor(sc.length/4)+1)*60):(folderViewHtml="文件夹为空",height+=30);let left,top;obj.parent("div").hasClass("dock-applist")?(left=parseInt(obj.attr("left"))+obj.width(),top=parseInt(obj.attr("top"))):(left=parseInt(obj.attr("left"))+obj.width(),top=parseInt(obj.attr("top"))-20);let isScrollbar=!1;if(height+top+44>$(window).height()){let outH=height+top+44-$(window).height();outH<=top?top-=outH:(height-=outH-top,top=0,isScrollbar=!0)}left+330>$(window).width()?(left-=330+obj.width(),iswindowopen?($(folderViewId+" .quick_view_container_list_in").html("").append(folderViewHtml),$(folderViewId).stop(!0,!1).animate({left:left,top:top},500),$(folderViewId+" .perfect_nine_m_l_t").stop(!0,!1).animate({top:0,height:Math.ceil((height+24)/2)},200),$(folderViewId+" .perfect_nine_m_l_m").stop(!0,!1).animate({top:Math.ceil((height+24)/2)},200).hide(),$(folderViewId+" .perfect_nine_m_l_b").stop(!0,!1).animate({top:Math.ceil((height+24)/2),height:Math.ceil((height+24)/2)+20},200),$(folderViewId+" .perfect_nine_m_r_t").stop(!0,!1).animate({top:0,height:obj.offset().top-top},200),$(folderViewId+" .perfect_nine_m_r_m").stop(!0,!1).animate({top:parseInt(obj.attr("top"))-top},200).show(),$(folderViewId+" .perfect_nine_m_r_b").stop(!0,!1).animate({top:parseInt(obj.attr("top"))-top+20,height:height+24-(parseInt(obj.attr("top"))-top)-0},200),$(folderViewId+" .quick_view_container_list_in").stop(!0,!1).animate({height:height},200)):$("body").append(folderViewTemp({id:"qv_"+obj.attr("appid"),appid:obj.attr("appid"),realappid:obj.attr("realappid"),apps:folderViewHtml,top:top,left:left,height:height,mlt:Math.ceil((height+24)/2),mlm:!1,mlb:Math.ceil((height+24)/2),mrt:obj.offset().top-top,mrm:!0,mrb:height+24-(obj.offset().top-top)-20}))):iswindowopen?($(folderViewId+" .quick_view_container_list_in").html("").append(folderViewHtml),$(folderViewId).stop(!0,!1).animate({left:left,top:top},500),$(folderViewId+" .perfect_nine_m_l_t").stop(!0,!1).animate({top:0,height:parseInt(obj.attr("top"))-top},200),$(folderViewId+" .perfect_nine_m_l_m").stop(!0,!1).animate({top:parseInt(obj.attr("top"))-top},200).show(),$(folderViewId+" .perfect_nine_m_l_b").stop(!0,!1).animate({top:parseInt(obj.attr("top"))-top+20,height:height+24-(parseInt(obj.attr("top"))-top)-20},200),$(folderViewId+" .perfect_nine_m_r_t").stop(!0,!1).animate({top:0,height:Math.ceil((height+24)/2)},200),$(folderViewId+" .perfect_nine_m_r_m").stop(!0,!1).animate({top:Math.ceil((height+24)/2)},200).hide(),$(folderViewId+" .perfect_nine_m_r_b").stop(!0,!1).animate({top:Math.ceil((height+24)/2),height:Math.ceil((height+24)/2)},200),$(folderViewId+" .quick_view_container_list_in").stop(!0,!1).animate({height:height},200)):$("body").append(folderViewTemp({id:"qv_"+obj.attr("appid"),appid:obj.attr("appid"),realappid:obj.attr("realappid"),apps:folderViewHtml,top:top,left:left,height:height,mlt:obj.offset().top-top,mlm:!0,mlb:height+24-(obj.offset().top-top)-20,mrt:Math.ceil((height+24)/2),mrm:!1,mrb:Math.ceil((height+24)/2)}));let view="#quick_view_container_list_in_"+obj.attr("appid"),scrollbar="#quick_view_container_list_"+obj.attr("appid")+" .scrollBar";$("#quick_view_container_list_"+obj.attr("appid")+" .scrollBar_bgc").hide();$(scrollbar).hide().height(0);isScrollbar&&($("#quick_view_container_list_"+obj.attr("appid")+" .scrollBar_bgc").show(),$(scrollbar).show().height($(view).height()/(Math.ceil($(view).children().length/4)*60)*$(view).height()))},0)},setPos:function(){$("body .quick_view_container").each(function(){HROS.folderView.get($("#d_"+$(this).attr("appid")))})},moveScrollbar:function(){$("body").on("mousedown",".quick_view_container .quick_view_container_list .scrollBar",function(e){let scrollbar=$(this),container=scrollbar.prev(".quick_view_container_list_in"),offsetTop=container.offset().top,y,cy,containerrealh,moveh;containerrealh=Math.ceil(container.children().length/4)*60;moveh=container.height()-scrollbar.height();y=e.clientY-scrollbar.offset().top;$(document).on("mousemove",function(e){cy=e.clientY-y-offsetTop<0?0:e.clientY-y-offsetTop>moveh?moveh:e.clientY-y-offsetTop;scrollbar.css("top",cy);container.scrollTop(cy/container.height()*containerrealh)}).on("mouseup",function(){$(this).off("mousemove").off("mouseup")})});$("body").on("mousewheel",".quick_view_container_list_in",function(event,delta){let desk=$(this),deskrealh=Math.ceil($(this).children().length/4)*60,scrollupdown;scrollupdown=delta<0?desk.scrollTop()+40>deskrealh-desk.height()?deskrealh-desk.height():desk.scrollTop()+40:desk.scrollTop()-40<0?0:desk.scrollTop()-40;desk.stop(!1,!0).animate({scrollTop:scrollupdown},300);$(this).next(".scrollBar").stop(!1,!0).animate({top:scrollupdown/deskrealh*desk.height()},300)})},hide:function(){$(".quick_view_container").remove()}}}();HROS.grid=function(){return{getAppGrid:function(){let width=$("#desk-"+HROS.CONFIG.desk).width()-HROS.CONFIG.appButtonLeft,height=$("#desk-"+HROS.CONFIG.desk).height()-HROS.CONFIG.appButtonTop,top=HROS.CONFIG.appButtonTop,left=HROS.CONFIG.appButtonLeft,appGrid=[],offsetTop=HROS.CONFIG.appSize=="s"?80:100,offsetLeft=HROS.CONFIG.appSize=="s"?100:120;for(let i=0;i<1e4;i++)appGrid.push({startY:top,endY:top+offsetTop,startX:left,endX:left+offsetLeft}),HROS.CONFIG.appXY.toLowerCase()==="x"?(left+=offsetLeft,left+offsetLeft>width&&(top+=offsetTop,left=HROS.CONFIG.appButtonLeft)):(top+=offsetTop,top+offsetTop>height&&(top=HROS.CONFIG.appButtonTop,left+=offsetLeft));return appGrid},searchAppGrid:function(x,y){let grid=HROS.grid.getAppGrid(),flag=null;for(let i=0;i<grid.length;i++)if(x>=grid[i].startX&&x<=grid[i].endX&&y>=grid[i].startY&&y<=grid[i].endY){flag=i;break}return flag},searchAppGrid2:function(x,y){let grid=HROS.grid.getAppGrid(),grid2=[];for(let i=0;i<grid.length;i++){let height=grid[i].endY-grid[i].startY,width=grid[i].endX-grid[i].startX,halfH=height/2,halfW=width/2;HROS.CONFIG.appXY.toLowerCase()=="x"?grid2.push({startY:grid[i].startY,endY:grid[i].startY+height,startX:grid[i].startX,endX:grid[i].startX+halfW},{startY:grid[i].startY,endY:grid[i].startY+height,startX:grid[i].startX+halfW,endX:grid[i].endX}):grid2.push({startY:grid[i].startY,endY:grid[i].startY+halfH,startX:grid[i].startX,endX:grid[i].startX+width},{startY:grid[i].startY+halfH,endY:grid[i].endY,startX:grid[i].startX,endX:grid[i].startX+width})}let flag=null;for(let i=0;i<grid2.length;i++)if(x>=grid2[i].startX&&x<=grid2[i].endX&&y>=grid2[i].startY&&y<=grid2[i].endY){flag=i;break}return flag},getDockAppGrid:function(){let height=$("#dock-bar .dock-applist").height(),dockAppGrid=[],top=0,left=0,offsetTop=68,offsetLeft=68;for(let i=0;i<7;i++)dockAppGrid.push({startY:top,endY:top+offsetTop,startX:left,endX:left+offsetLeft}),top+=offsetTop,top+offsetTop>height&&(top=0,left+=offsetLeft);return dockAppGrid},searchDockAppGrid:function(x,y){let grid=HROS.grid.getDockAppGrid(),flag=null;for(let i=0;i<grid.length;i++)if(x>=grid[i].startX&&x<=grid[i].endX&&y>=grid[i].startY&&y<=grid[i].endY){flag=i;break}return flag},searchDockAppGrid2:function(x,y){let grid=HROS.grid.getDockAppGrid(),grid2=[];for(let i=0;i<grid.length;i++){let height=grid[i].endY-grid[i].startY,width=grid[i].endX-grid[i].startX,halfH=height/2,halfW=width/2;HROS.CONFIG.dockPos.toLowerCase()=="top"?grid2.push({startY:grid[i].startY,endY:grid[i].startY+height,startX:grid[i].startX,endX:grid[i].startX+halfW},{startY:grid[i].startY,endY:grid[i].startY+height,startX:grid[i].startX+halfW,endX:grid[i].endX}):grid2.push({startY:grid[i].startY,endY:grid[i].startY+halfH,startX:grid[i].startX,endX:grid[i].startX+width},{startY:grid[i].startY+halfH,endY:grid[i].endY,startX:grid[i].startX,endX:grid[i].startX+width})}let flag=null;for(let i=0;i<grid2.length;i++)if(x>=grid2[i].startX&&x<=grid2[i].endX&&y>=grid2[i].startY&&y<=grid2[i].endY){flag=i;break}return flag},getFolderGrid:function(){let folderGrid=[];return $(".quick_view_container, .folder-window:visible").each(function(){folderGrid.push({zIndex:$(this).css("z-index"),id:$(this).attr("appid"),startY:$(this).offset().top,endY:$(this).offset().top+$(this).height(),startX:$(this).offset().left,endX:$(this).offset().left+$(this).width()})}),folderGrid.sort(function(x,y){return y.zIndex-x.zIndex}),folderGrid},searchFolderGrid:function(x,y){let folderGrid=HROS.grid.getFolderGrid(),flag=null;for(let i=0;i<folderGrid.length;i++)if(x>=folderGrid[i].startX&&x<=folderGrid[i].endX&&y>=folderGrid[i].startY&&y<=folderGrid[i].endY){flag=folderGrid[i].id;break}return flag},getManageDockAppGrid:function(){let manageDockAppGrid=[],left=20;for(let i=0;i<100;i++)manageDockAppGrid.push({startX:left,endX:left+70}),left+=70;return manageDockAppGrid},searchManageDockAppGrid:function(x){let grid=HROS.grid.getManageDockAppGrid(),flag=null;for(let i=0;i<grid.length;i++)if(x>=grid[i].startX&&x<=grid[i].endX){flag=i;break}return flag},searchManageDockAppGrid2:function(x){let grid=HROS.grid.getManageDockAppGrid(),grid2=[];for(let i=0;i<grid.length;i++){let width=grid[i].endX-grid[i].startX,halfW=width/2;grid2.push({startX:grid[i].startX,endX:grid[i].startX+halfW},{startX:grid[i].startX+halfW,endX:grid[i].endX})}let flag=null;for(let i=0;i<grid2.length;i++)if(x>=grid2[i].startX&&x<=grid2[i].endX){flag=i;break}return flag},getManageAppGrid:function(){let manageAppGrid=[],top=0;for(let i=0;i<1e4;i++)manageAppGrid.push({startY:top,endY:top+40}),top+=40;return manageAppGrid},searchManageAppGrid:function(y){let grid=HROS.grid.getManageAppGrid(),flag=null;for(let i=0;i<grid.length;i++)if(y>=grid[i].startY&&y<=grid[i].endY){flag=i;break}return flag},searchManageAppGrid2:function(y){let grid=HROS.grid.getManageAppGrid(),grid2=[];for(let i=0;i<grid.length;i++){let height=grid[i].endY-grid[i].startY,width=grid[i].endX-grid[i].startX,halfH=height/2;grid2.push({startY:grid[i].startY,endY:grid[i].startY+halfH},{startY:grid[i].startY+halfH,endY:grid[i].endY})}let flag=null;for(let i=0;i<grid2.length;i++)if(y>=grid2[i].startY&&y<=grid2[i].endY){flag=i;break}return flag}}}();HROS.hotkey=function(){return{init:function(){Mousetrap.bind(["backspace"],function(){return!1});Mousetrap.bind(["alt+d"],function(){return HROS.window.hideAll(),!1});Mousetrap.bind(["ctrl+up","command+up"],function(){return HROS.appmanage.set(),!1});Mousetrap.bind(["ctrl+f","command+f"],function(){return HROS.searchbar.get(),!1});Mousetrap.bind(["ctrl+1","command+1"],function(){return HROS.dock.switchDesk(1),!1});Mousetrap.bind(["ctrl+2","command+2"],function(){return HROS.dock.switchDesk(2),!1});Mousetrap.bind(["ctrl+3","command+3"],function(){return HROS.dock.switchDesk(3),!1});Mousetrap.bind(["ctrl+4","command+4"],function(){return HROS.dock.switchDesk(4),!1});Mousetrap.bind(["ctrl+5","command+5"],function(){return HROS.dock.switchDesk(5),!1});Mousetrap.bind(["ctrl+left","command+left"],function(){return parseInt(HROS.CONFIG.desk)-1<1?HROS.dock.switchDesk(5):HROS.dock.switchDesk(parseInt(HROS.CONFIG.desk)-1),!1});Mousetrap.bind(["ctrl+right","command+right"],function(){return parseInt(HROS.CONFIG.desk)+1>5?HROS.dock.switchDesk(1):HROS.dock.switchDesk(parseInt(HROS.CONFIG.desk)+1),!1});Mousetrap.bind(["ctrl+l","command+l"],function(){return HROS.lock.show(),!1})}}}();HROS.lock=function(){return{state:"nolock",init:function(){Mousetrap.bind(["space"],function(){return $("#lock").click(),!1});$("body").on("click","#lock",function(){$("#lock-info").is(":visible")?($("#lock .title").animate({top:"10%"},500),$("#lock .tip").animate({top:"80%"},500),$("#lock-info").fadeOut(),Mousetrap.bind(["space"],function(){return $("#lock").click(),!1}),Mousetrap.unbind("esc")):($("#lock .title").animate({top:"-200px"},500),$("#lock .tip").animate({top:"100%"},500),$("#lock-info").fadeIn(),$("#lockpassword").val("").focus(),$("#lock-info .text-tip").text(""),Mousetrap.bind(["esc"],function(){return $("#lock").click(),!1}),Mousetrap.unbind("space"))});$("body").on("click","#lock-info",function(){return!1});$("body").on("click","#lockbtn",function(){$("#lockpassword").val()!==""?HROS.request.post("/desk/unlockscreen",{unlockPassword:$("#lockpassword").val()},function(responseText){responseText.IsSuccess?HROS.lock.hide():($("#lockpassword").val("").focus(),$("#lock-info .text-tip").text("解锁密码错误"))}):$("#lock-info .text-tip").text("请输入解锁密码")});$("body").on("keydown","#lockpassword",function(e){e.keyCode=="13"&&$("#lockbtn").click()})},show:function(){if($("#lock").length==0)if(HROS.base.checkLogin()){let lock=function(){$("#desktop").hide();let userinfo=JSON.parse($.cookie("User"));$("body").append(lockTemp({avatar:userinfo.UserFace,userinfoname:userinfo.Name}));let getTimeDateWeek=function(){let time=new Date;$("#lock .time").text((time.getHours()<10?"0"+time.getHours():time.getHours())+":"+(time.getMinutes()<10?"0"+time.getMinutes():time.getMinutes()));let date=time.getFullYear()+"/"+(time.getMonth()+1)+"/"+time.getDate()+"，星期";switch(time.getDay()){case 1:date+="一";break;case 2:date+="二";break;case 3:date+="三";break;case 4:date+="四";break;case 5:date+="五";break;case 6:date+="六";break;default:date+="日"}$("#lock .week").text(date)};getTimeDateWeek();let lockFunc=setInterval(function(){let iswarning=!1;$("#desktop").is(":visible")&&(iswarning=!0);$("#lock").length==0&&(iswarning=!0);$("#lock").is(":hidden")&&(iswarning=!0);iswarning&&(clearInterval(lockFunc),$("#lock").remove(),HROS.lock.show());getTimeDateWeek()},1e3)};parseInt(HROS.CONFIG.lockPwdAndLoginPwd)?$.dialog({title:"温馨提示",icon:"warning",content:"解锁密码默认为登录密码，是否要先进行修改？",button:[{name:"继续锁定",callback:function(){lock()},focus:!0},{name:"修改解锁密码",callback:function(){HROS.window.createTemp({appid:"zhsz",title:"账号设置",url:"/usersetting/index?target=usersafe",width:550,height:580})}}]}):lock()}else $.dialog({title:"温馨提示",icon:"warning",content:"锁定功能需要登录后才能使用,为了更好的操作,是否登录?",ok:function(){HROS.base.login()}})},hide:function(){clearInterval(lockFunc);$("#lock").remove();$("#desktop").show()}}}();HROS.maskBox=function(){return{desk:function(){return TEMP.maskBoxDesk||(TEMP.maskBoxDesk=$('<div id="maskbox"><\/div>'),$("body").append(TEMP.maskBoxDesk)),TEMP.maskBoxDesk},dock:function(){return TEMP.maskBoxDock||(TEMP.maskBoxDock=$('<div id="maskbox-dockdrap"><div id="docktop" class="dock_drap_effect dock_drap_effect_top"><\/div><div id="dockleft" class="dock_drap_effect dock_drap_effect_left"><\/div><div id="dockright" class="dock_drap_effect dock_drap_effect_right"><\/div><div id="dockmask" class="dock_drap_mask"><div class="dock_drop_region_top"><div class="text">拖放至顶部<\/div><\/div><div class="dock_drop_region_left"><div class="text">拖放至左侧<\/div><\/div><div class="dock_drop_region_right"><div class="text">拖放至右侧<\/div><\/div><\/div><\/div>'),$("body").append(TEMP.maskBoxDock)),TEMP.maskBoxDock},copyright:function(){return TEMP.maskBoxCopyright||(TEMP.maskBoxCopyright=$('<div id="maskbox-copyright"><\/div>'),$("body").append(TEMP.maskBoxCopyright)),TEMP.maskBoxCopyright}}}();HROS.popupMenu=function(){return{init:function(){$(".popup-menu").on("contextmenu",function(){return!1});$("body").on("mouseenter",".popup-menu li",function(){$(this).children(".popup-menu").length==1&&($(this).children("a").addClass("focus"),$(this).children(".popup-menu").show(),$(this).parents(".popup-menu").offset().left+$(this).parents(".popup-menu").width()*2+10<$(window).width()?$(this).children(".popup-menu").css({left:$(this).parents(".popup-menu").width()-5,top:0}):$(this).children(".popup-menu").css({left:-1*$(this).parents(".popup-menu").width(),top:0}),$(this).children(".popup-menu").offset().top+$(this).children(".popup-menu").height()+10>$(window).height()&&$(this).children(".popup-menu").css({top:$(window).height()-$(this).children(".popup-menu").height()-$(this).children(".popup-menu").offset().top-10}))}).on("mouseleave",".popup-menu li",function(){$(this).children("a").removeClass("focus");$(this).children(".popup-menu").hide()})},app:function(obj){if(HROS.window.show2under(),!TEMP.popupMenuApp){let internalHtml="";internalHtml+='<div class="popup-menu app-menu"><ul>';internalHtml+='<li style="border-bottom:1px solid #F0F0F0"><a menu="open" href="###">打开<\/a><\/li>';internalHtml+="<li>";internalHtml+='<a menu="move" href="###">移动到<b class="arrow">»<\/b><\/a>';internalHtml+='<div class="popup-menu"><ul>';for(let i=1;i<=HROS.CONFIG.deskCount;i++)internalHtml+='<li><a menu="moveto" desk="'+i+'" href="###">桌面'+i+"<\/a><\/li>";internalHtml+="<\/ul><\/div>";internalHtml+="<\/li>";internalHtml+='<li><a menu="edit" href="###"><b class="edit"><\/b>编辑<\/a><\/li>';internalHtml+='<li><a menu="del" href="###"><b class="uninstall"><\/b>卸载<\/a><\/li>';internalHtml+="<\/ul><\/div>";TEMP.popupMenuApp=$(internalHtml);$("body").append(TEMP.popupMenuApp)}$('.app-menu a[menu="moveto"]').removeClass("disabled");obj.parent().hasClass("desktop-apps-container")&&$('.app-menu a[menu="moveto"]').each(function(){$(this).attr("desk")==HROS.CONFIG.desk&&$(this).addClass("disabled")});$('.app-menu a[menu="moveto"]').off("click").on("click",function(){let id=obj.attr("appid"),from=obj.index(),to=99999,todesk=$(this).attr("desk"),fromdesk=HROS.CONFIG.desk,fromfolderid=obj.parents(".folder-window").attr("appid")||obj.parents(".quick_view_container").attr("appid");if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving())obj.parent().hasClass("dock-applist")?HROS.app.dataDockToOtherdesk(id,from,todesk)&&HROS.request.post("/desk/membermove",{model:{MoveType:"desk-desk",MemberId:id,From:from,To:todesk}},function(responseText){responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.msgbox.fail(responseText.Message)}):obj.parent().hasClass("desktop-apps-container")?HROS.app.dataDeskToOtherdesk(id,from,to,"a",todesk,fromdesk)&&HROS.request.post("/desk/membermove",{model:{MoveType:"desk-desk",MemberId:id,From:from,To:todesk}},function(responseText){responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.msgbox.fail(responseText.Message)}):HROS.app.dataFolderToOtherdesk(id,from,todesk,fromfolderid)&&HROS.request.post("/desk/membermove",{model:{MoveType:"folder-desk",MemberId:id,From:from,To:todesk}},function(responseText){responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.msgbox.fail(responseText.Message)})}else obj.parent().hasClass("dock-applist")?HROS.app.dataDockToOtherdesk(id,from,todesk):obj.parent().hasClass("desktop-apps-container")?HROS.app.dataDeskToOtherdesk(id,from,to,"a",todesk,fromdesk):HROS.app.dataFolderToOtherdesk(id,from,todesk,fromfolderid);$(".popup-menu").hide()});$('.app-menu a[menu="open"]').off("click").on("click",function(){HROS.window.create(obj.attr("realappid"),obj.attr("type"));$(".popup-menu").hide()});$('.app-menu a[menu="edit"]').off("click").on("click",function(){HROS.base.checkLogin()?$.dialog.open("/desk/configmember?memberId="+obj.attr("realappid"),{id:"editdialog",title:"编辑应用“"+obj.children("span").text()+"”",width:600,height:350}):HROS.base.login();$(".popup-menu").hide()});$('.app-menu a[menu="del"]').off("click").on("click",function(){HROS.app.dataDeleteByAppid(obj.attr("appid"));HROS.widget.removeCookie(obj.attr("realappid"),obj.attr("type"));HROS.app.remove(obj.attr("appid"),function(){obj.find("img, span").show().animate({opacity:"toggle",width:0,height:0},500,function(){obj.remove();HROS.deskTop.resize()})});$(".popup-menu").hide()});return TEMP.popupMenuApp},papp:function(obj){if(HROS.window.show2under(),!TEMP.popupMenuPapp){let internalHtml="";internalHtml+='<div class="popup-menu papp-menu"><ul>';internalHtml+='<li style="border-bottom:1px solid #F0F0F0"><a menu="open" href="###">打开<\/a><\/li>';internalHtml+="<li>";internalHtml+='<a menu="move" href="###">移动到<b class="arrow">»<\/b><\/a>';internalHtml+='<div class="popup-menu"><ul>';for(let i=1;i<=HROS.CONFIG.deskCount;i++)internalHtml+='<li><a menu="moveto" desk="'+i+'" href="###">桌面'+i+"<\/a><\/li>";internalHtml+="<\/ul><\/div>";internalHtml+="<\/li>";internalHtml+='<li><a menu="edit" href="###"><b class="edit"><\/b>编辑<\/a><\/li>';internalHtml+='<li><a menu="del" href="###"><b class="del"><\/b>删除<\/a><\/li>';internalHtml+="<\/ul><\/div>";TEMP.popupMenuPapp=$(internalHtml);$("body").append(TEMP.popupMenuPapp)}$('.papp-menu a[menu="moveto"]').removeClass("disabled");obj.parent().hasClass("desktop-apps-container")&&$('.papp-menu a[menu="moveto"]').each(function(){$(this).attr("desk")==HROS.CONFIG.desk&&$(this).addClass("disabled")});$('.papp-menu a[menu="moveto"]').off("click").on("click",function(){let id=obj.attr("appid"),from=obj.index(),to=99999,todesk=$(this).attr("desk"),fromdesk=HROS.CONFIG.desk,fromfolderid=obj.parents(".folder-window").attr("appid")||obj.parents(".quick_view_container").attr("appid");if(HROS.base.checkLogin())obj.parent().hasClass("dock-applist")?HROS.app.dataDockToOtherdesk(id,from,todesk)&&HROS.request.post("/desk/membermove",{model:{MoveType:"dock-otherdesk",MemberId:id,From:from,To:todesk}},function(responseText){responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.msgbox.fail(responseText.Message)}):obj.parent().hasClass("desktop-apps-container")?HROS.app.dataDeskToOtherdesk(id,from,to,"a",todesk,fromdesk)&&HROS.request.post("/desk/membermove",{model:{MoveType:"desk-desk",MemberId:id,Trom:from,To:todesk}},function(responseText){responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.msgbox.fail(responseText.Message)}):HROS.app.dataFolderToOtherdesk(id,from,todesk,fromfolderid);else obj.parent().hasClass("dock-applist")?HROS.app.dataDockToOtherdesk(id,from,todesk):obj.parent().hasClass("desktop-apps-container")?HROS.app.dataDeskToOtherdesk(id,from,to,"a",todesk,fromdesk):HROS.app.dataFolderToOtherdesk(id,from,todesk,fromfolderid);$(".popup-menu").hide()});$('.papp-menu a[menu="open"]').off("click").on("click",function(){switch(obj.attr("type")){case"papp":HROS.window.create(obj.attr("realappid"),obj.attr("type"));break;case"pwidget":HROS.widget.create(obj.attr("realappid"),obj.attr("type"))}$(".popup-menu").hide()});$('.papp-menu a[menu="edit"]').off("click").on("click",function(){HROS.base.checkLogin()?NewCrm.msgbox.info("正在开发中...."):HROS.base.login();$(".popup-menu").hide()});$('.papp-menu a[menu="del"]').off("click").on("click",function(){HROS.app.dataDeleteByAppid(obj.attr("appid"));HROS.widget.removeCookie(obj.attr("realappid"),obj.attr("type"));HROS.app.remove(obj.attr("appid"),function(){obj.find("img, span").show().animate({opacity:"toggle",width:0,height:0},500,function(){obj.remove();HROS.deskTop.resize()})});$(".popup-menu").hide()});return TEMP.popupMenuPapp},folder:function(obj){if(HROS.window.show2under(),!TEMP.popupMenuFolder){let internalHtml="";internalHtml+='<div class="popup-menu folder-menu"><ul><li><a menu="view" href="###">预览<\/a><\/li>';internalHtml+='<li style="border-bottom:1px solid #F0F0F0"><a menu="open" href="###">打开<\/a><\/li>';internalHtml+="<li>";internalHtml+='<a menu="move" href="###">移动到<b class="arrow">»<\/b><\/a>';internalHtml+='<div class="popup-menu"><ul>';for(let i=1;i<=HROS.CONFIG.deskCount;i++)internalHtml+='<li><a menu="moveto" desk="'+i+'" href="###">桌面'+i+"<\/a><\/li>";internalHtml+="<\/ul><\/div>";internalHtml+="<\/li>";internalHtml+='<li><a menu="rename" href="###"><b class="edit"><\/b>重命名<\/a><\/li>';internalHtml+='<li><a menu="del" href="###"><b class="del"><\/b>删除<\/a><\/li>';internalHtml+="<\/ul><\/div>";TEMP.popupMenuFolder=$(internalHtml);$("body").append(TEMP.popupMenuFolder)}$('.folder-menu a[menu="moveto"]').removeClass("disabled");obj.parent().hasClass("desktop-apps-container")&&$('.folder-menu a[menu="moveto"]').each(function(){$(this).attr("desk")==HROS.CONFIG.desk&&$(this).addClass("disabled")});$('.folder-menu a[menu="view"]').off("click").on("click",function(){HROS.folderView.get(obj);$(".popup-menu").hide()});$('.folder-menu a[menu="open"]').off("click").on("click",function(){HROS.window.create(obj.attr("realappid"),obj.attr("type"));$(".popup-menu").hide()});$('.folder-menu a[menu="moveto"]').off("click").on("click",function(){let id=obj.attr("appid"),from=obj.index(),to=99999,todesk=$(this).attr("desk"),fromdesk=HROS.CONFIG.desk,fromfolderid=obj.parents(".folder-window").attr("appid")||obj.parents(".quick_view_container").attr("appid");if(HROS.base.checkLogin())obj.parent().hasClass("dock-applist")?HROS.app.dataDockToOtherdesk(id,from,todesk)&&HROS.request.post("/desk/membermove",{model:{MoveType:"dock-otherdesk",MemberId:id,From:from,To:todesk}},function(responseText){responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.msgbox.fail(responseText.Message)}):obj.parent().hasClass("desktop-apps-container")?HROS.app.dataDeskToOtherdesk(id,from,to,"a",todesk,fromdesk)&&HROS.request.post("/desk/membermove",{model:{MoveType:"desk-desk",MemberId:id,From:from,To:todesk}},function(responseText){responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.msgbox.fail(responseText.Message)}):HROS.app.dataFolderToOtherdesk(id,from,todesk,fromfolderid);else obj.parent().hasClass("dock-applist")?HROS.app.dataDockToOtherdesk(id,from,todesk):obj.parent().hasClass("desktop-apps-container")?HROS.app.dataDeskToOtherdesk(id,from,to,"a",todesk,fromdesk):HROS.app.dataFolderToOtherdesk(id,from,todesk,fromfolderid);$(".popup-menu").hide()});$('.folder-menu a[menu="rename"]').off("click").on("click",function(){if(HROS.base.checkLogin()){$.dialog({id:"addfolder",title:"重命名“"+obj.find("span").text()+"”文件夹",padding:0,content:editFolderDialogTemp({name:obj.find("span").text(),src:obj.find("img").attr("src")}),ok:function(){if($("#folderName").val()!="")HROS.request.post("/desk/modifyfolderinfo",{name:$("#folderName").val(),icon:$(".folderSelector img").attr("src"),memberId:parseInt(obj.attr("appid"))},function(responseText){responseText.IsSuccess&&HROS.app.get()});else return $(".folderNameError").show(),!1},cancel:!0});$(".folderSelector").off("click").on("click",function(){$(".fcDropdown").show()});$(".fcDropdown_item").off("click").on("click",function(){$(".folderSelector img").attr("src",$(this).children("img").attr("src")).attr("idx",$(this).children("img").attr("idx"));$(".fcDropdown").hide()})}else HROS.base.login();$(".popup-menu").hide()});$('.folder-menu a[menu="del"]').off("click").on("click",function(){$.dialog({id:"delfolder",title:"删除“"+obj.find("span").text()+"”文件夹",content:"删除文件夹会将文件夹内的应用移出到桌面",icon:"warning",ok:function(){HROS.app.remove(obj.attr("appid"),function(){HROS.app.dataDeleteByAppid(obj.attr("appid"));obj.find("img, span").show().animate({opacity:"toggle",width:0,height:0},500,function(){obj.remove();HROS.deskTop.resize()})})},cancel:!0});$(".popup-menu").hide()});return TEMP.popupMenuFolder},file:function(obj){HROS.window.show2under();TEMP.popupMenuFile||(TEMP.popupMenuFile=$('<div class="popup-menu file-menu"><ul><li style="border-bottom:1px solid #F0F0F0"><a menu="download" href="###">下载<\/a><\/li><li><a menu="del" href="###"><b class="del"><\/b>删除<\/a><\/li><\/ul><\/div>'),$("body").append(TEMP.popupMenuFile));$('.file-menu a[menu="download"]').off("click").on("click",function(){$("body").append(fileDownloadTemp({appid:obj.attr("appid")}));$(".popup-menu").hide()});$('.file-menu a[menu="del"]').off("click").on("click",function(){HROS.app.dataDeleteByAppid(obj.attr("appid"));HROS.app.remove(obj.attr("appid"),function(){obj.find("img, span").show().animate({opacity:"toggle",width:0,height:0},500,function(){obj.remove();HROS.deskTop.resize()})});$(".popup-menu").hide()});return TEMP.popupMenuFile},dock:function(){if(HROS.window.show2under(),!TEMP.popupMenuDock){TEMP.popupMenuDock=$('<div class="popup-menu dock-menu"><ul><li><a menu="dockPos" pos="top" href="###"><b class="hook"><\/b>向上停靠<\/a><\/li><li><a menu="dockPos" pos="left" href="###"><b class="hook"><\/b>向左停靠<\/a><\/li><li><a menu="dockPos" pos="right" href="###"><b class="hook"><\/b>向右停靠<\/a><\/li><li><a menu="dockPos" pos="none" href="###">隐藏<\/a><\/li><\/ul><\/div>');$("body").append(TEMP.popupMenuDock);$('.dock-menu a[menu="dockPos"]').on("click",function(){$(this).attr("pos")=="none"?$.dialog({title:"温馨提示",icon:"warning",content:"<p>如果应用码头存在应用，隐藏后会将应用转移到当前桌面。<\/p><p>若需要再次开启，可在桌面空白处点击右键，进入「 桌面设置 」里开启。<\/p>",ok:function(){HROS.dock.updatePos("none")},cancel:!0}):HROS.dock.updatePos($(this).attr("pos"));$(".popup-menu").hide()})}return $('.dock-menu a[menu="dockPos"]').each(function(){$(this).children(".hook").hide();$(this).attr("pos")==HROS.CONFIG.dockPos.toLowerCase()&&$(this).children(".hook").show();$(".popup-menu").hide()}),TEMP.popupMenuDock},task:function(obj){HROS.window.show2under();TEMP.popupMenuTask||(TEMP.popupMenuTask=$('<div class="popup-menu task-menu"><ul><li><a menu="max" href="###">最大化<\/a><\/li><li style="border-bottom:1px solid #F0F0F0"><a menu="hide" href="###">最小化<\/a><\/li><li><a menu="close" href="###">关闭<\/a><\/li><\/ul><\/div>'),$("body").append(TEMP.popupMenuTask));$('.task-menu a[menu="max"]').off("click").on("click",function(){HROS.window.max(obj.attr("appid"),obj.attr("type"));$(".popup-menu").hide()});$('.task-menu a[menu="hide"]').off("click").on("click",function(){HROS.window.hide(obj.attr("appid"),obj.attr("type"));$(".popup-menu").hide()});$('.task-menu a[menu="close"]').off("click").on("click",function(){HROS.window.close(obj.attr("appid"),obj.attr("type"));$(".popup-menu").hide()});return TEMP.popupMenuTask},desk:function(){if(HROS.window.show2under(),!TEMP.popupMenuDesk){TEMP.popupMenuDesk=$('<div class="popup-menu desk-menu"><ul><li><a menu="hideall" href="###">显示桌面<\/a><\/li><li style="border-bottom:1px solid #F0F0F0"><a menu="closeall" href="###">关闭所有窗口<\/a><\/li><li><a href="###">新建<b class="arrow">»<\/b><\/a><div class="popup-menu"><ul><li><a menu="addfolder" href="###"><b class="folder"><\/b>新建文件夹<\/a><\/li><li><a menu="addpapp" href="###"><b class="customapp"><\/b>新建私人应用<\/a><\/li><\/ul><\/div><\/li><li style="border-bottom:1px solid #F0F0F0"><b class="upload"><\/b><a menu="uploadfile" href="###">上传文件<\/a><\/li><li><a menu="themes" href="###"><b class="themes"><\/b>主题设置<\/a><\/li><li><a menu="setting" href="###"><b class="setting"><\/b>桌面设置<\/a><\/li><li style="border-bottom:1px solid #F0F0F0"><a href="###">图标设置<b class="arrow">»<\/b><\/a><div class="popup-menu"><ul><li><a href="###">排列<b class="arrow">»<\/b><\/a><div class="popup-menu"><ul><li><a menu="orderby" orderby="x" href="###"><b class="hook"><\/b>横向排列<\/a><\/li><li><a menu="orderby" orderby="y" href="###"><b class="hook"><\/b>纵向排列<\/a><\/li><\/ul><\/div><\/li><li><a href="###">尺寸<b class="arrow">»<\/b><\/a><div class="popup-menu"><ul><li><a menu="size" size="32" href="###"><b class="hook"><\/b>小图标<\/a><\/li><li><a menu="size" size="48" href="###"><b class="hook"><\/b>常规图标<\/a><\/li><li><a menu="size" size="64" href="###"><b class="hook"><\/b>大图标<\/a><\/li><\/ul><\/div><\/li><\/ul><\/div><\/li><li><a menu="lock" href="###">锁定<\/a><\/li><li><a menu="logout" href="###">注销<\/a><\/li><\/ul><\/div>');$("body").append(TEMP.popupMenuDesk);HROS.base.checkLogin()||$('body .desk-menu li a[menu="logout"]').parent().remove();$('.desk-menu a[menu="orderby"]').on("click",function(){HROS.app.updateXY($(this).attr("orderby"));$(".popup-menu").hide()});$('.desk-menu a[menu="size"]').on("click",function(){HROS.app.updateSize($(this).attr("size"));$(".popup-menu").hide()});$('.desk-menu a[menu="hideall"]').on("click",function(){HROS.window.hideAll();$(".popup-menu").hide()});$('.desk-menu a[menu="closeall"]').on("click",function(){HROS.window.closeAll();$(".popup-menu").hide()});$('.desk-menu a[menu="addfolder"]').on("click",function(){if(HROS.base.checkLogin()){$.dialog({id:"addfolder",title:"新建文件夹",padding:0,content:editFolderDialogTemp({name:"新建文件夹",src:"/images/ui/folder_default.png"}),ok:function(){if($("#folderName").val()!="")HROS.request.post("/desk/createfolder",{FolderName:$("#folderName").val(),FolderImg:$(".folderSelector img").attr("src"),DeskId:HROS.CONFIG.desk},function(){HROS.app.get()});else return $(".folderNameError").show(),!1},cancel:!0});$(".folderSelector").on("click",function(){return $("#addfolder .fcDropdown").show(),!1});$(document).click(function(){$("#addfolder .fcDropdown").hide()});$(".fcDropdown_item").on("click",function(){$(".folderSelector img").attr("src",$(this).children("img").attr("src")).attr("idx",$(this).children("img").attr("idx"));$("#addfolder .fcDropdown").hide()})}else HROS.base.login();$(".popup-menu").hide()});$('.desk-menu a[menu="addpapp"]').on("click",function(){HROS.base.checkLogin()?NewCrm.msgbox.info("正在开发中...."):HROS.base.login();$(".popup-menu").hide()});$('.desk-menu a[menu="uploadfile"]').on("click",function(){NewCrm.msgbox.info("正在开发中....");$(".popup-menu").hide()});$('.desk-menu a[menu="themes"]').on("click",function(){HROS.base.checkLogin()?HROS.window.createTemp({appid:"hoorayos-ztsz",title:"主题设置",url:"/Desk/SystemWallPaper",width:580,height:520,isflash:!1}):HROS.base.login();$(".popup-menu").hide()});$('.desk-menu a[menu="setting"]').on("click",function(){HROS.base.checkLogin()?HROS.window.createTemp({appid:"hoorayos-zmsz",title:"桌面设置",url:"/Desk/ConfigDesk",width:750,height:450,isflash:!1}):HROS.base.login();$(".popup-menu").hide()});$('.desk-menu a[menu="lock"]').on("click",function(){HROS.lock.show();$(".popup-menu").hide()});$('.desk-menu a[menu="logout"]').on("click",function(){HROS.base.logout();$(".popup-menu").hide()})}return $('.desk-menu a[menu="orderby"]').each(function(){$(this).children(".hook").hide();$(this).attr("orderby")==HROS.CONFIG.appXY.toLowerCase()&&$(this).children(".hook").show();$(".popup-menu").hide()}),$('.desk-menu a[menu="size"]').each(function(){$(this).children(".hook").hide();$(this).attr("size")==HROS.CONFIG.appSize&&$(this).children(".hook").show();$(".popup-menu").hide()}),TEMP.popupMenuDesk},hide:function(){$(".popup-menu").hide()}}}();HROS.searchbar=function(){return{init:function(){$("#pageletSearchInput").on("click",function(){return!1});$("#search-suggest .resultBox").on("click","li",function(){switch($(this).attr("type")){case"window":HROS.window.create($(this).attr("realappid"),$(this).attr("type"));break;case"widget":HROS.widget.create($(this).attr("realappid"),$(this).attr("type"))}});$("#search-suggest .openAppMarket a, #pageletSearchButton").on("click",function(){HROS.searchbar.openAppMarket($("#pageletSearchInput").val())});$("#pageletSearchInput").on("keydown",function(e){e.keyCode=="13"&&($("#search-suggest .resultBox .resultList a.selected").length==0&&$("#search-suggest > .resultList a.selected").length==0?HROS.searchbar.openAppMarket($(this).val()):$("#search-suggest .resultList a.selected").click())})},get:function(){let oldSearchVal="";var searchFunc=setInterval(function(){let searchVal=$("#pageletSearchInput").val();searchVal!=""?($("#search-suggest").show(),searchVal!=oldSearchVal&&(oldSearchVal=searchVal,HROS.searchbar.getSuggest(searchVal)),$("#search-bar").removeClass("above").addClass("above")):($("#search-suggest").hide(),$("#search-bar").removeClass("above"))},1e3);HROS.searchbar.set();Mousetrap.bind(["up"],function(){if($("#search-suggest .resultBox .resultList a.selected").length==0&&$("#search-suggest > .resultList a.selected").length==0)$("#search-suggest > .resultList:last a").addClass("selected");else if($("#search-suggest .resultBox .resultList:first a").hasClass("selected"))$("#search-suggest .resultList a").removeClass("selected");else if($("#search-suggest > .resultList a.selected").length!=0){let i=$("#search-suggest > .resultList a.selected").parent(".resultList").index();$("#search-suggest .resultList a").removeClass("selected");i>1?$("#search-suggest > .resultList:eq("+(i-1)+") a").addClass("selected"):$("#search-suggest .resultBox .resultList:last a").addClass("selected")}else{let i=$("#search-suggest .resultBox .resultList a.selected").parent(".resultList").index();$("#search-suggest .resultList a").removeClass("selected");i>0&&$("#search-suggest .resultBox .resultList:eq("+(i-1)+") a").addClass("selected")}return!1});Mousetrap.bind(["down"],function(){if($("#search-suggest .resultBox .resultList a.selected").length==0&&$("#search-suggest > .resultList a.selected").length==0)$("#search-suggest .resultBox .resultList").length==0?$("#search-suggest > .resultList:first a").addClass("selected"):$("#search-suggest .resultBox .resultList:first a").addClass("selected");else if($("#search-suggest > .resultList:last a").hasClass("selected"))$("#search-suggest .resultList a").removeClass("selected");else if($("#search-suggest .resultBox .resultList a.selected").length!=0){let i=$("#search-suggest .resultBox .resultList a.selected").parent(".resultList").index();$("#search-suggest .resultList a").removeClass("selected");i<$("#search-suggest .resultBox .resultList").length-1?$("#search-suggest .resultBox .resultList:eq("+(i+1)+") a").addClass("selected"):$("#search-suggest > .resultList:first a").addClass("selected")}else{let i=$("#search-suggest > .resultList a.selected").parent(".resultList").index();$("#search-suggest .resultList a").removeClass("selected");i<$("#search-suggest > .resultList").length-1?$("#search-suggest > .resultList:eq("+(i+1)+") a").addClass("selected"):$("#search-suggest .resultBox .resultList:first a").addClass("selected")}return!1});Mousetrap.bind(["backspace"],function(){})},set:function(){$("#search-bar").show();$("#search-suggest .resultList a").removeClass("selected");$("#pageletSearchInput").focus()},getSuggest:function(val){let apps=[];$(HROS.VAR.dock).each(function(){$.inArray(this.type,["window","widget"])>=0&&apps.push(this)});for(let i=1;i<=5;i++){let desk=eval("HROS.VAR.desk"+i);$(desk).each(function(){$.inArray(this.type,["window","widget"])>=0&&apps.push(this)})}$(HROS.VAR.folder).each(function(){$(this.apps).each(function(){$.inArray(this.type,["window","widget"])>=0&&apps.push(this)})});let suggest="";$(apps).each(function(){this.name.indexOf(val)>=0&&(suggest+=suggestTemp({name:this.name,appid:this.appid,realappid:this.realappid,type:this.type}))});$("#search-suggest .resultBox").html(suggest);suggest==""?$("#search-suggest .resultBox").hide():$("#search-suggest .resultBox").show();HROS.searchbar.set()},openAppMarket:function(searchkey){searchkey!=""&&HROS.window.createTemp({appid:"hoorayos-yysc",title:"大资本市场",url:"/AppMarket/Index?searchText="+searchkey,width:800,height:484,isflash:!1,refresh:!0});HROS.searchbar.hide()},hide:function(){typeof searchFunc!="undefined"&&clearInterval(searchFunc);$("#search-bar").removeClass("above");$("#search-bar, #search-suggest").hide();$("#pageletSearchInput").val("");$("#search-suggest .resultBox").html("");Mousetrap.unbind(["up","down"])}}}();HROS.startmenu=function(){return{init:function(){$("#startmenu-container").on("mousedown",function(e){e.preventDefault()});$("#startmenu-container .startmenu-nick a, #startmenu-container .startmenu-avatar img").on("click",function(){HROS.startmenu.openUser()});$("#startmenu-container .startmenu-exit a").on("click",function(){HROS.base.logout()});$("#startmenu-container .startmenu-lock").on("click",function(){HROS.lock.show()});$("#startmenu-container .startmenu-feedback").on("click",function(){HROS.window.createTemp({appid:"hoorayos-feedback",title:"反馈",url:"about:blank",width:700,height:500,isflash:!1})});$("#startmenu-container .startmenu a").on("click",function(){switch($(this).attr("class")){case"help":HROS.base.help()}})},getAvatar:function(){HROS.request.get("/desk/getuserface",{},function(responseText){responseText.IsSuccess&&$("#startmenu-container .startmenu-avatar img").attr("src",responseText.Model)})},openUser:function(){HROS.CONFIG.memberID!=0?HROS.window.createTemp({appid:"zhsz",title:"账号设置",url:"/usersetting/index",width:800,height:600}):HROS.base.login()},show:function(){HROS.popupMenu.hide();HROS.folderView.hide();HROS.searchbar.hide();$("#startmenu-container").css({top:"auto",left:"auto",right:"auto",bottom:"auto"}).show();switch(HROS.CONFIG.dockPos.toLowerCase()){case"top":$("#startmenu-container").css({top:$("#dock-container").height()-1,right:$("#dock-container").offset().left});break;case"left":$("#startmenu-container").css({bottom:$("#dock-container").offset().top,left:$("#dock-container").width()-1});break;case"right":$("#startmenu-container").css({bottom:$("#dock-container").offset().top,right:$("#dock-container").width()-1})}},hide:function(){$("#startmenu-container").hide()}}}();HROS.taskbar=function(){return{init:function(){$(window).on("resize",function(){HROS.taskbar.resize()});HROS.taskbar.click();HROS.taskbar.pageClick()},click:function(){$("#task-content-inner").on("click","a.task-item",function(){$(this).hasClass("task-item-current")?HROS.window.hide($(this).attr("appid")):HROS.window.show2top($(this).attr("appid"))}).on("contextmenu","a.task-item",function(e){$(".popup-menu").hide();$(".quick_view_container").remove();let popupmenu=HROS.popupMenu.task($(this)),l=$(window).width()-e.clientX<popupmenu.width()?e.clientX-popupmenu.width():e.clientX,t=e.clientY-popupmenu.height();return popupmenu.css({left:l,top:t}).show(),!1})},pageClick:function(){$("#task-next-btn").on("click",function(){if($(this).hasClass("disable")==!1){let w=$("#task-bar").width(),realW=$("#task-content-inner .task-item").length*114,showW=w-112,overW=realW-showW,marginL=parseInt($("#task-content-inner").css("margin-left"))-114;marginL<=overW*-1&&(marginL=overW*-1,$("#task-next a").addClass("disable"));$("#task-pre a").removeClass("disable");$("#task-content-inner").animate({marginLeft:marginL},200)}});$("#task-pre-btn").on("click",function(){if($(this).hasClass("disable")==!1){let marginL=parseInt($("#task-content-inner").css("margin-left"))+114;marginL>=0&&(marginL=0,$("#task-pre a").addClass("disable"));$("#task-next a").removeClass("disable");$("#task-content-inner").animate({marginLeft:marginL},200)}})},resize:function(){$("#task-content-inner").removeClass("fl");HROS.CONFIG.dockPos.toLowerCase()=="left"?$("#task-bar").css({left:$("#dock-bar").width(),right:0}):HROS.CONFIG.dockPos.toLowerCase()=="right"?($("#task-bar").css({left:0,right:$("#dock-bar").width()}),$("#task-content-inner").addClass("fl")):$("#task-bar").css({left:0,right:0});let w=$("#task-bar").width(),realW=$("#task-content-inner .task-item").length*114,showW=w-112;$("#task-content-inner").css("width",realW);realW>=showW?($("#task-next, #task-pre").show(),$("#task-content").css("width",showW),$("#task-content-inner").addClass("fl").stop(!0,!1).animate({marginLeft:0},200),$("#task-next a").removeClass("disable"),$("#task-pre a").addClass("disable")):($("#task-next, #task-pre").hide(),$("#task-content").css("width","100%"),$("#task-content-inner").css({"margin-left":0,"margin-right":0}))}}}();HROS.wallpaper=function(){return{init:function(){HROS.wallpaper.get(function(){HROS.wallpaper.set()})},get:function(callback){HROS.request.get("/desk/getwallpaper",{},function(responseText){if(responseText.IsSuccess){let values=responseText.Model;HROS.CONFIG.wallpaperState=values.WallpaperSource;switch(HROS.CONFIG.wallpaperState.toLowerCase()){case"upload":case"system":HROS.CONFIG.wallpaper=values.WallpaperUrl;HROS.CONFIG.wallpaperType=values.WallpaperMode;HROS.CONFIG.wallpaperWidth=values.WallpaperWidth;HROS.CONFIG.wallpaperHeight=values.WallpaperHeigth;break;case"bing":case"web":HROS.CONFIG.wallpaperType=values.WallpaperMode;HROS.CONFIG.wallpaper=values.WallpaperUrl}typeof callback=="function"&&callback&&callback()}})},set:function(isreload){isreload=isreload||!0;isreload&&($("#zoomWallpaperGrid").attr("id","zoomWallpaperGrid-ready2remove").css("zIndex",-11),setTimeout(function(){$("#zoomWallpaperGrid-ready2remove").remove();$("#zoomWallpaperGrid").removeClass("radi")},1500));let w=$(window).width(),h=$(window).height();switch(HROS.CONFIG.wallpaperState.toLowerCase()){case"upload":case"system":let t,l;switch(HROS.CONFIG.wallpaperType.toLocaleLowerCase()){case"tile":isreload&&$("body").append('<div id="zoomWallpaperGrid" class="radi" style="position:absolute;z-index:-10;top:0;left:0;height:100%;width:100%;background:#fff url('+HROS.CONFIG.wallpaper+') repeat"><\/div>');break;case"center":isreload&&$("body").append('<div id="zoomWallpaperGrid" class="radi" style="position:absolute;z-index:-10;top:0;left:0;height:100%;width:100%;background:#fff url('+HROS.CONFIG.wallpaper+') no-repeat 50% 50%"><\/div>');break;case"fill":t=(h-HROS.CONFIG.wallpaperHeight)/2;l=(w-HROS.CONFIG.wallpaperWidth)/2;isreload?$("body").append('<div id="zoomWallpaperGrid" class="radi" style="position:absolute;z-index:-10;left:0;top:0;overflow:hidden;height:'+h+"px;width:"+w+'px;background:#fff"><img id="zoomWallpaper" src="'+HROS.CONFIG.wallpaper+'" style="position:absolute;height:'+HROS.CONFIG.wallpaperHeight+"px;width:"+HROS.CONFIG.wallpaperWidth+"px;top:"+t+"px;left:"+l+'px"><div style="position:absolute;height:'+h+"px;width:"+w+'px;background:#fff;opacity:0;filter:alpha(opacity=0)"><\/div><\/div>'):($("#zoomWallpaperGrid, #zoomWallpaperGrid div").css({height:h+"px",width:w+"px"}),$("#zoomWallpaper").css({top:t+"px",left:l+"px"}));break;case"adapted":let imgH,imgW;HROS.CONFIG.wallpaperHeight/HROS.CONFIG.wallpaperWidth>h/w?(imgH=h,imgW=HROS.CONFIG.wallpaperWidth*(h/HROS.CONFIG.wallpaperHeight),t=0,l=(w-imgW)/2):HROS.CONFIG.wallpaperHeight/HROS.CONFIG.wallpaperWidth<h/w?(imgW=w,imgH=HROS.CONFIG.wallpaperHeight*(w/HROS.CONFIG.wallpaperWidth),l=0,t=(h-imgH)/2):(imgH=HROS.CONFIG.wallpaperHeight,imgW=HROS.CONFIG.wallpaperWidth,t=l=0);isreload?$("body").append('<div id="zoomWallpaperGrid" class="radi" style="position:absolute;z-index:-10;left:0;top:0;overflow:hidden;height:'+h+"px;width:"+w+'px;background:#fff"><img id="zoomWallpaper" src="'+HROS.CONFIG.wallpaper+'" style="position:absolute;height:'+imgH+"px;width:"+imgW+"px;top:"+t+"px;left:"+l+'px"><div style="position:absolute;height:'+h+"px;width:"+w+'px;background:#fff;opacity:0;filter:alpha(opacity=0)"><\/div><\/div>'):($("#zoomWallpaperGrid, #zoomWallpaperGrid div").css({height:h+"px",width:w+"px"}),$("#zoomWallpaper").css({height:imgH+"px",width:imgW+"px",top:t+"px",left:l+"px"}));break;case"draw":isreload?$("body").append('<div id="zoomWallpaperGrid" class="radi" style="position:absolute;z-index:-10;left:0;top:0;overflow:hidden;height:'+h+"px;width:"+w+'px;background:#fff"><img id="zoomWallpaper" src="'+HROS.CONFIG.wallpaper+'" style="position:absolute;height:'+h+"px;width:"+w+'px;top:0;left:0"><div style="position:absolute;height:'+h+"px;width:"+w+'px;background:#fff;opacity:0;filter:alpha(opacity=0)"><\/div><\/div>'):$("#zoomWallpaperGrid").css({height:h+"px",width:w+"px"}).children("#zoomWallpaper, div").css({height:h+"px",width:w+"px"})}break;case"bing":case"web":isreload&&$("body").append('<div id="zoomWallpaperGrid" class="radi" style="position:absolute;z-index:-10;top:0;left:0;height:100%;width:100%;overflow:hidden"><div><\/div><iframe id="iframeWallpaper" frameborder="no" border="0" scrolling="no" class="iframeWallpaper" style="position:absolute;left:0;top:0;overflow:hidden;width:100%;height:100%" src="'+HROS.CONFIG.wallpaper+'"><\/iframe><\/div>')}},update:function(wallpaperShowType,wallpaperId){function done(){HROS.wallpaper.get(function(){HROS.wallpaper.set()})}HROS.base.checkLogin()?wallpaperId?HROS.request.post("/desk/modifywallpaper",{wallpaperId:wallpaperId},function(responseText){responseText.IsSuccess&&(NewCrm.msgbox.success("壁纸设置成功！"),done())}):HROS.request.post("/desk/modifydisplaymodel",{wallPaperShowType:wallpaperShowType},function(responseText){responseText.IsSuccess&&(NewCrm.msgbox.success("壁纸显示模式设置成功！"),done())}):(NewCrm.msgbox.success("壁纸设置成功！"),done())}}}();HROS.widget=function(){return{init:function(){HROS.widget.handle();HROS.widget.move();HROS.widget.reduction();$("#desk").on("mouseover",".widget",function(){$(this).children(".move").show()}).on("mouseout",".widget",function(){$(this).children(".move").hide()})},createTemp:function(obj){let appid=obj.appid==null?Date.parse(new Date):obj.appid,iswidgetopen=!1;if($("#desk .widget").each(function(){if($(this).attr("appid")==appid)return iswidgetopen=!0,!1}),!iswidgetopen){function nextDo(options){$("#desk").append(widgetWindowTemp({width:options.width,height:options.height,type:"widgetTemp",id:"w_"+options.appid,appid:options.appid,realappid:options.appid,top:options.top,right:options.right,url:options.url,zIndex:HROS.CONFIG.widgetIndexid,issetbar:0}));HROS.CONFIG.widgetIndexid+=1}nextDo({appid:appid,url:obj.url,width:obj.width,height:obj.height,top:obj.top==null?0:obj.top,right:obj.right==null?0:obj.right})}},create:function(appid,type){type=type?"widget":type;let iswidgetopen=!1;if($("#desk .widget").each(function(){if($(this).attr("appid")==appid)return iswidgetopen=!0,!1}),!iswidgetopen&&$("#d_"+appid).attr("opening")!=1){$("#d_"+appid).attr("opening",1);function nextDo(options){let widgetId="#w_"+options.appid;if(HROS.widget.checkCookie(appid,type)){let widgetState=$.parseJSON($.cookie("widgetState"+HROS.CONFIG.memberID));$(widgetState).each(function(){this.appid==options.appid&&this.type==options.type.toLowerCase()&&(options.top=this.top,options.right=this.right)})}else HROS.widget.addCookie(options.realappid,options.type.toLowerCase(),0,0);TEMP.widgetTemp={title:options.title,width:options.width,height:options.height,type:options.type.toLowerCase(),id:"w_"+options.appid,appid:options.appid,realappid:options.realappid==0?options.appid:options.realappid,top:options.top?options.top:0,right:options.right?options.right:0,url:options.url,zIndex:HROS.CONFIG.widgetIndexid,issetbar:1,starcount:options.starcount};$("#desk").append(widgetWindowTemp(TEMP.widgetTemp));$(widgetId).data("info",TEMP.widgetTemp);HROS.CONFIG.widgetIndexid+=1}HROS.request.get("/desk/createwindow",{id:appid,type:type},function(responseText){if(responseText.IsSuccess){let app=responseText.Model;nextDo({type:app.type,appid:app.appId,realappid:app.appId,title:app.name,imgsrc:app.icon,url:app.url,width:app.width,height:app.height,isresize:app.isResize,isopenmax:app.isOpenMax,issetbar:app.isSetbar,starcount:app.starCount});$("#d_"+appid).attr("opening",0)}else NewCrm.msgbox.fail(responseText.Message)})}},reduction:function(){if(typeof $.cookie("widgetState"+HROS.CONFIG.memberID)!="undefined"){let widgetState=JSON.parse($.cookie("widgetState"+HROS.CONFIG.memberID));$(widgetState).each(function(){HROS.widget.create(this.appid,this.type)})}},checkCookie:function(appid,type){let value=$.cookie("widgetState"+HROS.CONFIG.memberID),flag=!1;if(value){let widgetState=JSON.parse(value);return $(widgetState).each(function(){this.appid==appid&&this.type==type&&(flag=!0)}),flag}return flag},addCookie:function(appid,type,top,right){if(type=="widget"||type=="pwidget"){let coo=$.cookie("widgetState"+HROS.CONFIG.memberID),widgetState=coo?JSON.parse(coo):null;HROS.widget.checkCookie(appid,type)?$(widgetState).each(function(){this.appid==appid&&this.type==type&&(this.top=top,this.right=right)}):(widgetState==null&&(widgetState=[]),widgetState.push({appid:appid,type:type,top:top,right:right}));$.cookie("widgetState"+HROS.CONFIG.memberID,JSON.stringify(widgetState),{expires:95})}},removeCookie:function(appid,type){if((type=="widget"||type=="pwidget")&&HROS.widget.checkCookie(appid,type)){let widgetState=JSON.parse($.cookie("widgetState"+HROS.CONFIG.memberID));$(widgetState).each(function(i){if(this.appid==appid&&this.type==type)return widgetState.splice(i,1),!1});$.cookie("widgetState"+HROS.CONFIG.memberID,JSON.stringify(widgetState),{expires:95})}},move:function(){$("#desk").on("mousedown",".widget .move",function(e){let obj=$(this).parents(".widget");HROS.widget.show2top(obj.attr("appid"));let x=e.clientX-obj.offset().left,y=e.clientY-obj.offset().top,lay,t,r;$(document).on("mousemove",function(e){lay=HROS.maskBox.desk();lay.show();t=e.clientY-y<0?0:e.clientY-y;r=$(window).width()-obj.width()-(e.clientX-x);obj.css({top:t,right:r})}).on("mouseup",function(){$(this).off("mousemove").off("mouseup");typeof lay!="undefined"&&lay.hide();obj.attr("type")!="widgetTemp"&&HROS.widget.addCookie(obj.attr("appid"),obj.attr("type"),t,r)})})},close:function(appid){let widgetId="#w_"+appid;HROS.widget.removeCookie($(widgetId).attr("appid"),$(widgetId).attr("type"));$(widgetId).html("").remove()},show2top:function(appid){let widgetId="#w_"+appid;$(widgetId).css("z-index",HROS.CONFIG.widgetIndexid);HROS.CONFIG.widgetIndexid+=1},handle:function(){$("#desk").on("mousedown",".widget a",function(e){e.preventDefault();e.stopPropagation()});$("#desk").on("click",".widget .ha-close",function(){let obj=$(this).parents(".widget");HROS.widget.close(obj.attr("appid"))}).on("click",".widget .ha-star",function(){let obj=$(this).parents(".widget"),point=parseFloat(obj.data("info").starcount).toFixed(1);$.dialog({title:"给“"+obj.data("info").title+"”打分",width:250,id:"star",content:starDialogTemp({realappid:obj.data("info").realappid,point:point,realpoint:point*20})})}).on("click",".widget .ha-share",function(){let obj=$(this).parents(".widget");$.dialog({title:"分享应用",width:370,id:"share",content:shareDialogTemp({sinaweiboAppkey:HROS.CONFIG.sinaweiboAppkey==""?"1197457869":HROS.CONFIG.sinaweiboAppkey,tweiboAppkey:HROS.CONFIG.tweiboAppkey==""?"801356816":HROS.CONFIG.tweiboAppkey,title:"我正在使用 %23HoorayOS%23 中的 %23"+obj.data("info").title+"%23 应用，很不错哦，推荐你也来试试！",url:HROS.CONFIG.website+"?run="+obj.data("info").realappid+"%26type=widget"})})})}}}();HROS.window=function(){return{init:function(){HROS.window.handle();HROS.window.move();HROS.window.resize();$("#desk").on("click",".window-container .window-mask, .window-container .folder_body",function(){HROS.window.show2top($(this).parents(".window-container").attr("appid"),!0)});$("#desk").on("contextmenu",".window-container",function(){return!1});$("#desk").on("click",".folder_body li",function(){return!1}).on("contextmenu",".folder_body .appbtn",function(e){$(".popup-menu").hide();$(".quick_view_container").remove();let popupmenu;switch($(this).attr("type")){case"app":case"window":case"widget":popupmenu=HROS.popupMenu.app($(this));break;case"pwindow":case"pwidget":popupmenu=HROS.popupMenu.papp($(this))}let l=$(window).width()-e.clientX<popupmenu.width()?e.clientX-popupmenu.width():e.clientX,t=$(window).height()-e.clientY<popupmenu.height()?e.clientY-popupmenu.height():e.clientY;return popupmenu.css({left:l,top:t}).show(),!1})},createTemp:function(obj){let type="window",appid=obj.appid==null?Date.parse(new Date):obj.appid,iswindowopen=!1;if($("#task-content-inner a.task-item").each(function(){if($(this).attr("appid")==appid)return iswindowopen=!0,HROS.window.show2top($(this).attr("appid")),!1}),iswindowopen){if(obj.refresh){let windowId="#w_"+appid;$(windowId).find("iframe").attr("src",obj.url)}}else{function nextDo(options){let windowId="#w_"+options.appid;$("#task-content-inner").prepend(taskTemp({type:options.type.toLowerCase(),id:"t_"+options.appid,appid:options.appid,realappid:options.appid,title:options.title,imgsrc:options.imgsrc}));HROS.taskbar.resize();TEMP.windowTemp={top:($(window).height()-options.height)/2<=0?0:($(window).height()-options.height)/2,left:($(window).width()-options.width)/2<=0?0:($(window).width()-options.width)/2,emptyW:$(window).width()-options.width,emptyH:$(window).height()-options.height,width:options.width,height:options.height,zIndex:HROS.CONFIG.windowIndexid,type:options.type.toLowerCase(),id:"w_"+options.appid,appid:options.appid,realappid:options.appid,title:options.title,url:options.url,imgsrc:options.imgsrc,isresize:options.isresize,isopenmax:options.isopenmax,istitlebar:options.isresize,istitlebarFullscreen:options.isresize?window.fullScreenApi.supportsFullScreen==!0?!0:!1:!1,issetbar:options.issetbar,isflash:options.isflash};$("#desk").append(windowTemp(TEMP.windowTemp));$(windowId).data("info",TEMP.windowTemp);HROS.CONFIG.windowIndexid+=1;HROS.window.setPos(!1);$(windowId+" iframe").on("load",function(){$(windowId+" .window-frame").children("div").eq(1).fadeOut()});HROS.window.show2top(options.appid)}nextDo({type:type,appid:appid,realappid:appid,imgsrc:"/images/ui/default_icon.png",title:obj.title,url:obj.url,width:obj.width,height:obj.height,isresize:obj.isresize,isopenmax:obj.isopenmax,issetbar:!1,isflash:obj.isflash})}},create:function(realappid,type){type=type==null?"window":type;let appid,iswindowopen=!1;if($("#task-content-inner a.task-item").each(function(){if($(this).attr("realappid")==realappid)return iswindowopen=!0,appid=$(this).attr("appid"),HROS.window.show2top(appid),!1}),!iswindowopen&&$("#d_"+realappid).attr("opening")!=1){$("#d_"+appid).attr("opening",1);function nextDo(options){let windowId="#w_"+options.appid,top=($(window).height()-options.height)/2<=0?0:($(window).height()-options.height)/2,left=($(window).width()-options.width)/2<=0?0:($(window).width()-options.width)/2;switch(options.type.toLowerCase()){case"app":case"pwindow":$("#task-content-inner").prepend(taskTemp({type:options.type.toLowerCase(),id:"t_"+options.appid,appid:options.appid,realappid:options.realappid,title:options.title,imgsrc:options.imgsrc}));HROS.taskbar.resize();TEMP.windowTemp={top:top,left:left,emptyW:$(window).width()-options.width,emptyH:$(window).height()-options.height,width:options.width,height:options.height,zIndex:HROS.CONFIG.windowIndexid,type:options.type.toLowerCase(),id:"w_"+options.appid,appid:options.appid,realappid:options.realappid,title:options.title,url:options.url,imgsrc:options.imgsrc,isresize:options.isresize,isopenmax:options.isresize?options.isopenmax:!1,istitlebar:options.isresize,istitlebarFullscreen:options.isresize?window.fullScreenApi.supportsFullScreen==!0?!0:!1:!1,issetbar:options.issetbar,isflash:options.isflash,starcount:options.starcount};$("#desk").append(windowTemp(TEMP.windowTemp));$(windowId).data("info",TEMP.windowTemp);HROS.CONFIG.windowIndexid+=1;HROS.window.setPos(!1);$(windowId+" iframe").on("load",function(){$(windowId+" .window-frame").children("div").fadeOut()});HROS.window.show2top(options.appid);break;case"folder":$("#task-content-inner").prepend(taskTemp({type:options.type.toLowerCase(),id:"t_"+options.appid,appid:options.appid,realappid:options.realappid,title:options.title,imgsrc:options.imgsrc}));HROS.taskbar.resize();TEMP.folderWindowTemp={top:top,left:left,emptyW:$(window).width()-options.width,emptyH:$(window).height()-options.height,width:options.width,height:options.height,zIndex:HROS.CONFIG.windowIndexid,type:options.type.toLowerCase(),id:"w_"+options.appid,appid:options.appid,realappid:options.realappid,title:options.title,imgsrc:options.imgsrc};$("#desk").append(folderWindowTemp(TEMP.folderWindowTemp));$(windowId).data("info",TEMP.folderWindowTemp);HROS.CONFIG.windowIndexid+=1;HROS.window.setPos(!1);let sc="";if($(HROS.VAR.folder).each(function(){if(this.memberId==options.appid)return sc=this.apps,!1}),sc!=""){let folder_append="";$(sc).each(function(){folder_append+=appbtnTemp({title:this.name,type:this.type,id:"d_"+this.memberId,appid:this.memberId,realappid:this.appId==0?this.memberId:this.appId,imgsrc:this.icon})});$(windowId).find(".folder_body").append(folder_append)}HROS.window.show2top(options.appid);break;case"file":TEMP.fileWindowTemp={top:top,left:left,emptyW:$(window).width()-options.width,emptyH:$(window).height()-options.height,width:options.width,height:options.height,zIndex:HROS.CONFIG.windowIndexid,type:options.type.toLowerCase(),id:"w_"+options.appid,appid:options.appid,realappid:options.realappid,title:options.title,imgsrc:options.imgsrc};$("body").append(fileDownloadTemp(TEMP.fileWindowTemp))}}HROS.request.get("/desk/createwindow",{id:realappid,type:type},function(responseText){if(responseText.IsSuccess){let app=responseText.Model;nextDo({type:app.type,appid:app.memberId,realappid:app.appId,title:app.name,imgsrc:app.icon,url:app.url,width:app.width,height:app.height,isresize:app.isResize,isopenmax:app.isOpenMax,issetbar:app.isSetbar,starcount:app.starCount});$("#d_"+appid).attr("opening",0)}else NewCrm.msgbox.fail(responseText.Message)})}},setPos:function(isAnimate){isAnimate=isAnimate==null?!0:isAnimate;$("#desk .window-container").each(function(){let windowdata=$(this).data("info"),currentW=$(window).width()-$(this).width(),currentH=$(window).height()-$(this).height(),left=windowdata.left/windowdata.emptyW*currentW>=currentW?currentW:windowdata.left/windowdata.emptyW*currentW;left=left<=0?0:left;let top=windowdata.top/windowdata.emptyH*currentH>=currentH?currentH:windowdata.top/windowdata.emptyH*currentH;top=top<=0?0:top;$(this).attr("state")!="hide"?$(this).stop(!0,!1).animate({left:left,top:top},isAnimate?500:0,function(){windowdata.left=left;windowdata.top=top;windowdata.emptyW=$(window).width()-$(this).width();windowdata.emptyH=$(window).height()-$(this).height()}):(windowdata.left=left,windowdata.top=top,windowdata.emptyW=$(window).width()-$(this).width(),windowdata.emptyH=$(window).height()-$(this).height())})},close:function(appid){let windowId="#w_"+appid,taskId="#t_"+appid;$(windowId).removeData("info").html("").remove();$("#task-content-inner "+taskId).html("").remove();$("#task-content-inner").css("width",$("#task-content-inner .task-item").length*114);$("#task-bar, #nav-bar").removeClass("min-zIndex");HROS.taskbar.resize()},closeAll:function(){$("#desk .window-container").each(function(){HROS.window.close($(this).attr("appid"))})},hide:function(appid){let windowId="#w_"+appid,taskId="#t_"+appid;$(windowId).css("left",-1e4).attr("state","hide");$("#task-content-inner "+taskId).removeClass("task-item-current");$(windowId).attr("ismax")==1&&$("#task-bar, #nav-bar").removeClass("min-zIndex")},hideAll:function(){$("#task-content-inner a.task-item").removeClass("task-item-current");$("#desk-"+HROS.CONFIG.desk).nextAll("div.window-container").css("left",-1e4).attr("state","hide")},max:function(appid){HROS.window.show2top(appid);let windowId="#w_"+appid,taskId="#t_"+appid;$(windowId+" .title-handle .ha-max").hide().next(".ha-revert").show();$(windowId).addClass("window-maximize").attr("ismax",1).animate({width:"100%",height:"100%",top:0,left:0},200);$("#task-bar, #nav-bar").addClass("min-zIndex")},revert:function(appid){HROS.window.show2top(appid);let windowId="#w_"+appid,taskId="#t_"+appid;$(windowId+" .title-handle .ha-revert").hide().prev(".ha-max").show();let obj=$(windowId),windowdata=obj.data("info");obj.removeClass("window-maximize").attr("ismax",0).animate({width:windowdata.width,height:windowdata.height,left:windowdata.left,top:windowdata.top},500);$("#task-bar, #nav-bar").removeClass("min-zIndex")},refresh:function(appid){let windowId="#w_"+appid,taskId="#t_"+appid;$(windowId+"_iframe").length!=0?$(windowId+"_iframe").attr("src",$(windowId+"_iframe").attr("src")):HROS.window.updateFolder(appid)},show2top:function(appid,isAnimate){function show(){HROS.window.show2under();$("#task-content-inner "+taskId).addClass("task-item-current");$(windowId).attr("ismax")==1&&$("#task-bar, #nav-bar").addClass("min-zIndex");$(windowId).addClass("window-current").css({"z-index":HROS.CONFIG.windowIndexid,left:windowdata.left,top:windowdata.top}).attr("state","show");$(windowId).attr("ismax")==1&&$(windowId).css({left:0,top:0});$(windowId+" .window-mask").hide();$(windowId+" iframe").show();HROS.CONFIG.windowIndexid+=1}isAnimate=isAnimate==null?!1:isAnimate;let windowId="#w_"+appid,taskId="#t_"+appid,windowdata=$(windowId).data("info"),arr=[];if(isAnimate){let baseStartX=$(windowId).offset().left,baseEndX=baseStartX+$(windowId).width(),baseStartY=$(windowId).offset().top,baseEndY=baseStartY+$(windowId).height(),baseCenterX=baseStartX+$(windowId).width()/2,baseCenterY=baseStartY+$(windowId).height()/2,baseZIndex=parseInt($(windowId).css("zIndex"));$("#desk .window-container:not("+windowId+")").each(function(){let thisStartX=$(this).offset().left,thisEndX=thisStartX+$(this).width(),thisStartY=$(this).offset().top,thisEndY=thisStartY+$(this).height(),thisCenterX=thisStartX+$(this).width()/2,thisCenterY=thisStartY+$(this).height()/2,thisZIndex=parseInt($(this).css("zIndex")),flag="";if(thisZIndex>baseZIndex&&((thisStartX>=baseStartX&&thisStartX<=baseEndX&&thisStartY>=baseStartY&&thisStartY<=baseEndY||thisStartX>=baseStartX&&thisStartX<=baseEndX&&thisEndY>=baseStartY&&thisEndY<=baseEndY||thisEndX>=baseStartX&&thisEndX<=baseEndX&&thisStartY>=baseStartY&&thisStartY<=baseEndY||thisEndX>=baseStartX&&thisEndX<=baseEndX&&thisEndY>=baseStartY&&thisEndY<=baseEndY)&&(flag="x"),(thisStartX>=baseStartX&&thisStartX<=baseEndX&&thisStartY<baseStartY&&thisEndY>baseEndY||thisEndX>=baseStartX&&thisEndX<=baseEndX&&thisStartY<baseStartY&&thisEndY>baseEndY)&&(flag="x"),(thisStartY>=baseStartY&&thisStartY<=baseEndY&&thisStartX<baseStartX&&thisEndX>baseEndX||thisEndY>=baseStartY&&thisEndY<=baseEndY&&thisStartX<baseStartX&&thisEndX>baseEndX)&&(flag="y"),(thisStartX>=baseStartX&&thisStartX<=baseEndX&&thisEndY>=baseStartY&&thisEndY<=baseEndY&&thisEndX>=baseStartX&&thisEndX<=baseEndX&&thisEndY>=baseStartY&&thisEndY<=baseEndY||thisStartX>=baseStartX&&thisStartX<=baseEndX&&thisStartY>=baseStartY&&thisStartY<=baseEndY&&thisEndX>=baseStartX&&thisEndX<=baseEndX&&thisStartY>=baseStartY&&thisStartY<=baseEndY)&&(flag="y")),flag!=""){let direction,distance;flag=="x"?thisCenterX>baseCenterX?(direction="right",distance=baseEndX-thisStartX+30):(direction="left",distance=thisEndX-baseStartX+30):thisCenterY>baseCenterY?(direction="bottom",distance=baseEndY-thisStartY+30):(direction="top",distance=thisEndY-baseStartY+30);arr.push({id:$(this).attr("id"),direction:direction,distance:distance})}});let delayTime=0;for(let i=0;i<arr.length;i++){let baseLeft=$("#"+arr[i].id).offset().left,baseTop=$("#"+arr[i].id).offset().top;arr[i].direction=="left"?$("#"+arr[i].id).delay(delayTime).animate({left:baseLeft-arr[i].distance},300).animate({left:baseLeft},300):arr[i].direction=="right"?$("#"+arr[i].id).delay(delayTime).animate({left:baseLeft+arr[i].distance},300).animate({left:baseLeft},300):arr[i].direction=="top"?$("#"+arr[i].id).delay(delayTime).animate({top:baseTop-arr[i].distance},300).animate({top:baseTop},300):arr[i].direction=="bottom"&&$("#"+arr[i].id).delay(delayTime).animate({top:baseTop+arr[i].distance},300).animate({top:baseTop},300);delayTime+=100}setTimeout(show,delayTime+100)}else show()},show2under:function(){$("#task-content-inner a.task-item").removeClass("task-item-current");$("#desk .window-container").removeClass("window-current");$("#desk .window-container .window-mask").show();$("#desk .window-container-flash iframe").hide()},updateFolder:function(appid){let windowId="#w_"+appid,taskId="#t_"+appid,sc="";if($(HROS.VAR.folder).each(function(){if(this.memberId==parseInt(appid))return sc=this.apps,!1}),sc!=null){let folder_append="";for(let i=0;i<sc.length;i++)folder_append+=appbtnTemp({top:0,left:0,title:sc[i].name,type:sc[i].type,id:"d_"+sc[i].memberId,appid:sc[i].memberId,realappid:sc[i].appId,imgsrc:sc[i].icon});$(windowId).find(".folder_body").html("").append(folder_append).on("contextmenu",".appbtn",function(e){$(".popup-menu").hide();$(".quick_view_container").remove();TEMP.AppRight=HROS.popupMenu.app($(this));let l=$(window).width()-e.clientX<TEMP.AppRight.width()?e.clientX-TEMP.AppRight.width():e.clientX,t=$(window).height()-e.clientY<TEMP.AppRight.height()?e.clientY-TEMP.AppRight.height():e.clientY;return TEMP.AppRight.css({left:l,top:t}).show(),!1})}},handle:function(){$("#desk").on("mousedown",".window-container .title-bar .title-handle a",function(e){e.preventDefault();e.stopPropagation()});$("#desk").on("dblclick",".window-container .title-bar",function(){let obj=$(this).parents(".window-container");obj.find(".ha-max").is(":hidden")?obj.find(".ha-revert").click():obj.find(".ha-max").click()}).on("click",".window-container .ha-hide",function(){let obj=$(this).parents(".window-container");HROS.window.hide(obj.attr("appid"))}).on("click",".window-container .ha-max",function(){let obj=$(this).parents(".window-container");HROS.window.max(obj.attr("appid"))}).on("click",".window-container .ha-revert",function(){let obj=$(this).parents(".window-container");HROS.window.revert(obj.attr("appid"))}).on("click",".window-container .ha-fullscreen",function(){let obj=$(this).parents(".window-container");window.fullScreenApi.requestFullScreen(document.getElementById(obj.find("iframe").attr("id")))}).on("click",".window-container .ha-close",function(){let obj=$(this).parents(".window-container");HROS.window.close(obj.attr("appid"))}).on("click",".window-container .refresh",function(){let obj=$(this).parents(".window-container");HROS.window.refresh(obj.attr("appid"))}).on("click",".window-container .detail",function(){let obj=$(this).parents(".window-container");obj.attr("realappid")!==0?HROS.window.createTemp({appid:"hoorayos-yysc",title:"应用市场",url:"/AppMarket/AppDetail?appId="+obj.attr("realappid"),width:800,height:484,isflash:!1,refresh:!0}):NewCrm.msgbox.info("对不起，该应用没有任何详细介绍")}).on("click",".window-container .star",function(){let obj=$(this).parents(".window-container"),point=parseFloat(obj.data("info").starcount).toFixed(1);$.dialog({title:"给“"+obj.data("info").title+"”打分",width:250,id:"star",content:starDialogTemp({realappid:obj.data("info").realappid,point:point,realpoint:point*20})})}).on("click",".window-container .share",function(){let obj=$(this).parents(".window-container");$.dialog({title:"分享应用",width:370,id:"share",content:shareDialogTemp({sinaweiboAppkey:HROS.CONFIG.sinaweiboAppkey==""?"1197457869":HROS.CONFIG.sinaweiboAppkey,tweiboAppkey:HROS.CONFIG.tweiboAppkey==""?"801356816":HROS.CONFIG.tweiboAppkey,title:"我正在使用 %23HoorayOS%23 中的 %23"+obj.data("info").title+"%23 应用，很不错哦，推荐你也来试试！",url:HROS.CONFIG.website+"?run="+obj.data("info").realappid+"%26type=app"})})}).on("contextmenu",".window-container",function(){return $(".popup-menu").hide(),$(".quick_view_container").remove(),!1})},move:function(){$("#desk").on("mousedown",".window-container .title-bar",function(e){let obj=$(this).parents(".window-container");if(obj.attr("ismax")==1)return!1;HROS.window.show2top(obj.attr("appid"));let windowdata=obj.data("info"),x=e.clientX-obj.offset().left,y=e.clientY-obj.offset().top,lay;$(document).on("mousemove",function(e){lay=HROS.maskBox.desk();lay.show();obj.find(".ha-revert").hide().prev(".ha-max").show();obj.css({width:windowdata.width,height:windowdata.height,left:e.clientX-x,top:e.clientY-y<=10?0:e.clientY-y>=lay.height()-30?lay.height()-30:e.clientY-y});obj.data("info").left=obj.offset().left;obj.data("info").top=obj.offset().top}).on("mouseup",function(){$(this).off("mousemove").off("mouseup");typeof lay!="undefined"&&lay.hide()})})},resize:function(){$("#desk").on("mousedown",".window-container .window-resize",function(e){let obj=$(this).parents(".window-container"),resizeobj=$(this),lay,x=e.clientX,y=e.clientY,w=obj.width(),h=obj.height();$(document).on("mousemove",function(e){lay=HROS.maskBox.desk();lay.show();let _x=e.clientX<=10?0:e.clientX>=lay.width()-12?lay.width()-2:e.clientX,_y=e.clientY<=10?0:e.clientY>=lay.height()-12?lay.height():e.clientY;switch(resizeobj.attr("resize")){case"t":h+y-_y>HROS.CONFIG.windowMinHeight?obj.css({height:h+y-_y,top:_y}):obj.css({height:HROS.CONFIG.windowMinHeight});break;case"r":w-x+_x>HROS.CONFIG.windowMinWidth?obj.css({width:w-x+_x}):obj.css({width:HROS.CONFIG.windowMinWidth});break;case"b":h-y+_y>HROS.CONFIG.windowMinHeight?obj.css({height:h-y+_y}):obj.css({height:HROS.CONFIG.windowMinHeight});break;case"l":w+x-_x>HROS.CONFIG.windowMinWidth?obj.css({width:w+x-_x,left:_x}):obj.css({width:HROS.CONFIG.windowMinWidth});break;case"rt":h+y-_y>HROS.CONFIG.windowMinHeight?obj.css({height:h+y-_y,top:_y}):obj.css({height:HROS.CONFIG.windowMinHeight});w-x+_x>HROS.CONFIG.windowMinWidth?obj.css({width:w-x+_x}):obj.css({width:HROS.CONFIG.windowMinWidth});break;case"rb":w-x+_x>HROS.CONFIG.windowMinWidth?obj.css({width:w-x+_x}):obj.css({width:HROS.CONFIG.windowMinWidth});h-y+_y>HROS.CONFIG.windowMinHeight?obj.css({height:h-y+_y}):obj.css({height:HROS.CONFIG.windowMinHeight});break;case"lt":w+x-_x>HROS.CONFIG.windowMinWidth?obj.css({width:w+x-_x,left:_x}):obj.css({width:HROS.CONFIG.windowMinWidth});h+y-_y>HROS.CONFIG.windowMinHeight?obj.css({height:h+y-_y,top:_y}):obj.css({height:HROS.CONFIG.windowMinHeight});break;case"lb":w+x-_x>HROS.CONFIG.windowMinWidth?obj.css({width:w+x-_x,left:_x}):obj.css({width:HROS.CONFIG.windowMinWidth});h-y+_y>HROS.CONFIG.windowMinHeight?obj.css({height:h-y+_y}):obj.css({height:HROS.CONFIG.windowMinHeight})}}).on("mouseup",function(){typeof lay!="undefined"&&lay.hide();obj.data("info").width=obj.width();obj.data("info").height=obj.height();obj.data("info").left=obj.offset().left;obj.data("info").top=obj.offset().top;obj.data("info").emptyW=$(window).width()-obj.width();obj.data("info").emptyH=$(window).height()-obj.height();$(this).off("mousemove").off("mouseup")})})}}}();HROS.zoom=function(){return{init:function(){$("body").append('<div id="zoombox"><\/div>');swfobject.embedSWF("/js/hooray/zoom.swf?onchange=HROS.zoom.check","zoombox","10","10","6.0.0","expressInstall.swf","",{allowScriptAccess:"always",wmode:"transparent",scale:"noScale"},{id:"accessory_zoom",name:"zoom_detect"})},check:function(o){let s=o.scale,m=s>1?"放大":"缩小";s!=1?(HROS.VAR.zoomLevel=s,$("#zoom-tip").show().find("span").text("您的浏览器目前处于"+m+"状态，会导致显示不正常，您可以键盘按“ctrl+数字0”组合键恢复初始状态！")):s!=HROS.VAR.zoomLevel&&$("#zoom-tip").fadeOut()},close:function(){$("#zoom-tip").remove()}}}();HROS.signalR=function(){return{init:function(){let connection=(new signalR.HubConnectionBuilder).withUrl("/hubs?userId="+HROS.CONFIG.memberID).configureLogging(signalR.LogLevel.Information).build();connection.on("Message",responseText=>{let message=JSON.parse(responseText),Notification=window.Notification||window.mozNotification||window.webKitNotification;Notification&&Notification.permission!=="granted"?Notification.requestPermission(function(status){Notification.permission!==status&&(Notification.permission=status)}):Notification&&Notification.permission==="granted"&&new Notification(message.Title,{dir:"rtl",lang:"zh-CN",body:message.Content})});connection.start().catch(()=>NewCrm.msgbox.fail("推送服务连接失败"));HROS.signalR.instance=connection},stop:function(callback){HROS.signalR.instance.stop();HROS.signalR.instance.onclose(function(){callback&&callback&&callback()})}}}();HROS.request=function(){return{get:function(url,parameter,callback){return HROS.request.internalRequset(url,"GET",parameter,callback)},post:function(url,parameter,callback){if(HROS.request.state==="posting")NewCrm.msgbox.fail(HROS.CONFIG.postOnce);else return HROS.request.internalRequset(url,"POST",parameter,callback)},internalRequset:function(url,method,parameter,callback){let cookie=$.cookie("User");cookie||HROS.request.noCheckUrls.includes(url.toLowerCase())?$.ajax({type:method,url:url,data:Object.keys(parameter).length?parameter:null,beforeSend:function(){NewCrm.msgbox.loading(HROS.CONFIG.loadingPrompt);HROS.request.state="posting"},success:function(responseText){NewCrm.msgbox.close();callback&&(HROS.request.state=responseText.IsSuccess?"posted":"normal",callback&&callback(responseText))},error:function(responseText){NewCrm.msgbox.fail(responseText.statusText);HROS.request.state="normal";responseText.abort()}}):NewCrm.msgbox.fail(HROS.CONFIG.timeOutPrompt)},noCheckUrls:function(){return["/desk/landing"]}()}}(),function($,win,undef){function setCenter(obj,time){var left=($(window).width()-obj.outerWidth())/2,top=($(window).height()-obj.outerHeight())/2,top=(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop)+(top>0?top:0);obj.css({left:left}).animate({top:top},{duration:time,queue:!1})}function creatMsgbox(){if($("#Validform_msg").length!==0)return!1;msgobj=$('<div id="Validform_msg"><div class="Validform_title">'+tipmsg.tit+'<a class="Validform_close" href="javascript:void(0);">&chi;<\/a><\/div><div class="Validform_info"><\/div><div class="iframe"><iframe frameborder="0" scrolling="no" height="100%" width="100%"><\/iframe><\/div><\/div>').appendTo("body");msgobj.find("a.Validform_close").click(function(){return msgobj.hide(),msghidden=!0,errorobj&&errorobj.focus().addClass("Validform_error"),!1}).focus(function(){this.blur()});$(window).bind("scroll resize",function(){msghidden||setCenter(msgobj,400)})}var errorobj=null,msgobj=null,msghidden=!0,tipmsg={tit:"提示信息",w:{"*":"不能为空！","*6-16":"请填写6到16位任意字符！",n:"请填写数字！","n6-16":"请填写6到16位数字！",s:"不能输入特殊字符！","s6-18":"请填写6到18位字符！",p:"请填写邮政编码！",m:"请填写手机号码！",e:"邮箱地址格式不对！",url:"请填写网址！"},def:"请填写正确信息！",undef:"datatype未定义！",reck:"两次输入的内容不一致！",r:"通过信息验证！",c:"正在检测信息…",s:"请{填写|选择}{0|信息}！",v:"所填信息没有经过验证，请稍后…",p:"正在提交数据…"},Validform;$.Tipmsg=tipmsg;Validform=function(forms,settings,inited){var settings=$.extend({},Validform.defaults,settings),brothers;if(settings.datatype&&$.extend(Validform.util.dataType,settings.datatype),brothers=this,brothers.tipmsg={w:{}},brothers.forms=forms,brothers.objects=[],inited===!0)return!1;forms.each(function(){var curform,$this;if(this.validform_inited=="inited")return!0;this.validform_inited="inited";curform=this;curform.settings=$.extend({},settings);$this=$(curform);curform.validform_status="normal";$this.data("tipmsg",brothers.tipmsg);$this.delegate("[datatype]","blur",function(){var subpost=arguments[1];Validform.util.check.call(this,$this,subpost)});$this.delegate(":text","keypress",function(event){event.keyCode==13&&$this.find(":submit").length==0&&$this.submit()});Validform.util.enhance.call($this,curform.settings.tiptype,curform.settings.usePlugin,curform.settings.tipSweep);curform.settings.btnSubmit&&$this.find(curform.settings.btnSubmit).bind("click",function(){return $this.trigger("submit"),!1});$this.submit(function(){var subflag=Validform.util.submitForm.call($this,curform.settings);return subflag===undef&&(subflag=!0),subflag});$this.find("[type='reset']").add($this.find(curform.settings.btnReset)).bind("click",function(){Validform.util.resetForm.call($this)})});(settings.tiptype==1||(settings.tiptype==2||settings.tiptype==3)&&settings.ajaxPost)&&creatMsgbox()};Validform.defaults={tiptype:1,tipSweep:!1,showAllError:!1,postonce:!1,ajaxPost:!1};Validform.util={dataType:{"*":/[\w\W]+/,"*6-16":/^[\w\W]{6,16}$/,n:/^\d+$/,"n6-16":/^\d{6,16}$/,s:/^[\u4E00-\u9FA5\uf900-\ufa2d\w\.\s]+$/,"s6-18":/^[\u4E00-\u9FA5\uf900-\ufa2d\w\.\s]{6,18}$/,p:/^[0-9]{6}$/,m:/^13[0-9]{9}$|14[0-9]{9}|15[0-9]{9}$|18[0-9]{9}$/,e:/^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,url:/^(\w+:\/\/)?\w+(\.\w+)+.*$/},toString:Object.prototype.toString,isEmpty:function(val){return val===""||val===$.trim(this.attr("tip"))},getValue:function(obj){var inputval,curform=this;return obj.is(":radio")?(inputval=curform.find(":radio[name='"+obj.attr("name")+"']:checked").val(),inputval=inputval===undef?"":inputval):obj.is(":checkbox")?(inputval="",curform.find(":checkbox[name='"+obj.attr("name")+"']:checked").each(function(){inputval+=$(this).val()+","}),inputval=inputval===undef?"":inputval):inputval=obj.val(),inputval=$.trim(inputval),Validform.util.isEmpty.call(obj,inputval)?"":inputval},enhance:function(tiptype,usePlugin,tipSweep,addRule){var curform=this;curform.find("[datatype]").each(function(){tiptype==2?$(this).parent().next().find(".Validform_checktip").length==0&&($(this).parent().next().append("<span class='Validform_checktip' />"),$(this).siblings(".Validform_checktip").remove()):(tiptype==3||tiptype==4)&&$(this).siblings(".Validform_checktip").length==0&&($(this).parent().append("<span class='Validform_checktip' />"),$(this).parent().next().find(".Validform_checktip").remove())});curform.find("input[recheck]").each(function(){if(this.validform_inited=="inited")return!0;this.validform_inited="inited";var _this=$(this),recheckinput=curform.find("input[name='"+$(this).attr("recheck")+"']");recheckinput.bind("keyup",function(){if(recheckinput.val()==_this.val()&&recheckinput.val()!=""){if(recheckinput.attr("tip")&&recheckinput.attr("tip")==recheckinput.val())return!1;_this.trigger("blur")}}).bind("blur",function(){if(recheckinput.val()!=_this.val()&&_this.val()!=""){if(_this.attr("tip")&&_this.attr("tip")==_this.val())return!1;_this.trigger("blur")}})});curform.find("[tip]").each(function(){if(this.validform_inited=="inited")return!0;this.validform_inited="inited";var defaultvalue=$(this).attr("tip"),altercss=$(this).attr("altercss");$(this).focus(function(){$(this).val()==defaultvalue&&($(this).val(""),altercss&&$(this).removeClass(altercss))}).blur(function(){$.trim($(this).val())===""&&($(this).val(defaultvalue),altercss&&$(this).addClass(altercss))})});curform.find(":checkbox[datatype],:radio[datatype]").each(function(){if(this.validform_inited=="inited")return!0;this.validform_inited="inited";var _this=$(this),name=_this.attr("name");curform.find("[name='"+name+"']").filter(":checkbox,:radio").bind("click",function(){setTimeout(function(){_this.trigger("blur")},0)})});curform.find("select[datatype][multiple]").bind("click",function(){var _this=$(this);setTimeout(function(){_this.trigger("blur")},0)});Validform.util.usePlugin.call(curform,usePlugin,tiptype,tipSweep,addRule)},usePlugin:function(plugin,tiptype,tipSweep,addRule){var curform=this,plugin=plugin||{},custom;if(curform.find("input[plugin='swfupload']").length&&typeof swfuploadhandler!="undefined"&&(custom={custom_settings:{form:curform,showmsg:function(msg,type){Validform.util.showmsg.call(curform,msg,tiptype,{obj:curform.find("input[plugin='swfupload']"),type:type,sweep:tipSweep})}}},custom=$.extend(!0,{},plugin.swfupload,custom),curform.find("input[plugin='swfupload']").each(function(n){if(this.validform_inited=="inited")return!0;this.validform_inited="inited";$(this).val("");swfuploadhandler.init(custom,n)})),curform.find("input[plugin='datepicker']").length&&$.fn.datePicker&&(plugin.datepicker=plugin.datepicker||{},plugin.datepicker.format&&(Date.format=plugin.datepicker.format,delete plugin.datepicker.format),plugin.datepicker.firstDayOfWeek&&(Date.firstDayOfWeek=plugin.datepicker.firstDayOfWeek,delete plugin.datepicker.firstDayOfWeek),curform.find("input[plugin='datepicker']").each(function(){if(this.validform_inited=="inited")return!0;this.validform_inited="inited";plugin.datepicker.callback&&$(this).bind("dateSelected",function(){var d=new Date($.event._dpCache[this._dpId].getSelected()[0]).asString(Date.format);plugin.datepicker.callback(d,this)});$(this).datePicker(plugin.datepicker)})),curform.find("input[plugin*='passwordStrength']").length&&$.fn.passwordStrength&&(plugin.passwordstrength=plugin.passwordstrength||{},plugin.passwordstrength.showmsg=function(obj,msg,type){Validform.util.showmsg.call(curform,msg,tiptype,{obj:obj,type:type,sweep:tipSweep})},curform.find("input[plugin='passwordStrength']").each(function(){if(this.validform_inited=="inited")return!0;this.validform_inited="inited";$(this).passwordStrength(plugin.passwordstrength)})),addRule!="addRule"&&plugin.jqtransform&&$.fn.jqTransSelect){if(curform[0].jqTransSelected=="true")return;curform[0].jqTransSelected="true";var jqTransformHideSelect=function(oTarget){var ulVisible=$(".jqTransformSelectWrapper ul:visible");ulVisible.each(function(){var oSelect=$(this).parents(".jqTransformSelectWrapper:first").find("select").get(0);oTarget&&oSelect.oLabel&&oSelect.oLabel.get(0)==oTarget.get(0)||$(this).hide()})},jqTransformCheckExternalClick=function(event){$(event.target).parents(".jqTransformSelectWrapper").length===0&&jqTransformHideSelect($(event.target))},jqTransformAddDocumentListener=function(){$(document).mousedown(jqTransformCheckExternalClick)};plugin.jqtransform.selector?(curform.find(plugin.jqtransform.selector).filter('input:submit, input:reset, input[type="button"]').jqTransInputButton(),curform.find(plugin.jqtransform.selector).filter("input:text, input:password").jqTransInputText(),curform.find(plugin.jqtransform.selector).filter("input:checkbox").jqTransCheckBox(),curform.find(plugin.jqtransform.selector).filter("input:radio").jqTransRadio(),curform.find(plugin.jqtransform.selector).filter("textarea").jqTransTextarea(),curform.find(plugin.jqtransform.selector).filter("select").length>0&&(curform.find(plugin.jqtransform.selector).filter("select").jqTransSelect(),jqTransformAddDocumentListener())):curform.jqTransform();curform.find(".jqTransformSelectWrapper").find("li a").click(function(){$(this).parents(".jqTransformSelectWrapper").find("select").trigger("blur")})}},getNullmsg:function(curform){var obj=this,reg=/[\u4E00-\u9FA5\uf900-\ufa2da-zA-Z\s]+/g,nullmsg,label=curform[0].settings.label||".Validform_label";if(label=obj.siblings(label).eq(0).text()||obj.siblings().find(label).eq(0).text()||obj.parent().siblings(label).eq(0).text()||obj.parent().siblings().find(label).eq(0).text(),label=label.replace(/\s(?![a-zA-Z])/g,"").match(reg),label=label?label.join(""):[""],reg=/\{(.+)\|(.+)\}/,nullmsg=curform.data("tipmsg").s||tipmsg.s,label!=""){if(nullmsg=nullmsg.replace(/\{0\|(.+)\}/,label),obj.attr("recheck"))return nullmsg=nullmsg.replace(/\{(.+)\}/,""),obj.attr("nullmsg",nullmsg),nullmsg}else nullmsg=obj.is(":checkbox,:radio,select")?nullmsg.replace(/\{0\|(.+)\}/,""):nullmsg.replace(/\{0\|(.+)\}/,"$1");return nullmsg=obj.is(":checkbox,:radio,select")?nullmsg.replace(reg,"$2"):nullmsg.replace(reg,"$1"),obj.attr("nullmsg",nullmsg),nullmsg},getErrormsg:function(curform,datatype,recheck){var mac=datatype.match(/^(.+?)((\d+)-(\d+))?$/),str,tipmsg_w_ex,name;if(recheck=="recheck")return curform.data("tipmsg").reck||tipmsg.reck;if(tipmsg_w_ex=$.extend({},tipmsg.w,curform.data("tipmsg").w),mac[0]in tipmsg_w_ex)return curform.data("tipmsg").w[mac[0]]||tipmsg.w[mac[0]];for(name in tipmsg_w_ex)if(name.indexOf(mac[1])!=-1&&/^(.+?)(\d+)-(\d+)$/.test(name))return str=(curform.data("tipmsg").w[name]||tipmsg.w[name]).replace(/(.*?)\d+(.+?)\d+(.*)/,"$1"+mac[3]+"$2"+mac[4]+"$3"),curform.data("tipmsg").w[mac[0]]=str,str;return curform.data("tipmsg").def||tipmsg.def},_regcheck:function(datatype,gets,obj,curform){var curform=curform,info=null,passed=!1,reg=/\/.+\//g,regex=/^(.+?)(\d+)-(\d+)$/,type=3,mac,temp,name,theother;if(reg.test(datatype)){var regstr=datatype.match(reg)[0].slice(1,-1),param=datatype.replace(reg,""),rexp=RegExp(regstr,param);passed=rexp.test(gets)}else if(Validform.util.toString.call(Validform.util.dataType[datatype])=="[object Function]")passed=Validform.util.dataType[datatype](gets,obj,curform,Validform.util.dataType),passed===!0||passed===undef?passed=!0:(info=passed,passed=!1);else{if(!(datatype in Validform.util.dataType))if(mac=datatype.match(regex),mac){for(name in Validform.util.dataType)if((temp=name.match(regex),temp)&&mac[1]===temp[1]){var str=Validform.util.dataType[name].toString(),param=str.match(/\/[mgi]*/g)[1].replace("/",""),regxp=new RegExp("\\{"+temp[2]+","+temp[3]+"\\}","g");str=str.replace(/\/[mgi]*/g,"/").replace(regxp,"{"+mac[2]+","+mac[3]+"}").replace(/^\//,"").replace(/\/$/,"");Validform.util.dataType[datatype]=new RegExp(str,param);break}}else passed=!1,info=curform.data("tipmsg").undef||tipmsg.undef;Validform.util.toString.call(Validform.util.dataType[datatype])=="[object RegExp]"&&(passed=Validform.util.dataType[datatype].test(gets))}return passed?(type=2,info=obj.attr("sucmsg")||curform.data("tipmsg").r||tipmsg.r,obj.attr("recheck")&&(theother=curform.find("input[name='"+obj.attr("recheck")+"']:first"),gets!=theother.val()&&(passed=!1,type=3,info=obj.attr("errormsg")||Validform.util.getErrormsg.call(obj,curform,datatype,"recheck")))):(info=info||obj.attr("errormsg")||Validform.util.getErrormsg.call(obj,curform,datatype),Validform.util.isEmpty.call(obj,gets)&&(info=obj.attr("nullmsg")||Validform.util.getNullmsg.call(obj,curform))),{passed:passed,type:type,info:info}},regcheck:function(datatype,gets,obj){var curform=this,info=null,dtype,res,eithor,dtp;if(obj.attr("ignore")==="ignore"&&Validform.util.isEmpty.call(obj,gets))return obj.data("cked")&&(info=""),{passed:!0,type:4,info:info};for(obj.data("cked","cked"),dtype=Validform.util.parseDatatype(datatype),eithor=0;eithor<dtype.length;eithor++){for(dtp=0;dtp<dtype[eithor].length;dtp++)if(res=Validform.util._regcheck(dtype[eithor][dtp],gets,obj,curform),!res.passed)break;if(res.passed)break}return res},parseDatatype:function(datatype){var reg=/\/.+?\/[mgi]*(?=(,|$|\||\s))|[\w\*-]+/g,dtype=datatype.match(reg),sepor=datatype.replace(reg,"").replace(/\s*/g,"").split(""),arr=[],m=0,n;for(arr[0]=[],arr[0].push(dtype[0]),n=0;n<sepor.length;n++)sepor[n]=="|"&&(m++,arr[m]=[]),arr[m].push(dtype[n+1]);return arr},showmsg:function(msg,type,o,triggered){if(msg!=undef&&(triggered!="bycheck"||!o.sweep||(!o.obj||o.obj.is(".Validform_error"))&&typeof type!="function")){if($.extend(o,{curform:this}),typeof type=="function"){type(msg,o,Validform.util.cssctl);return}(type==1||triggered=="byajax"&&type!=4)&&msgobj.find(".Validform_info").html(msg);(type==1&&triggered!="bycheck"&&o.type!=2||triggered=="byajax"&&type!=4)&&(msghidden=!1,msgobj.find(".iframe").css("height",msgobj.outerHeight()),msgobj.show(),setCenter(msgobj,100));type==2&&o.obj&&(o.obj.parent().next().find(".Validform_checktip").html(msg),Validform.util.cssctl(o.obj.parent().next().find(".Validform_checktip"),o.type));(type==3||type==4)&&o.obj&&(o.obj.siblings(".Validform_checktip").html(msg),Validform.util.cssctl(o.obj.siblings(".Validform_checktip"),o.type))}},cssctl:function(obj,status){switch(status){case 1:obj.removeClass("Validform_right Validform_wrong").addClass("Validform_checktip Validform_loading");break;case 2:obj.removeClass("Validform_wrong Validform_loading").addClass("Validform_checktip Validform_right");break;case 4:obj.removeClass("Validform_right Validform_wrong Validform_loading").addClass("Validform_checktip");break;default:obj.removeClass("Validform_right Validform_loading").addClass("Validform_checktip Validform_wrong")}},check:function(curform,subpost,bool){var settings=curform[0].settings,subpost=subpost||"",inputval=Validform.util.getValue.call(curform,$(this)),flag,_this,ajaxurl,inputobj,ajaxsetup,localconfig,temp_suc,temp_err;if(settings.ignoreHidden&&$(this).is(":hidden")||$(this).data("dataIgnore")==="dataIgnore")return!0;if(settings.dragonfly&&!$(this).data("cked")&&Validform.util.isEmpty.call($(this),inputval)&&$(this).attr("ignore")!="ignore")return!1;if(flag=Validform.util.regcheck.call(curform,$(this).attr("datatype"),inputval,$(this)),inputval==this.validform_lastval&&!$(this).attr("recheck")&&subpost=="")return flag.passed?!0:!1;if(this.validform_lastval=inputval,errorobj=_this=$(this),!flag.passed)return Validform.util.abort.call(_this[0]),bool||(Validform.util.showmsg.call(curform,flag.info,settings.tiptype,{obj:$(this),type:flag.type,sweep:settings.tipSweep},"bycheck"),settings.tipSweep||_this.addClass("Validform_error")),!1;if(ajaxurl=$(this).attr("ajaxurl"),!ajaxurl||Validform.util.isEmpty.call($(this),inputval)||bool)ajaxurl&&Validform.util.isEmpty.call($(this),inputval)&&(Validform.util.abort.call(_this[0]),_this[0].validform_valid="true");else return(inputobj=$(this),inputobj[0].validform_subpost=subpost=="postform"?"postform":"",inputobj[0].validform_valid==="posting"&&inputval==inputobj[0].validform_ckvalue)?"ajax":(inputobj[0].validform_valid="posting",inputobj[0].validform_ckvalue=inputval,Validform.util.showmsg.call(curform,curform.data("tipmsg").c||tipmsg.c,settings.tiptype,{obj:inputobj,type:1,sweep:settings.tipSweep},"bycheck"),Validform.util.abort.call(_this[0]),ajaxsetup=$.extend(!0,{},settings.ajaxurl||{}),localconfig={type:"POST",cache:!1,url:ajaxurl,data:"param="+encodeURIComponent(inputval)+"&name="+encodeURIComponent($(this).attr("name")),success:function(data){$.trim(data.status)==="y"?(inputobj[0].validform_valid="true",data.info&&inputobj.attr("sucmsg",data.info),Validform.util.showmsg.call(curform,inputobj.attr("sucmsg")||curform.data("tipmsg").r||tipmsg.r,settings.tiptype,{obj:inputobj,type:2,sweep:settings.tipSweep},"bycheck"),_this.removeClass("Validform_error"),errorobj=null,inputobj[0].validform_subpost=="postform"&&curform.trigger("submit")):(inputobj[0].validform_valid=data.info,Validform.util.showmsg.call(curform,data.info,settings.tiptype,{obj:inputobj,type:3,sweep:settings.tipSweep}),_this.addClass("Validform_error"));_this[0].validform_ajax=null},error:function(data){if(data.status=="200")return data.responseText=="y"?ajaxsetup.success({status:"y"}):ajaxsetup.success({status:"n",info:data.responseText}),!1;if(data.statusText!=="abort"){var msg="status: "+data.status+"; statusText: "+data.statusText;Validform.util.showmsg.call(curform,msg,settings.tiptype,{obj:inputobj,type:3,sweep:settings.tipSweep});_this.addClass("Validform_error")}return inputobj[0].validform_valid=data.statusText,_this[0].validform_ajax=null,!0}},ajaxsetup.success&&(temp_suc=ajaxsetup.success,ajaxsetup.success=function(data){localconfig.success(data);temp_suc(data,inputobj)}),ajaxsetup.error&&(temp_err=ajaxsetup.error,ajaxsetup.error=function(data){localconfig.error(data)&&temp_err(data,inputobj)}),ajaxsetup=$.extend({},localconfig,ajaxsetup,{dataType:"json"}),_this[0].validform_ajax=$.ajax(ajaxsetup),"ajax");return bool||(Validform.util.showmsg.call(curform,flag.info,settings.tiptype,{obj:$(this),type:flag.type,sweep:settings.tipSweep},"bycheck"),_this.removeClass("Validform_error")),errorobj=null,!0},submitForm:function(settings,flg,url,ajaxPost,sync){var curform=this,beforeCheck,flag,inflag,beforeSubmit,ajaxsetup,temp_suc,temp_err,localconfig,url;if(curform[0].validform_status==="posting"||settings.postonce&&curform[0].validform_status==="posted")return settings.postonceTip(),!1;if(beforeCheck=settings.beforeCheck&&settings.beforeCheck(curform),beforeCheck===!1)return!1;if(flag=!0,curform.find("[datatype]").each(function(){var inputval,_this,thisobj;if(flg)return!1;if(settings.ignoreHidden&&$(this).is(":hidden")||$(this).data("dataIgnore")==="dataIgnore")return!0;if(inputval=Validform.util.getValue.call(curform,$(this)),errorobj=_this=$(this),inflag=Validform.util.regcheck.call(curform,$(this).attr("datatype"),inputval,$(this)),!inflag.passed)return(Validform.util.showmsg.call(curform,inflag.info,settings.tiptype,{obj:$(this),type:inflag.type,sweep:settings.tipSweep}),_this.addClass("Validform_error"),!settings.showAllError)?(_this.focus(),flag=!1,!1):(flag&&(flag=!1),!0);if($(this).attr("ajaxurl")&&!Validform.util.isEmpty.call($(this),inputval)){if(this.validform_valid!=="true")return(thisobj=$(this),Validform.util.showmsg.call(curform,curform.data("tipmsg").v||tipmsg.v,settings.tiptype,{obj:thisobj,type:3,sweep:settings.tipSweep}),_this.addClass("Validform_error"),thisobj.trigger("blur",["postform"]),!settings.showAllError)?(flag=!1,!1):(flag&&(flag=!1),!0)}else $(this).attr("ajaxurl")&&Validform.util.isEmpty.call($(this),inputval)&&(Validform.util.abort.call(this),this.validform_valid="true");Validform.util.showmsg.call(curform,inflag.info,settings.tiptype,{obj:$(this),type:inflag.type,sweep:settings.tipSweep});_this.removeClass("Validform_error");errorobj=null}),settings.showAllError&&curform.find(".Validform_error:first").focus(),flag){if(beforeSubmit=settings.beforeSubmit&&settings.beforeSubmit(curform),beforeSubmit===!1)return!1;if(curform[0].validform_status="posting",settings.ajaxPost||ajaxPost==="ajaxPost")ajaxsetup=$.extend(!0,{},settings.ajaxpost||{}),ajaxsetup.url=url||ajaxsetup.url||settings.url||curform.attr("action"),Validform.util.showmsg.call(curform,curform.data("tipmsg").p||tipmsg.p,settings.tiptype,{obj:curform,type:1,sweep:settings.tipSweep},"byajax"),sync?ajaxsetup.async=!1:sync===!1&&(ajaxsetup.async=!0),ajaxsetup.success&&(temp_suc=ajaxsetup.success,ajaxsetup.success=function(data){settings.callback&&settings.callback(data);curform[0].validform_ajax=null;curform[0].validform_status=$.trim(data.status)==="y"?"posted":"normal";temp_suc(data,curform)}),ajaxsetup.error&&(temp_err=ajaxsetup.error,ajaxsetup.error=function(data){settings.callback&&settings.callback(data);curform[0].validform_status="normal";curform[0].validform_ajax=null;temp_err(data,curform)}),localconfig={type:"POST",async:!0,data:curform.serializeArray(),success:function(data){$.trim(data.status)==="y"?(curform[0].validform_status="posted",Validform.util.showmsg.call(curform,data.info,settings.tiptype,{obj:curform,type:2,sweep:settings.tipSweep},"byajax")):(curform[0].validform_status="normal",Validform.util.showmsg.call(curform,data.info,settings.tiptype,{obj:curform,type:3,sweep:settings.tipSweep},"byajax"));settings.callback&&settings.callback(data);curform[0].validform_ajax=null},error:function(data){var msg="status: "+data.status+"; statusText: "+data.statusText;Validform.util.showmsg.call(curform,msg,settings.tiptype,{obj:curform,type:3,sweep:settings.tipSweep},"byajax");settings.callback&&settings.callback(data);curform[0].validform_status="normal";curform[0].validform_ajax=null}},ajaxsetup=$.extend({},localconfig,ajaxsetup,{dataType:"json"}),curform[0].validform_ajax=$.ajax(ajaxsetup);else return settings.postonce||(curform[0].validform_status="normal"),url=url||settings.url,url&&curform.attr("action",url),settings.callback&&settings.callback(curform)}return!1},resetForm:function(){var brothers=this;brothers.each(function(){this.reset&&this.reset();this.validform_status="normal"});brothers.find(".Validform_right").text("");brothers.find(".passwordStrength").children().removeClass("bgStrength");brothers.find(".Validform_checktip").removeClass("Validform_wrong Validform_right Validform_loading");brothers.find(".Validform_error").removeClass("Validform_error");brothers.find("[datatype]").removeData("cked").removeData("dataIgnore").each(function(){this.validform_lastval=null});brothers.eq(0).find("input:first").focus()},abort:function(){this.validform_ajax&&this.validform_ajax.abort()}};$.Datatype=Validform.util.dataType;Validform.prototype={dataType:Validform.util.dataType,eq:function(n){var obj=this;return n>=obj.forms.length?null:(n in obj.objects||(obj.objects[n]=new Validform($(obj.forms[n]).get(),{},!0)),obj.objects[n])},resetStatus:function(){var obj=this;return $(obj.forms).each(function(){this.validform_status="normal"}),this},setStatus:function(status){var obj=this;return $(obj.forms).each(function(){this.validform_status=status||"posting"}),this},getStatus:function(){var obj=this;return $(obj.forms)[0].validform_status},ignore:function(selector){var obj=this,selector=selector||"[datatype]";return $(obj.forms).find(selector).each(function(){$(this).data("dataIgnore","dataIgnore").removeClass("Validform_error")}),this},unignore:function(selector){var obj=this,selector=selector||"[datatype]";return $(obj.forms).find(selector).each(function(){$(this).removeData("dataIgnore")}),this},addRule:function(rule){for(var o,attr,obj=this,rule=rule||[],index=0;index<rule.length;index++){o=$(obj.forms).find(rule[index].ele);for(attr in rule[index])attr!=="ele"&&o.attr(attr,rule[index][attr])}return $(obj.forms).each(function(){var $this=$(this);Validform.util.enhance.call($this,this.settings.tiptype,this.settings.usePlugin,this.settings.tipSweep,"addRule")}),this},ajaxPost:function(flag,sync,url){var obj=this;return $(obj.forms).each(function(){(this.settings.tiptype==1||this.settings.tiptype==2||this.settings.tiptype==3)&&creatMsgbox();Validform.util.submitForm.call($(obj.forms[0]),this.settings,flag,url,"ajaxPost",sync)}),this},submitForm:function(flag,url){var obj=this;return $(obj.forms).each(function(){var subflag=Validform.util.submitForm.call($(this),this.settings,flag,url);subflag===undef&&(subflag=!0);subflag===!0&&this.submit()}),this},resetForm:function(){var obj=this;return Validform.util.resetForm.call($(obj.forms)),this},abort:function(){var obj=this;return $(obj.forms).each(function(){Validform.util.abort.call(this)}),this},check:function(bool,selector){var selector=selector||"[datatype]",obj=this,curform=$(obj.forms),flag=!0;return curform.find(selector).each(function(){Validform.util.check.call(this,curform,"",bool)||(flag=!1)}),flag},config:function(setup){var obj=this;return setup=setup||{},$(obj.forms).each(function(){var $this=$(this);this.settings=$.extend(!0,this.settings,setup);Validform.util.enhance.call($this,this.settings.tiptype,this.settings.usePlugin,this.settings.tipSweep)}),this}};$.fn.Validform=function(settings){return new Validform(this,settings)};$.Showmsg=function(msg){creatMsgbox();Validform.util.showmsg.call(win,msg,1,{})};$.Hidemsg=function(){msgobj.hide();msghidden=!0}}(jQuery,window);!function(a,b){var c,d={},e=function(a,b){var c,d,e;if("string"==typeof a)return h(a);for(c=[],d=a.length,e=0;d>e;e++)c.push(h(a[e]));return b.apply(null,c)},f=function(a,b,c){2===arguments.length&&(c=b,b=null);e(b||[],function(){g(a,c,arguments)})},g=function(a,b,c){var f,g={exports:b};"function"==typeof b&&(c.length||(c=[e,g.exports,g]),f=b.apply(null,c),void 0!==f&&(g.exports=f));d[a]=g.exports},h=function(b){var c=d[b]||a[b];if(!c)throw new Error("`"+b+"` is undefined");return c},i=function(a){var b,c,e,f,g,h=function(a){return a&&a.charAt(0).toUpperCase()+a.substr(1)};for(b in d)if(c=a,d.hasOwnProperty(b)){for(e=b.split("/"),g=h(e.pop());f=h(e.shift());)c[f]=c[f]||{},c=c[f];c[g]=d[b]}return a},j=function(c){return a.__dollar=c,i(b(a,f,e))};"object"==typeof module&&"object"==typeof module.exports?module.exports=j():"function"==typeof define&&define.amd?define(["jquery"],j):(c=a.WebUploader,a.WebUploader=j(),a.WebUploader.noConflict=function(){a.WebUploader=c})}(window,function(a,b,c){return b("dollar-third",[],function(){var b=a.__dollar||a.jQuery||a.Zepto;if(!b)throw new Error("jQuery or Zepto not found!");return b}),b("dollar",["dollar-third"],function(a){return a}),b("promise-third",["dollar"],function(a){return{Deferred:a.Deferred,when:a.when,isPromise:function(a){return a&&"function"==typeof a.then}}}),b("promise",["promise-third"],function(a){return a}),b("base",["dollar","promise"],function(b,c){function d(a){return function(){return h.apply(a,arguments)}}function e(a,b){return function(){return a.apply(b,arguments)}}function f(a){var b;return Object.create?Object.create(a):(b=function(){},b.prototype=a,new b)}var g=function(){},h=Function.call;return{version:"0.1.5",$:b,Deferred:c.Deferred,isPromise:c.isPromise,when:c.when,browser:function(a){var b={},c=a.match(/WebKit\/([\d.]+)/),d=a.match(/Chrome\/([\d.]+)/)||a.match(/CriOS\/([\d.]+)/),e=a.match(/MSIE\s([\d\.]+)/)||a.match(/(?:trident)(?:.*rv:([\w.]+))?/i),f=a.match(/Firefox\/([\d.]+)/),g=a.match(/Safari\/([\d.]+)/),h=a.match(/OPR\/([\d.]+)/);return c&&(b.webkit=parseFloat(c[1])),d&&(b.chrome=parseFloat(d[1])),e&&(b.ie=parseFloat(e[1])),f&&(b.firefox=parseFloat(f[1])),g&&(b.safari=parseFloat(g[1])),h&&(b.opera=parseFloat(h[1])),b}(navigator.userAgent),os:function(a){var b={},c=a.match(/(?:Android);?[\s\/]+([\d.]+)?/),d=a.match(/(?:iPad|iPod|iPhone).*OS\s([\d_]+)/);return c&&(b.android=parseFloat(c[1])),d&&(b.ios=parseFloat(d[1].replace(/_/g,"."))),b}(navigator.userAgent),inherits:function(a,c,d){var e;return"function"==typeof c?(e=c,c=null):e=c&&c.hasOwnProperty("constructor")?c.constructor:function(){return a.apply(this,arguments)},b.extend(!0,e,a,d||{}),e.__super__=a.prototype,e.prototype=f(a.prototype),c&&b.extend(!0,e.prototype,c),e},noop:g,bindFn:e,log:function(){return a.console?e(console.log,console):g}(),nextTick:function(){return function(a){setTimeout(a,1)}}(),slice:d([].slice),guid:function(){var a=0;return function(b){for(var c=(+new Date).toString(32),d=0;5>d;d++)c+=Math.floor(65535*Math.random()).toString(32);return(b||"wu_")+c+(a++).toString(32)}}(),formatSize:function(a,b,c){var d;for(c=c||["B","K","M","G","TB"];(d=c.shift())&&a>1024;)a/=1024;return("B"===d?a:a.toFixed(b||2))+d}}}),b("mediator",["base"],function(a){function b(a,b,c,d){return f.grep(a,function(a){return!(!a||b&&a.e!==b||c&&a.cb!==c&&a.cb._cb!==c||d&&a.ctx!==d)})}function c(a,b,c){f.each((a||"").split(h),function(a,d){c(d,b)})}function d(a,b){for(var c,d=!1,e=-1,f=a.length;++e<f;)if(c=a[e],c.cb.apply(c.ctx2,b)===!1){d=!0;break}return!d}var e,f=a.$,g=[].slice,h=/\s+/;return e={on:function(a,b,d){var e,f=this;return b?(e=this._events||(this._events=[]),c(a,b,function(a,b){var c={e:a};c.cb=b;c.ctx=d;c.ctx2=d||f;c.id=e.length;e.push(c)}),this):this},once:function(a,b,d){var e=this;return b?(c(a,b,function(a,b){var c=function(){return e.off(a,c),b.apply(d||e,arguments)};c._cb=b;e.on(a,c,d)}),e):e},off:function(a,d,e){var g=this._events;return g?a||d||e?(c(a,d,function(a,c){f.each(b(g,a,c,e),function(){delete g[this.id]})}),this):(this._events=[],this):this},trigger:function(a){var c,e,f;return this._events&&a?(c=g.call(arguments,1),e=b(this._events,a),f=b(this._events,"all"),d(e,c)&&d(f,arguments)):this}},f.extend({installTo:function(a){return f.extend(a,e)}},e)}),b("uploader",["base","mediator"],function(a,b){function c(a){this.options=d.extend(!0,{},c.options,a);this._init(this.options)}var d=a.$;return c.options={},b.installTo(c.prototype),d.each({upload:"start-upload",stop:"stop-upload",getFile:"get-file",getFiles:"get-files",addFile:"add-file",addFiles:"add-file",sort:"sort-files",removeFile:"remove-file",cancelFile:"cancel-file",skipFile:"skip-file",retry:"retry",isInProgress:"is-in-progress",makeThumb:"make-thumb",md5File:"md5-file",getDimension:"get-dimension",addButton:"add-btn",predictRuntimeType:"predict-runtime-type",refresh:"refresh",disable:"disable",enable:"enable",reset:"reset"},function(a,b){c.prototype[a]=function(){return this.request(b,arguments)}}),d.extend(c.prototype,{state:"pending",_init:function(a){var b=this;b.request("init",a,function(){b.state="ready";b.trigger("ready")})},option:function(a,b){var c=this.options;return arguments.length>1?void(d.isPlainObject(b)&&d.isPlainObject(c[a])?d.extend(c[a],b):c[a]=b):a?c[a]:c},getStats:function(){var a=this.request("get-stats");return a?{successNum:a.numOfSuccess,progressNum:a.numOfProgress,cancelNum:a.numOfCancel,invalidNum:a.numOfInvalid,uploadFailNum:a.numOfUploadFailed,queueNum:a.numOfQueue,interruptNum:a.numofInterrupt}:{}},trigger:function(a){var c=[].slice.call(arguments,1),e=this.options,f="on"+a.substring(0,1).toUpperCase()+a.substring(1);return b.trigger.apply(this,arguments)===!1||d.isFunction(e[f])&&e[f].apply(this,c)===!1||d.isFunction(this[f])&&this[f].apply(this,c)===!1||b.trigger.apply(b,[this,a].concat(c))===!1?!1:!0},destroy:function(){this.request("destroy",arguments);this.off()},request:a.noop}),a.create=c.create=function(a){return new c(a)},a.Uploader=c,c}),b("runtime/runtime",["base","mediator"],function(a,b){function c(b){this.options=d.extend({container:document.body},b);this.uid=a.guid("rt_")}var d=a.$,e={},f=function(a){for(var b in a)if(a.hasOwnProperty(b))return b;return null};return d.extend(c.prototype,{getContainer:function(){var a,b,c=this.options;return this._container?this._container:(a=d(c.container||document.body),b=d(document.createElement("div")),b.attr("id","rt_"+this.uid),b.css({position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),a.append(b),a.addClass("webuploader-container"),this._container=b,this._parent=a,b)},init:a.noop,exec:a.noop,destroy:function(){this._container&&this._container.remove();this._parent&&this._parent.removeClass("webuploader-container");this.off()}}),c.orders="html5,flash",c.addRuntime=function(a,b){e[a]=b},c.hasRuntime=function(a){return!!(a?e[a]:f(e))},c.create=function(a,b){var g;if(b=b||c.orders,d.each(b.split(/\s*,\s*/g),function(){if(e[this])return(g=this,!1)}),g=g||f(e),!g)throw new Error("Runtime Error");return new e[g](a)},b.installTo(c.prototype),c}),b("runtime/client",["base","mediator","runtime/runtime"],function(a,b,c){function d(b,d){var f,g=a.Deferred();this.uid=a.guid("client_");this.runtimeReady=function(a){return g.done(a)};this.connectRuntime=function(b,h){if(f)throw new Error("already connected!");return g.done(h),"string"==typeof b&&e.get(b)&&(f=e.get(b)),f=f||e.get(null,d),f?(a.$.extend(f.options,b),f.__promise.then(g.resolve),f.__client++):(f=c.create(b,b.runtimeOrder),f.__promise=g.promise(),f.once("ready",g.resolve),f.init(),e.add(f),f.__client=1),d&&(f.__standalone=d),f};this.getRuntime=function(){return f};this.disconnectRuntime=function(){f&&(f.__client--,f.__client<=0&&(e.remove(f),delete f.__promise,f.destroy()),f=null)};this.exec=function(){if(f){var c=a.slice(arguments);return b&&c.unshift(b),f.exec.apply(this,c)}};this.getRuid=function(){return f&&f.uid};this.destroy=function(a){return function(){a&&a.apply(this,arguments);this.trigger("destroy");this.off();this.exec("destroy");this.disconnectRuntime()}}(this.destroy)}var e;return e=function(){var a={};return{add:function(b){a[b.uid]=b},get:function(b,c){var d;if(b)return a[b];for(d in a)if(!c||!a[d].__standalone)return a[d];return null},remove:function(b){delete a[b.uid]}}}(),b.installTo(d.prototype),d}),b("lib/dnd",["base","mediator","runtime/client"],function(a,b,c){function d(a){a=this.options=e.extend({},d.options,a);a.container=e(a.container);a.container.length&&c.call(this,"DragAndDrop")}var e=a.$;return d.options={accept:null,disableGlobalDnd:!1},a.inherits(c,{constructor:d,init:function(){var a=this;a.connectRuntime(a.options,function(){a.exec("init");a.trigger("ready")})}}),b.installTo(d.prototype),d}),b("widgets/widget",["base","uploader"],function(a,b){function c(a){if(!a)return!1;var b=a.length,c=e.type(a);return 1===a.nodeType&&b?!0:"array"===c||"function"!==c&&"string"!==c&&(0===b||"number"==typeof b&&b>0&&b-1 in a)}function d(a){this.owner=a;this.options=a.options}var e=a.$,f=b.prototype._init,g=b.prototype.destroy,h={},i=[];return e.extend(d.prototype,{init:a.noop,invoke:function(a,b){var c=this.responseMap;return c&&a in c&&c[a]in this&&e.isFunction(this[c[a]])?this[c[a]].apply(this,b):h},request:function(){return this.owner.request.apply(this.owner,arguments)}}),e.extend(b.prototype,{_init:function(){var a=this,b=a._widgets=[],c=a.options.disableWidgets||"";return e.each(i,function(d,e){c&&~c.indexOf(e._name)||b.push(new e(a))}),f.apply(a,arguments)},request:function(b,d,e){var f,g,i,j,k=0,l=this._widgets,m=l&&l.length,n=[],o=[];for(d=c(d)?d:[d];m>k;k++)f=l[k],g=f.invoke(b,d),g!==h&&(a.isPromise(g)?o.push(g):n.push(g));return e||o.length?(i=a.when.apply(a,o),j=i.pipe?"pipe":"then",i[j](function(){var b=a.Deferred(),c=arguments;return 1===c.length&&(c=c[0]),setTimeout(function(){b.resolve(c)},1),b.promise()})[e?j:"done"](e||a.noop)):n[0]},destroy:function(){g.apply(this,arguments);this._widgets=null}}),b.register=d.register=function(b,c){var f,g={init:"init",destroy:"destroy",name:"anonymous"};return 1===arguments.length?(c=b,e.each(c,function(a){return"_"===a[0]||"name"===a?void("name"===a&&(g.name=c.name)):void(g[a.replace(/[A-Z]/g,"-$&").toLowerCase()]=a)})):g=e.extend(g,b),c.responseMap=g,f=a.inherits(d,c),f._name=g.name,i.push(f),f},b.unRegister=d.unRegister=function(a){if(a&&"anonymous"!==a)for(var b=i.length;b--;)i[b]._name===a&&i.splice(b,1)},d}),b("widgets/filednd",["base","uploader","lib/dnd","widgets/widget"],function(a,b,c){var d=a.$;return b.options.dnd="",b.register({name:"dnd",init:function(b){if(b.dnd&&"html5"===this.request("predict-runtime-type")){var e,f=this,g=a.Deferred(),h=d.extend({},{disableGlobalDnd:b.disableGlobalDnd,container:b.dnd,accept:b.accept});return this.dnd=e=new c(h),e.once("ready",g.resolve),e.on("drop",function(a){f.request("add-file",[a])}),e.on("accept",function(a){return f.owner.trigger("dndAccept",a)}),e.init(),g.promise()}},destroy:function(){this.dnd&&this.dnd.destroy()}})}),b("lib/filepaste",["base","mediator","runtime/client"],function(a,b,c){function d(a){a=this.options=e.extend({},a);a.container=e(a.container||document.body);c.call(this,"FilePaste")}var e=a.$;return a.inherits(c,{constructor:d,init:function(){var a=this;a.connectRuntime(a.options,function(){a.exec("init");a.trigger("ready")})}}),b.installTo(d.prototype),d}),b("widgets/filepaste",["base","uploader","lib/filepaste","widgets/widget"],function(a,b,c){var d=a.$;return b.register({name:"paste",init:function(b){if(b.paste&&"html5"===this.request("predict-runtime-type")){var e,f=this,g=a.Deferred(),h=d.extend({},{container:b.paste,accept:b.accept});return this.paste=e=new c(h),e.once("ready",g.resolve),e.on("paste",function(a){f.owner.request("add-file",[a])}),e.init(),g.promise()}},destroy:function(){this.paste&&this.paste.destroy()}})}),b("lib/blob",["base","runtime/client"],function(a,b){function c(a,c){var d=this;d.source=c;d.ruid=a;this.size=c.size||0;this.type=!c.type&&this.ext&&~"jpg,jpeg,png,gif,bmp".indexOf(this.ext)?"image/"+("jpg"===this.ext?"jpeg":this.ext):c.type||"application/octet-stream";b.call(d,"Blob");this.uid=c.uid||this.uid;a&&d.connectRuntime(a)}return a.inherits(b,{constructor:c,slice:function(a,b){return this.exec("slice",a,b)},getSource:function(){return this.source}}),c}),b("lib/file",["base","lib/blob"],function(a,b){function c(a,c){var f;this.name=c.name||"untitled"+d++;f=e.exec(c.name)?RegExp.$1.toLowerCase():"";!f&&c.type&&(f=/\/(jpg|jpeg|png|gif|bmp)$/i.exec(c.type)?RegExp.$1.toLowerCase():"",this.name+="."+f);this.ext=f;this.lastModifiedDate=c.lastModifiedDate||(new Date).toLocaleString();b.apply(this,arguments)}var d=1,e=/\.([^.]+)$/;return a.inherits(b,c)}),b("lib/filepicker",["base","runtime/client","lib/file"],function(b,c,d){function e(a){if(a=this.options=f.extend({},e.options,a),a.container=f(a.id),!a.container.length)throw new Error("按钮指定错误");a.innerHTML=a.innerHTML||a.label||a.container.html()||"";a.button=f(a.button||document.createElement("div"));a.button.html(a.innerHTML);a.container.html(a.button);c.call(this,"FilePicker",!0)}var f=b.$;return e.options={button:null,container:null,label:null,innerHTML:null,multiple:!0,accept:null,name:"file"},b.inherits(c,{constructor:e,init:function(){var c=this,e=c.options,g=e.button;g.addClass("webuploader-pick");c.on("all",function(a){var b;switch(a){case"mouseenter":g.addClass("webuploader-pick-hover");break;case"mouseleave":g.removeClass("webuploader-pick-hover");break;case"change":b=c.exec("getFiles");c.trigger("select",f.map(b,function(a){return a=new d(c.getRuid(),a),a._refer=e.container,a}),e.container)}});c.connectRuntime(e,function(){c.refresh();c.exec("init",e);c.trigger("ready")});this._resizeHandler=b.bindFn(this.refresh,this);f(a).on("resize",this._resizeHandler)},refresh:function(){var a=this.getRuntime().getContainer(),b=this.options.button,c=b.outerWidth?b.outerWidth():b.width(),d=b.outerHeight?b.outerHeight():b.height(),e=b.offset();c&&d&&a.css({bottom:"auto",right:"auto",width:c+"px",height:d+"px"}).offset(e)},enable:function(){var a=this.options.button;a.removeClass("webuploader-pick-disable");this.refresh()},disable:function(){var a=this.options.button;this.getRuntime().getContainer().css({top:"-99999px"});a.addClass("webuploader-pick-disable")},destroy:function(){var b=this.options.button;f(a).off("resize",this._resizeHandler);b.removeClass("webuploader-pick-disable webuploader-pick-hover webuploader-pick")}}),e}),b("widgets/filepicker",["base","uploader","lib/filepicker","widgets/widget"],function(a,b,c){var d=a.$;return d.extend(b.options,{pick:null,accept:null}),b.register({name:"picker",init:function(a){return this.pickers=[],a.pick&&this.addBtn(a.pick)},refresh:function(){d.each(this.pickers,function(){this.refresh()})},addBtn:function(b){var e=this,f=e.options,g=f.accept,h=[];if(b)return d.isPlainObject(b)||(b={id:b}),d(b.id).each(function(){var i,j,k;k=a.Deferred();i=d.extend({},b,{accept:d.isPlainObject(g)?[g]:g,swf:f.swf,runtimeOrder:f.runtimeOrder,id:this});j=new c(i);j.once("ready",k.resolve);j.on("select",function(a){e.owner.request("add-file",[a])});j.init();e.pickers.push(j);h.push(k.promise())}),a.when.apply(a,h)},disable:function(){d.each(this.pickers,function(){this.disable()})},enable:function(){d.each(this.pickers,function(){this.enable()})},destroy:function(){d.each(this.pickers,function(){this.destroy()});this.pickers=null}})}),b("lib/image",["base","runtime/client","lib/blob"],function(a,b,c){function d(a){this.options=e.extend({},d.options,a);b.call(this,"Image");this.on("load",function(){this._info=this.exec("info");this._meta=this.exec("meta")})}var e=a.$;return d.options={quality:90,crop:!1,preserveHeaders:!1,allowMagnify:!1},a.inherits(b,{constructor:d,info:function(a){return a?(this._info=a,this):this._info},meta:function(a){return a?(this._meta=a,this):this._meta},loadFromBlob:function(a){var b=this,c=a.getRuid();this.connectRuntime(c,function(){b.exec("init",b.options);b.exec("loadFromBlob",a)})},resize:function(){var b=a.slice(arguments);return this.exec.apply(this,["resize"].concat(b))},crop:function(){var b=a.slice(arguments);return this.exec.apply(this,["crop"].concat(b))},getAsDataUrl:function(a){return this.exec("getAsDataUrl",a)},getAsBlob:function(a){var b=this.exec("getAsBlob",a);return new c(this.getRuid(),b)}}),d}),b("widgets/image",["base","uploader","lib/image","widgets/widget"],function(a,b,c){var d,e=a.$;return d=function(a){var b=0,c=[],d=function(){for(var d;c.length&&a>b;)d=c.shift(),b+=d[0],d[1]()};return function(a,e,f){c.push([e,f]);a.once("destroy",function(){b-=e;setTimeout(d,1)});setTimeout(d,1)}}(5242880),e.extend(b.options,{thumb:{width:110,height:110,quality:70,allowMagnify:!0,crop:!0,preserveHeaders:!1,type:"image/jpeg"},compress:{width:1600,height:1600,quality:90,allowMagnify:!1,crop:!1,preserveHeaders:!0}}),b.register({name:"image",makeThumb:function(a,b,f,g){var h,i;return a=this.request("get-file",a),a.type.match(/^image/)?(h=e.extend({},this.options.thumb),e.isPlainObject(f)&&(h=e.extend(h,f),f=null),f=f||h.width,g=g||h.height,i=new c(h),i.once("load",function(){a._info=a._info||i.info();a._meta=a._meta||i.meta();1>=f&&f>0&&(f=a._info.width*f);1>=g&&g>0&&(g=a._info.height*g);i.resize(f,g)}),i.once("complete",function(){b(!1,i.getAsDataUrl(h.type));i.destroy()}),i.once("error",function(a){b(a||!0);i.destroy()}),void d(i,a.source.size,function(){a._info&&i.info(a._info);a._meta&&i.meta(a._meta);i.loadFromBlob(a.source)})):void b(!0)},beforeSendFile:function(b){var d,f,g=this.options.compress||this.options.resize,h=g&&g.compressSize||0,i=g&&g.noCompressIfLarger||!1;return b=this.request("get-file",b),!g||!~"image/jpeg,image/jpg".indexOf(b.type)||b.size<h||b._compressed?void 0:(g=e.extend({},g),f=a.Deferred(),d=new c(g),f.always(function(){d.destroy();d=null}),d.once("error",f.reject),d.once("load",function(){var a=g.width,c=g.height;b._info=b._info||d.info();b._meta=b._meta||d.meta();1>=a&&a>0&&(a=b._info.width*a);1>=c&&c>0&&(c=b._info.height*c);d.resize(a,c)}),d.once("complete",function(){var a,c;try{a=d.getAsBlob(g.type);c=b.size;(!i||a.size<c)&&(b.source=a,b.size=a.size,b.trigger("resize",a.size,c));b._compressed=!0;f.resolve()}catch(e){f.resolve()}}),b._info&&d.info(b._info),b._meta&&d.meta(b._meta),d.loadFromBlob(b.source),f.promise())}})}),b("file",["base","mediator"],function(a,b){function c(){return f+g++}function d(a){this.name=a.name||"Untitled";this.size=a.size||0;this.type=a.type||"application/octet-stream";this.lastModifiedDate=a.lastModifiedDate||1*new Date;this.id=c();this.ext=h.exec(this.name)?RegExp.$1:"";this.statusText="";i[this.id]=d.Status.INITED;this.source=a;this.loaded=0;this.on("error",function(a){this.setStatus(d.Status.ERROR,a)})}var e=a.$,f="WU_FILE_",g=0,h=/\.([^.]+)$/,i={};return e.extend(d.prototype,{setStatus:function(a,b){var c=i[this.id];"undefined"!=typeof b&&(this.statusText=b);a!==c&&(i[this.id]=a,this.trigger("statuschange",a,c))},getStatus:function(){return i[this.id]},getSource:function(){return this.source},destroy:function(){this.off();delete i[this.id]}}),b.installTo(d.prototype),d.Status={INITED:"inited",QUEUED:"queued",PROGRESS:"progress",ERROR:"error",COMPLETE:"complete",CANCELLED:"cancelled",INTERRUPT:"interrupt",INVALID:"invalid"},d}),b("queue",["base","mediator","file"],function(a,b,c){function d(){this.stats={numOfQueue:0,numOfSuccess:0,numOfCancel:0,numOfProgress:0,numOfUploadFailed:0,numOfInvalid:0,numofDeleted:0,numofInterrupt:0};this._queue=[];this._map={}}var e=a.$,f=c.Status;return e.extend(d.prototype,{append:function(a){return this._queue.push(a),this._fileAdded(a),this},prepend:function(a){return this._queue.unshift(a),this._fileAdded(a),this},getFile:function(a){return"string"!=typeof a?a:this._map[a]},fetch:function(a){var b,c,d=this._queue.length;for(a=a||f.QUEUED,b=0;d>b;b++)if(c=this._queue[b],a===c.getStatus())return c;return null},sort:function(a){"function"==typeof a&&this._queue.sort(a)},getFiles:function(){for(var a,b=[].slice.call(arguments,0),c=[],d=0,f=this._queue.length;f>d;d++)a=this._queue[d],(!b.length||~e.inArray(a.getStatus(),b))&&c.push(a);return c},removeFile:function(a){var b=this._map[a.id];b&&(delete this._map[a.id],a.destroy(),this.stats.numofDeleted++)},_fileAdded:function(a){var b=this,c=this._map[a.id];c||(this._map[a.id]=a,a.on("statuschange",function(a,c){b._onFileStatusChange(a,c)}))},_onFileStatusChange:function(a,b){var c=this.stats;switch(b){case f.PROGRESS:c.numOfProgress--;break;case f.QUEUED:c.numOfQueue--;break;case f.ERROR:c.numOfUploadFailed--;break;case f.INVALID:c.numOfInvalid--;break;case f.INTERRUPT:c.numofInterrupt--}switch(a){case f.QUEUED:c.numOfQueue++;break;case f.PROGRESS:c.numOfProgress++;break;case f.ERROR:c.numOfUploadFailed++;break;case f.COMPLETE:c.numOfSuccess++;break;case f.CANCELLED:c.numOfCancel++;break;case f.INVALID:c.numOfInvalid++;break;case f.INTERRUPT:c.numofInterrupt++}}}),b.installTo(d.prototype),d}),b("widgets/queue",["base","uploader","queue","file","lib/file","runtime/client","widgets/widget"],function(a,b,c,d,e,f){var g=a.$,h=/\.\w+$/,i=d.Status;return b.register({name:"queue",init:function(b){var d,e,h,i,j,k,l,m=this;if(g.isPlainObject(b.accept)&&(b.accept=[b.accept]),b.accept){for(j=[],h=0,e=b.accept.length;e>h;h++)i=b.accept[h].extensions,i&&j.push(i);j.length&&(k="\\."+j.join(",").replace(/,/g,"$|\\.").replace(/\*/g,".*")+"$");m.accept=new RegExp(k,"i")}return m.queue=new c,m.stats=m.queue.stats,"html5"===this.request("predict-runtime-type")?(d=a.Deferred(),this.placeholder=l=new f("Placeholder"),l.connectRuntime({runtimeOrder:"html5"},function(){m._ruid=l.getRuid();d.resolve()}),d.promise()):void 0},_wrapFile:function(a){if(!(a instanceof d)){if(!(a instanceof e)){if(!this._ruid)throw new Error("Can't add external files.");a=new e(this._ruid,a)}a=new d(a)}return a},acceptFile:function(a){var b=!a||!a.size||this.accept&&h.exec(a.name)&&!this.accept.test(a.name);return!b},_addFile:function(a){var b=this;return a=b._wrapFile(a),b.owner.trigger("beforeFileQueued",a)?b.acceptFile(a)?(b.queue.append(a),b.owner.trigger("fileQueued",a),a):void b.owner.trigger("error","Q_TYPE_DENIED",a):void 0},getFile:function(a){return this.queue.getFile(a)},addFile:function(a){var b=this;a.length||(a=[a]);a=g.map(a,function(a){return b._addFile(a)});b.owner.trigger("filesQueued",a);b.options.auto&&setTimeout(function(){b.request("start-upload")},20)},getStats:function(){return this.stats},removeFile:function(a,b){var c=this;a=a.id?a:c.queue.getFile(a);this.request("cancel-file",a);b&&this.queue.removeFile(a)},getFiles:function(){return this.queue.getFiles.apply(this.queue,arguments)},fetchFile:function(){return this.queue.fetch.apply(this.queue,arguments)},retry:function(a,b){var c,d,e,f=this;if(a)return a=a.id?a:f.queue.getFile(a),a.setStatus(i.QUEUED),void(b||f.request("start-upload"));for(c=f.queue.getFiles(i.ERROR),d=0,e=c.length;e>d;d++)a=c[d],a.setStatus(i.QUEUED);f.request("start-upload")},sortFiles:function(){return this.queue.sort.apply(this.queue,arguments)},reset:function(){this.owner.trigger("reset");this.queue=new c;this.stats=this.queue.stats},destroy:function(){this.reset();this.placeholder&&this.placeholder.destroy()}})}),b("widgets/runtime",["uploader","runtime/runtime","widgets/widget"],function(a,b){return a.support=function(){return b.hasRuntime.apply(b,arguments)},a.register({name:"runtime",init:function(){if(!this.predictRuntimeType())throw Error("Runtime Error");},predictRuntimeType:function(){var a,c,d=this.options.runtimeOrder||b.orders,e=this.type;if(!e)for(d=d.split(/\s*,\s*/g),a=0,c=d.length;c>a;a++)if(b.hasRuntime(d[a])){this.type=e=d[a];break}return e}})}),b("lib/transport",["base","runtime/client","mediator"],function(a,b,c){function d(a){var c=this;a=c.options=e.extend(!0,{},d.options,a||{});b.call(this,"Transport");this._blob=null;this._formData=a.formData||{};this._headers=a.headers||{};this.on("progress",this._timeout);this.on("load error",function(){c.trigger("progress",1);clearTimeout(c._timer)})}var e=a.$;return d.options={server:"",method:"POST",withCredentials:!1,fileVal:"file",timeout:12e4,formData:{},headers:{},sendAsBinary:!1},e.extend(d.prototype,{appendBlob:function(a,b,c){var d=this,e=d.options;d.getRuid()&&d.disconnectRuntime();d.connectRuntime(b.ruid,function(){d.exec("init")});d._blob=b;e.fileVal=a||e.fileVal;e.filename=c||e.filename},append:function(a,b){"object"==typeof a?e.extend(this._formData,a):this._formData[a]=b},setRequestHeader:function(a,b){"object"==typeof a?e.extend(this._headers,a):this._headers[a]=b},send:function(a){this.exec("send",a);this._timeout()},abort:function(){return clearTimeout(this._timer),this.exec("abort")},destroy:function(){this.trigger("destroy");this.off();this.exec("destroy");this.disconnectRuntime()},getResponse:function(){return this.exec("getResponse")},getResponseAsJson:function(){return this.exec("getResponseAsJson")},getStatus:function(){return this.exec("getStatus")},_timeout:function(){var a=this,b=a.options.timeout;b&&(clearTimeout(a._timer),a._timer=setTimeout(function(){a.abort();a.trigger("error","timeout")},b))}}),c.installTo(d.prototype),d}),b("widgets/upload",["base","uploader","file","lib/transport","widgets/widget"],function(a,b,c,d){function e(a,b){for(var c,e=[],f=a.source,g=f.size,h=b?Math.ceil(g/b):1,i=0,j=0,d={file:a,has:function(){return!!e.length},shift:function(){return e.shift()},unshift:function(a){e.unshift(a)}};h>j;)c=Math.min(b,g-i),e.push({file:a,start:i,end:b?i+c:g,total:g,chunks:h,chunk:j++,cuted:d}),i+=c;return a.blocks=e.concat(),a.remaning=e.length,d}var f=a.$,g=a.isPromise,h=c.Status;f.extend(b.options,{prepareNextFile:!1,chunked:!1,chunkSize:5242880,chunkRetry:2,threads:3,formData:{}});b.register({name:"upload",init:function(){var b=this.owner,c=this;this.runing=!1;this.progress=!1;b.on("startUpload",function(){c.progress=!0}).on("uploadFinished",function(){c.progress=!1});this.pool=[];this.stack=[];this.pending=[];this.remaning=0;this.__tick=a.bindFn(this._tick,this);b.on("uploadComplete",function(a){a.blocks&&f.each(a.blocks,function(a,b){b.transport&&(b.transport.abort(),b.transport.destroy());delete b.transport});delete a.blocks;delete a.remaning})},reset:function(){this.request("stop-upload",!0);this.runing=!1;this.pool=[];this.stack=[];this.pending=[];this.remaning=0;this._trigged=!1;this._promise=null},startUpload:function(b){var c=this,d,b;if(f.each(c.request("get-files",h.INVALID),function(){c.request("remove-file",this)}),b)if(b=b.id?b:c.request("get-file",b),b.getStatus()===h.INTERRUPT)f.each(c.pool,function(a,c){c.file===b&&c.transport&&c.transport.send()}),b.setStatus(h.QUEUED);else{if(b.getStatus()===h.PROGRESS)return;b.setStatus(h.QUEUED)}else f.each(c.request("get-files",[h.INITED]),function(){this.setStatus(h.QUEUED)});if(!c.runing){for(c.runing=!0,d=[],f.each(c.pool,function(a,b){var e=b.file;e.getStatus()===h.INTERRUPT&&(d.push(e),c._trigged=!1,b.transport&&b.transport.send())});b=d.shift();)b.setStatus(h.PROGRESS);b||f.each(c.request("get-files",h.INTERRUPT),function(){this.setStatus(h.PROGRESS)});c._trigged=!1;a.nextTick(c.__tick);c.owner.trigger("startUpload")}},stopUpload:function(b,c){var d=this;if(b===!0&&(c=b,b=null),d.runing!==!1){if(b)return(b=b.id?b:d.request("get-file",b),b.getStatus()!==h.PROGRESS&&b.getStatus()!==h.QUEUED)?void 0:(b.setStatus(h.INTERRUPT),f.each(d.pool,function(a,c){c.file===b&&(c.transport&&c.transport.abort(),d._putback(c),d._popBlock(c))}),a.nextTick(d.__tick));d.runing=!1;this._promise&&this._promise.file&&this._promise.file.setStatus(h.INTERRUPT);c&&f.each(d.pool,function(a,b){b.transport&&b.transport.abort();b.file.setStatus(h.INTERRUPT)});d.owner.trigger("stopUpload")}},cancelFile:function(a){a=a.id?a:this.request("get-file",a);a.blocks&&f.each(a.blocks,function(a,b){var c=b.transport;c&&(c.abort(),c.destroy(),delete b.transport)});a.setStatus(h.CANCELLED);this.owner.trigger("fileDequeued",a)},isInProgress:function(){return!!this.progress},_getStats:function(){return this.request("get-stats")},skipFile:function(a,b){a=a.id?a:this.request("get-file",a);a.setStatus(b||h.COMPLETE);a.skipped=!0;a.blocks&&f.each(a.blocks,function(a,b){var c=b.transport;c&&(c.abort(),c.destroy(),delete b.transport)});this.owner.trigger("uploadSkip",a)},_tick:function(){var b,c,d=this,e=d.options;return d._promise?d._promise.always(d.__tick):void(d.pool.length<e.threads&&(c=d._nextBlock())?(d._trigged=!1,b=function(b){d._promise=null;b&&b.file&&d._startSend(b);a.nextTick(d.__tick)},d._promise=g(c)?c.always(b):b(c)):d.remaning||d._getStats().numOfQueue||d._getStats().numofInterrupt||(d.runing=!1,d._trigged||a.nextTick(function(){d.owner.trigger("uploadFinished")}),d._trigged=!0))},_putback:function(a){var b;a.cuted.unshift(a);b=this.stack.indexOf(a.cuted);~b||this.stack.unshift(a.cuted)},_getStack:function(){for(var a,b=0;a=this.stack[b++];){if(a.has()&&a.file.getStatus()===h.PROGRESS)return a;a.has()&&(a.file.getStatus()===h.PROGRESS||a.file.getStatus()===h.INTERRUPT)||this.stack.splice(--b,1)}return null},_nextBlock:function(){var a,b,c,d,f=this,h=f.options;return(a=this._getStack())?(h.prepareNextFile&&!f.pending.length&&f._prepareNextFile(),a.shift()):f.runing?(!f.pending.length&&f._getStats().numOfQueue&&f._prepareNextFile(),b=f.pending.shift(),c=function(b){return b?(a=e(b,h.chunked?h.chunkSize:0),f.stack.push(a),a.shift()):null},g(b)?(d=b.file,b=b[b.pipe?"pipe":"then"](c),b.file=d,b):c(b)):void 0},_prepareNextFile:function(){var a,b=this,c=b.request("fetch-file"),d=b.pending;c&&(a=b.request("before-send-file",c,function(){return c.getStatus()===h.PROGRESS||c.getStatus()===h.INTERRUPT?c:b._finishFile(c)}),b.owner.trigger("uploadStart",c),c.setStatus(h.PROGRESS),a.file=c,a.done(function(){var b=f.inArray(a,d);~b&&d.splice(b,1,c)}),a.fail(function(a){c.setStatus(h.ERROR,a);b.owner.trigger("uploadError",c,a);b.owner.trigger("uploadComplete",c)}),d.push(a))},_popBlock:function(a){var b=f.inArray(a,this.pool);this.pool.splice(b,1);a.file.remaning--;this.remaning--},_startSend:function(b){var c,d=this,e=b.file;return e.getStatus()!==h.PROGRESS?void(e.getStatus()===h.INTERRUPT&&d._putback(b)):(d.pool.push(b),d.remaning++,b.blob=1===b.chunks?e.source:e.source.slice(b.start,b.end),c=d.request("before-send",b,function(){e.getStatus()===h.PROGRESS?d._doSend(b):(d._popBlock(b),a.nextTick(d.__tick))}),void c.fail(function(){1===e.remaning?d._finishFile(e).always(function(){b.percentage=1;d._popBlock(b);d.owner.trigger("uploadComplete",e);a.nextTick(d.__tick)}):(b.percentage=1,d.updateFileProgress(e),d._popBlock(b),a.nextTick(d.__tick))}))},_doSend:function(b){var c,e,g=this,i=g.owner,j=g.options,k=b.file,l=new d(j),m=f.extend({},j.formData),n=f.extend({},j.headers);b.transport=l;l.on("destroy",function(){delete b.transport;g._popBlock(b);a.nextTick(g.__tick)});l.on("progress",function(a){b.percentage=a;g.updateFileProgress(k)});c=function(a){var c;return e=l.getResponseAsJson()||{},e._raw=l.getResponse(),c=function(b){a=b},i.trigger("uploadAccept",b,e,c)||(a=a||"server"),a};l.on("error",function(a,d){b.retried=b.retried||0;b.chunks>1&&~"http,abort".indexOf(a)&&b.retried<j.chunkRetry?(b.retried++,l.send()):(d||"server"!==a||(a=c(a)),k.setStatus(h.ERROR,a),i.trigger("uploadError",k,a),i.trigger("uploadComplete",k))});l.on("load",function(){var a;return(a=c())?void l.trigger("error",a,!0):void(1===k.remaning?g._finishFile(k,e):l.destroy())});m=f.extend(m,{id:k.id,name:k.name,type:k.type,lastModifiedDate:k.lastModifiedDate,size:k.size});b.chunks>1&&f.extend(m,{chunks:b.chunks,chunk:b.chunk});i.trigger("uploadBeforeSend",b,m,n);l.appendBlob(j.fileVal,b.blob,k.name);l.append(m);l.setRequestHeader(n);l.send()},_finishFile:function(a,b,c){var d=this.owner;return d.request("after-send-file",arguments,function(){a.setStatus(h.COMPLETE);d.trigger("uploadSuccess",a,b,c)}).fail(function(b){a.getStatus()===h.PROGRESS&&a.setStatus(h.ERROR,b);d.trigger("uploadError",a,b)}).always(function(){d.trigger("uploadComplete",a)})},updateFileProgress:function(a){var b=0,c=0;a.blocks&&(f.each(a.blocks,function(a,b){c+=(b.percentage||0)*(b.end-b.start)}),b=c/a.size,this.owner.trigger("uploadProgress",a,b||0))}})}),b("widgets/validator",["base","uploader","file","widgets/widget"],function(a,b,c){var d,e=a.$,f={};return d={addValidator:function(a,b){f[a]=b},removeValidator:function(a){delete f[a]}},b.register({name:"validator",init:function(){var b=this;a.nextTick(function(){e.each(f,function(){this.call(b.owner)})})}}),d.addValidator("fileNumLimit",function(){var a=this,b=a.options,c=0,d=parseInt(b.fileNumLimit,10),e=!0;d&&(a.on("beforeFileQueued",function(a){return c>=d&&e&&(e=!1,this.trigger("error","Q_EXCEED_NUM_LIMIT",d,a),setTimeout(function(){e=!0},1)),c>=d?!1:!0}),a.on("fileQueued",function(){c++}),a.on("fileDequeued",function(){c--}),a.on("reset",function(){c=0}))}),d.addValidator("fileSizeLimit",function(){var a=this,b=a.options,c=0,d=parseInt(b.fileSizeLimit,10),e=!0;d&&(a.on("beforeFileQueued",function(a){var b=c+a.size>d;return b&&e&&(e=!1,this.trigger("error","Q_EXCEED_SIZE_LIMIT",d,a),setTimeout(function(){e=!0},1)),b?!1:!0}),a.on("fileQueued",function(a){c+=a.size}),a.on("fileDequeued",function(a){c-=a.size}),a.on("reset",function(){c=0}))}),d.addValidator("fileSingleSizeLimit",function(){var a=this,b=a.options,d=b.fileSingleSizeLimit;d&&a.on("beforeFileQueued",function(a){if(a.size>d)return(a.setStatus(c.Status.INVALID,"exceed_size"),this.trigger("error","F_EXCEED_SIZE",d,a),!1)})}),d.addValidator("duplicate",function(){function a(a){for(var b,c=0,d=0,e=a.length;e>d;d++)b=a.charCodeAt(d),c=b+(c<<6)+(c<<16)-c;return c}var b=this,c=b.options,d={};c.duplicate||(b.on("beforeFileQueued",function(b){var c=b.__hash||(b.__hash=a(b.name+b.size+b.lastModifiedDate));if(d[c])return(this.trigger("error","F_DUPLICATE",b),!1)}),b.on("fileQueued",function(a){var b=a.__hash;b&&(d[b]=!0)}),b.on("fileDequeued",function(a){var b=a.__hash;b&&delete d[b]}),b.on("reset",function(){d={}}))}),d}),b("lib/md5",["runtime/client","mediator"],function(a,b){function c(){a.call(this,"Md5")}return b.installTo(c.prototype),c.prototype.loadFromBlob=function(a){var b=this;b.getRuid()&&b.disconnectRuntime();b.connectRuntime(a.ruid,function(){b.exec("init");b.exec("loadFromBlob",a)})},c.prototype.getResult=function(){return this.exec("getResult")},c}),b("widgets/md5",["base","uploader","lib/md5","lib/blob","widgets/widget"],function(a,b,c,d){return b.register({name:"md5",md5File:function(b,e,f){var g=new c,h=a.Deferred(),i=b instanceof d?b:this.request("get-file",b).source;return g.on("progress load",function(a){a=a||{};h.notify(a.total?a.loaded/a.total:1)}),g.on("complete",function(){h.resolve(g.getResult())}),g.on("error",function(a){h.reject(a)}),arguments.length>1&&(e=e||0,f=f||0,0>e&&(e=i.size+e),0>f&&(f=i.size+f),f=Math.min(f,i.size),i=i.slice(e,f)),g.loadFromBlob(i),h.promise()}})}),b("runtime/compbase",[],function(){function a(a,b){this.owner=a;this.options=a.options;this.getRuntime=function(){return b};this.getRuid=function(){return b.uid};this.trigger=function(){return a.trigger.apply(a,arguments)}}return a}),b("runtime/html5/runtime",["base","runtime/runtime","runtime/compbase"],function(b,c,d){function e(){var a={},d=this,e=this.destroy;c.apply(d,arguments);d.type=f;d.exec=function(c,e){var f,h=this,i=h.uid,j=b.slice(arguments,2);if(g[c]&&(f=a[i]=a[i]||new g[c](h,d),f[e]))return f[e].apply(f,j)};d.destroy=function(){return e&&e.apply(this,arguments)}}var f="html5",g={};return b.inherits(c,{constructor:e,init:function(){var a=this;setTimeout(function(){a.trigger("ready")},1)}}),e.register=function(a,c){return g[a]=b.inherits(d,c)},a.Blob&&a.FileReader&&a.DataView&&c.addRuntime(f,e),e}),b("runtime/html5/blob",["runtime/html5/runtime","lib/blob"],function(a,b){return a.register("Blob",{slice:function(a,c){var d=this.owner.source,e=d.slice||d.webkitSlice||d.mozSlice;return d=e.call(d,a,c),new b(this.getRuid(),d)}})}),b("runtime/html5/dnd",["base","runtime/html5/runtime","lib/file"],function(a,b,c){var d=a.$,e="webuploader-dnd-";return b.register("DragAndDrop",{init:function(){var b=this.elem=this.options.container;this.dragEnterHandler=a.bindFn(this._dragEnterHandler,this);this.dragOverHandler=a.bindFn(this._dragOverHandler,this);this.dragLeaveHandler=a.bindFn(this._dragLeaveHandler,this);this.dropHandler=a.bindFn(this._dropHandler,this);this.dndOver=!1;b.on("dragenter",this.dragEnterHandler);b.on("dragover",this.dragOverHandler);b.on("dragleave",this.dragLeaveHandler);b.on("drop",this.dropHandler);this.options.disableGlobalDnd&&(d(document).on("dragover",this.dragOverHandler),d(document).on("drop",this.dropHandler))},_dragEnterHandler:function(a){var b,c=this,d=c._denied||!1;return a=a.originalEvent||a,c.dndOver||(c.dndOver=!0,b=a.dataTransfer.items,b&&b.length&&(c._denied=d=!c.trigger("accept",b)),c.elem.addClass(e+"over"),c.elem[d?"addClass":"removeClass"](e+"denied")),a.dataTransfer.dropEffect=d?"none":"copy",!1},_dragOverHandler:function(a){var b=this.elem.parent().get(0);return b&&!d.contains(b,a.currentTarget)?!1:(clearTimeout(this._leaveTimer),this._dragEnterHandler.call(this,a),!1)},_dragLeaveHandler:function(){var a,b=this;return a=function(){b.dndOver=!1;b.elem.removeClass(e+"over "+e+"denied")},clearTimeout(b._leaveTimer),b._leaveTimer=setTimeout(a,100),!1},_dropHandler:function(a){var b,f,g=this,h=g.getRuid(),i=g.elem.parent().get(0);if(i&&!d.contains(i,a.currentTarget))return!1;a=a.originalEvent||a;b=a.dataTransfer;try{f=b.getData("text/html")}catch(j){}if(!f)return(g._getTansferFiles(b,function(a){g.trigger("drop",d.map(a,function(a){return new c(h,a)}))}),g.dndOver=!1,g.elem.removeClass(e+"over"),!1)},_getTansferFiles:function(b,c){var d,e,f,g,h,i,j,k=[],l=[];for(d=b.items,e=b.files,j=!(!d||!d[0].webkitGetAsEntry),h=0,i=e.length;i>h;h++)f=e[h],g=d&&d[h],j&&g.webkitGetAsEntry().isDirectory?l.push(this._traverseDirectoryTree(g.webkitGetAsEntry(),k)):k.push(f);a.when.apply(a,l).done(function(){k.length&&c(k)})},_traverseDirectoryTree:function(b,c){var d=a.Deferred(),e=this;return b.isFile?b.file(function(a){c.push(a);d.resolve()}):b.isDirectory&&b.createReader().readEntries(function(b){for(var g=b.length,h=[],i=[],f=0;g>f;f++)h.push(e._traverseDirectoryTree(b[f],i));a.when.apply(a,h).then(function(){c.push.apply(c,i);d.resolve()},d.reject)}),d.promise()},destroy:function(){var a=this.elem;a&&(a.off("dragenter",this.dragEnterHandler),a.off("dragover",this.dragOverHandler),a.off("dragleave",this.dragLeaveHandler),a.off("drop",this.dropHandler),this.options.disableGlobalDnd&&(d(document).off("dragover",this.dragOverHandler),d(document).off("drop",this.dropHandler)))}})}),b("runtime/html5/filepaste",["base","runtime/html5/runtime","lib/file"],function(a,b,c){return b.register("FilePaste",{init:function(){var b,c,d,e,f=this.options,g=this.elem=f.container,h=".*";if(f.accept){for(b=[],c=0,d=f.accept.length;d>c;c++)e=f.accept[c].mimeTypes,e&&b.push(e);b.length&&(h=b.join(","),h=h.replace(/,/g,"|").replace(/\*/g,".*"))}this.accept=h=new RegExp(h,"i");this.hander=a.bindFn(this._pasteHander,this);g.on("paste",this.hander)},_pasteHander:function(a){var b,d,e,f,g,h=[],i=this.getRuid();for(a=a.originalEvent||a,b=a.clipboardData.items,f=0,g=b.length;g>f;f++)d=b[f],"file"===d.kind&&(e=d.getAsFile())&&h.push(new c(i,e));h.length&&(a.preventDefault(),a.stopPropagation(),this.trigger("paste",h))},destroy:function(){this.elem.off("paste",this.hander)}})}),b("runtime/html5/filepicker",["base","runtime/html5/runtime"],function(a,b){var c=a.$;return b.register("FilePicker",{init:function(){var a,b,d,e,f=this.getRuntime().getContainer(),g=this,h=g.owner,i=g.options,j=this.label=c(document.createElement("label")),k=this.input=c(document.createElement("input"));if(k.attr("type","file"),k.attr("name",i.name),k.addClass("webuploader-element-invisible"),j.on("click",function(){k.trigger("click")}),j.css({opacity:0,width:"100%",height:"100%",display:"block",cursor:"pointer",background:"#ffffff"}),i.multiple&&k.attr("multiple","multiple"),i.accept&&i.accept.length>0){for(a=[],b=0,d=i.accept.length;d>b;b++)a.push(i.accept[b].mimeTypes);k.attr("accept",a.join(","))}f.append(k);f.append(j);e=function(a){h.trigger(a.type)};k.on("change",function(a){var b,d=arguments.callee;g.files=a.target.files;b=this.cloneNode(!0);b.value=null;this.parentNode.replaceChild(b,this);k.off();k=c(b).on("change",d).on("mouseenter mouseleave",e);h.trigger("change")});j.on("mouseenter mouseleave",e)},getFiles:function(){return this.files},destroy:function(){this.input.off();this.label.off()}})}),b("runtime/html5/util",["base"],function(b){var c=a.createObjectURL&&a||a.URL&&URL.revokeObjectURL&&URL||a.webkitURL,d=b.noop,e=d;return c&&(d=function(){return c.createObjectURL.apply(c,arguments)},e=function(){return c.revokeObjectURL.apply(c,arguments)}),{createObjectURL:d,revokeObjectURL:e,dataURL2Blob:function(a){var b,c,d,e,f,g;for(g=a.split(","),b=~g[0].indexOf("base64")?atob(g[1]):decodeURIComponent(g[1]),d=new ArrayBuffer(b.length),c=new Uint8Array(d),e=0;e<b.length;e++)c[e]=b.charCodeAt(e);return f=g[0].split(":")[1].split(";")[0],this.arrayBufferToBlob(d,f)},dataURL2ArrayBuffer:function(a){var b,c,d,e;for(e=a.split(","),b=~e[0].indexOf("base64")?atob(e[1]):decodeURIComponent(e[1]),c=new Uint8Array(b.length),d=0;d<b.length;d++)c[d]=b.charCodeAt(d);return c.buffer},arrayBufferToBlob:function(b,c){var d,e=a.BlobBuilder||a.WebKitBlobBuilder;return e?(d=new e,d.append(b),d.getBlob(c)):new Blob([b],c?{type:c}:{})},canvasToDataUrl:function(a,b,c){return a.toDataURL(b,c/100)},parseMeta:function(a,b){b(!1,{})},updateImageHead:function(a){return a}}}),b("runtime/html5/imagemeta",["runtime/html5/util"],function(a){var b;return b={parsers:{65505:[]},maxMetaDataSize:262144,parse:function(a,b){var c=this,d=new FileReader;d.onload=function(){b(!1,c._parse(this.result));d=d.onload=d.onerror=null};d.onerror=function(a){b(a.message);d=d.onload=d.onerror=null};a=a.slice(0,c.maxMetaDataSize);d.readAsArrayBuffer(a.getSource())},_parse:function(a,c){if(!(a.byteLength<6)){var d,e,f,g,h=new DataView(a),i=2,j=h.byteLength-4,k=i,l={};if(65496===h.getUint16(0)){for(;j>i&&(d=h.getUint16(i),d>=65504&&65519>=d||65534===d)&&(e=h.getUint16(i+2)+2,!(i+e>h.byteLength));){if(f=b.parsers[d],!c&&f)for(g=0;g<f.length;g+=1)f[g].call(b,h,i,e,l);i+=e;k=i}k>6&&(l.imageHead=a.slice?a.slice(2,k):new Uint8Array(a).subarray(2,k))}return l}},updateImageHead:function(a,b){var c,d,e,f=this._parse(a,!0);return e=2,f.imageHead&&(e=2+f.imageHead.byteLength),d=a.slice?a.slice(e):new Uint8Array(a).subarray(e),c=new Uint8Array(b.byteLength+2+d.byteLength),c[0]=255,c[1]=216,c.set(new Uint8Array(b),2),c.set(new Uint8Array(d),b.byteLength+2),c.buffer}},a.parseMeta=function(){return b.parse.apply(b,arguments)},a.updateImageHead=function(){return b.updateImageHead.apply(b,arguments)},b}),b("runtime/html5/imagemeta/exif",["base","runtime/html5/imagemeta"],function(a,b){var c={};return c.ExifMap=function(){return this},c.ExifMap.prototype.map={Orientation:274},c.ExifMap.prototype.get=function(a){return this[a]||this[this.map[a]]},c.exifTagTypes={1:{getValue:function(a,b){return a.getUint8(b)},size:1},2:{getValue:function(a,b){return String.fromCharCode(a.getUint8(b))},size:1,ascii:!0},3:{getValue:function(a,b,c){return a.getUint16(b,c)},size:2},4:{getValue:function(a,b,c){return a.getUint32(b,c)},size:4},5:{getValue:function(a,b,c){return a.getUint32(b,c)/a.getUint32(b+4,c)},size:8},9:{getValue:function(a,b,c){return a.getInt32(b,c)},size:4},10:{getValue:function(a,b,c){return a.getInt32(b,c)/a.getInt32(b+4,c)},size:8}},c.exifTagTypes[7]=c.exifTagTypes[1],c.getExifValue=function(b,d,e,f,g,h){var i,j,k,l,m,n,o=c.exifTagTypes[f];if(!o)return void a.log("Invalid Exif data: Invalid tag type.");if(i=o.size*g,j=i>4?d+b.getUint32(e+8,h):e+8,j+i>b.byteLength)return void a.log("Invalid Exif data: Invalid data offset.");if(1===g)return o.getValue(b,j,h);for(k=[],l=0;g>l;l+=1)k[l]=o.getValue(b,j+l*o.size,h);if(o.ascii){for(m="",l=0;l<k.length&&(n=k[l],"\x00"!==n);l+=1)m+=n;return m}return k},c.parseExifTag=function(a,b,d,e,f){var g=a.getUint16(d,e);f.exif[g]=c.getExifValue(a,b,d,a.getUint16(d+2,e),a.getUint32(d+4,e),e)},c.parseExifTags=function(b,c,d,e,f){var g,h,i;if(d+6>b.byteLength)return void a.log("Invalid Exif data: Invalid directory offset.");if(g=b.getUint16(d,e),h=d+2+12*g,h+4>b.byteLength)return void a.log("Invalid Exif data: Invalid directory size.");for(i=0;g>i;i+=1)this.parseExifTag(b,c,d+2+12*i,e,f);return b.getUint32(h,e)},c.parseExifData=function(b,d,e,f){var g,h,i=d+10;if(1165519206===b.getUint32(d+4)){if(i+8>b.byteLength)return void a.log("Invalid Exif data: Invalid segment size.");if(0!==b.getUint16(d+8))return void a.log("Invalid Exif data: Missing byte alignment offset.");switch(b.getUint16(i)){case 18761:g=!0;break;case 19789:g=!1;break;default:return void a.log("Invalid Exif data: Invalid byte alignment marker.")}if(42!==b.getUint16(i+2,g))return void a.log("Invalid Exif data: Missing TIFF marker.");h=b.getUint32(i+4,g);f.exif=new c.ExifMap;h=c.parseExifTags(b,i,i+h,g,f)}},b.parsers[65505].push(c.parseExifData),c}),b("runtime/html5/jpegencoder",[],function(){function a(a){function b(a){for(var d,e,f,g,k,b=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],c=0;64>c;c++)d=y((b[c]*a+50)/100),1>d?d=1:d>255&&(d=255),z[P[c]]=d;for(e=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],f=0;64>f;f++)g=y((e[f]*a+50)/100),1>g?g=1:g>255&&(g=255),A[P[f]]=g;for(var h=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],i=0,j=0;8>j;j++)for(k=0;8>k;k++)B[i]=1/(z[P[i]]*h[j]*h[k]*8),C[i]=1/(A[P[i]]*h[j]*h[k]*8),i++}function c(a,b){for(var g,c=0,d=0,e=[],f=1;16>=f;f++){for(g=1;g<=a[f];g++)e[b[d]]=[],e[b[d]][0]=c,e[b[d]][1]=f,d++,c++;c*=2}return e}function d(){t=c(Q,R);u=c(U,V);v=c(S,T);w=c(W,X)}function e(){for(var d,e,a=1,b=2,c=1;15>=c;c++){for(d=a;b>d;d++)E[32767+d]=c,D[32767+d]=[],D[32767+d][1]=c,D[32767+d][0]=d;for(e=-(b-1);-a>=e;e++)E[32767+e]=c,D[32767+e]=[],D[32767+e][1]=c,D[32767+e][0]=b-1+e;a<<=1;b<<=1}}function f(){for(var a=0;256>a;a++)O[a]=19595*a,O[a+256>>0]=38470*a,O[a+512>>0]=7471*a+32768,O[a+768>>0]=-11059*a,O[a+1024>>0]=-21709*a,O[a+1280>>0]=32768*a+8421375,O[a+1536>>0]=-27439*a,O[a+1792>>0]=-5329*a}function g(a){for(var b=a[0],c=a[1]-1;c>=0;)b&1<<c&&(I|=1<<J),c--,J--,0>J&&(255==I?(h(255),h(0)):h(I),J=7,I=0)}function h(a){H.push(N[a])}function i(a){h(a>>8&255);h(255&a)}function j(a,b){for(var c,d,e,f,g,h,i,j,l=0,m=8,A,U,_,k=0;m>k;++k){c=a[l];d=a[l+1];e=a[l+2];f=a[l+3];g=a[l+4];h=a[l+5];i=a[l+6];j=a[l+7];var o=c+j,p=c-j,q=d+i,r=d-i,s=e+h,t=e-h,u=f+g,v=f-g,w=o+u,x=o-u,y=q+s,z=q-s;a[l]=w+y;a[l+4]=w-y;A=.707106781*(z+x);a[l+2]=x+A;a[l+6]=x-A;w=v+t;y=t+r;z=r+p;var B=.382683433*(w-z),C=.5411961*w+B,D=1.306562965*z+B,E=.707106781*y,G=p+E,H=p-E;a[l+5]=H+C;a[l+3]=H-C;a[l+1]=G+D;a[l+7]=G-D;l+=8}for(l=0,k=0;m>k;++k){c=a[l];d=a[l+8];e=a[l+16];f=a[l+24];g=a[l+32];h=a[l+40];i=a[l+48];j=a[l+56];var I=c+j,J=c-j,K=d+i,L=d-i,M=e+h,N=e-h,O=f+g,P=f-g,Q=I+O,R=I-O,S=K+M,T=K-M;a[l]=Q+S;a[l+32]=Q-S;U=.707106781*(T+R);a[l+16]=R+U;a[l+48]=R-U;Q=P+N;S=N+L;T=L+J;var V=.382683433*(Q-T),W=.5411961*Q+V,X=1.306562965*T+V,Y=.707106781*S,Z=J+Y,$=J-Y;a[l+40]=$+W;a[l+24]=$-W;a[l+8]=Z+X;a[l+56]=Z-X;l++}for(k=0;64>k;++k)_=a[k]*b[k],F[k]=_>0?_+.5|0:_-.5|0;return F}function k(){i(65504);i(16);h(74);h(70);h(73);h(70);h(0);h(1);h(1);h(0);i(1);i(1);h(0);h(0)}function l(a,b){i(65472);i(17);h(8);i(b);i(a);h(3);h(1);h(17);h(0);h(2);h(17);h(1);h(3);h(17);h(1)}function m(){var a,b;for(i(65499),i(132),h(0),a=0;64>a;a++)h(z[a]);for(h(1),b=0;64>b;b++)h(A[b])}function n(){var a,b,c,d,e,f,g,j;for(i(65476),i(418),h(0),a=0;16>a;a++)h(Q[a+1]);for(b=0;11>=b;b++)h(R[b]);for(h(16),c=0;16>c;c++)h(S[c+1]);for(d=0;161>=d;d++)h(T[d]);for(h(1),e=0;16>e;e++)h(U[e+1]);for(f=0;11>=f;f++)h(V[f]);for(h(17),g=0;16>g;g++)h(W[g+1]);for(j=0;161>=j;j++)h(X[j])}function o(){i(65498);i(12);h(3);h(1);h(0);h(2);h(17);h(3);h(17);h(0);h(63);h(0)}function p(a,b,c,d,e){for(var p,q,r,s,t,u,v,f,h=e[0],i=e[240],n=j(a,b),o=0;64>o;++o)G[P[o]]=n[o];for(p=G[0]-c,c=G[0],0==p?g(d[0]):(f=32767+p,g(d[E[f]]),g(D[f])),q=63;q>0&&0==G[q];q--);if(0==q)return g(h),c;for(s=1;q>=s;){for(t=s;0==G[s]&&q>=s;++s);if(u=s-t,u>=16){for(r=u>>4,v=1;r>=v;++v)g(i);u=15&u}f=32767+G[s];g(e[(u<<4)+E[f]]);g(D[f]);s++}return q!=63&&g(h),c}function q(){for(var a=String.fromCharCode,b=0;256>b;b++)N[b]=a(b)}function r(a){if(0>=a&&(a=1),a>100&&(a=100),x!=a){var c=0;c=Math.floor(50>a?5e3/a:200-2*a);b(c);x=a}}function s(){a||(a=50);q();d();e();f();r(a)}var t,u,v,w,x,y=(Math.round,Math.floor),z=new Array(64),A=new Array(64),B=new Array(64),C=new Array(64),D=new Array(65535),E=new Array(65535),F=new Array(64),G=new Array(64),H=[],I=0,J=7,K=new Array(64),L=new Array(64),M=new Array(64),N=new Array(256),O=new Array(2048),P=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],Q=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],R=[0,1,2,3,4,5,6,7,8,9,10,11],S=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],T=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],U=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],V=[0,1,2,3,4,5,6,7,8,9,10,11],W=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],X=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];this.encode=function(a,b){var P,Q;b&&r(b);H=[];I=0;J=7;i(65496);k();m();l(a.width,a.height);n();o();var c=0,d=0,e=0;I=0;J=7;this.encode.displayName="_encode_";for(var f,h,j,q,s,x,y,z,A,D=a.data,E=a.width,F=a.height,G=4*E,N=0;F>N;){for(f=0;G>f;){for(s=G*N+f,x=s,y=-1,z=0,A=0;64>A;A++)z=A>>3,y=4*(7&A),x=s+z*G+y,N+z>=F&&(x-=G*(N+1+z-F)),f+y>=G&&(x-=f+y-G+4),h=D[x++],j=D[x++],q=D[x++],K[A]=(O[h]+O[j+256>>0]+O[q+512>>0]>>16)-128,L[A]=(O[h+768>>0]+O[j+1024>>0]+O[q+1280>>0]>>16)-128,M[A]=(O[h+1280>>0]+O[j+1536>>0]+O[q+1792>>0]>>16)-128;c=p(K,B,c,t,v);d=p(L,C,d,u,w);e=p(M,C,e,u,w);f+=32}N+=8}return J>=0&&(P=[],P[1]=J+1,P[0]=(1<<J+1)-1,g(P)),i(65497),Q="data:image/jpeg;base64,"+btoa(H.join("")),H=[],Q};s()}return a.encode=function(b,c){var d=new a(c);return d.encode(b)},a}),b("runtime/html5/androidpatch",["runtime/html5/util","runtime/html5/jpegencoder","base"],function(a,b,c){var d,e=a.canvasToDataUrl;a.canvasToDataUrl=function(a,f,g){var h,i,j,k,l;return c.os.android?("image/jpeg"===f&&"undefined"==typeof d&&(k=e.apply(null,arguments),l=k.split(","),k=~l[0].indexOf("base64")?atob(l[1]):decodeURIComponent(l[1]),k=k.substring(0,2),d=255===k.charCodeAt(0)&&216===k.charCodeAt(1)),"image/jpeg"!==f||d?e.apply(null,arguments):(i=a.width,j=a.height,h=a.getContext("2d"),b.encode(h.getImageData(0,0,i,j),g))):e.apply(null,arguments)}}),b("runtime/html5/image",["base","runtime/html5/runtime","runtime/html5/util"],function(a,b,c){var d="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D";return b.register("Image",{modified:!1,init:function(){var a=this,b=new Image;b.onload=function(){a._info={type:a.type,width:this.width,height:this.height};a._metas||"image/jpeg"!==a.type?a.owner.trigger("load"):c.parseMeta(a._blob,function(b,c){a._metas=c;a.owner.trigger("load")})};b.onerror=function(){a.owner.trigger("error")};a._img=b},loadFromBlob:function(a){var b=this,d=b._img;b._blob=a;b.type=a.type;d.src=c.createObjectURL(a.getSource());b.owner.once("load",function(){c.revokeObjectURL(d.src)})},resize:function(a,b){var c=this._canvas||(this._canvas=document.createElement("canvas"));this._resize(this._img,c,a,b);this._blob=null;this.modified=!0;this.owner.trigger("complete","resize")},crop:function(a,b,c,d,e){var f=this._canvas||(this._canvas=document.createElement("canvas")),g=this.options,h=this._img,i=h.naturalWidth,j=h.naturalHeight,k=this.getOrientation();e=e||1;f.width=c;f.height=d;g.preserveHeaders||this._rotate2Orientaion(f,k);this._renderImageToCanvas(f,h,-a,-b,i*e,j*e);this._blob=null;this.modified=!0;this.owner.trigger("complete","crop")},getAsBlob:function(a){var b,d=this._blob,e=this.options;if(a=a||this.type,this.modified||this.type!==a){if(b=this._canvas,"image/jpeg"===a){if(d=c.canvasToDataUrl(b,a,e.quality),e.preserveHeaders&&this._metas&&this._metas.imageHead)return d=c.dataURL2ArrayBuffer(d),d=c.updateImageHead(d,this._metas.imageHead),d=c.arrayBufferToBlob(d,a)}else d=c.canvasToDataUrl(b,a);d=c.dataURL2Blob(d)}return d},getAsDataUrl:function(a){var b=this.options;return a=a||this.type,"image/jpeg"===a?c.canvasToDataUrl(this._canvas,a,b.quality):this._canvas.toDataURL(a)},getOrientation:function(){return this._metas&&this._metas.exif&&this._metas.exif.get("Orientation")||1},info:function(a){return a?(this._info=a,this):this._info},meta:function(a){return a?(this._meta=a,this):this._meta},destroy:function(){var a=this._canvas;this._img.onload=null;a&&(a.getContext("2d").clearRect(0,0,a.width,a.height),a.width=a.height=0,this._canvas=null);this._img.src=d;this._img=this._blob=null},_resize:function(a,b,c,d){var e,f,g,h,i,j=this.options,k=a.width,l=a.height,m=this.getOrientation();~[5,6,7,8].indexOf(m)&&(c^=d,d^=c,c^=d);e=Math[j.crop?"max":"min"](c/k,d/l);j.allowMagnify||(e=Math.min(1,e));f=k*e;g=l*e;j.crop?(b.width=c,b.height=d):(b.width=f,b.height=g);h=(b.width-f)/2;i=(b.height-g)/2;j.preserveHeaders||this._rotate2Orientaion(b,m);this._renderImageToCanvas(b,a,h,i,f,g)},_rotate2Orientaion:function(a,b){var c=a.width,d=a.height,e=a.getContext("2d");switch(b){case 5:case 6:case 7:case 8:a.width=d;a.height=c}switch(b){case 2:e.translate(c,0);e.scale(-1,1);break;case 3:e.translate(c,d);e.rotate(Math.PI);break;case 4:e.translate(0,d);e.scale(1,-1);break;case 5:e.rotate(.5*Math.PI);e.scale(1,-1);break;case 6:e.rotate(.5*Math.PI);e.translate(0,-d);break;case 7:e.rotate(.5*Math.PI);e.translate(c,-d);e.scale(-1,1);break;case 8:e.rotate(-.5*Math.PI);e.translate(-c,0)}},_renderImageToCanvas:function(){function b(a,b,c){var d,e,f,g=document.createElement("canvas"),h=g.getContext("2d"),i=0,j=c,k=c;for(g.width=1,g.height=c,h.drawImage(a,0,0),d=h.getImageData(0,0,1,c).data;k>i;)e=d[4*(k-1)+3],0===e?j=k:i=k,k=j+i>>1;return f=k/c,0===f?1:f}function c(a){var b,c,d=a.naturalWidth,e=a.naturalHeight;return d*e>1048576?(b=document.createElement("canvas"),b.width=b.height=1,c=b.getContext("2d"),c.drawImage(a,-d+1,0),0===c.getImageData(0,0,1,1).data[3]):!1}return a.os.ios?a.os.ios>=7?function(a,c,d,e,f,g){var h=c.naturalWidth,i=c.naturalHeight,j=b(c,h,i);return a.getContext("2d").drawImage(c,0,0,h*j,i*j,d,e,f,g)}:function(a,d,e,f,g,h){var i,j,k,l,m,n,o,p=d.naturalWidth,q=d.naturalHeight,r=a.getContext("2d"),s=c(d),t="image/jpeg"===this.type,u=1024,v=0,w=0;for(s&&(p/=2,q/=2),r.save(),i=document.createElement("canvas"),i.width=i.height=u,j=i.getContext("2d"),k=t?b(d,p,q):1,l=Math.ceil(u*g/p),m=Math.ceil(u*h/q/k);q>v;){for(n=0,o=0;p>n;)j.clearRect(0,0,u,u),j.drawImage(d,-n,-v),r.drawImage(i,0,0,u,u,e+o,f+w,l,m),n+=u,o+=l;v+=u;w+=m}r.restore();i=j=null}:function(b){var c=a.slice(arguments,1),d=b.getContext("2d");d.drawImage.apply(d,c)}}()})}),b("runtime/html5/transport",["base","runtime/html5/runtime"],function(a,b){var c=a.noop,d=a.$;return b.register("Transport",{init:function(){this._status=0;this._response=null},send:function(){var b,c,e,f=this.owner,g=this.options,h=this._initAjax(),i=f._blob,j=g.server;g.sendAsBinary?(j+=(/\?/.test(j)?"&":"?")+d.param(f._formData),c=i.getSource()):(b=new FormData,d.each(f._formData,function(a,c){b.append(a,c)}),b.append(g.fileVal,i.getSource(),g.filename||f._formData.name||""));g.withCredentials&&"withCredentials"in h?(h.open(g.method,j,!0),h.withCredentials=!0):h.open(g.method,j);this._setRequestHeader(h,g.headers);c?(h.overrideMimeType&&h.overrideMimeType("application/octet-stream"),a.os.android?(e=new FileReader,e.onload=function(){h.send(this.result);e=e.onload=null},e.readAsArrayBuffer(c)):h.send(c)):h.send(b)},getResponse:function(){return this._response},getResponseAsJson:function(){return this._parseJson(this._response)},getStatus:function(){return this._status},abort:function(){var a=this._xhr;a&&(a.upload.onprogress=c,a.onreadystatechange=c,a.abort(),this._xhr=a=null)},destroy:function(){this.abort()},_initAjax:function(){var a=this,b=new XMLHttpRequest,d=this.options;return!d.withCredentials||"withCredentials"in b||"undefined"==typeof XDomainRequest||(b=new XDomainRequest),b.upload.onprogress=function(b){var c=0;return b.lengthComputable&&(c=b.loaded/b.total),a.trigger("progress",c)},b.onreadystatechange=function(){if(4===b.readyState)return(b.upload.onprogress=c,b.onreadystatechange=c,a._xhr=null,a._status=b.status,b.status>=200&&b.status<300?(a._response=b.responseText,a.trigger("load")):b.status>=500&&b.status<600?(a._response=b.responseText,a.trigger("error","server")):a.trigger("error",a._status?"http":"abort"))},a._xhr=b,b},_setRequestHeader:function(a,b){d.each(b,function(b,c){a.setRequestHeader(b,c)})},_parseJson:function(a){var b;try{b=JSON.parse(a)}catch(c){b={}}return b}})}),b("runtime/html5/md5",["runtime/html5/runtime"],function(a){var b=function(a,b){return a+b&4294967295},c=function(a,c,d,e,f,g){return c=b(b(c,a),b(e,g)),b(c<<f|c>>>32-f,d)},d=function(a,b,d,e,f,g,h){return c(b&d|~b&e,a,b,f,g,h)},e=function(a,b,d,e,f,g,h){return c(b&e|d&~e,a,b,f,g,h)},f=function(a,b,d,e,f,g,h){return c(b^d^e,a,b,f,g,h)},g=function(a,b,d,e,f,g,h){return c(d^(b|~e),a,b,f,g,h)},h=function(a,c){var h=a[0],i=a[1],j=a[2],k=a[3];h=d(h,i,j,k,c[0],7,-680876936);k=d(k,h,i,j,c[1],12,-389564586);j=d(j,k,h,i,c[2],17,606105819);i=d(i,j,k,h,c[3],22,-1044525330);h=d(h,i,j,k,c[4],7,-176418897);k=d(k,h,i,j,c[5],12,1200080426);j=d(j,k,h,i,c[6],17,-1473231341);i=d(i,j,k,h,c[7],22,-45705983);h=d(h,i,j,k,c[8],7,1770035416);k=d(k,h,i,j,c[9],12,-1958414417);j=d(j,k,h,i,c[10],17,-42063);i=d(i,j,k,h,c[11],22,-1990404162);h=d(h,i,j,k,c[12],7,1804603682);k=d(k,h,i,j,c[13],12,-40341101);j=d(j,k,h,i,c[14],17,-1502002290);i=d(i,j,k,h,c[15],22,1236535329);h=e(h,i,j,k,c[1],5,-165796510);k=e(k,h,i,j,c[6],9,-1069501632);j=e(j,k,h,i,c[11],14,643717713);i=e(i,j,k,h,c[0],20,-373897302);h=e(h,i,j,k,c[5],5,-701558691);k=e(k,h,i,j,c[10],9,38016083);j=e(j,k,h,i,c[15],14,-660478335);i=e(i,j,k,h,c[4],20,-405537848);h=e(h,i,j,k,c[9],5,568446438);k=e(k,h,i,j,c[14],9,-1019803690);j=e(j,k,h,i,c[3],14,-187363961);i=e(i,j,k,h,c[8],20,1163531501);h=e(h,i,j,k,c[13],5,-1444681467);k=e(k,h,i,j,c[2],9,-51403784);j=e(j,k,h,i,c[7],14,1735328473);i=e(i,j,k,h,c[12],20,-1926607734);h=f(h,i,j,k,c[5],4,-378558);k=f(k,h,i,j,c[8],11,-2022574463);j=f(j,k,h,i,c[11],16,1839030562);i=f(i,j,k,h,c[14],23,-35309556);h=f(h,i,j,k,c[1],4,-1530992060);k=f(k,h,i,j,c[4],11,1272893353);j=f(j,k,h,i,c[7],16,-155497632);i=f(i,j,k,h,c[10],23,-1094730640);h=f(h,i,j,k,c[13],4,681279174);k=f(k,h,i,j,c[0],11,-358537222);j=f(j,k,h,i,c[3],16,-722521979);i=f(i,j,k,h,c[6],23,76029189);h=f(h,i,j,k,c[9],4,-640364487);k=f(k,h,i,j,c[12],11,-421815835);j=f(j,k,h,i,c[15],16,530742520);i=f(i,j,k,h,c[2],23,-995338651);h=g(h,i,j,k,c[0],6,-198630844);k=g(k,h,i,j,c[7],10,1126891415);j=g(j,k,h,i,c[14],15,-1416354905);i=g(i,j,k,h,c[5],21,-57434055);h=g(h,i,j,k,c[12],6,1700485571);k=g(k,h,i,j,c[3],10,-1894986606);j=g(j,k,h,i,c[10],15,-1051523);i=g(i,j,k,h,c[1],21,-2054922799);h=g(h,i,j,k,c[8],6,1873313359);k=g(k,h,i,j,c[15],10,-30611744);j=g(j,k,h,i,c[6],15,-1560198380);i=g(i,j,k,h,c[13],21,1309151649);h=g(h,i,j,k,c[4],6,-145523070);k=g(k,h,i,j,c[11],10,-1120210379);j=g(j,k,h,i,c[2],15,718787259);i=g(i,j,k,h,c[9],21,-343485551);a[0]=b(h,a[0]);a[1]=b(i,a[1]);a[2]=b(j,a[2]);a[3]=b(k,a[3])},i=function(a){for(var c=[],b=0;64>b;b+=4)c[b>>2]=a.charCodeAt(b)+(a.charCodeAt(b+1)<<8)+(a.charCodeAt(b+2)<<16)+(a.charCodeAt(b+3)<<24);return c},j=function(a){for(var c=[],b=0;64>b;b+=4)c[b>>2]=a[b]+(a[b+1]<<8)+(a[b+2]<<16)+(a[b+3]<<24);return c},k=function(a){for(var c,d,e,f,g,j=a.length,k=[1732584193,-271733879,-1732584194,271733878],b=64;j>=b;b+=64)h(k,i(a.substring(b-64,b)));for(a=a.substring(b-64),c=a.length,d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b=0;c>b;b+=1)d[b>>2]|=a.charCodeAt(b)<<(b%4<<3);if(d[b>>2]|=128<<(b%4<<3),b>55)for(h(k,d),b=0;16>b;b+=1)d[b]=0;return e=8*j,e=e.toString(16).match(/(.*?)(.{0,8})$/),f=parseInt(e[2],16),g=parseInt(e[1],16)||0,d[14]=f,d[15]=g,h(k,d),k},l=function(a){for(var c,d,e,f,g,i=a.length,k=[1732584193,-271733879,-1732584194,271733878],b=64;i>=b;b+=64)h(k,j(a.subarray(b-64,b)));for(a=i>b-64?a.subarray(b-64):new Uint8Array(0),c=a.length,d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b=0;c>b;b+=1)d[b>>2]|=a[b]<<(b%4<<3);if(d[b>>2]|=128<<(b%4<<3),b>55)for(h(k,d),b=0;16>b;b+=1)d[b]=0;return e=8*i,e=e.toString(16).match(/(.*?)(.{0,8})$/),f=parseInt(e[2],16),g=parseInt(e[1],16)||0,d[14]=f,d[15]=g,h(k,d),k},m=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],n=function(a){for(var c="",b=0;4>b;b+=1)c+=m[a>>8*b+4&15]+m[a>>8*b&15];return c},o=function(a){for(var b=0;b<a.length;b+=1)a[b]=n(a[b]);return a.join("")},p=function(a){return o(k(a))},q=function(){this.reset()};return"5d41402abc4b2a76b9719d911017c592"!==p("hello")&&(b=function(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}),q.prototype.append=function(a){return/[\u0080-\uFFFF]/.test(a)&&(a=unescape(encodeURIComponent(a))),this.appendBinary(a),this},q.prototype.appendBinary=function(a){this._buff+=a;this._length+=a.length;for(var c=this._buff.length,b=64;c>=b;b+=64)h(this._state,i(this._buff.substring(b-64,b)));return this._buff=this._buff.substr(b-64),this},q.prototype.end=function(a){for(var c,d=this._buff,e=d.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b=0;e>b;b+=1)f[b>>2]|=d.charCodeAt(b)<<(b%4<<3);return this._finish(f,e),c=a?this._state:o(this._state),this.reset(),c},q.prototype._finish=function(a,b){var c,d,e,f=b;if(a[f>>2]|=128<<(f%4<<3),f>55)for(h(this._state,a),f=0;16>f;f+=1)a[f]=0;c=8*this._length;c=c.toString(16).match(/(.*?)(.{0,8})$/);d=parseInt(c[2],16);e=parseInt(c[1],16)||0;a[14]=d;a[15]=e;h(this._state,a)},q.prototype.reset=function(){return this._buff="",this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},q.prototype.destroy=function(){delete this._state;delete this._buff;delete this._length},q.hash=function(a,b){/ [\u0080 - \uFFFF] /.test(a)&&(a=unescape(encodeURIComponent(a)));var c=k(a);return b?c:o(c)},q.hashBinary=function(a,b){var c=k(a);return b?c:o(c)},q.ArrayBuffer=function(){this.reset()},q.ArrayBuffer.prototype.append=function(a){var b,c=this._concatArrayBuffer(this._buff,a),d=c.length;for(this._length+=a.byteLength,b=64;d>=b;b+=64)h(this._state,j(c.subarray(b-64,b)));return this._buff=d>b-64?c.subarray(b-64):new Uint8Array(0),this},q.ArrayBuffer.prototype.end=function(a){for(var c,d=this._buff,e=d.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b=0;e>b;b+=1)f[b>>2]|=d[b]<<(b%4<<3);return this._finish(f,e),c=a?this._state:o(this._state),this.reset(),c},q.ArrayBuffer.prototype._finish=q.prototype._finish,q.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},q.ArrayBuffer.prototype.destroy=q.prototype.destroy,q.ArrayBuffer.prototype._concatArrayBuffer=function(a,b){var c=a.length,d=new Uint8Array(c+b.byteLength);return d.set(a),d.set(new Uint8Array(b),c),d},q.ArrayBuffer.hash=function(a,b){var c=l(new Uint8Array(a));return b?c:o(c)},a.register("Md5",{init:function(){},loadFromBlob:function(a){var b,c,d=a.getSource(),e=2097152,f=Math.ceil(d.size/e),g=0,h=this.owner,i=new q.ArrayBuffer,j=this,k=d.mozSlice||d.webkitSlice||d.slice;c=new FileReader;(b=function(){var l,m;l=g*e;m=Math.min(l+e,d.size);c.onload=function(b){i.append(b.target.result);h.trigger("progress",{total:a.size,loaded:m})};c.onloadend=function(){c.onloadend=c.onload=null;++g<f?setTimeout(b,1):setTimeout(function(){h.trigger("load");j.result=i.end();b=a=d=i=null;h.trigger("complete")},50)};c.readAsArrayBuffer(k.call(d,l,m))})()},getResult:function(){return this.result}})}),b("runtime/flash/runtime",["base","runtime/runtime","runtime/compbase"],function(b,c,d){function e(){var a;try{a=navigator.plugins["Shockwave Flash"];a=a.description}catch(b){try{a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(c){a="0.0"}}return a=a.match(/\d+/g),parseFloat(a[0]+"."+a[1],10)}function f(){function d(a,b){var c,d,e=a.type||a;c=e.split("::");d=c[0];e=c[1];"Ready"===e&&d===j.uid?j.trigger("ready"):f[d]&&f[d].trigger(e.toLowerCase(),a,b)}var e={},f={},g=this.destroy,j=this,k=b.guid("webuploader_");c.apply(j,arguments);j.type=h;j.exec=function(a,c){var d,g=this,h=g.uid,k=b.slice(arguments,2);return f[h]=g,i[a]&&(e[h]||(e[h]=new i[a](g,j)),d=e[h],d[c])?d[c].apply(d,k):j.flashExec.apply(g,arguments)};a[k]=function(){var a=arguments;setTimeout(function(){d.apply(null,a)},1)};this.jsreciver=k;this.destroy=function(){return g&&g.apply(this,arguments)};this.flashExec=function(a,c){var d=j.getFlash(),e=b.slice(arguments,2);return d.exec(this.uid,a,c,e)}}var g=b.$,h="flash",i={};return b.inherits(c,{constructor:f,init:function(){var a,c=this.getContainer(),d=this.options;c.css({position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"});a='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+d.swf+'" ';b.browser.ie&&(a+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" ');a+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+d.swf+'" /><param name="flashvars" value="uid='+this.uid+"&jsreciver="+this.jsreciver+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /><\/object>';c.html(a)},getFlash:function(){return this._flash?this._flash:(this._flash=g("#"+this.uid).get(0),this._flash)}}),f.register=function(a,c){return i[a]=b.inherits(d,g.extend({flashExec:function(){var a=this.owner,b=this.getRuntime();return b.flashExec.apply(a,arguments)}},c))},e()>=11.4&&c.addRuntime(h,f),f}),b("runtime/flash/filepicker",["base","runtime/flash/runtime"],function(a,b){var c=a.$;return b.register("FilePicker",{init:function(a){for(var e=c.extend({},a),b=e.accept&&e.accept.length,d=0;b>d;d++)e.accept[d].title||(e.accept[d].title="Files");delete e.button;delete e.id;delete e.container;this.flashExec("FilePicker","init",e)},destroy:function(){this.flashExec("FilePicker","destroy")}})}),b("runtime/flash/image",["runtime/flash/runtime"],function(a){return a.register("Image",{loadFromBlob:function(a){var b=this.owner;b.info()&&this.flashExec("Image","info",b.info());b.meta()&&this.flashExec("Image","meta",b.meta());this.flashExec("Image","loadFromBlob",a.uid)}})}),b("runtime/flash/transport",["base","runtime/flash/runtime","runtime/client"],function(b,c,d){var e=b.$;return c.register("Transport",{init:function(){this._status=0;this._response=null;this._responseJson=null},send:function(){var a,b=this.owner,c=this.options,d=this._initAjax(),f=b._blob,g=c.server;d.connectRuntime(f.ruid);c.sendAsBinary?(g+=(/\?/.test(g)?"&":"?")+e.param(b._formData),a=f.uid):(e.each(b._formData,function(a,b){d.exec("append",a,b)}),d.exec("appendBlob",c.fileVal,f.uid,c.filename||b._formData.name||""));this._setRequestHeader(d,c.headers);d.exec("send",{method:c.method,url:g,forceURLStream:c.forceURLStream,mimeType:"application/octet-stream"},a)},getStatus:function(){return this._status},getResponse:function(){return this._response||""},getResponseAsJson:function(){return this._responseJson},abort:function(){var a=this._xhr;a&&(a.exec("abort"),a.destroy(),this._xhr=a=null)},destroy:function(){this.abort()},_initAjax:function(){var b=this,c=new d("XMLHttpRequest");return c.on("uploadprogress progress",function(a){var c=a.loaded/a.total;return c=Math.min(1,Math.max(0,c)),b.trigger("progress",c)}),c.on("load",function(){var d,e=c.exec("getStatus"),f=!1,g="";return c.off(),b._xhr=null,e>=200&&300>e?f=!0:e>=500&&600>e?(f=!0,g="server"):g="http",f&&(b._response=c.exec("getResponse"),b._response=decodeURIComponent(b._response),d=a.JSON&&a.JSON.parse||function(a){try{return new Function("return "+a).call()}catch(b){return{}}},b._responseJson=b._response?d(b._response):{}),c.destroy(),c=null,g?b.trigger("error",g):b.trigger("load")}),c.on("error",function(){c.off();b._xhr=null;b.trigger("error","http")}),b._xhr=c,c},_setRequestHeader:function(a,b){e.each(b,function(b,c){a.exec("setRequestHeader",b,c)})}})}),b("runtime/flash/blob",["runtime/flash/runtime","lib/blob"],function(a,b){return a.register("Blob",{slice:function(a,c){var d=this.flashExec("Blob","slice",a,c);return new b(d.uid,d)}})}),b("runtime/flash/md5",["runtime/flash/runtime"],function(a){return a.register("Md5",{init:function(){},loadFromBlob:function(a){return this.flashExec("Md5","loadFromBlob",a.uid)}})}),b("preset/all",["base","widgets/filednd","widgets/filepaste","widgets/filepicker","widgets/image","widgets/queue","widgets/runtime","widgets/upload","widgets/validator","widgets/md5","runtime/html5/blob","runtime/html5/dnd","runtime/html5/filepaste","runtime/html5/filepicker","runtime/html5/imagemeta/exif","runtime/html5/androidpatch","runtime/html5/image","runtime/html5/transport","runtime/html5/md5","runtime/flash/filepicker","runtime/flash/image","runtime/flash/transport","runtime/flash/blob","runtime/flash/md5"],function(a){return a}),b("widgets/log",["base","uploader","widgets/widget"],function(a,b){function c(a){var b=e.extend({},d,a),c=f.replace(/^(.*)\?/,"$1"+e.param(b)),g=new Image;g.src=c}var d,e=a.$,f=" http://static.tieba.baidu.com/tb/pms/img/st.gif??",g=(location.hostname||location.host||"protected").toLowerCase(),h=g&&/baidu/i.exec(g);if(h)return d={dv:3,master:"webuploader",online:/test/.exec(g)?0:1,module:"",product:g,type:0},b.register({name:"log",init:function(){var a=this.owner,b=0,d=0;a.on("error",function(a){c({type:2,c_error_code:a})}).on("uploadError",function(a,b){c({type:2,c_error_code:"UPLOAD_ERROR",c_reason:""+b})}).on("uploadComplete",function(a){b++;d+=a.size}).on("uploadFinished",function(){c({c_count:b,c_size:d});b=d=0});c({c_usage:1})}})}),b("webuploader",["preset/all","widgets/log"],function(a){return a}),c("webuploader")});!function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p;a.noop=a.noop||function(){};h=0;i=a(b);j=a(document);k=a("html");l=document.documentElement;m=b.VBArray&&!b.XMLHttpRequest;n="createTouch"in document&&!("onmousemove"in l)||/(iPhone|iPad|iPod)/i.test(navigator.userAgent);o="artDialog"+ +new Date;p=function(b,e,f){var g,i,j,k;b=b||{};("string"==typeof b||1===b.nodeType)&&(b={content:b,fixed:!n});i=p.defaults;j=b.follow=1===this.nodeType&&this||b.follow;for(k in i)b[k]===c&&(b[k]=i[k]);return a.each({ok:"yesFn",cancel:"noFn",close:"closeFn",init:"initFn",okVal:"yesText",cancelVal:"noText"},function(a,d){b[a]=b[a]!==c?b[a]:b[d]}),"string"==typeof j&&(j=a(j)[0]),b.id=j&&j[o+"follow"]||b.id||o+h,g=p.list[b.id],j&&g?g.follow(j).zIndex().focus():g?g.zIndex().focus():(n&&(b.fixed=!1),a.isArray(b.button)||(b.button=b.button?[b.button]:[]),e!==c&&(b.ok=e),f!==c&&(b.cancel=f),b.ok&&b.button.push({name:b.okVal,callback:b.ok,focus:!0}),b.cancel&&b.button.push({name:b.cancelVal,callback:b.cancel}),p.defaults.zIndex=b.zIndex,h++,p.list[b.id]=d?d._init(b):new p.fn._init(b))};p.fn=p.prototype={version:"4.1.7",closed:!0,_init:function(a){var c,e=this,f=a.icon,g=f&&(m?{png:"icons/"+f+".png"}:{backgroundImage:"url('"+a.path+"/skins/icons/"+f+".png')"});return e.closed=!1,e.config=a,e.DOM=c=e.DOM||e._getDOM(),c.wrap.addClass(a.skin),c.close[a.cancel===!1?"hide":"show"](),c.icon[0].style.display=f?"":"none",c.iconBg.css(g||{background:"none"}),c.se.css("cursor",a.resize?"se-resize":"auto"),c.title.css("cursor",a.drag?"move":"auto"),c.content.css("padding",a.padding),e[a.show?"show":"hide"](!0),e.button(a.button).title(a.title).content(a.content,!0).size(a.width,a.height).time(a.time),a.follow?e.follow(a.follow):e.position(a.left,a.top),e.zIndex().focus(),a.lock&&e.lock(),e._addEvent(),e._ie6PngFix(),d=null,a.init&&a.init.call(e,b),e},content:function(a){var b,d,e,f,g=this,h=g.DOM,i=h.wrap[0],j=i.offsetWidth,k=i.offsetHeight,l=parseInt(i.style.left),m=parseInt(i.style.top),n=i.style.width,o=h.content,p=o[0];return g._elemBack&&g._elemBack(),i.style.width="auto",a===c?p:("string"==typeof a?o.html(a):a&&1===a.nodeType&&(f=a.style.display,b=a.previousSibling,d=a.nextSibling,e=a.parentNode,g._elemBack=function(){b&&b.parentNode?b.parentNode.insertBefore(a,b.nextSibling):d&&d.parentNode?d.parentNode.insertBefore(a,d):e&&e.appendChild(a);a.style.display=f;g._elemBack=null},o.html(""),p.appendChild(a),a.style.display="block"),arguments[1]||(g.config.follow?g.follow(g.config.follow):(j=i.offsetWidth-j,k=i.offsetHeight-k,l-=j/2,m-=k/2,i.style.left=Math.max(l,0)+"px",i.style.top=Math.max(m,0)+"px"),n&&"auto"!==n&&(i.style.width=i.offsetWidth+"px"),g._autoPositionType()),g._ie6SelectFix(),g._runScript(p),g)},title:function(a){var b=this.DOM,d=b.wrap,e=b.title,f="aui_state_noTitle";return a===c?e[0]:(a===!1?(e.hide().html(""),d.addClass(f)):(e.show().html(a||""),d.removeClass(f)),this)},position:function(a,b){var d=this,e=d.config,f=d.DOM.wrap[0],g=m?!1:e.fixed,h=m&&d.config.fixed,k=j.scrollLeft(),l=j.scrollTop(),n=g?0:k,o=g?0:l,p=i.width(),q=i.height(),r=f.offsetWidth,s=f.offsetHeight,t=f.style;return(a||0===a)&&(d._left=-1!==a.toString().indexOf("%")?a:null,a=d._toNumber(a,p-r),"number"==typeof a?(a=h?a+=k:a+n,t.left=Math.max(a,n)+"px"):"string"==typeof a&&(t.left=a)),(b||0===b)&&(d._top=-1!==b.toString().indexOf("%")?b:null,b=d._toNumber(b,q-s),"number"==typeof b?(b=h?b+=l:b+o,t.top=Math.max(b,o)+"px"):"string"==typeof b&&(t.top=b)),a!==c&&b!==c&&(d._follow=null,d._autoPositionType()),d},size:function(a,b){var c,d,e,f,g=this,h=(g.config,g.DOM),j=h.wrap,k=h.main,l=j[0].style,m=k[0].style;return a&&(g._width=-1!==a.toString().indexOf("%")?a:null,c=i.width()-j[0].offsetWidth+k[0].offsetWidth,e=g._toNumber(a,c),a=e,"number"==typeof a?(l.width="auto",m.width=Math.max(g.config.minWidth,a)+"px",l.width=j[0].offsetWidth+"px"):"string"==typeof a&&(m.width=a,"auto"===a&&j.css("width","auto"))),b&&(g._height=-1!==b.toString().indexOf("%")?b:null,d=i.height()-j[0].offsetHeight+k[0].offsetHeight,f=g._toNumber(b,d),b=f,"number"==typeof b?m.height=Math.max(g.config.minHeight,b)+"px":"string"==typeof b&&(m.height=b)),g._ie6SelectFix(),g},follow:function(b){var c,d,e,f,g,h,k,l,n,p,q,r,s,t,u,v,w,x,y,z,A=this,B=A.config;return("string"==typeof b||b&&1===b.nodeType)&&(c=a(b),b=c[0]),b&&(b.offsetWidth||b.offsetHeight)?(d=o+"follow",e=i.width(),f=i.height(),g=j.scrollLeft(),h=j.scrollTop(),k=c.offset(),l=b.offsetWidth,n=b.offsetHeight,p=m?!1:B.fixed,q=p?k.left-g:k.left,r=p?k.top-h:k.top,s=A.DOM.wrap[0],t=s.style,u=s.offsetWidth,v=s.offsetHeight,w=q-(u-l)/2,x=r+n,y=p?0:g,z=p?0:h,w=y>w?q:w+u>e&&q-u>y?q-u+l:w,x=x+v>f+z&&r-v>z?r-v:x,t.left=w+"px",t.top=x+"px",A._follow&&A._follow.removeAttribute(d),A._follow=b,b[d]=B.id,A._autoPositionType(),A):A.position(A._left,A._top)},button:function(){var b=this,d=arguments,e=b.DOM,f=e.buttons,g=f[0],h="aui_state_highlight",i=b._listeners=b._listeners||{},j=a.isArray(d[0])?d[0]:[].slice.call(d);return d[0]===c?g:(a.each(j,function(c,d){var e=d.name,f=!i[e],j=f?document.createElement("button"):i[e].elem;i[e]||(i[e]={});d.callback&&(i[e].callback=d.callback);d.className&&(j.className=d.className);d.focus&&(b._focus&&b._focus.removeClass(h),b._focus=a(j).addClass(h),b.focus());j.setAttribute("type","button");j[o+"callback"]=e;j.disabled=!!d.disabled;f&&(j.innerHTML=e,i[e].elem=j,g.appendChild(j))}),f[0].style.display=j.length?"":"none",b._ie6SelectFix(),b)},show:function(){return this.DOM.wrap.show(),!arguments[0]&&this._lockMaskWrap&&this._lockMaskWrap.show(),this},hide:function(){return this.DOM.wrap.hide(),!arguments[0]&&this._lockMaskWrap&&this._lockMaskWrap.hide(),this},close:function(){var a,c,e,f,g,h,i;if(this.closed)return this;if(a=this,c=a.DOM,e=c.wrap,f=p.list,g=a.config.close,h=a.config.follow,a.time(),"function"==typeof g&&g.call(a,b)===!1)return a;a.unlock();a._elemBack&&a._elemBack();e[0].className=e[0].style.cssText="";c.title.html("");c.content.html("");c.buttons.html("");p.focus===a&&(p.focus=null);h&&h.removeAttribute(o+"follow");delete f[a.config.id];a._removeEvent();a.hide(!0)._setAbsolute();for(i in a)a.hasOwnProperty(i)&&"DOM"!==i&&delete a[i];return d?e.remove():d=a,a},time:function(a){var b=this,c=b.config.cancelVal,d=b._timer;return d&&clearTimeout(d),a&&(b._timer=setTimeout(function(){b._click(c)},1e3*a)),b},focus:function(){try{if(this.config.focus){var a=this._focus&&this._focus[0]||this.DOM.close[0];a&&a.focus()}}catch(b){}return this},zIndex:function(){var a=this,b=a.DOM,c=b.wrap,d=p.focus,e=p.defaults.zIndex++;return c.css("zIndex",e),a._lockMask&&a._lockMask.css("zIndex",e-1),d&&d.DOM.wrap.removeClass("aui_state_focus"),p.focus=a,c.addClass("aui_state_focus"),a},lock:function(){if(this._lock)return this;var b=this,c=p.defaults.zIndex-1,d=b.DOM.wrap,e=b.config,f=j.width(),g=j.height(),h=b._lockMaskWrap||a(document.body.appendChild(document.createElement("div"))),i=b._lockMask||a(h[0].appendChild(document.createElement("div"))),k="(document).documentElement",l=n?"width:"+f+"px;height:"+g+"px":"width:100%;height:100%",o=m?"position:absolute;left:expression("+k+".scrollLeft);top:expression("+k+".scrollTop);width:expression("+k+".clientWidth);height:expression("+k+".clientHeight)":"";return b.zIndex(),d.addClass("aui_state_lock"),h[0].style.cssText=l+";position:fixed;z-index:"+c+";top:0;left:0;overflow:hidden;"+o,i[0].style.cssText="height:100%;background:"+e.background+";filter:alpha(opacity=0);opacity:0",m&&i.html('<iframe src="about:blank" style="width:100%;height:100%;position:absolute;top:0;left:0;z-index:-1;filter:alpha(opacity=0)"><\/iframe>'),i.stop(),i.bind("click",function(){b._reset()}).bind("dblclick",function(){b._click(b.config.cancelVal)}),0===e.duration?i.css({opacity:e.opacity}):i.animate({opacity:e.opacity},e.duration),b._lockMaskWrap=h,b._lockMask=i,b._lock=!0,b},unlock:function(){var a,b,c=this,e=c._lockMaskWrap,f=c._lockMask;return c._lock?(a=e[0].style,b=function(){m&&(a.removeExpression("width"),a.removeExpression("height"),a.removeExpression("left"),a.removeExpression("top"));a.cssText="display:none";d&&e.remove()},f.stop().unbind(),c.DOM.wrap.removeClass("aui_state_lock"),c.config.duration?f.animate({opacity:0},c.config.duration,b):b(),c._lock=!1,c):c},_getDOM:function(){var b,c,d,e,f,g=document.createElement("div"),h=document.body;for(g.style.cssText="position:absolute;left:0;top:0",g.innerHTML=p._templates,h.insertBefore(g,h.firstChild),c=0,d={wrap:a(g)},e=g.getElementsByTagName("*"),f=e.length;f>c;c++)b=e[c].className.split("aui_")[1],b&&(d[b]=a(e[c]));return d},_toNumber:function(a,b){if(!a&&0!==a||"number"==typeof a)return a;var c=a.length-1;return a.lastIndexOf("px")===c?a=parseInt(a):a.lastIndexOf("%")===c&&(a=parseInt(b*a.split("%")[0]/100)),a},_ie6PngFix:m?function(){for(var a,b,c,d,e=0,f=p.defaults.path+"/skins/",g=this.DOM.wrap[0].getElementsByTagName("*");e<g.length;e++)a=g[e],b=a.currentStyle.png,b&&(c=f+b,d=a.runtimeStyle,d.backgroundImage="none",d.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+c+"',sizingMethod='crop')")}:a.noop,_ie6SelectFix:m?function(){var a=this.DOM.wrap,b=a[0],c=o+"iframeMask",d=a[c],e=b.offsetWidth,f=b.offsetHeight;e+="px";f+="px";d?(d.style.width=e,d.style.height=f):(d=b.appendChild(document.createElement("iframe")),a[c]=d,d.src="about:blank",d.style.cssText="position:absolute;z-index:-1;left:0;top:0;filter:alpha(opacity=0);width:"+e+";height:"+f)}:a.noop,_runScript:function(a){for(var b,c=0,d=0,e=a.getElementsByTagName("script"),f=e.length,g=[];f>c;c++)"text/dialog"===e[c].type&&(g[d]=e[c].innerHTML,d++);g.length&&(g=g.join(""),b=new Function(g),b.call(this))},_autoPositionType:function(){this[this.config.fixed?"_setFixed":"_setAbsolute"]()},_setFixed:function(){return m&&a(function(){var b="backgroundAttachment";"fixed"!==k.css(b)&&"fixed"!==a("body").css(b)&&k.css({zoom:1,backgroundImage:"url(about:blank)",backgroundAttachment:"fixed"})}),function(){var a,b,c,d,e,f=this.DOM.wrap,g=f[0].style;m?(a=parseInt(f.css("left")),b=parseInt(f.css("top")),c=j.scrollLeft(),d=j.scrollTop(),e="(document.documentElement)",this._setAbsolute(),g.setExpression("left","eval("+e+".scrollLeft+"+(a-c)+') + "px"'),g.setExpression("top","eval("+e+".scrollTop+"+(b-d)+') + "px"')):g.position="fixed"}}(),_setAbsolute:function(){var a=this.DOM.wrap[0].style;m&&(a.removeExpression("left"),a.removeExpression("top"));a.position="absolute"},_click:function(a){var c=this,d=c._listeners[a]&&c._listeners[a].callback;return"function"!=typeof d||d.call(c,b)!==!1?c.close():c},_reset:function(a){var b,c=this,d=c._winSize||i.width()*i.height(),e=c._follow,f=c._width,g=c._height,h=c._left,j=c._top;a&&(b=c._winSize=i.width()*i.height(),d===b)||((f||g)&&c.size(f,g),e?c.follow(e):(h||j)&&c.position(h,j))},_addEvent:function(){var a,c=this,d=c.config,e="CollectGarbage"in b,f=c.DOM;c._winResize=function(){a&&clearTimeout(a);a=setTimeout(function(){c._reset(e)},40)};i.bind("resize",c._winResize);f.wrap.bind("click",function(a){var b,e=a.target;return e.disabled?!1:e===f.close[0]?(c._click(d.cancelVal),!1):(b=e[o+"callback"],b&&c._click(b),c._ie6SelectFix(),void 0)}).bind("mousedown",function(){c.zIndex()})},_removeEvent:function(){var a=this,b=a.DOM;b.wrap.unbind();i.unbind("resize",a._winResize)}};p.fn._init.prototype=p.fn;a.fn.dialog=a.fn.artDialog=function(){var a=arguments;return this[this.live?"live":"bind"]("click",function(){return p.apply(this,a),!1}),this};p.focus=null;p.get=function(a){return a===c?p.list:p.list[a]};p.list={};j.bind("keydown",function(a){var b=a.target,c=b.nodeName,e=p.focus,f=a.keyCode;e&&e.config.esc&&!/^INPUT|TEXTAREA$/.test(c)&&27===f&&e._click(e.config.cancelVal)});g=b._artDialog_path||function(a,c,d){for(c in a)a[c].src&&-1!==a[c].src.indexOf("artDialog")&&(d=a[c]);return e=d||a[a.length-1],d=e.src.replace(/\\/g,"/"),b._artDialog_path=d.lastIndexOf("/")<0?".":d.substring(0,d.lastIndexOf("/"))}(document.getElementsByTagName("script"));i.bind("load",function(){setTimeout(function(){if(!h){if(f=p.defaults.skin){var a=document.createElement("link");a.rel="stylesheet";a.href="/js/artDialog4.1.7/skins/"+f+".css?"+p.fn.version;e.parentNode.insertBefore(a,e)}p({left:"-9999em",time:9,fixed:!1,lock:!1,focus:!1})}},150)});try{document.execCommand("BackgroundImageCache",!1,!0)}catch(q){}p._templates='<div class="aui_outer"><table class="aui_border"><tbody><tr><td class="aui_nw"><\/td><td class="aui_n"><\/td><td class="aui_ne"><\/td><\/tr><tr><td class="aui_w"><\/td><td class="aui_c"><div class="aui_inner"><table class="aui_dialog"><tbody><tr><td colspan="2" class="aui_header"><div class="aui_titleBar"><div class="aui_title"><\/div><a class="aui_close" href="javascript:;">×<\/a><\/div><\/td><\/tr><tr><td class="aui_icon"><div class="aui_iconBg"><\/div><\/td><td class="aui_main"><div class="aui_content"><\/div><\/td><\/tr><tr><td colspan="2" class="aui_footer"><div class="aui_buttons"><\/div><\/td><\/tr><\/tbody><\/table><\/div><\/td><td class="aui_e"><\/td><\/tr><tr><td class="aui_sw"><\/td><td class="aui_s"><\/td><td class="aui_se"><\/td><\/tr><\/tbody><\/table><\/div>';p.defaults={content:'<div class="aui_loading"><span>loading..<\/span><\/div>',title:"消息",button:null,ok:null,cancel:null,init:null,close:null,okVal:"确定",cancelVal:"取消",width:"auto",height:"auto",minWidth:96,minHeight:32,padding:"20px 25px",skin:"",icon:null,time:null,esc:!0,focus:!0,show:!0,follow:null,path:g,lock:!1,background:"#000",opacity:.7,duration:300,fixed:!1,left:"50%",top:"38.2%",zIndex:1987,resize:!0,drag:!0};b.artDialog=a.dialog=a.artDialog=p}(this.art||this.jQuery&&(this.art=jQuery),this),function(a){var b,c,d=a(window),e=a(document),f=document.documentElement,g=!("minWidth"in f.style),h="onlosecapture"in f,i="setCapture"in f;artDialog.dragEvent=function(){var a=this,b=function(b){var c=a[b];a[b]=function(){return c.apply(a,arguments)}};b("start");b("move");b("end")};artDialog.dragEvent.prototype={onstart:a.noop,start:function(a){return e.bind("mousemove",this.move).bind("mouseup",this.end),this._sClientX=a.clientX,this._sClientY=a.clientY,this.onstart(a.clientX,a.clientY),!1},onmove:a.noop,move:function(a){return this._mClientX=a.clientX,this._mClientY=a.clientY,this.onmove(a.clientX-this._sClientX,a.clientY-this._sClientY),!1},onend:a.noop,end:function(a){return e.unbind("mousemove",this.move).unbind("mouseup",this.end),this.onend(a.clientX,a.clientY),!1}};c=function(a){var c,f,j,k,l,m,n=artDialog.focus,o=n.DOM,p=o.wrap,q=o.title,r=o.main,s="getSelection"in window?function(){window.getSelection().removeAllRanges()}:function(){try{document.selection.empty()}catch(a){}};b.onstart=function(){m?(f=r[0].offsetWidth,j=r[0].offsetHeight):(k=p[0].offsetLeft,l=p[0].offsetTop);e.bind("dblclick",b.end);!g&&h?q.bind("losecapture",b.end):d.bind("blur",b.end);i&&q[0].setCapture();p.addClass("aui_state_drag");n.focus()};b.onmove=function(a,b){var d,e,g,h,i,o;m?(d=p[0].style,e=r[0].style,g=a+f,h=b+j,d.width="auto",e.width=Math.max(0,g)+"px",d.width=p[0].offsetWidth+"px",e.height=Math.max(0,h)+"px"):(e=p[0].style,i=Math.max(c.minX,Math.min(c.maxX,a+k)),o=Math.max(c.minY,Math.min(c.maxY,b+l)),e.left=i+"px",e.top=o+"px");s();n._ie6SelectFix()};b.onend=function(){e.unbind("dblclick",b.end);!g&&h?q.unbind("losecapture",b.end):d.unbind("blur",b.end);i&&q[0].releaseCapture();g&&!n.closed&&n._autoPositionType();p.removeClass("aui_state_drag")};m=a.target===o.se[0]?!0:!1;c=function(){var b,c=n.DOM.wrap[0],f="fixed"===c.style.position,g=c.offsetWidth,h=c.offsetHeight,i=d.width(),j=d.height(),k=f?0:e.scrollLeft(),l=f?0:e.scrollTop(),a=i-g+k;return b=j-h+l,{minX:k,minY:l,maxX:a,maxY:b}}();b.start(a)};e.bind("mousedown",function(a){var d,e,f,g=artDialog.focus;if(g)return(d=a.target,e=g.config,f=g.DOM,e.drag!==!1&&d===f.title[0]||e.resize!==!1&&d===f.se[0]?(b=b||new artDialog.dragEvent,c(a),!1):void 0)})}(this.art||this.jQuery&&(this.art=jQuery));
/*!
 * artDialog iframeTools
 * Date: 2011-12-08 1:32
 * http://code.google.com/p/artdialog/
 * (c) 2009-2011 TangBin, http://www.planeArt.cn
 *
 * This is licensed under the GNU LGPL, version 2.1 or later.
 * For details, see: http://creativecommons.org/licenses/LGPL/2.1/
 */
eval(function(B,D,A,G,E,F){function C(A){return A<62?String.fromCharCode(A+=A<26?65:A<52?71:-4):A<63?"_":A<64?"$":C(A>>6)+C(A&63)}while(A>0)E[C(G--)]=D[--A];return B.replace(/[\w\$]+/g,function(A){return E[A]==F[A]?A:E[A]})}('(6(E,C,D,A){c B,X,W,J="@_.DATA",K="@_.OPEN",H="@_.OPENER",I=C.k=C.k||"@_.WINNAME"+(Bd Bo).Be(),F=C.VBArray&&!C.XMLHttpRequest;E(6(){!C.Bu&&7.BY==="B0"&&Br("9 Error: 7.BY === \\"B0\\"")});c G=D.d=6(){c W=C,X=6(A){f{c W=C[A].7;W.BE}u(X){v!V}v C[A].9&&W.BE("frameset").length===U};v X("d")?W=C.d:X("BB")&&(W=C.BB),W}();D.BB=G,B=G.9,W=6(){v B.BW.w},D.m=6(C,B){c W=D.d,X=W[J]||{};W[J]=X;b(B!==A)X[C]=B;else v X[C];v X},D.BQ=6(W){c X=D.d[J];X&&X[W]&&1 X[W]},D.through=X=6(){c X=B.BR(i,BJ);v G!==C&&(D.B4[X.0.Z]=X),X},G!==C&&E(C).BN("unload",6(){c A=D.B4,W;BO(c X BS A)A[X]&&(W=A[X].0,W&&(W.duration=U),A[X].s(),1 A[X])}),D.p=6(B,O,BZ){O=O||{};c N,L,M,Bc,T,S,R,Q,BF,P=D.d,Ba="8:BD;n:-Bb;d:-Bb;Bp:o U;Bf:transparent",BI="r:g%;x:g%;Bp:o U";b(BZ===!V){c BH=(Bd Bo).Be(),BG=B.replace(/([?&])W=[^&]*/,"$1_="+BH);B=BG+(BG===B?(/\\?/.test(B)?"&":"?")+"W="+BH:"")}c G=6(){c B,C,W=L.2.B2(".aui_loading"),A=N.0;M.addClass("Bi"),W&&W.hide();f{Q=T.$,R=E(Q.7),BF=Q.7.Bg}u(X){T.q.5=BI,A.z?N.z(A.z):N.8(A.n,A.d),O.j&&O.j.l(N,Q,P),O.j=By;v}B=A.r==="Bt"?R.r()+(F?U:parseInt(E(BF).Bv("marginLeft"))):A.r,C=A.x==="Bt"?R.x():A.x,setTimeout(6(){T.q.5=BI},U),N.Bk(B,C),A.z?N.z(A.z):N.8(A.n,A.d),O.j&&O.j.l(N,Q,P),O.j=By},I={w:W(),j:6(){N=i,L=N.h,Bc=L.BM,M=L.2,T=N.BK=P.7.Bn("BK"),T.Bx=B,T.k="Open"+N.0.Z,T.q.5=Ba,T.BX("frameborder",U,U),T.BX("allowTransparency",!U),S=E(T),N.2().B3(T),Q=T.$;f{Q.k=T.k,D.m(T.k+K,N),D.m(T.k+H,C)}u(X){}S.BN("BC",G)},s:6(){S.Bv("4","o").unbind("BC",G);b(O.s&&O.s.l(i,T.$,P)===!V)v!V;M.removeClass("Bi"),S[U].Bx="about:blank",S.remove();f{D.BQ(T.k+K),D.BQ(T.k+H)}u(X){}}};Bq O.Y=="6"&&(I.Y=6(){v O.Y.l(N,T.$,P)}),Bq O.y=="6"&&(I.y=6(){v O.y.l(N,T.$,P)}),1 O.2;BO(c J BS O)I[J]===A&&(I[J]=O[J]);v X(I)},D.p.Bw=D.m(I+K),D.BT=D.m(I+H)||C,D.p.origin=D.BT,D.s=6(){c X=D.m(I+K);v X&&X.s(),!V},G!=C&&E(7).BN("mousedown",6(){c X=D.p.Bw;X&&X.w()}),D.BC=6(C,D,B){B=B||!V;c G=D||{},H={w:W(),j:6(A){c W=i,X=W.0;E.ajax({url:C,success:6(X){W.2(X),G.j&&G.j.l(W,A)},cache:B})}};1 D.2;BO(c F BS G)H[F]===A&&(H[F]=G[F]);v X(H)},D.Br=6(B,A){v X({Z:"Alert",w:W(),BL:"warning",t:!U,BA:!U,2:B,Y:!U,s:A})},D.confirm=6(C,A,B){v X({Z:"Confirm",w:W(),BL:"Bm",t:!U,BA:!U,3:U.V,2:C,Y:6(X){v A.l(i,X)},y:6(X){v B&&B.l(i,X)}})},D.prompt=6(D,B,C){C=C||"";c A;v X({Z:"Prompt",w:W(),BL:"Bm",t:!U,BA:!U,3:U.V,2:["<e q=\\"margin-bottom:5px;font-Bk:12px\\">",D,"<\/e>","<e>","<Bl B1=\\"",C,"\\" q=\\"r:18em;Bh:6px 4px\\" />","<\/e>"].join(""),j:6(){A=i.h.2.B2("Bl")[U],A.select(),A.BP()},Y:6(X){v B&&B.l(i,A.B1,X)},y:!U})},D.tips=6(B,A){v X({Z:"Tips",w:W(),title:!V,y:!V,t:!U,BA:!V}).2("<e q=\\"Bh: U 1em;\\">"+B+"<\/e>").time(A||V.B6)},E(6(){c A=D.dragEvent;b(!A)v;c B=E(C),X=E(7),W=F?"BD":"t",H=A.prototype,I=7.Bn("e"),G=I.q;G.5="4:o;8:"+W+";n:U;d:U;r:g%;x:g%;"+"cursor:move;filter:alpha(3=U);3:U;Bf:#FFF",7.Bg.B3(I),H.Bj=H.Bs,H.BV=H.Bz,H.Bs=6(){c E=D.BP.h,C=E.BM[U],A=E.2[U].BE("BK")[U];H.Bj.BR(i,BJ),G.4="block",G.w=D.BW.w+B5,W==="BD"&&(G.r=B.r()+"a",G.x=B.x()+"a",G.n=X.scrollLeft()+"a",G.d=X.scrollTop()+"a"),A&&C.offsetWidth*C.offsetHeight>307200&&(C.q.BU="hidden")},H.Bz=6(){c X=D.BP;H.BV.BR(i,BJ),G.4="o",X&&(X.h.BM[U].q.BU="visible")}})})(i.art||i.Bu,i,i.9)',"P|R|T|U|V|W|0|1|_|$|ok|id|px|if|var|top|div|try|100|DOM|this|init|name|call|data|left|none|open|style|width|close|fixed|catch|return|zIndex|height|cancel|follow|config|delete|content|opacity|display|cssText|function|document|position|artDialog|ARTDIALOG|contentWindow|lock|parent|load|absolute|getElementsByTagName|S|Y|Z|a|arguments|iframe|icon|main|bind|for|focus|removeData|apply|in|opener|visibility|_end|defaults|setAttribute|compatMode|O|Q|9999em|X|new|getTime|background|body|padding|aui_state_full|_start|size|input|question|createElement|Date|border|typeof|alert|start|auto|jQuery|css|api|src|null|end|BackCompat|value|find|appendChild|list|3|5".split("|"),109,122,{},{}));