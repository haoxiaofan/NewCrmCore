"use strict";let version="3.2.0",ajaxUrl="",TEMP={};var HROS={};HROS.CONFIG={website:"http://"+location.hostname+location.pathname,sinaweiboAppkey:"",tweiboAppkey:"",memberID:0,lockPwdAndLoginPwd:!1,desk:1,dockPos:"",appXY:"",appSize:"",appButtonTop:20,appButtonLeft:20,windowIndexid:1e4,widgetIndexid:1,windowMinWidth:215,windowMinHeight:59,wallpaperState:"",wallpaper:"",wallpaperType:"",wallpaperWidth:0,wallpaperHeight:0,appVerticalSpacing:0,appHorizontalSpacing:0,deskCount:0,timeOutPrompt:"会话过期,请重新登陆!",loadingPrompt:"正在载入中，请稍后...",postOnce:"不要重复提交!"};HROS.VAR={zoomLevel:1,isAppMoving:!1,dock:[],desk1:[],desk2:[],desk3:[],desk4:[],desk5:[],folder:[]};let appbtnTemp=template.compile('<div id="<%=id%>" class="appbtn" title="<%=title%>" appid="<%=appid%>" realappid="<%=realappid%>" type="<%=type%>">'+'<img src="<%=imgsrc%>" alt="<%=title%>" style="width:<%=appsize%>px;height:<%=appsize%>px;">'+'<span style="width:<%=appsize+10%>px;"><%=title%><\/span>'+"<\/div>"),addbtnTemp=template.compile('<div class="appbtn add"><div><img src="/images/ui/addicon.png"><\/div>'+'<span style="width:<%=appsize+10%>px;">添加应用<\/span>'+"<\/div>"),taskTemp=template.compile('<a id="<%=id%>" class="task-item task-item-current" title="<%=title%>" appid="<%=appid%>" realappid="<%=realappid%>" type="<%=type%>">'+'<div class="task-item-icon">'+'<img src="<%=imgsrc%>" alt="<%=title%>">'+"<\/div>"+'<div class="task-item-txt"><%=title%><\/div>'+"<\/a>"),widgetWindowTemp=template.compile('<div id="<%=id%>" class="widget" appid="<%=appid%>" realappid="<%=realappid%>" type="<%=type%>" style="z-index:<%=zIndex%>;width:<%=width%>px;height:<%=height%>px;top:<%=top%>px;right:<%=right%>px">'+'<div class="move"><a class="ha-close" href="###" title="关闭"><\/a>'+"<% if(issetbar){ %>"+'<a class="ha-star" href="###" title="评分"><\/a>'+"<% } %>"+'<\/div><div class="frame">'+'<iframe src="<%=url%>" frameborder="0" allowtransparency="true"><\/iframe>'+"<\/div><\/div>"),windowTemp=template.compile('<div id="<%=id%>" class="window-container window-current<% if(isflash){ %> window-container-flash<% } %>" starcount="<%=starcount%>" appid="<%=appid%>" realappid="<%=realappid%>" type="<%=type%>" state="show" style="<% if(isopenmax){ %>width:100%;height:100%;<% }else{ %>width:<%=width%>px;height:<%=height%>px;<% } %>z-index:<%=zIndex%>" ismax="<% if(isopenmax){ %>1<% }else{ %>0<% } %>">'+'<div style="height:100%"><div class="title-bar">'+'<img class="icon" src="<%=imgsrc%>" alt="<%=title%>"><span class="title"><%=title%><\/span>'+'<div class="title-handle"><a class="ha-hide" btn="hide" href="###" title="最小化"><b class="hide-b"><\/b><\/a>'+"<% if(istitlebar){ %>"+'<a class="ha-max" btn="max" href="###" title="最大化" <% if(isopenmax){ %>style="display:none"<% } %>><b class="max-b"><\/b><\/a>'+'<a class="ha-revert" btn="revert" href="###" title="还原" <% if(!isopenmax){ %>style="display:none"<% } %>><b class="revert-b"><\/b><b class="revert-t"><\/b><\/a>'+"<% } %>"+"<% if(istitlebarFullscreen){ %>"+'<a class="ha-fullscreen" btn="fullscreen" href="###" title="全屏">+<\/a>'+"<% } %>"+'<a class="ha-close" btn="close" href="###" title="关闭"><\/a><\/div><\/div><div class="window-frame">'+"<% if(isflash){ %>"+'<div class="window-mask"><div class="maskbg"><\/div><div>运行中，点击恢复显示 :)<\/div><\/div>'+"<% }else{ %>"+'<div class="window-mask window-mask-noflash"><\/div>'+"<% } %>"+'<div class="window-loading"><\/div>'+'<iframe id="<%=id%>_iframe" frameborder="0" src="<%=url%>"><\/iframe>'+'<\/div><div class="set-bar"><div class="fr">'+"<% if(issetbar){ %>"+'<a class="btn star"><i class="icon icon177"><\/i><span class="btn-con">评分<\/span><\/a><a class="btn detail"><i class="icon icon120"><\/i><span class="btn-con">详情<\/span><\/a>'+"<% } %>"+'<a class="btn refresh"><i class="icon icon158"><\/i><span class="btn-con">刷新<\/span><\/a><\/div><\/div><\/div>'+"<% if(isresize){ %>"+'<div class="window-resize window-resize-t" resize="t"><\/div><div class="window-resize window-resize-r" resize="r"><\/div><div class="window-resize window-resize-b" resize="b"><\/div><div class="window-resize window-resize-l" resize="l"><\/div><div class="window-resize window-resize-rt" resize="rt"><\/div><div class="window-resize window-resize-rb" resize="rb"><\/div><div class="window-resize window-resize-lt" resize="lt"><\/div><div class="window-resize window-resize-lb" resize="lb"><\/div>'+"<% } %>"+"<\/div>"),folderWindowTemp=template.compile('<div id="<%=id%>" class="folder-window window-container window-current" appid="<%=appid%>" realappid="<%=realappid%>" type="<%=type%>" state="show" style="width:<%=width%>px;height:<%=height%>px;z-index:<%=zIndex%>">'+'<div style="height:100%"><div class="title-bar">'+'<img class="icon" src="<%=imgsrc%>" alt="<%=title%>"><span class="title"><%=title%><\/span>'+'<div class="title-handle"><a class="ha-hide" btn="hide" href="###" title="最小化"><b class="hide-b"><\/b><\/a>'+"<% if(istitlebar){ %>"+'<a class="ha-max" btn="max" href="###" title="最大化"><b class="max-b"><\/b><\/a><a class="ha-revert" btn="revert" href="###" title="还原" style="display:none"><b class="revert-b"><\/b><b class="revert-t"><\/b><\/a>'+"<% } %>"+'<a class="ha-close" btn="close" href="###" title="关闭"><\/a><\/div><\/div><div class="window-frame"><div class="folder_body"><\/div><\/div><div class="set-bar"><div class="fr"><a class="btn refresh"><i class="icon icon158"><\/i><span class="btn-con">刷新<\/span><\/a><\/div><\/div><\/div>'+"<% if(isresize){ %>"+'<div class="window-resize window-resize-t" resize="t"><\/div><div class="window-resize window-resize-r" resize="r"><\/div><div class="window-resize window-resize-b" resize="b"><\/div><div class="window-resize window-resize-l" resize="l"><\/div><div class="window-resize window-resize-rt" resize="rt"><\/div><div class="window-resize window-resize-rb" resize="rb"><\/div><div class="window-resize window-resize-lt" resize="lt"><\/div><div class="window-resize window-resize-lb" resize="lb"><\/div>'+"<% } %>"+"<\/div>"),folderViewTemp=template.compile('<div id="<%=id%>" class="quick_view_container" appid="<%=appid%>" realappid="<%=realappid%>" style="top:<%=top%>px;left:<%=left%>px">'+'<div class="perfect_nine_box"><div class="perfect_nine_t"><div class="perfect_nine_t_m"><\/div><\/div><span class="perfect_nine_t_l"><\/span><span class="perfect_nine_t_r"><\/span><div class="perfect_nine_middle"><span class="perfect_nine_m_l">'+'<div class="perfect_nine_m_l_t" style="top:0px;height:<%=mlt%>px"><\/div>'+'<div class="perfect_nine_m_l_m" style="top:<%=mlt%>px;height:20px;display:<% if(mlm){ %>block<% }else{ %>none<% } %>"><\/div>'+'<div class="perfect_nine_m_l_b" style="top:<% if(mlm){ %><%=mlt+20%><% }else{ %><%=mlt%><% } %>px;height:<%=mlb%>px"><\/div>'+'<\/span><span class="perfect_nine_m_r">'+'<div class="perfect_nine_m_r_t" style="top:0px;height:<%=mrt%>px"><\/div>'+'<div class="perfect_nine_m_r_m" style="top:<%=mrt%>px;height:20px;display:<% if(mrm){ %>block<% }else{ %>none<% } %>"><\/div>'+'<div class="perfect_nine_m_r_b" style="top:<% if(mrm){ %><%=mrt+20%><% }else{ %><%=mrt%><% } %>px;height:<%=mrb%>px"><\/div>'+'<\/span><div class="perfect_nine_context"><div class="quick_view_container_control"><a href="###" class="quick_view_container_open">打开<\/a><\/div>'+'<div class="quick_view_container_list" id="quick_view_container_list_<%=appid%>" realid="<%=appid%>">'+'<div class="quick_view_container_list_in" id="quick_view_container_list_in_<%=appid%>" style="height:<%=height%>px">'+"<%==apps%>"+'<\/div><div class="scrollBar"><\/div><div class="scrollBar_bgc"><\/div><\/div><\/div><\/div><div class="perfect_nine_b"><div class="perfect_nine_b_m"><\/div><\/div><span class="perfect_nine_b_l"><\/span><span class="perfect_nine_b_r"><\/span><\/div><\/div>'),fileDownloadTemp=template.compile('<iframe src="filedownload.php?appid=<%=appid%>" frameborder="0" style="display:none"><\/iframe>'),suggestTemp=template.compile('<li class="resultList" appid="<%=appid%>" realappid="<%=realappid%>" type="<%=type%>">'+'<a href="###"><div><%=name%><\/div><\/a>'+"<\/li>"),editFolderDialogTemp=template.compile('<div id="addfolder">'+'<a class="folderSelector"><img src="<%=src%>"><\/a>'+'<div class="folderNameTxt">请输入文件夹名称：<\/div>'+'<div class="folderInput"><input type="text" class="folderName" id="folderName" value="<%=name%>"><\/div>'+'<div class="folderNameError">文件夹名称不能只包含空字符<\/div><div class="fcDropdown"><a class="fcDropdown_item" title="默认"><img class="fcDropdown_img" src="/images/ui/folder_default.png"><\/a><a class="fcDropdown_item" title="文本"><img class="fcDropdown_img" src="/images/ui/folder_doc.png"><\/a><a class="fcDropdown_item" title="游戏"><img class="fcDropdown_img" src="/images/ui/folder_game.png"><\/a><a class="fcDropdown_item" title="生活"><img class="fcDropdown_img" src="/images/ui/folder_life.png"><\/a><a class="fcDropdown_item" title="音乐"><img class="fcDropdown_img" src="/images/ui/folder_music.png"><\/a><a class="fcDropdown_item" title="工具"><img class="fcDropdown_img" src="/images/ui/folder_tool.png"><\/a><a class="fcDropdown_item" title="视频"><img class="fcDropdown_img" src="/images/ui/folder_video.png"><\/a><\/div><\/div>'),starDialogTemp=template.compile('<div id="star" realappid="<%=realappid%>">'+'<div class="grade-box">'+'<div class="star-num"><%=point%><\/div>'+'<div class="star-box"><div>打分：<\/div>'+'<i style="width:<%=realpoint%>%"><\/i>'+'<ul><li class="grade-1" num="1"><a href="###"><em>很不好用<\/em><\/a><\/li><li class="grade-2" num="2"><a href="###"><em>体验一般般<\/em><\/a><\/li><li class="grade-3" num="3"><a href="###"><em>比较好用<\/em><\/a><\/li><li class="grade-4" num="4"><a href="###"><em>很好用<\/em><\/a><\/li><li class="grade-5" num="5"><a href="###"><em>棒极了，推荐<\/em><\/a><\/li><\/ul><\/div><\/div><\/div>'),lockTemp=template.compile('<div id="lock"><div class="title"><div class="time"><\/div><div class="week"><\/div><\/div><div id="lock-info">'+'<div class="img"><img src="<%=avatar%>" title="<%=username%>" alt="<%=username%>"><\/img><\/div>'+'<div class="text"><input type="password" class="mousetrap" id="lockpassword" placeholder="请输入解锁密码"><\/div><div class="text-tip"><\/div><div class="text"><input type="button" id="lockbtn" value="解 锁"><\/div><\/div><div class="tip">点击屏幕，开启解锁<\/div><\/div>');HROS.app=(()=>({init:()=>{$("#desk").on("click",".add",()=>{HROS.window.createTemp({appid:"hoorayos-yysc",title:"应用市场",url:"/AppMarket/Index",width:800,height:484,isflash:!1})});HROS.app.move();HROS.app.moveScrollbar();$("body").on("contextmenu",".appbtn:not(.add)",function(e){HROS.popupMenu.hide();let popupmenu;switch($(this).attr("type")){case"app":case"widget":popupmenu=HROS.popupMenu.app($(this));break;case"pwindow":case"pwidget":popupmenu=HROS.popupMenu.papp($(this));break;case"folder":popupmenu=HROS.popupMenu.folder($(this));break;case"file":popupmenu=HROS.popupMenu.file($(this))}let l=$(window).width()-e.clientX<popupmenu.width()?e.clientX-popupmenu.width():e.clientX,t=$(window).height()-e.clientY<popupmenu.height()?e.clientY-popupmenu.height():e.clientY;return popupmenu.css({left:l,top:t}).show(),!1});$("body").on("click","#star ul li",function(){let num=$(this).attr("num");!isNaN(num)&&/^[1-5]$/.test(num)&&(HROS.base.checkLogin()?HROS.request.post("/appmarket/modifystar",{AppId:$("#star").attr("realappid"),StarCount:num},responseText=>{responseText.IsSuccess?responseText.IsSuccess?NewCrm.success("打分成功！"):NewCrm.fail("你已经打过分了！"):NewCrm.fail(responseText.Message),$.dialog.list.star.close()}):HROS.base.login())}).on("click","#share a",()=>{$.dialog.list.share.close()});HROS.app.get()},updateXY:i=>{HROS.CONFIG.appXY.toLowerCase()!==i&&HROS.base.checkLogin()&&HROS.request.post("/desk/modifyxy",{appXy:i},responseText=>{responseText.IsSuccess?(HROS.CONFIG.appXY=i.toLowerCase(),HROS.deskTop.resize(),NewCrm.success("图标排列方向更新成功")):NewCrm.fail("图标排列方向更新失败")})},updateSize:i=>{HROS.CONFIG.appSize!==i&&(HROS.CONFIG.appSize=i,HROS.deskTop.resize(),HROS.base.checkLogin()&&HROS.request.post("/desk/modifysize",{appSize:i},responseText=>{responseText.IsSuccess?NewCrm.success("更新应用显示尺寸成功"):NewCrm.fail("更新应用显示尺寸失败")}))},updateVertical:i=>{HROS.CONFIG.appVerticalSpacing!==i&&(HROS.CONFIG.appVerticalSpacing=i,HROS.deskTop.resize(),HROS.base.checkLogin()&&HROS.request.post("/desk/modifyverticalspace",{appVertical:i},responseText=>{responseText.IsSuccess?NewCrm.success("更新应用垂直间距成功"):NewCrm.fail("更新应用垂直间距失败")}))},updateHorizontal:i=>{HROS.CONFIG.appHorizontalSpacing!==i&&(HROS.CONFIG.appHorizontalSpacing=i,HROS.deskTop.resize(),HROS.base.checkLogin()&&HROS.request.post("/desk/modifyhorizontalspace",{appHorizontal:i},responseText=>{responseText.IsSuccess?NewCrm.success("更新应用水平间距成功"):NewCrm.fail("更新应用水平间距失败")}))},get:callback=>{HROS.VAR.isAppMoving=!0,HROS.request.get("/desk/getuserdeskmembers",{},responseText=>{if(responseText.IsSuccess){if(HROS.VAR.isAppMoving=!1,typeof responseText=="object"){let folders=[],docks=[];$.each(responseText.Model,(k,v)=>{let apps=[];$.each(v,(a,b)=>{b.type==="folder"&&folders.push(b),b.isOnDock?docks.push(b):apps.push(b)});eval("HROS.VAR.desk"+k+"=apps")});HROS.VAR.folder=folders;HROS.VAR.dock=docks}HROS.app.set()}callback&&callback()})},set:()=>{let dock_append="";HROS.VAR.dock!==null&&HROS.VAR.dock!==""&&HROS.VAR.dock.forEach(f=>{dock_append+=appbtnTemp({title:f.name,type:f.type,id:"d_"+f.memberId,appid:f.memberId,realappid:f.appId===0?f.memberId:f.appId,imgsrc:f.icon,appsize:48})});$("#dock-bar .dock-applist .appbtn").remove();$("#dock-bar .dock-applist").append(dock_append);for(let j=1;j<=HROS.CONFIG.deskCount;j++){let desk_append="",desk=eval("HROS.VAR.desk"+j);desk&&$(desk).each(function(){desk_append+=appbtnTemp({title:this.name,type:this.type,id:"d_"+this.memberId,appid:this.memberId,realappid:this.appId===0?this.memberId:this.appId,imgsrc:this.icon,appsize:HROS.CONFIG.appSize})});desk_append+=addbtnTemp({appsize:HROS.CONFIG.appSize});$("#desk-"+j+" .desktop-apps-container .appbtn").remove();$("#desk-"+j+" .desktop-apps-container").append(desk_append)}HROS.app.setPos(!1);$("body .quick_view_container").each(function(){HROS.folderView.get($("#d_"+$(this).attr("appid")))});$("#desk .folder-window").each(function(){HROS.window.updateFolder($(this).attr("appid"))});HROS.app.getScrollbar()},setPos:isAnimate=>{$("i.addicon").width(HROS.CONFIG.appSize).height(HROS.CONFIG.appSize);$("#desk .desktop-container .appbtn img ").width(HROS.CONFIG.appSize).height(HROS.CONFIG.appSize);$("#desk .desktop-container .appbtn span").width(Number(HROS.CONFIG.appSize)+10);isAnimate=isAnimate===null?!0:isAnimate;let grid=HROS.grid.getAppGrid(),dockGrid=HROS.grid.getDockAppGrid();$("#dock-bar .dock-applist .appbtn").each(function(i){$(this).css({top:HROS.CONFIG.dockPos.toLowerCase()==="top"?dockGrid[i].startY:dockGrid[i].startY+5,left:HROS.CONFIG.dockPos.toLowerCase()==="top"?dockGrid[i].startX+5:dockGrid[i].startX}).attr("top",$(this).offset().top).attr("left",$(this).offset().left)});for(let j=1;j<=5;j++)$("#desk-"+j+" .appbtn").each(function(i){let offsetTop=HROS.CONFIG.appVerticalSpacing/2,offsetLeft=HROS.CONFIG.appHorizontalSpacing/2,top=grid[i].startY+offsetTop,left=grid[i].startX+offsetLeft;$(this).stop(!0,!1).animate({top:top,left:left},isAnimate?500:0);switch(HROS.CONFIG.dockPos.toLowerCase()){case"top":$(this).attr("left",left).attr("top",top+$("#dock-bar").height());break;case"left":$(this).attr("left",left+$("#dock-bar").width()).attr("top",top);break;default:$(this).attr("left",left).attr("top",top)}});HROS.app.getScrollbar()},add:(id,callback)=>{HROS.base.checkLogin()?HROS.request.post("/appmarket/install",{AppId:id,DeskNum:HROS.CONFIG.desk},responseText=>{responseText.IsSuccess?callback&&callback():NewCrm.fail(responseText.Message)}):callback&&callback()},remove:(id,callback)=>{function done(){HROS.widget.removeCookie(id);callback&&callback()}HROS.base.checkLogin()?HROS.request.post("/desk/uninstall",{memberId:parseInt(id)},responseText=>{responseText.IsSuccess?(done(),NewCrm.success("移除成功，刷新后查看")):NewCrm.fail(responseText.Message)}):done()},move:()=>{$("#dock-bar .dock-applist").on("mousedown",".appbtn",function(e){if(e.preventDefault(),e.stopPropagation(),e.button===0||e.button===1){let oldobj=$(this),obj=$('<div id="shortcut_shadow">'+oldobj.html()+"<\/div>"),dx=e.clientX,dy=e.clientY,cx=e.clientX,cy=e.clientY,x=dx-oldobj.offset().left,y=dy-oldobj.offset().top,lay=HROS.maskBox.desk();$(document).on("mousemove",e=>{$("body").append(obj),lay.show(),cx=e.clientX<=0?0:e.clientX>=$(window).width()?$(window).width():e.clientX,cy=e.clientY<=0?0:e.clientY>=$(window).height()?$(window).height():e.clientY,(dx!==cx||dy!==cy)&&obj.css({left:cx-x,top:cy-y}).show()}).on("mouseup",()=>{if($(document).off("mousemove").off("mouseup"),obj.remove(),lay.hide(),dx===cx&&dy===cy){switch(oldobj.attr("type")){case"window":case"pwindow":case"file":HROS.window.create(oldobj.attr("realappid"),oldobj.attr("type"));break;case"widget":case"pwidget":HROS.widget.create(oldobj.attr("realappid"),oldobj.attr("type"));break;case"folder":HROS.folderView.get(oldobj)}return!1}let movegrid=HROS.grid.searchFolderGrid(cx,cy);if(movegrid!==null){if(oldobj.hasClass("folder")===!1){let id=oldobj.attr("appid"),from=oldobj.index(),to=movegrid;HROS.base.checkLogin()?HROS.app.checkIsMoving()||HROS.app.dataDockToFolder(id,from,to)&&HROS.request.post("/desk/membermove",{model:{MoveType:"dock-folder",MemberId:id,From:from,To:to}},responseText=>{responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.fail(responseText.Message)}):HROS.app.dataDockToFolder(id,from,to)}}else{let dock_w=HROS.CONFIG.dockPos.toLowerCase()==="left"?0:HROS.CONFIG.dockPos.toLowerCase()==="top"?($(window).width()-$("#dock-container").width()+20)/2:$(window).width()-$("#dock-container").width(),dock_h=HROS.CONFIG.dockPos.toLowerCase()==="top"?0:($(window).height()-$("#dock-container").height()+20)/2,movegrid=HROS.grid.searchDockAppGrid(cx-dock_w,cy-dock_h);if(movegrid!==null){if(movegrid!==oldobj.index()){let movegrid2=HROS.grid.searchDockAppGrid2(cx-dock_w,cy-dock_h),id=oldobj.attr("appid"),from=oldobj.index(),to=movegrid,boa=movegrid2%2==0?"b":"a";HROS.base.checkLogin()?HROS.app.checkIsMoving()||HROS.app.dataDockToDock(id,from,to,boa):HROS.app.dataDockToDock(id,from,to,boa)}}else{let dock_w=HROS.CONFIG.dockPos.toLowerCase()==="left"?$("#dock-bar").width():0,dock_h=HROS.CONFIG.dockPos.toLowerCase()==="top"?$("#dock-bar").height():0,deskScrollLeft=$("#desk-"+HROS.CONFIG.desk+" .desktop-apps-container").scrollLeft(),deskScrollTop=$("#desk-"+HROS.CONFIG.desk+" .desktop-apps-container").scrollTop(),movegrid=HROS.grid.searchAppGrid(cx-dock_w+deskScrollLeft,cy-dock_h+deskScrollTop);if(movegrid!==null){let movegrid2=HROS.grid.searchAppGrid2(cx-dock_w+deskScrollLeft,cy-dock_h+deskScrollTop),id=oldobj.attr("appid"),from=oldobj.index(),to=movegrid,boa=movegrid2%2==0?"b":"a",desk=HROS.CONFIG.desk;HROS.base.checkLogin()?HROS.app.checkIsMoving()||HROS.app.dataDockToDesk(id,from,to,boa,desk)&&HROS.request.post("/desk/membermove",{model:{MoveType:"dock-desk",MemberId:id,From:from,To:desk}},responseText=>{responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.fail(responseText.Message)}):HROS.app.dataDockToDesk(id,from,to,boa,desk)}}}})}});$("#desktop .desktop-apps-container").on("mousedown",".appbtn:not(.add)",function(e){if(e.preventDefault(),e.stopPropagation(),e.button===0||e.button===1){let oldobj=$(this),obj=$('<div id="shortcut_shadow">'+oldobj.html()+"<\/div>"),dx=e.clientX,dy=e.clientY,cx=e.clientX,cy=e.clientY,x=dx-oldobj.offset().left,y=dy-oldobj.offset().top,lay=HROS.maskBox.desk();$(document).on("mousemove",e=>{$("body").append(obj),lay.show(),cx=e.clientX<=0?0:e.clientX>=$(window).width()?$(window).width():e.clientX,cy=e.clientY<=0?0:e.clientY>=$(window).height()?$(window).height():e.clientY,(dx!==cx||dy!==cy)&&obj.css({left:cx-x,top:cy-y}).show()}).on("mouseup",()=>{if($(document).off("mousemove").off("mouseup"),obj.remove(),lay.hide(),dx===cx&&dy===cy){switch(oldobj.attr("type")){case"app":case"pwindow":case"file":HROS.window.create(oldobj.attr("realappid"),oldobj.attr("type"));break;case"widget":case"pwidget":HROS.widget.create(oldobj.attr("realappid"),oldobj.attr("type"));break;case"folder":HROS.folderView.get(oldobj)}return!1}let movegrid=HROS.grid.searchFolderGrid(cx,cy);if(movegrid!==null){if(oldobj.attr("type")!=="folder"){let id=oldobj.attr("appid"),from=oldobj.index(),to=movegrid,desk=HROS.CONFIG.desk;HROS.base.checkLogin()?HROS.app.checkIsMoving()||HROS.app.dataDeskToFolder(id,from,to,desk)&&HROS.request.post("/desk/membermove",{model:{MoveType:"desk-folder",MemberId:id,From:from,To:to}},responseText=>{responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.fail(responseText.Message)}):HROS.app.dataDeskToFolder(id,from,to,desk)}}else{let dock_w=HROS.CONFIG.dockPos.toLowerCase()==="left"?0:HROS.CONFIG.dockPos.toLowerCase()==="top"?($(window).width()-$("#dock-container").width()+20)/2:$(window).width()-$("#dock-container").width(),dock_h=HROS.CONFIG.dockPos.toLowerCase()==="top"?0:($(window).height()-$("#dock-container").height()+20)/2,movegrid=HROS.grid.searchDockAppGrid(cx-dock_w,cy-dock_h);if(movegrid!==null){let movegrid2=HROS.grid.searchDockAppGrid2(cx-dock_w,cy-dock_h),id=oldobj.attr("appid"),from=oldobj.index(),to=movegrid,boa=movegrid2%2==0?"b":"a",desk=HROS.CONFIG.desk;HROS.base.checkLogin()?HROS.app.checkIsMoving()||HROS.app.dataDeskToDock(id,from,to,boa,desk)&&HROS.request.post("/desk/membermove",{model:{MoveType:"desk-dock",MemberId:id,From:from,To:to}},responseText=>{responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.fail(responseText.Message)}):HROS.app.dataDeskToDock(id,from,to,boa,desk)}else{let dock_w=HROS.CONFIG.dockPos.toLowerCase()==="left"?$("#dock-bar").width():0,dock_h=HROS.CONFIG.dockPos.toLowerCase()==="top"?$("#dock-bar").height():0,deskScrollLeft=$("#desk-"+HROS.CONFIG.desk+" .desktop-apps-container").scrollLeft(),deskScrollTop=$("#desk-"+HROS.CONFIG.desk+" .desktop-apps-container").scrollTop(),movegrid=HROS.grid.searchAppGrid(cx-dock_w+deskScrollLeft,cy-dock_h+deskScrollTop);if(movegrid!==null&&movegrid!==oldobj.index()){let movegrid2=HROS.grid.searchAppGrid2(cx-dock_w+deskScrollLeft,cy-dock_h+deskScrollTop),id=oldobj.attr("appid"),from=oldobj.index(),to=movegrid,boa=movegrid2%2==0?"b":"a",desk=HROS.CONFIG.desk;HROS.base.checkLogin()?HROS.app.checkIsMoving()||HROS.app.dataDeskToDesk(id,from,to,boa,desk):HROS.app.dataDeskToDesk(id,from,to,boa,desk)}}}})}});$("body").on("mousedown",".folder_body .appbtn, .quick_view_container .appbtn",function(e){if(e.preventDefault(),e.stopPropagation(),e.button===0||e.button===1){let oldobj=$(this),obj=$('<div id="shortcut_shadow">'+oldobj.html()+"<\/div>"),dx=e.clientX,dy=e.clientY,cx=e.clientX,cy=e.clientY,x=dx-oldobj.offset().left,y=dy-oldobj.offset().top,lay=HROS.maskBox.desk();$(document).on("mousemove",e=>{$("body").append(obj),lay.show(),cx=e.clientX<=0?0:e.clientX>=$(window).width()?$(window).width():e.clientX,cy=e.clientY<=0?0:e.clientY>=$(window).height()?$(window).height():e.clientY,(dx!==cx||dy!==cy)&&obj.css({left:cx-x,top:cy-y}).show()}).on("mouseup",()=>{if($(document).off("mousemove").off("mouseup"),obj.remove(),lay.hide(),dx===cx&&dy===cy){switch(oldobj.attr("type")){case"app":case"window":case"pwindow":case"file":HROS.window.create(oldobj.attr("realappid"),oldobj.attr("type"));break;case"widget":case"pwidget":HROS.widget.create(oldobj.attr("realappid"),oldobj.attr("type"))}return!1}let movegrid=HROS.grid.searchFolderGrid(cx,cy);if(movegrid!==null){if(oldobj.parents(".folder-window").attr("appid")!==movegrid){let id=oldobj.attr("appid"),from=oldobj.index(),to=movegrid,fromFolderId=oldobj.parents(".folder-window").attr("appid")||oldobj.parents(".quick_view_container").attr("appid");HROS.base.checkLogin()?HROS.app.checkIsMoving()||HROS.app.dataFolderToFolder(id,from,to,fromFolderId)&&HROS.request.post("/desk/membermove",{model:{MoveType:"folder-folder",MemberId:id,From:from,To:to}},responseText=>{responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.fail(responseText.Message)}):HROS.app.dataFolderToFolder(id,from,to,fromFolderId)}}else{let dock_w=HROS.CONFIG.dockPos.toLowerCase()==="left"?0:HROS.CONFIG.dockPos.toLowerCase()==="top"?($(window).width()-$("#dock-container").width()+20)/2:$(window).width()-$("#dock-container").width(),dock_h=HROS.CONFIG.dockPos.toLowerCase()==="top"?0:($(window).height()-$("#dock-container").height()+20)/2,movegrid=HROS.grid.searchDockAppGrid(cx-dock_w,cy-dock_h);if(movegrid!==null){let movegrid2=HROS.grid.searchDockAppGrid2(cx-dock_w,cy-dock_h),id=oldobj.attr("appid"),from=oldobj.index(),to=movegrid,fromFolderId=oldobj.parents(".folder-window").attr("appid")||oldobj.parents(".quick_view_container").attr("appid"),boa=movegrid2%2==0?"b":"a",desk=HROS.CONFIG.desk;HROS.base.checkLogin()?HROS.app.checkIsMoving()||HROS.app.dataFolderToDock(id,from,to,fromFolderId,boa,desk)&&HROS.request.post("/desk/membermove",{model:{MoveType:"folder-dock",MemberId:id,From:from,To:to}},responseText=>{responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.fail(responseText.Message)}):HROS.app.dataFolderToDock(id,from,to,fromFolderId,boa,desk)}else{let dock_w=HROS.CONFIG.dockPos.toLowerCase()==="left"?$("#dock-bar").width():0,dock_h=HROS.CONFIG.dockPos.toLowerCase()==="top"?$("#dock-bar").height():0,deskScrollLeft=$("#desk-"+HROS.CONFIG.desk+" .desktop-apps-container").scrollLeft(),deskScrollTop=$("#desk-"+HROS.CONFIG.desk+" .desktop-apps-container").scrollTop(),movegrid=HROS.grid.searchAppGrid(cx-dock_w+deskScrollLeft,cy-dock_h+deskScrollTop);if(movegrid!==null){let movegrid2=HROS.grid.searchAppGrid2(cx-dock_w+deskScrollLeft,cy-dock_h+deskScrollTop),id=oldobj.attr("appid"),from=oldobj.index(),to=movegrid,fromFolderId=oldobj.parents(".folder-window").attr("appid")||oldobj.parents(".quick_view_container").attr("appid"),boa=movegrid2%2==0?"b":"a",desk=HROS.CONFIG.desk;HROS.base.checkLogin()?HROS.app.checkIsMoving()||HROS.app.dataFolderToDesk(id,from,to,fromFolderId,boa,desk)&&HROS.request.post("/desk/membermove",{model:{MoveType:"folder-desk",MemberId:id,From:from,To:desk}},responseText=>{responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.fail(responseText.Message)}):HROS.app.dataFolderToDesk(id,from,to,fromFolderId,boa,desk)}}}})}})},getScrollbar:()=>{setTimeout(()=>{$("#desk .desktop-container").each(function(){let desk=$(this).children(".desktop-apps-container"),scrollbar=$(this).children(".scrollbar"),scrollbarLeft=desk.nextAll(".scrollbar-x").position().left,scrollbarTop=desk.nextAll(".scrollbar-y").position().top;if(scrollbar.hide(),desk.scrollLeft(0).scrollTop(0),HROS.CONFIG.appXY.toLowerCase()==="x"){let deskH=parseInt(desk.children(".add").css("top"))+108;desk.height()/deskH<1&&(desk.nextAll(".scrollbar-y").height(desk.height()/deskH*desk.height()),scrollbarTop=scrollbarTop+desk.nextAll(".scrollbar-y").height()>desk.height()?desk.height()-desk.nextAll(".scrollbar-y").height():scrollbarTop,desk.nextAll(".scrollbar-y").css("top",scrollbarTop).show(),desk.scrollTop(scrollbarTop/desk.height()*deskH))}else{let deskW=parseInt(desk.children(".add").css("left"))+106;desk.width()/deskW<1&&(desk.nextAll(".scrollbar-x").width(desk.width()/deskW*desk.width()),scrollbarLeft=scrollbarLeft+desk.nextAll(".scrollbar-x").width()>desk.width()?desk.width()-desk.nextAll(".scrollbar-w").width():scrollbarLeft,desk.nextAll(".scrollbar-x").css("left",scrollbarLeft).show(),desk.scrollLeft(scrollbarLeft/desk.width()*deskW))}})},500)},moveScrollbar:()=>{$("#desk .scrollbar").on("mousedown",function(e){let x,y,cx,cy,deskrealw,deskrealh,movew,moveh,scrollbar=$(this),desk=scrollbar.prevAll(".desktop-apps-container");deskrealw=parseInt(desk.children(".add").css("left"))+106;deskrealh=parseInt(desk.children(".add").css("top"))+108;movew=desk.width()-scrollbar.width();moveh=desk.height()-scrollbar.height();scrollbar.hasClass("scrollbar-x")?x=e.clientX-scrollbar.position().left:y=e.clientY-scrollbar.position().top;$(document).on("mousemove",e=>{scrollbar.hasClass("scrollbar-x")?(cx=e.clientX-x<0?0:e.clientX-x>movew?movew:e.clientX-x,scrollbar.css("left",cx),desk.scrollLeft(cx/desk.width()*deskrealw)):(cy=e.clientY-y<0?0:e.clientY-y>moveh?moveh:e.clientY-y,scrollbar.css("top",cy),desk.scrollTop(cy/desk.height()*deskrealh))}).on("mouseup",function(){$(this).off("mousemove").off("mouseup")})});for(let i=1;i<=5;i++)$("#desk-"+i).on("mousewheel",function(event,delta){let desk=$(this).find(".desktop-apps-container");if(HROS.CONFIG.appXY.toLowerCase()==="x"){let deskrealh=parseInt(desk.find(".add").css("top"))+108,scrollupdown;scrollupdown=delta<0?desk.scrollTop()+200>deskrealh-desk.height()?deskrealh-desk.height():desk.scrollTop()+200:desk.scrollTop()-200<0?0:desk.scrollTop()-200;desk.stop(!1,!0).animate({scrollTop:scrollupdown},300);desk.nextAll(".scrollbar-y").stop(!1,!0).animate({top:scrollupdown/deskrealh*desk.height()},300)}else{let deskrealw=parseInt(desk.find(".add").css("left"))+106,scrollleftright;scrollleftright=delta<0?desk.scrollLeft()+200>deskrealw-desk.width()?deskrealw-desk.width():desk.scrollLeft()+200:desk.scrollLeft()-200<0?0:desk.scrollLeft()-200;desk.stop(!1,!0).animate({scrollLeft:scrollleftright},300);desk.nextAll(".scrollbar-x").stop(!1,!0).animate({left:scrollleftright/deskrealw*desk.width()},300)}})},checkIsMoving:()=>{let rtn=!1;return HROS.VAR.isAppMoving?($.dialog({title:"温馨提示",icon:"warning",content:"数据正在处理中，请稍后。",ok:!0}),rtn=!0):HROS.VAR.isAppMoving=!0,rtn},dataWarning:()=>{$.dialog({title:"温馨提示",icon:"warning",content:"数据错误，请刷新后重试。",ok:!0})},dataDockToFolder:(id,from,to)=>{let rtn=!1;return $(HROS.VAR.dock).each(function(i){if(this.memberId===parseInt(id))return $(HROS.VAR.folder).each(function(j){if(this.memberId===parseInt(to))return HROS.VAR.folder[j].apps.push(HROS.VAR.dock[i]),HROS.VAR.folder[j].apps=HROS.VAR.folder[j].apps.sortBy(n=>n.memberId,!0),HROS.VAR.dock.splice(i,1),rtn=!0,!1}),!1}),rtn?$("#desktop").is(":visible")?HROS.app.set():HROS.appmanage.set():HROS.app.dataWarning(),rtn},dataDockToDock:(id,from,to,boa)=>{let rtn=!1;return HROS.VAR.dock[from]!==null&&(to===0?boa==="b"?HROS.VAR.dock.splice(0,0,HROS.VAR.dock[from]):HROS.VAR.dock.splice(1,0,HROS.VAR.dock[from]):boa==="b"?HROS.VAR.dock.splice(to,0,HROS.VAR.dock[from]):HROS.VAR.dock.splice(to+1,0,HROS.VAR.dock[from]),from>to?HROS.VAR.dock.splice(from+1,1):HROS.VAR.dock.splice(from,1),rtn=!0),rtn?$("#desktop").is(":visible")?HROS.app.set():HROS.appmanage.set():HROS.app.dataWarning(),rtn},dataDockToDesk:(id,from,to,boa,desk)=>{let rtn=!1;return desk=eval("HROS.VAR.desk"+desk),HROS.VAR.dock[from]!==null&&(to===0?boa==="b"?desk.splice(0,0,HROS.VAR.dock[from]):desk.splice(1,0,HROS.VAR.dock[from]):boa==="b"?desk.splice(to,0,HROS.VAR.dock[from]):desk.splice(to+1,0,HROS.VAR.dock[from]),HROS.VAR.dock.splice(from,1),rtn=!0),rtn?$("#desktop").is(":visible")?HROS.app.set():HROS.appmanage.set():HROS.app.dataWarning(),rtn},dataDockToOtherdesk:(id,from,todesk)=>{let rtn=!1;return todesk=eval("HROS.VAR.desk"+todesk),HROS.VAR.dock[from]!==null&&(todesk.push(HROS.VAR.dock[from]),HROS.VAR.dock.splice(from,1),rtn=!0),rtn?$("#desktop").is(":visible")?HROS.app.set():HROS.appmanage.set():HROS.app.dataWarning(),rtn},dataDockToDelete:(id,from)=>{let rtn=!1;return HROS.VAR.dock[from]!==null&&(HROS.VAR.dock.splice(from,1),rtn=!0),rtn?$("#desktop").is(":visible")?HROS.app.set():HROS.appmanage.set():HROS.app.dataWarning(),rtn},dataDeskToFolder:(id,from,to,desk)=>{let rtn=!1;return desk=eval("HROS.VAR.desk"+desk),$(HROS.VAR.folder).each(function(i){if(this.memberId===parseInt(to)&&desk[from]!==null)return HROS.VAR.folder[i].apps.push(desk[from]),HROS.VAR.folder[i].apps=HROS.VAR.folder[i].apps.sortBy(n=>n.memberId,!0),desk.splice(from,1),rtn=!0,!1}),rtn?$("#desktop").is(":visible")?HROS.app.set():HROS.appmanage.set():HROS.app.dataWarning(),rtn},dataDeskToDock:(id,from,to,boa,desk)=>{let rtn=!1;return desk=eval("HROS.VAR.desk"+desk),desk[from]!==null&&(to===0?boa==="b"?HROS.VAR.dock.splice(0,0,desk[from]):HROS.VAR.dock.splice(1,0,desk[from]):boa==="b"?HROS.VAR.dock.splice(to,0,desk[from]):HROS.VAR.dock.splice(to+1,0,desk[from]),desk.splice(from,1),HROS.VAR.dock.length>7&&(desk.push(HROS.VAR.dock[7]),HROS.VAR.dock.splice(7,1)),rtn=!0),rtn?$("#desktop").is(":visible")?HROS.app.set():HROS.appmanage.set():HROS.app.dataWarning(),rtn},dataDeskToDesk:(id,from,to,boa,desk)=>{let rtn=!1;return desk=eval("HROS.VAR.desk"+desk),desk[from]!==null&&(to===0?boa==="b"?desk.splice(0,0,desk[from]):desk.splice(1,0,desk[from]):boa==="b"?desk.splice(to,0,desk[from]):desk.splice(to+1,0,desk[from]),from>to?desk.splice(from+1,1):desk.splice(from,1),rtn=!0),rtn?$("#desktop").is(":visible")?HROS.app.set():HROS.appmanage.set():HROS.app.dataWarning(),rtn},dataDeskToOtherdesk:(id,from,to,boa,todesk,fromdesk)=>{let rtn=!1;return fromdesk=eval("HROS.VAR.desk"+fromdesk),todesk=eval("HROS.VAR.desk"+todesk),fromdesk[from]!==null&&(to===0?boa==="b"?todesk.splice(0,0,fromdesk[from]):todesk.splice(1,0,fromdesk[from]):boa==="b"?todesk.splice(to,0,fromdesk[from]):todesk.splice(to+1,0,fromdesk[from]),fromdesk.splice(from,1),rtn=!0),rtn?$("#desktop").is(":visible")?HROS.app.set():HROS.appmanage.set():HROS.app.dataWarning(),rtn},dataFolderToFolder:(id,from,to,fromFolderId)=>{let rtn=!1,flags=0,fromKey,toKey;return $(HROS.VAR.folder).each(function(i){this.memberId===parseInt(fromFolderId)&&HROS.VAR.folder[i].apps[from]!==null&&(fromKey=i,flags+=1);this.memberId===parseInt(to)&&(toKey=i,flags+=1)}),flags===2&&(HROS.VAR.folder[toKey].apps.push(HROS.VAR.folder[fromKey].apps[from]),HROS.VAR.folder[toKey].apps=HROS.VAR.folder[toKey].apps.sortBy(n=>n.appid,!0),HROS.VAR.folder[fromKey].apps.splice(from,1),rtn=!0),rtn?$("#desktop").is(":visible")?HROS.app.set():HROS.appmanage.set():HROS.app.dataWarning(),rtn},dataFolderToDock:(id,from,to,fromFolderId,boa,desk)=>{let rtn=!1;return desk=eval("HROS.VAR.desk"+desk),$(HROS.VAR.folder).each(function(i){if(this.memberId===parseInt(fromFolderId)&&HROS.VAR.folder[i].apps[from]!==null)return to===0?boa==="b"?HROS.VAR.dock.splice(0,0,HROS.VAR.folder[i].apps[from]):HROS.VAR.dock.splice(1,0,HROS.VAR.folder[i].apps[from]):boa==="b"?HROS.VAR.dock.splice(to,0,HROS.VAR.folder[i].apps[from]):HROS.VAR.dock.splice(to+1,0,HROS.VAR.folder[i].apps[from]),HROS.VAR.folder[i].apps.splice(from,1),HROS.VAR.dock.length>7&&(desk.push(HROS.VAR.dock[7]),HROS.VAR.dock.splice(7,1)),rtn=!0,!1}),rtn?$("#desktop").is(":visible")?HROS.app.set():HROS.appmanage.set():HROS.app.dataWarning(),rtn},dataFolderToDesk:(id,from,to,fromFolderId,boa,desk)=>{let rtn=!1;return desk=eval("HROS.VAR.desk"+desk),$(HROS.VAR.folder).each(function(i){if(this.memberId===parseInt(fromFolderId)&&HROS.VAR.folder[i].apps[from]!==null)return to===0?boa==="b"?desk.splice(0,0,HROS.VAR.folder[i].apps[from]):desk.splice(1,0,HROS.VAR.folder[i].apps[from]):boa==="b"?desk.splice(to,0,HROS.VAR.folder[i].apps[from]):desk.splice(to+1,0,HROS.VAR.folder[i].apps[from]),HROS.VAR.folder[i].apps.splice(from,1),rtn=!0,!1}),rtn?$("#desktop").is(":visible")?HROS.app.set():HROS.appmanage.set():HROS.app.dataWarning(),rtn},dataFolderToOtherdesk:(id,from,todesk,fromFolderId)=>{let rtn=!1;return todesk=eval("HROS.VAR.desk"+todesk),$(HROS.VAR.folder).each(function(i){if(this.memberId===parseInt(fromFolderId)&&HROS.VAR.folder[i].apps[from]!==null)return todesk.push(HROS.VAR.folder[i].apps[from]),HROS.VAR.folder[i].apps.splice(from,1),rtn=!0,!1}),rtn?$("#desktop").is(":visible")?HROS.app.set():HROS.appmanage.set():HROS.app.dataWarning(),rtn},dataAllDockToDesk:desk=>{desk=eval("HROS.VAR.desk"+desk),$(HROS.VAR.dock).each(i=>{desk.push(HROS.VAR.dock[i])}),HROS.VAR.dock.splice(0,HROS.VAR.dock.length)},dataDeleteByAppid:appid=>{$(HROS.VAR.dock).each(function(i){if(this.appid===appid)return HROS.VAR.dock.splice(i,1),!1});for(let i=1;i<=5;i++){let desk=eval("HROS.VAR.desk"+i);$(desk).each(function(j){if(this.appid===appid)return desk.splice(j,1),this.type==="folder"&&$(HROS.VAR.folder).each(k=>{if(this.appid===appid)return HROS.VAR.folder.splice(k,1),!1}),!1})}$(HROS.VAR.folder).each(function(i){$(this.apps).each(function(j){if(this.appid===appid)return HROS.VAR.folder[i].apps.splice(j,1),!1})})}}))();HROS.appmanage=(()=>({init:()=>{$("#appmanage .amg_close").off("click").on("click",()=>{HROS.appmanage.close()});$("#amg_folder_container").on("contextmenu",".appbtn",()=>!1);HROS.appmanage.move();HROS.appmanage.moveScrollbar()},set:()=>{$("#desktop").hide();$("#appmanage").show();$("#amg_folder_container .folderItem").show().addClass("folderItem_turn");$("#amg_folder_container .folderInner").height($(window).height()-80);let dockAppend="";HROS.VAR.dock!==""&&$(HROS.VAR.dock).each(function(){dockAppend+=appbtnTemp({title:this.name,type:this.type,id:"d_"+this.memberId,appid:this.memberId,realappid:this.appId===0?this.memberId:this.appId,imgsrc:this.icon})});$("#amg_dock_container").html(dockAppend);for(let j=0;j<HROS.CONFIG.deskCount;j++){let desk_append="",desk=eval("HROS.VAR.desk"+(j+1));desk!==""&&$(desk).each(function(){desk_append+=appbtnTemp({title:this.name,type:this.type,id:"d_"+this.memberId,appid:this.memberId,realappid:this.appId===0?this.memberId:this.appId,imgsrc:this.icon,appsize:26})});$("#amg_folder_container .folderItem:eq("+j+") .folderInner .appbtn").remove();$("#amg_folder_container .folderItem:eq("+j+") .folderInner").append(desk_append)}HROS.appmanage.setPos();HROS.appmanage.getScrollbar()},setPos:()=>{let manageDockGrid=HROS.grid.getManageDockAppGrid(),manageAppGrid=HROS.grid.getManageAppGrid();$("#amg_dock_container .appbtn").each(function(i){$(this).css({top:10,left:manageDockGrid[i].startX+6})});for(let j=0;j<5;j++)$("#amg_folder_container .folderItem:eq("+j+") .folderInner .appbtn").each(function(i){$(this).css({top:manageAppGrid[i].startY+5,left:0})})},move:()=>{function _next(oldobj){let movegrid=HROS.grid.searchManageDockAppGrid(cx);if(movegrid!==null){let movegrid2=HROS.grid.searchManageDockAppGrid2(cx),id=oldobj.attr("appid"),from=oldobj.index(),to=movegrid,boa=movegrid2%2==0?"b":"a",desk=oldobj.parent().attr("desk");HROS.base.checkLogin()?HROS.app.checkIsMoving()||HROS.app.dataDeskToDock(id,from,to,boa,desk):HROS.app.dataDeskToDock(id,from,to,boa,desk)}}$("#amg_dock_container").on("mousedown",".appbtn",function(e){if(e.preventDefault(),e.stopPropagation(),e.button===0||e.button===1){let oldobj=$(this),obj=$('<div id="shortcut_shadow">'+oldobj.html()+"<\/div>"),dx=e.clientX,dy=e.clientY,cx=e.clientX,cy=e.clientY,x=dx-oldobj.offset().left,y=dy-oldobj.offset().top,lay=HROS.maskBox.desk();$(document).on("mousemove",e=>{$("body").append(obj),lay.show(),cx=e.clientX<=0?0:e.clientX>=$(window).width()?$(window).width():e.clientX,cy=e.clientY<=0?0:e.clientY>=$(window).height()?$(window).height():e.clientY,(dx!==cx||dy!==cy)&&obj.css({left:cx-x,top:cy-y}).show()}).on("mouseup",()=>{if($(document).off("mousemove").off("mouseup"),obj.remove(),lay.hide(),dx===cx&&dy===cy){HROS.appmanage.close();switch(oldobj.attr("type")){case"widget":case"pwidget":HROS.widget.create(oldobj.attr("realappid"),oldobj.attr("type"));break;case"window":case"pwindow":case"folder":HROS.window.create(oldobj.attr("realappid"),oldobj.attr("type"))}return!1}if(cy<=80){let movegrid=HROS.grid.searchManageDockAppGrid(cx);if(movegrid!==null&&movegrid!==oldobj.index()){let movegrid2=HROS.grid.searchManageDockAppGrid2(cx),id=oldobj.attr("appid"),from=oldobj.index(),to=movegrid,boa=movegrid2%2==0?"b":"a";HROS.base.checkLogin()?HROS.app.checkIsMoving()||HROS.app.dataDockToDock(id,from,to,boa):HROS.app.dataDockToDock(id,from,to,boa)}}else{let movedesk=parseInt(cx/($(window).width()/5)),movegrid=HROS.grid.searchManageAppGrid(cy-80+$("#amg_folder_container .folderItem:eq("+movedesk+") .folderInner").scrollTop());if(movegrid!==null){let movegrid2=HROS.grid.searchManageAppGrid2(cy-80+$("#amg_folder_container .folderItem:eq("+movedesk+") .folderInner").scrollTop()),id=oldobj.attr("appid"),from=oldobj.index(),to=movegrid,boa=movegrid2%2==0?"b":"a",desk=movedesk+1;HROS.base.checkLogin()?HROS.app.checkIsMoving()||HROS.app.dataDockToDesk(id,from,to,boa,desk)&&HROS.request.post("/desk/membermove",{model:{MoveType:"dock-desk",MemberId:id,From:from,To:desk}},responseText=>{responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.fail(responseText.Message)}):HROS.app.dataDockToDesk(id,from,to,boa,desk)}}})}return!1});$("#amg_folder_container").on("mousedown",".appbtn:not(.add)",function(e){if(e.preventDefault(),e.stopPropagation(),e.button===0||e.button===1){let oldobj=$(this),obj=$('<div id="shortcut_shadow2">'+oldobj.html()+"<\/div>"),dx=e.clientX,dy=e.clientY,cx=e.clientX,cy=e.clientY,x=dx-oldobj.offset().left,y=dy-oldobj.offset().top,lay=HROS.maskBox.desk();$(document).on("mousemove",e=>{$("body").append(obj),lay.show(),cx=e.clientX<=0?0:e.clientX>=$(window).width()?$(window).width():e.clientX,cy=e.clientY<=0?0:e.clientY>=$(window).height()?$(window).height():e.clientY,(dx!==cx||dy!==cy)&&obj.css({left:cx-x,top:cy-y}).show()}).on("mouseup",()=>{if($(document).off("mousemove").off("mouseup"),obj.remove(),lay.hide(),dx===cx&&dy===cy){HROS.appmanage.close();switch(oldobj.attr("type")){case"app":HROS.window.create(oldobj.attr("realappid"),oldobj.attr("type"));break;case"widget":case"pwidget":HROS.widget.create(oldobj.attr("realappid"),oldobj.attr("type"));break;case"window":case"pwindow":case"folder":HROS.window.create(oldobj.attr("realappid"),oldobj.attr("type"))}return!1}if(cy<=80)HROS.CONFIG.dockPos.toLowerCase()==="none"?$.dialog({title:"温馨提示",icon:"warning",content:"当前应用码头处于停用状态，是否开启？",ok:()=>{HROS.dock.updatePos("top"),_next(oldobj)},cancel:!0}):_next(oldobj);else{let movedesk=parseInt(cx/($(window).width()/5)),movegrid=HROS.grid.searchManageAppGrid(cy-80+$("#amg_folder_container .folderItem:eq("+movedesk+") .folderInner").scrollTop());if(movedesk+1===oldobj.parent().attr("desk")){if(movegrid!==null&&movegrid!==oldobj.index()){let movegrid2=HROS.grid.searchManageAppGrid2(cy-80+$("#amg_folder_container .folderItem:eq("+movedesk+") .folderInner").scrollTop()),id=oldobj.attr("appid"),from=oldobj.index(),to=movegrid,boa=movegrid2%2==0?"b":"a",desk=movedesk+1;HROS.base.checkLogin()?HROS.app.checkIsMoving()||HROS.app.dataDeskToDesk(id,from,to,boa,desk):HROS.app.dataDeskToDesk(id,from,to,boa,desk)}}else if(movegrid!==null){let movegrid2=HROS.grid.searchManageAppGrid2(cy-80+$("#amg_folder_container .folderItem:eq("+movedesk+") .folderInner").scrollTop()),id=oldobj.attr("appid"),from=oldobj.index(),to=movegrid,boa=movegrid2%2==0?"b":"a",todesk=movedesk+1,fromdesk=oldobj.parent().attr("desk");HROS.base.checkLogin()?HROS.app.checkIsMoving()||HROS.app.dataDeskToOtherdesk(id,from,to,boa,todesk,fromdesk)&&HROS.request.post("/desk/membermove",{model:{MoveType:"desk-desk",MemberId:id,From:from,To:todesk}},responseText=>{responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.fail(responseText.Message)}):HROS.app.dataDeskToOtherdesk(id,from,to,boa,todesk,fromdesk)}}})}return!1})},getScrollbar:()=>{$("#amg_folder_container .folderInner").height($(window).height()-80),$("#amg_folder_container .folderItem").each(function(){let desk=$(this).find(".folderInner"),deskrealh=parseInt(desk.children(".appbtn:last").css("top"))+41,scrollbar=desk.next(".scrollBar"),scrollbarTop=scrollbar.position().top;scrollbar.hide();desk.scrollTop(0);desk.height()/deskrealh<1&&(scrollbar.height(desk.height()/deskrealh*desk.height()),scrollbarTop=scrollbarTop+scrollbar.height()>desk.height()?desk.height()-scrollbar.height():scrollbarTop,scrollbar.css("top",scrollbarTop).show(),desk.scrollTop(scrollbarTop/desk.height()*deskrealh))})},moveScrollbar:()=>{$(".scrollBar").on("mousedown",function(e){let y,cy,deskrealh,moveh,scrollbar=$(this),desk=scrollbar.prev(".folderInner");deskrealh=parseInt(desk.children(".appbtn:last").css("top"))+41;moveh=desk.height()-scrollbar.height();y=e.clientY-scrollbar.offset().top;$(document).on("mousemove",e=>{cy=e.clientY-y-80<0?0:e.clientY-y-80>moveh?moveh:e.clientY-y-80,scrollbar.css("top",cy),desk.scrollTop(cy/desk.height()*deskrealh)}).on("mouseup",function(){$(this).off("mousemove").off("mouseup")})});$("#amg_folder_container .folderInner").on("mousewheel",function(event,delta){let desk=$(this),deskrealh=parseInt(desk.children(".appbtn:last").css("top"))+41,scrollupdown;scrollupdown=delta<0?desk.scrollTop()+120>deskrealh-desk.height()?deskrealh-desk.height():desk.scrollTop()+120:desk.scrollTop()-120<0?0:desk.scrollTop()-120;desk.stop(!1,!0).animate({scrollTop:scrollupdown},300);desk.next(".scrollBar").stop(!1,!0).animate({top:scrollupdown/deskrealh*desk.height()},300)})},resize:()=>{HROS.appmanage.getScrollbar()},close:()=>{$("#amg_dock_container").html(""),$("#amg_folder_container .folderInner").html(""),$("#desktop").show(),$("#appmanage").hide(),$("#amg_folder_container .folderItem").removeClass("folderItem_turn"),HROS.app.set(),HROS.deskTop.resize()}}))();HROS.base=(()=>({init:()=>{HROS.CONFIG.memberID=JSON.parse(HROS.cookie.get("User")).Id;$("body").on("contextmenu",()=>!1);HROS.signalR.init();HROS.base.getSkin(undefined,arg=>{HROS.base.setSkin(arg,null)});HROS.copyright.init();HROS.zoom.init();HROS.deskTop.init();HROS.wallpaper.init();HROS.searchbar.init();HROS.startmenu.init();HROS.taskbar.init();HROS.dock.init();HROS.app.init();HROS.widget.init();HROS.window.init();HROS.folderView.init();HROS.appmanage.init();HROS.popupMenu.init();HROS.lock.init();HROS.hotkey.init();HROS.base.run()},login:()=>{$(".login").animate({top:0},500,()=>{changeTabindex("login")})},logout:()=>{HROS.signalR.stop(()=>{HROS.request.get("/desk/logout",{},()=>{location.reload()})})},checkLogin:()=>parseInt(HROS.CONFIG.memberID)!==0?!0:!1,getSkin:function(objSkin,callback){typeof objSkin=="undefined"?HROS.request.get("/desk/getskin",{},responseText=>{responseText.IsSuccess&&typeof callback!="undefined"&&callback&&callback(responseText.Model)}):this.setSkin(objSkin,callback)},setSkin:(skin,callback)=>{function styleOnload(node,callback){node.attachEvent?node.attachEvent("onload",callback):setTimeout(()=>{poll(node,callback)},0)}function poll(node,callback){if(!callback.isCalled){let isLoaded=!1;if(/webkit/i.test(navigator.userAgent))node.sheet&&(isLoaded=!0);else if(node.sheet)try{node.sheet.cssRules&&(isLoaded=!0)}catch(ex){ex.code===1e3&&(isLoaded=!0)}isLoaded?setTimeout(()=>{callback()},1):setTimeout(()=>{poll(node,callback)},1)}}$("#window-skin").attr("id","window-skin-ready2remove");let css=document.createElement("link");css.href="/images/skins/"+skin+".css?"+version;css.rel="stylesheet";css.id="window-skin";$("head").append(css);styleOnload(css,()=>{$("#window-skin-ready2remove").remove(),HROS.CONFIG.skin=skin,callback&&callback()})},run:()=>{let url=location.search,request={};if(url.indexOf("?")!==-1){let str=url.substr(1),strs=str.split("&");for(let i=0;i<strs.length;i++)request[strs[i].split("=")[0]]=unescape(strs[i].split("=")[1])}typeof request.run!="undefined"&&typeof request.type!="undefined"&&(request.type==="app"?HROS.window.create(request.run):HROS.widget.checkCookie(request.run,request.type)||HROS.widget.create(request.run))}}))();HROS.deskTop=(()=>({init:()=>{$(window).on("resize",()=>{HROS.deskTop.resize()});$("body").on("click","#desktop",()=>{HROS.popupMenu.hide(),HROS.folderView.hide(),HROS.searchbar.hide(),HROS.startmenu.hide()}).on("contextmenu","#desktop",e=>{HROS.popupMenu.hide();HROS.folderView.hide();HROS.searchbar.hide();HROS.startmenu.hide();let popupmenu=HROS.popupMenu.desk(),l=$(window).width()-e.clientX<popupmenu.width()?e.clientX-popupmenu.width():e.clientX,t=$(window).height()-e.clientY<popupmenu.height()?e.clientY-popupmenu.height():e.clientY;return popupmenu.css({left:l,top:t}).show(),!1})},resize:()=>{$("#desktop").is(":visible")?(HROS.dock.setPos(),HROS.app.setPos(),HROS.window.setPos(),HROS.folderView.setPos()):HROS.appmanage.resize(),HROS.wallpaper.set(!1)},updateDefaultDesk:i=>{HROS.base.checkLogin()&&HROS.request.post("/desk/modifydefaultdesk",{deskNum:i},responseText=>{responseText.IsSuccess?(NewCrm.success("默认桌面更新成功"),$(".dock-pagination").find("a").each(function(k){parseInt(i)===k+1&&$(this).trigger("click")})):NewCrm.fail("默认桌面更新失败")})},modifyWallpaperSource:value=>{HROS.base.checkLogin()&&HROS.request.post("/desk/modifywallpapersource",{source:value},responseText=>{responseText.IsSuccess?HROS.wallpaper.get(()=>{HROS.wallpaper.set()}):NewCrm.fail(responseText.Message)})}}))();HROS.dock=(()=>({init:()=>{HROS.dock.getPos(()=>{HROS.dock.setPos()});HROS.dock.move();let dockShowtopFunc;$("#dock-container").on("mouseenter",()=>{dockShowtopFunc=setTimeout(()=>{$("#dock-container").addClass("showtop")},300)}).on("mouseleave",function(){clearInterval(dockShowtopFunc);$(this).removeClass("showtop")});$("body").on("contextmenu","#dock-container",e=>{HROS.popupMenu.hide();HROS.folderView.hide();HROS.searchbar.hide();HROS.startmenu.hide();let popupmenu=HROS.popupMenu.dock(),l=$(window).width()-e.clientX<popupmenu.width()?e.clientX-popupmenu.width():e.clientX,t=$(window).height()-e.clientY<popupmenu.height()?e.clientY-popupmenu.height():e.clientY;return popupmenu.css({left:l,top:t}).show(),!1});$("#dock-bar .dock-tool-setting").on("mousedown",()=>!1).on("click",()=>{HROS.base.checkLogin()?HROS.window.createTemp({appid:"hoorayos-zmsz",title:"桌面设置",url:"/Desk/ConfigDesk",width:750,height:450,isflash:!1}):HROS.base.login()});$("#dock-bar .dock-tool-style").on("mousedown",()=>!1).on("click",()=>{HROS.base.checkLogin()?HROS.window.createTemp({appid:"hoorayos-ztsz",title:"主题设置",url:"/Desk/SystemWallPaper",width:580,height:520,isflash:!1}):HROS.base.login()});$("#dock-bar .dock-tool-appmanage").on("mousedown",()=>!1).on("click",()=>{HROS.appmanage.set()});$("#dock-bar .dock-tool-search").on("mousedown",()=>!1).on("click",e=>{e.stopPropagation(),HROS.searchbar.get()});$("#dock-bar .pagination").on("mousedown",function(){return!1}).on("click",function(){HROS.dock.switchDesk($(this).attr("index"))});$("#dock-bar .dock-tool-start").on("mousedown",()=>!1).on("click",()=>(HROS.startmenu.show(),!1))},setPos:()=>{HROS.dock.switchDesk(HROS.CONFIG.desk);let desktop=$("#desk-"+HROS.CONFIG.desk),desktops=$("#desk .desktop-container"),deskW=desktop.css("width","100%").width(),deskH=desktop.css("height","100%").height();$("#dock-container").removeClass("dock-top dock-left dock-right");$("#dock-bar").removeClass("top-bar left-bar right-bar").hide();HROS.CONFIG.dockPos.toLowerCase()==="top"?($("#dock-bar").addClass("top-bar").children("#dock-container").addClass("dock-top"),desktops.css({width:deskW,height:deskH-$("#task-bar").height()-$("#dock-bar").height(),left:deskW,top:$("#dock-bar").height()}),desktop.css({left:0}),$("#dock-bar").show()):HROS.CONFIG.dockPos.toLowerCase()==="left"?($("#dock-bar").addClass("left-bar").children("#dock-container").addClass("dock-left"),desktops.css({width:deskW-$("#dock-bar").width(),height:deskH-$("#task-bar").height(),left:deskW+$("#dock-bar").width(),top:0}),desktop.css({left:$("#dock-bar").width()}),$("#dock-bar").show()):HROS.CONFIG.dockPos.toLowerCase()==="right"?($("#dock-bar").addClass("right-bar").children("#dock-container").addClass("dock-right"),desktops.css({width:deskW-$("#dock-bar").width(),height:deskH-$("#task-bar").height(),left:deskW,top:0}),desktop.css({left:0}),$("#dock-bar").show()):HROS.CONFIG.dockPos.toLowerCase()==="none"&&(desktops.css({width:deskW,height:deskH-$("#task-bar").height(),left:deskW,top:0}),desktop.css({left:0}));HROS.taskbar.resize();HROS.folderView.setPos()},updatePos:pos=>{typeof pos!="undefined"&&pos!==HROS.CONFIG.dockPos.toLowerCase()&&(HROS.CONFIG.dockPos=pos.toLowerCase(),pos==="none"&&HROS.app.dataAllDockToDesk(HROS.CONFIG.desk),HROS.base.checkLogin()&&HROS.request.post("/desk/modifydockposition",{Pos:pos,DeskNum:HROS.CONFIG.desk},responseText=>{responseText.IsSuccess?(NewCrm.success("应用码头位置更新成功"),HROS.dock.setPos(),HROS.app.set()):NewCrm.fail("应用码头位置更新失败")}))},move:()=>{$("#dock-container").on("mousedown",e=>{if(e.button===0||e.button===1){let lay=HROS.maskBox.dock(),location;$(document).on("mousemove",e=>{lay.show(),location=e.clientY<lay.height()*.2?"top":e.clientX<lay.width()*.5?"left":"right",$(".dock_drap_effect").removeClass("hover"),$(".dock_drap_effect_"+location).addClass("hover")}).on("mouseup",()=>{$(document).off("mousemove").off("mouseup"),lay.hide(),HROS.dock.updatePos(location)})}})},switchDesk:deskNumber=>{deskNumber=/^\+?[1-5]*$/.test(deskNumber)?deskNumber:1;let pagination=$("#dock-bar .dock-pagination"),currindex=HROS.CONFIG.desk,switchindex=deskNumber,currleft=$("#desk-"+currindex).offset().left,switchleft=$("#desk-"+switchindex).offset().left;currindex!==switchindex?$("#desk-"+switchindex).hasClass("animated")||$("#desk-"+currindex).hasClass("animated")||($("#desk-"+currindex).addClass("animated").animate({left:switchleft},500,"easeInOutCirc",function(){$(this).removeClass("animated")}),$("#desk-"+switchindex).addClass("animated").animate({left:currleft},500,"easeInOutCirc",function(){$(this).removeClass("animated");pagination.removeClass("current-pagination-"+currindex).addClass("current-pagination-"+switchindex);HROS.CONFIG.desk=switchindex})):pagination.removeClass("current-pagination-"+currindex).addClass("current-pagination-"+switchindex)},getPos:callback=>{HROS.request.get("/desk/getdockpos",{},responseText=>{responseText.IsSuccess&&(HROS.CONFIG.dockPos=responseText.Model.toLowerCase(),typeof callback=="function"&&callback&&callback())})}}))();HROS.folderView=(()=>({init:()=>{$("body").on("click",".quick_view_container",()=>{HROS.popupMenu.hide()}).on("click",".quick_view_container_open",function(){HROS.window.create($(this).parents(".quick_view_container").attr("appid"),"folder");HROS.folderView.hide()}).on("click",".appbtn",()=>{HROS.popupMenu.hide(),HROS.folderView.hide(),HROS.searchbar.hide(),HROS.startmenu.hide()});HROS.folderView.moveScrollbar()},get:obj=>{setTimeout(()=>{let iswindowopen=!1;$("body .quick_view_container").each(function(){if($(this).attr("realappid")===obj.attr("realappid"))return iswindowopen=!0,!1});let folderViewId=null;iswindowopen?folderViewId="#qv_"+obj.attr("appid"):HROS.folderView.hide();let sc="";$(HROS.VAR.folder).each(function(){if(this.memberId===parseInt(obj.attr("appid")))return sc=this.apps,!1});let folderViewHtml="",height=0;sc!==""?($(sc).each(function(){folderViewHtml+=appbtnTemp({title:this.name,type:this.type,id:"d_"+this.memberId,appid:this.memberId,realappid:this.appId===0?this.memberId:this.appId,imgsrc:this.icon})}),height+=sc.length%4==0?Math.floor(sc.length/4)*60:(Math.floor(sc.length/4)+1)*60):(folderViewHtml="文件夹为空",height+=30);let left,top;obj.parent("div").hasClass("dock-applist")?(left=parseInt(obj.attr("left"))+obj.width(),top=parseInt(obj.attr("top"))):(left=parseInt(obj.attr("left"))+obj.width(),top=parseInt(obj.attr("top"))-20);let isScrollbar=!1;if(height+top+44>$(window).height()){let outH=height+top+44-$(window).height();outH<=top?top-=outH:(height-=outH-top,top=0,isScrollbar=!0)}left+330>$(window).width()?(left-=330+obj.width(),iswindowopen?($(folderViewId+" .quick_view_container_list_in").html("").append(folderViewHtml),$(folderViewId).stop(!0,!1).animate({left:left,top:top},500),$(folderViewId+" .perfect_nine_m_l_t").stop(!0,!1).animate({top:0,height:Math.ceil((height+24)/2)},200),$(folderViewId+" .perfect_nine_m_l_m").stop(!0,!1).animate({top:Math.ceil((height+24)/2)},200).hide(),$(folderViewId+" .perfect_nine_m_l_b").stop(!0,!1).animate({top:Math.ceil((height+24)/2),height:Math.ceil((height+24)/2)+20},200),$(folderViewId+" .perfect_nine_m_r_t").stop(!0,!1).animate({top:0,height:obj.offset().top-top},200),$(folderViewId+" .perfect_nine_m_r_m").stop(!0,!1).animate({top:parseInt(obj.attr("top"))-top},200).show(),$(folderViewId+" .perfect_nine_m_r_b").stop(!0,!1).animate({top:parseInt(obj.attr("top"))-top+20,height:height+24-(parseInt(obj.attr("top"))-top)-0},200),$(folderViewId+" .quick_view_container_list_in").stop(!0,!1).animate({height:height},200)):$("body").append(folderViewTemp({id:"qv_"+obj.attr("appid"),appid:obj.attr("appid"),realappid:obj.attr("realappid"),apps:folderViewHtml,top:top,left:left,height:height,mlt:Math.ceil((height+24)/2),mlm:!1,mlb:Math.ceil((height+24)/2),mrt:obj.offset().top-top,mrm:!0,mrb:height+24-(obj.offset().top-top)-20}))):iswindowopen?($(folderViewId+" .quick_view_container_list_in").html("").append(folderViewHtml),$(folderViewId).stop(!0,!1).animate({left:left,top:top},500),$(folderViewId+" .perfect_nine_m_l_t").stop(!0,!1).animate({top:0,height:parseInt(obj.attr("top"))-top},200),$(folderViewId+" .perfect_nine_m_l_m").stop(!0,!1).animate({top:parseInt(obj.attr("top"))-top},200).show(),$(folderViewId+" .perfect_nine_m_l_b").stop(!0,!1).animate({top:parseInt(obj.attr("top"))-top+20,height:height+24-(parseInt(obj.attr("top"))-top)-20},200),$(folderViewId+" .perfect_nine_m_r_t").stop(!0,!1).animate({top:0,height:Math.ceil((height+24)/2)},200),$(folderViewId+" .perfect_nine_m_r_m").stop(!0,!1).animate({top:Math.ceil((height+24)/2)},200).hide(),$(folderViewId+" .perfect_nine_m_r_b").stop(!0,!1).animate({top:Math.ceil((height+24)/2),height:Math.ceil((height+24)/2)},200),$(folderViewId+" .quick_view_container_list_in").stop(!0,!1).animate({height:height},200)):$("body").append(folderViewTemp({id:"qv_"+obj.attr("appid"),appid:obj.attr("appid"),realappid:obj.attr("realappid"),apps:folderViewHtml,top:top,left:left,height:height,mlt:obj.offset().top-top,mlm:!0,mlb:height+24-(obj.offset().top-top)-20,mrt:Math.ceil((height+24)/2),mrm:!1,mrb:Math.ceil((height+24)/2)}));let view="#quick_view_container_list_in_"+obj.attr("appid"),scrollbar="#quick_view_container_list_"+obj.attr("appid")+" .scrollBar";$("#quick_view_container_list_"+obj.attr("appid")+" .scrollBar_bgc").hide();$(scrollbar).hide().height(0);isScrollbar&&($("#quick_view_container_list_"+obj.attr("appid")+" .scrollBar_bgc").show(),$(scrollbar).show().height($(view).height()/(Math.ceil($(view).children().length/4)*60)*$(view).height()))},0)},setPos:()=>{$("body .quick_view_container").each(function(){HROS.folderView.get($("#d_"+$(this).attr("appid")))})},moveScrollbar:()=>{$("body").on("mousedown",".quick_view_container .quick_view_container_list .scrollBar",function(e){let scrollbar=$(this),container=scrollbar.prev(".quick_view_container_list_in"),offsetTop=container.offset().top,y,cy,containerrealh,moveh;containerrealh=Math.ceil(container.children().length/4)*60;moveh=container.height()-scrollbar.height();y=e.clientY-scrollbar.offset().top;$(document).on("mousemove",e=>{cy=e.clientY-y-offsetTop<0?0:e.clientY-y-offsetTop>moveh?moveh:e.clientY-y-offsetTop,scrollbar.css("top",cy),container.scrollTop(cy/container.height()*containerrealh)}).on("mouseup",function(){$(this).off("mousemove").off("mouseup")})});$("body").on("mousewheel",".quick_view_container_list_in",function(event,delta){let desk=$(this),deskrealh=Math.ceil($(this).children().length/4)*60,scrollupdown;scrollupdown=delta<0?desk.scrollTop()+40>deskrealh-desk.height()?deskrealh-desk.height():desk.scrollTop()+40:desk.scrollTop()-40<0?0:desk.scrollTop()-40;desk.stop(!1,!0).animate({scrollTop:scrollupdown},300);$(this).next(".scrollBar").stop(!1,!0).animate({top:scrollupdown/deskrealh*desk.height()},300)})},hide:()=>{$(".quick_view_container").remove()}}))();HROS.grid=(()=>({getAppGrid:function(){let width=$("#desk-"+HROS.CONFIG.desk).width()-HROS.CONFIG.appButtonLeft,height=$("#desk-"+HROS.CONFIG.desk).height()-HROS.CONFIG.appButtonTop,top=HROS.CONFIG.appButtonTop,left=HROS.CONFIG.appButtonLeft,appGrid=[],offsetTop=HROS.CONFIG.appSize==="s"?80:100,offsetLeft=HROS.CONFIG.appSize==="s"?100:120;for(let i=0;i<1e4;i++)appGrid.push({startY:top,endY:top+offsetTop,startX:left,endX:left+offsetLeft}),HROS.CONFIG.appXY.toLowerCase()==="x"?(left+=offsetLeft,left+offsetLeft>width&&(top+=offsetTop,left=HROS.CONFIG.appButtonLeft)):(top+=offsetTop,top+offsetTop>height&&(top=HROS.CONFIG.appButtonTop,left+=offsetLeft));return appGrid},searchAppGrid:(x,y)=>{let grid=HROS.grid.getAppGrid(),flag=null;for(let i=0;i<grid.length;i++)if(x>=grid[i].startX&&x<=grid[i].endX&&y>=grid[i].startY&&y<=grid[i].endY){flag=i;break}return flag},searchAppGrid2:(x,y)=>{let grid=HROS.grid.getAppGrid(),grid2=[];for(let i=0;i<grid.length;i++){let height=grid[i].endY-grid[i].startY,width=grid[i].endX-grid[i].startX,halfH=height/2,halfW=width/2;HROS.CONFIG.appXY.toLowerCase()==="x"?grid2.push({startY:grid[i].startY,endY:grid[i].startY+height,startX:grid[i].startX,endX:grid[i].startX+halfW},{startY:grid[i].startY,endY:grid[i].startY+height,startX:grid[i].startX+halfW,endX:grid[i].endX}):grid2.push({startY:grid[i].startY,endY:grid[i].startY+halfH,startX:grid[i].startX,endX:grid[i].startX+width},{startY:grid[i].startY+halfH,endY:grid[i].endY,startX:grid[i].startX,endX:grid[i].startX+width})}let flag=null;for(let i=0;i<grid2.length;i++)if(x>=grid2[i].startX&&x<=grid2[i].endX&&y>=grid2[i].startY&&y<=grid2[i].endY){flag=i;break}return flag},getDockAppGrid:()=>{let height=$("#dock-bar .dock-applist").height(),dockAppGrid=[],top=0,left=0,offsetTop=68,offsetLeft=68;for(let i=0;i<7;i++)dockAppGrid.push({startY:top,endY:top+offsetTop,startX:left,endX:left+offsetLeft}),top+=offsetTop,top+offsetTop>height&&(top=0,left+=offsetLeft);return dockAppGrid},searchDockAppGrid:(x,y)=>{let grid=HROS.grid.getDockAppGrid(),flag=null;for(let i=0;i<grid.length;i++)if(x>=grid[i].startX&&x<=grid[i].endX&&y>=grid[i].startY&&y<=grid[i].endY){flag=i;break}return flag},searchDockAppGrid2:(x,y)=>{let grid=HROS.grid.getDockAppGrid(),grid2=[];for(let i=0;i<grid.length;i++){let height=grid[i].endY-grid[i].startY,width=grid[i].endX-grid[i].startX,halfH=height/2,halfW=width/2;HROS.CONFIG.dockPos.toLowerCase()==="top"?grid2.push({startY:grid[i].startY,endY:grid[i].startY+height,startX:grid[i].startX,endX:grid[i].startX+halfW},{startY:grid[i].startY,endY:grid[i].startY+height,startX:grid[i].startX+halfW,endX:grid[i].endX}):grid2.push({startY:grid[i].startY,endY:grid[i].startY+halfH,startX:grid[i].startX,endX:grid[i].startX+width},{startY:grid[i].startY+halfH,endY:grid[i].endY,startX:grid[i].startX,endX:grid[i].startX+width})}let flag=null;for(let i=0;i<grid2.length;i++)if(x>=grid2[i].startX&&x<=grid2[i].endX&&y>=grid2[i].startY&&y<=grid2[i].endY){flag=i;break}return flag},getFolderGrid:()=>{let folderGrid=[];return $(".quick_view_container, .folder-window:visible").each(function(){folderGrid.push({zIndex:$(this).css("z-index"),id:$(this).attr("appid"),startY:$(this).offset().top,endY:$(this).offset().top+$(this).height(),startX:$(this).offset().left,endX:$(this).offset().left+$(this).width()})}),folderGrid.sort((x,y)=>y.zIndex-x.zIndex),folderGrid},searchFolderGrid:(x,y)=>{let folderGrid=HROS.grid.getFolderGrid(),flag=null;for(let i=0;i<folderGrid.length;i++)if(x>=folderGrid[i].startX&&x<=folderGrid[i].endX&&y>=folderGrid[i].startY&&y<=folderGrid[i].endY){flag=folderGrid[i].id;break}return flag},getManageDockAppGrid:()=>{let manageDockAppGrid=[],left=20;for(let i=0;i<100;i++)manageDockAppGrid.push({startX:left,endX:left+70}),left+=70;return manageDockAppGrid},searchManageDockAppGrid:x=>{let grid=HROS.grid.getManageDockAppGrid(),flag=null;for(let i=0;i<grid.length;i++)if(x>=grid[i].startX&&x<=grid[i].endX){flag=i;break}return flag},searchManageDockAppGrid2:x=>{let grid=HROS.grid.getManageDockAppGrid(),grid2=[];for(let i=0;i<grid.length;i++){let width=grid[i].endX-grid[i].startX,halfW=width/2;grid2.push({startX:grid[i].startX,endX:grid[i].startX+halfW},{startX:grid[i].startX+halfW,endX:grid[i].endX})}let flag=null;for(let i=0;i<grid2.length;i++)if(x>=grid2[i].startX&&x<=grid2[i].endX){flag=i;break}return flag},getManageAppGrid:()=>{let manageAppGrid=[],top=0;for(let i=0;i<1e4;i++)manageAppGrid.push({startY:top,endY:top+40}),top+=40;return manageAppGrid},searchManageAppGrid:y=>{let grid=HROS.grid.getManageAppGrid(),flag=null;for(let i=0;i<grid.length;i++)if(y>=grid[i].startY&&y<=grid[i].endY){flag=i;break}return flag},searchManageAppGrid2:y=>{let grid=HROS.grid.getManageAppGrid(),grid2=[];for(let i=0;i<grid.length;i++){let height=grid[i].endY-grid[i].startY,width=grid[i].endX-grid[i].startX,halfH=height/2;grid2.push({startY:grid[i].startY,endY:grid[i].startY+halfH},{startY:grid[i].startY+halfH,endY:grid[i].endY})}let flag=null;for(let i=0;i<grid2.length;i++)if(y>=grid2[i].startY&&y<=grid2[i].endY){flag=i;break}return flag}}))();HROS.hotkey=(()=>({init:()=>{Mousetrap.bind(["backspace"],()=>!1),Mousetrap.bind(["alt+d"],()=>(HROS.window.hideAll(),!1)),Mousetrap.bind(["ctrl+up","command+up"],()=>(HROS.appmanage.set(),!1)),Mousetrap.bind(["ctrl+f","command+f"],()=>(HROS.searchbar.get(),!1)),Mousetrap.bind(["ctrl+1","command+1"],()=>(HROS.dock.switchDesk(1),!1)),Mousetrap.bind(["ctrl+2","command+2"],()=>(HROS.dock.switchDesk(2),!1)),Mousetrap.bind(["ctrl+3","command+3"],()=>(HROS.dock.switchDesk(3),!1)),Mousetrap.bind(["ctrl+4","command+4"],()=>(HROS.dock.switchDesk(4),!1)),Mousetrap.bind(["ctrl+5","command+5"],()=>(HROS.dock.switchDesk(5),!1)),Mousetrap.bind(["ctrl+left","command+left"],()=>(parseInt(HROS.CONFIG.desk)-1<1?HROS.dock.switchDesk(5):HROS.dock.switchDesk(parseInt(HROS.CONFIG.desk)-1),!1)),Mousetrap.bind(["ctrl+right","command+right"],()=>(parseInt(HROS.CONFIG.desk)+1>5?HROS.dock.switchDesk(1):HROS.dock.switchDesk(parseInt(HROS.CONFIG.desk)+1),!1)),Mousetrap.bind(["ctrl+l","command+l"],()=>(HROS.lock.show(),!1))}}))();HROS.lock=(()=>({state:"nolock",init:()=>{Mousetrap.bind(["space"],()=>($("#lock").click(),!1));$("body").on("click","#lock",()=>{$("#lock-info").is(":visible")?($("#lock .title").animate({top:"10%"},500),$("#lock .tip").animate({top:"80%"},500),$("#lock-info").fadeOut(),Mousetrap.bind(["space"],()=>($("#lock").click(),!1)),Mousetrap.unbind("esc")):($("#lock .title").animate({top:"-200px"},500),$("#lock .tip").animate({top:"100%"},500),$("#lock-info").fadeIn(),$("#lockpassword").val("").focus(),$("#lock-info .text-tip").text(""),Mousetrap.bind(["esc"],()=>($("#lock").click(),!1)),Mousetrap.unbind("space"))});$("body").on("click","#lock-info",()=>!1);$("body").on("click","#lockbtn",()=>{$("#lockpassword").val()!==""?HROS.request.post("/desk/unlockscreen",{unlockPassword:$("#lockpassword").val()},responseText=>{responseText.IsSuccess?HROS.lock.hide():($("#lockpassword").val("").focus(),$("#lock-info .text-tip").text("解锁密码错误"))}):$("#lock-info .text-tip").text("请输入解锁密码")});$("body").on("keydown","#lockpassword",e=>{e.keyCode==="13"&&$("#lockbtn").click()})},show:()=>{if($("#lock").length===0)if(HROS.base.checkLogin()){let lock=()=>{$("#desktop").hide();let userinfo=JSON.parse(HROS.cookie.get("User"));$("body").append(lockTemp({avatar:userinfo.UserFace,userinfoname:userinfo.Name}));let getTimeDateWeek=()=>{let time=new Date;$("#lock .time").text((time.getHours()<10?"0"+time.getHours():time.getHours())+":"+(time.getMinutes()<10?"0"+time.getMinutes():time.getMinutes()));let date=time.getFullYear()+"/"+(time.getMonth()+1)+"/"+time.getDate()+"，星期";switch(time.getDay()){case 1:date+="一";break;case 2:date+="二";break;case 3:date+="三";break;case 4:date+="四";break;case 5:date+="五";break;case 6:date+="六";break;default:date+="日"}$("#lock .week").text(date)};getTimeDateWeek();let lockFunc=setInterval(()=>{let iswarning=!1;$("#desktop").is(":visible")&&(iswarning=!0);$("#lock").length===0&&(iswarning=!0);$("#lock").is(":hidden")&&(iswarning=!0);iswarning&&(clearInterval(lockFunc),$("#lock").remove(),HROS.lock.show());getTimeDateWeek()},1e3)};parseInt(HROS.CONFIG.lockPwdAndLoginPwd)?$.dialog({title:"温馨提示",icon:"warning",content:"解锁密码默认为登录密码，是否要先进行修改？",button:[{name:"继续锁定",callback:()=>{lock()},focus:!0},{name:"修改解锁密码",callback:()=>{HROS.window.createTemp({appid:"zhsz",title:"账号设置",url:"/usersetting/index?target=usersafe",width:550,height:580})}}]}):lock()}else $.dialog({title:"温馨提示",icon:"warning",content:"锁定功能需要登录后才能使用,为了更好的操作,是否登录?",ok:()=>{HROS.base.login()}})},hide:()=>{clearInterval(lockFunc),$("#lock").remove(),$("#desktop").show()}}))();HROS.maskBox=(()=>({desk:()=>(TEMP.maskBoxDesk||(TEMP.maskBoxDesk=$('<div id="maskbox"><\/div>'),$("body").append(TEMP.maskBoxDesk)),TEMP.maskBoxDesk),dock:()=>(TEMP.maskBoxDock||(TEMP.maskBoxDock=$('<div id="maskbox-dockdrap"><div id="docktop" class="dock_drap_effect dock_drap_effect_top"><\/div><div id="dockleft" class="dock_drap_effect dock_drap_effect_left"><\/div><div id="dockright" class="dock_drap_effect dock_drap_effect_right"><\/div><div id="dockmask" class="dock_drap_mask"><div class="dock_drop_region_top"><div class="text">拖放至顶部<\/div><\/div><div class="dock_drop_region_left"><div class="text">拖放至左侧<\/div><\/div><div class="dock_drop_region_right"><div class="text">拖放至右侧<\/div><\/div><\/div><\/div>'),$("body").append(TEMP.maskBoxDock)),TEMP.maskBoxDock),copyright:()=>(TEMP.maskBoxCopyright||(TEMP.maskBoxCopyright=$('<div id="maskbox-copyright"><\/div>'),$("body").append(TEMP.maskBoxCopyright)),TEMP.maskBoxCopyright)}))();HROS.popupMenu=(()=>({init:()=>{$(".popup-menu").on("contextmenu",()=>!1);$("body").on("mouseenter",".popup-menu li",function(){$(this).children(".popup-menu").length===1&&($(this).children("a").addClass("focus"),$(this).children(".popup-menu").show(),$(this).parents(".popup-menu").offset().left+$(this).parents(".popup-menu").width()*2+10<$(window).width()?$(this).children(".popup-menu").css({left:$(this).parents(".popup-menu").width()-5,top:0}):$(this).children(".popup-menu").css({left:-1*$(this).parents(".popup-menu").width(),top:0}),$(this).children(".popup-menu").offset().top+$(this).children(".popup-menu").height()+10>$(window).height()&&$(this).children(".popup-menu").css({top:$(window).height()-$(this).children(".popup-menu").height()-$(this).children(".popup-menu").offset().top-10}))}).on("mouseleave",".popup-menu li",function(){$(this).children("a").removeClass("focus");$(this).children(".popup-menu").hide()})},app:obj=>{if(HROS.window.show2under(),!TEMP.popupMenuApp){let internalHtml="";internalHtml+='<div class="popup-menu app-menu"><ul>';internalHtml+='<li style="border-bottom:1px solid #F0F0F0"><a menu="open" href="###">打开<\/a><\/li>';internalHtml+="<li>";internalHtml+='<a menu="move" href="###">移动到<b class="arrow">»<\/b><\/a>';internalHtml+='<div class="popup-menu"><ul>';for(let i=1;i<=HROS.CONFIG.deskCount;i++)internalHtml+='<li><a menu="moveto" desk="'+i+'" href="###">桌面'+i+"<\/a><\/li>";internalHtml+="<\/ul><\/div>";internalHtml+="<\/li>";internalHtml+='<li><a menu="edit" href="###"><b class="edit"><\/b>编辑<\/a><\/li>';internalHtml+='<li><a menu="del" href="###"><b class="uninstall"><\/b>卸载<\/a><\/li>';internalHtml+="<\/ul><\/div>";TEMP.popupMenuApp=$(internalHtml);$("body").append(TEMP.popupMenuApp)}$('.app-menu a[menu="moveto"]').removeClass("disabled");obj.parent().hasClass("desktop-apps-container")&&$('.app-menu a[menu="moveto"]').each(function(){$(this).attr("desk")===HROS.CONFIG.desk&&$(this).addClass("disabled")});$('.app-menu a[menu="moveto"]').off("click").on("click",function(){let id=obj.attr("appid"),from=obj.index(),to=99999,todesk=$(this).attr("desk"),fromdesk=HROS.CONFIG.desk,fromfolderid=obj.parents(".folder-window").attr("appid")||obj.parents(".quick_view_container").attr("appid");if(HROS.base.checkLogin()){if(!HROS.app.checkIsMoving())obj.parent().hasClass("dock-applist")?HROS.app.dataDockToOtherdesk(id,from,todesk)&&HROS.request.post("/desk/membermove",{model:{MoveType:"desk-desk",MemberId:id,From:from,To:todesk}},responseText=>{responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.fail(responseText.Message)}):obj.parent().hasClass("desktop-apps-container")?HROS.app.dataDeskToOtherdesk(id,from,to,"a",todesk,fromdesk)&&HROS.request.post("/desk/membermove",{model:{MoveType:"desk-desk",MemberId:id,From:from,To:todesk}},responseText=>{responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.fail(responseText.Message)}):HROS.app.dataFolderToOtherdesk(id,from,todesk,fromfolderid)&&HROS.request.post("/desk/membermove",{model:{MoveType:"folder-desk",MemberId:id,From:from,To:todesk}},responseText=>{responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.fail(responseText.Message)})}else obj.parent().hasClass("dock-applist")?HROS.app.dataDockToOtherdesk(id,from,todesk):obj.parent().hasClass("desktop-apps-container")?HROS.app.dataDeskToOtherdesk(id,from,to,"a",todesk,fromdesk):HROS.app.dataFolderToOtherdesk(id,from,todesk,fromfolderid);$(".popup-menu").hide()});$('.app-menu a[menu="open"]').off("click").on("click",()=>{HROS.window.create(obj.attr("realappid"),obj.attr("type")),$(".popup-menu").hide()});$('.app-menu a[menu="edit"]').off("click").on("click",()=>{HROS.base.checkLogin()?$.dialog.open("/desk/configmember?memberId="+obj.attr("realappid"),{id:"editdialog",title:"编辑应用“"+obj.children("span").text()+"”",width:600,height:350}):HROS.base.login(),$(".popup-menu").hide()});$('.app-menu a[menu="del"]').off("click").on("click",()=>{HROS.app.dataDeleteByAppid(obj.attr("appid")),HROS.widget.removeCookie(obj.attr("realappid"),obj.attr("type")),HROS.app.remove(obj.attr("appid"),()=>{obj.find("img, span").show().animate({opacity:"toggle",width:0,height:0},500,()=>{obj.remove(),HROS.deskTop.resize()})}),$(".popup-menu").hide()});return TEMP.popupMenuApp},papp:obj=>{if(HROS.window.show2under(),!TEMP.popupMenuPapp){let internalHtml="";internalHtml+='<div class="popup-menu papp-menu"><ul>';internalHtml+='<li style="border-bottom:1px solid #F0F0F0"><a menu="open" href="###">打开<\/a><\/li>';internalHtml+="<li>";internalHtml+='<a menu="move" href="###">移动到<b class="arrow">»<\/b><\/a>';internalHtml+='<div class="popup-menu"><ul>';for(let i=1;i<=HROS.CONFIG.deskCount;i++)internalHtml+='<li><a menu="moveto" desk="'+i+'" href="###">桌面'+i+"<\/a><\/li>";internalHtml+="<\/ul><\/div>";internalHtml+="<\/li>";internalHtml+='<li><a menu="edit" href="###"><b class="edit"><\/b>编辑<\/a><\/li>';internalHtml+='<li><a menu="del" href="###"><b class="del"><\/b>删除<\/a><\/li>';internalHtml+="<\/ul><\/div>";TEMP.popupMenuPapp=$(internalHtml);$("body").append(TEMP.popupMenuPapp)}$('.papp-menu a[menu="moveto"]').removeClass("disabled");obj.parent().hasClass("desktop-apps-container")&&$('.papp-menu a[menu="moveto"]').each(function(){$(this).attr("desk")===HROS.CONFIG.desk&&$(this).addClass("disabled")});$('.papp-menu a[menu="moveto"]').off("click").on("click",function(){let id=obj.attr("appid"),from=obj.index(),to=99999,todesk=$(this).attr("desk"),fromdesk=HROS.CONFIG.desk,fromfolderid=obj.parents(".folder-window").attr("appid")||obj.parents(".quick_view_container").attr("appid");if(HROS.base.checkLogin())obj.parent().hasClass("dock-applist")?HROS.app.dataDockToOtherdesk(id,from,todesk)&&HROS.request.post("/desk/membermove",{model:{MoveType:"dock-otherdesk",MemberId:id,From:from,To:todesk}},responseText=>{responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.fail(responseText.Message)}):obj.parent().hasClass("desktop-apps-container")?HROS.app.dataDeskToOtherdesk(id,from,to,"a",todesk,fromdesk)&&HROS.request.post("/desk/membermove",{model:{MoveType:"desk-desk",MemberId:id,Trom:from,To:todesk}},responseText=>{responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.fail(responseText.Message)}):HROS.app.dataFolderToOtherdesk(id,from,todesk,fromfolderid);else obj.parent().hasClass("dock-applist")?HROS.app.dataDockToOtherdesk(id,from,todesk):obj.parent().hasClass("desktop-apps-container")?HROS.app.dataDeskToOtherdesk(id,from,to,"a",todesk,fromdesk):HROS.app.dataFolderToOtherdesk(id,from,todesk,fromfolderid);$(".popup-menu").hide()});$('.papp-menu a[menu="open"]').off("click").on("click",()=>{switch(obj.attr("type")){case"papp":HROS.window.create(obj.attr("realappid"),obj.attr("type"));break;case"pwidget":HROS.widget.create(obj.attr("realappid"),obj.attr("type"))}$(".popup-menu").hide()});$('.papp-menu a[menu="edit"]').off("click").on("click",()=>{HROS.base.checkLogin()?NewCrm.info("正在开发中...."):HROS.base.login(),$(".popup-menu").hide()});$('.papp-menu a[menu="del"]').off("click").on("click",()=>{HROS.app.dataDeleteByAppid(obj.attr("appid")),HROS.widget.removeCookie(obj.attr("realappid"),obj.attr("type")),HROS.app.remove(obj.attr("appid"),()=>{obj.find("img, span").show().animate({opacity:"toggle",width:0,height:0},500,()=>{obj.remove(),HROS.deskTop.resize()})}),$(".popup-menu").hide()});return TEMP.popupMenuPapp},folder:obj=>{if(HROS.window.show2under(),!TEMP.popupMenuFolder){let internalHtml="";internalHtml+='<div class="popup-menu folder-menu"><ul><li><a menu="view" href="###">预览<\/a><\/li>';internalHtml+='<li style="border-bottom:1px solid #F0F0F0"><a menu="open" href="###">打开<\/a><\/li>';internalHtml+="<li>";internalHtml+='<a menu="move" href="###">移动到<b class="arrow">»<\/b><\/a>';internalHtml+='<div class="popup-menu"><ul>';for(let i=1;i<=HROS.CONFIG.deskCount;i++)internalHtml+='<li><a menu="moveto" desk="'+i+'" href="###">桌面'+i+"<\/a><\/li>";internalHtml+="<\/ul><\/div>";internalHtml+="<\/li>";internalHtml+='<li><a menu="rename" href="###"><b class="edit"><\/b>重命名<\/a><\/li>';internalHtml+='<li><a menu="del" href="###"><b class="del"><\/b>删除<\/a><\/li>';internalHtml+="<\/ul><\/div>";TEMP.popupMenuFolder=$(internalHtml);$("body").append(TEMP.popupMenuFolder)}$('.folder-menu a[menu="moveto"]').removeClass("disabled");obj.parent().hasClass("desktop-apps-container")&&$('.folder-menu a[menu="moveto"]').each(function(){$(this).attr("desk")===HROS.CONFIG.desk&&$(this).addClass("disabled")});$('.folder-menu a[menu="view"]').off("click").on("click",()=>{HROS.folderView.get(obj),$(".popup-menu").hide()});$('.folder-menu a[menu="open"]').off("click").on("click",()=>{HROS.window.create(obj.attr("realappid"),obj.attr("type")),$(".popup-menu").hide()});$('.folder-menu a[menu="moveto"]').off("click").on("click",function(){let id=obj.attr("appid"),from=obj.index(),to=99999,todesk=$(this).attr("desk"),fromdesk=HROS.CONFIG.desk,fromfolderid=obj.parents(".folder-window").attr("appid")||obj.parents(".quick_view_container").attr("appid");if(HROS.base.checkLogin())obj.parent().hasClass("dock-applist")?HROS.app.dataDockToOtherdesk(id,from,todesk)&&HROS.request.post("/desk/membermove",{model:{MoveType:"dock-otherdesk",MemberId:id,From:from,To:todesk}},responseText=>{responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.fail(responseText.Message)}):obj.parent().hasClass("desktop-apps-container")?HROS.app.dataDeskToOtherdesk(id,from,to,"a",todesk,fromdesk)&&HROS.request.post("/desk/membermove",{model:{MoveType:"desk-desk",MemberId:id,From:from,To:todesk}},responseText=>{responseText.IsSuccess?HROS.VAR.isAppMoving=!1:NewCrm.fail(responseText.Message)}):HROS.app.dataFolderToOtherdesk(id,from,todesk,fromfolderid);else obj.parent().hasClass("dock-applist")?HROS.app.dataDockToOtherdesk(id,from,todesk):obj.parent().hasClass("desktop-apps-container")?HROS.app.dataDeskToOtherdesk(id,from,to,"a",todesk,fromdesk):HROS.app.dataFolderToOtherdesk(id,from,todesk,fromfolderid);$(".popup-menu").hide()});$('.folder-menu a[menu="rename"]').off("click").on("click",()=>{if(HROS.base.checkLogin()){$.dialog({id:"addfolder",title:"重命名“"+obj.find("span").text()+"”文件夹",padding:0,content:editFolderDialogTemp({name:obj.find("span").text(),src:obj.find("img").attr("src")}),ok:()=>{if($("#folderName").val()!=="")HROS.request.post("/desk/modifyfolderinfo",{name:$("#folderName").val(),icon:$(".folderSelector img").attr("src"),memberId:parseInt(obj.attr("appid"))},responseText=>{responseText.IsSuccess&&HROS.app.get()});else return $(".folderNameError").show(),!1},cancel:!0});$(".folderSelector").off("click").on("click",()=>{$(".fcDropdown").show()});$(".fcDropdown_item").off("click").on("click",function(){$(".folderSelector img").attr("src",$(this).children("img").attr("src")).attr("idx",$(this).children("img").attr("idx"));$(".fcDropdown").hide()})}else HROS.base.login();$(".popup-menu").hide()});$('.folder-menu a[menu="del"]').off("click").on("click",()=>{$.dialog({id:"delfolder",title:"删除“"+obj.find("span").text()+"”文件夹",content:"删除文件夹会将文件夹内的应用移出到桌面",icon:"warning",ok:()=>{HROS.app.remove(obj.attr("appid"),()=>{HROS.app.dataDeleteByAppid(obj.attr("appid")),obj.find("img, span").show().animate({opacity:"toggle",width:0,height:0},500,()=>{obj.remove(),HROS.deskTop.resize()})})},cancel:!0}),$(".popup-menu").hide()});return TEMP.popupMenuFolder},file:obj=>{HROS.window.show2under();TEMP.popupMenuFile||(TEMP.popupMenuFile=$('<div class="popup-menu file-menu"><ul><li style="border-bottom:1px solid #F0F0F0"><a menu="download" href="###">下载<\/a><\/li><li><a menu="del" href="###"><b class="del"><\/b>删除<\/a><\/li><\/ul><\/div>'),$("body").append(TEMP.popupMenuFile));$('.file-menu a[menu="download"]').off("click").on("click",()=>{$("body").append(fileDownloadTemp({appid:obj.attr("appid")})),$(".popup-menu").hide()});$('.file-menu a[menu="del"]').off("click").on("click",()=>{HROS.app.dataDeleteByAppid(obj.attr("appid")),HROS.app.remove(obj.attr("appid"),()=>{obj.find("img, span").show().animate({opacity:"toggle",width:0,height:0},500,()=>{obj.remove(),HROS.deskTop.resize()})}),$(".popup-menu").hide()});return TEMP.popupMenuFile},dock:()=>{if(HROS.window.show2under(),!TEMP.popupMenuDock){TEMP.popupMenuDock=$('<div class="popup-menu dock-menu"><ul><li><a menu="dockPos" pos="top" href="###"><b class="hook"><\/b>向上停靠<\/a><\/li><li><a menu="dockPos" pos="left" href="###"><b class="hook"><\/b>向左停靠<\/a><\/li><li><a menu="dockPos" pos="right" href="###"><b class="hook"><\/b>向右停靠<\/a><\/li><li><a menu="dockPos" pos="none" href="###">隐藏<\/a><\/li><\/ul><\/div>');$("body").append(TEMP.popupMenuDock);$('.dock-menu a[menu="dockPos"]').on("click",function(){$(this).attr("pos")==="none"?$.dialog({title:"温馨提示",icon:"warning",content:"<p>如果应用码头存在应用，隐藏后会将应用转移到当前桌面。<\/p><p>若需要再次开启，可在桌面空白处点击右键，进入「 桌面设置 」里开启。<\/p>",ok:()=>{HROS.dock.updatePos("none")},cancel:!0}):HROS.dock.updatePos($(this).attr("pos"));$(".popup-menu").hide()})}return $('.dock-menu a[menu="dockPos"]').each(function(){$(this).children(".hook").hide();$(this).attr("pos")===HROS.CONFIG.dockPos.toLowerCase()&&$(this).children(".hook").show();$(".popup-menu").hide()}),TEMP.popupMenuDock},task:obj=>{HROS.window.show2under();TEMP.popupMenuTask||(TEMP.popupMenuTask=$('<div class="popup-menu task-menu"><ul><li><a menu="max" href="###">最大化<\/a><\/li><li style="border-bottom:1px solid #F0F0F0"><a menu="hide" href="###">最小化<\/a><\/li><li><a menu="close" href="###">关闭<\/a><\/li><\/ul><\/div>'),$("body").append(TEMP.popupMenuTask));$('.task-menu a[menu="max"]').off("click").on("click",()=>{HROS.window.max(obj.attr("appid"),obj.attr("type")),$(".popup-menu").hide()});$('.task-menu a[menu="hide"]').off("click").on("click",()=>{HROS.window.hide(obj.attr("appid"),obj.attr("type")),$(".popup-menu").hide()});$('.task-menu a[menu="close"]').off("click").on("click",()=>{HROS.window.close(obj.attr("appid"),obj.attr("type")),$(".popup-menu").hide()});return TEMP.popupMenuTask},desk:()=>{if(HROS.window.show2under(),!TEMP.popupMenuDesk){TEMP.popupMenuDesk=$('<div class="popup-menu desk-menu"><ul><li><a menu="hideall" href="###">显示桌面<\/a><\/li><li style="border-bottom:1px solid #F0F0F0"><a menu="closeall" href="###">关闭所有窗口<\/a><\/li><li><a href="###">新建<b class="arrow">»<\/b><\/a><div class="popup-menu"><ul><li><a menu="addfolder" href="###"><b class="folder"><\/b>新建文件夹<\/a><\/li><li><a menu="addpapp" href="###"><b class="customapp"><\/b>新建私人应用<\/a><\/li><\/ul><\/div><\/li><li style="border-bottom:1px solid #F0F0F0"><b class="upload"><\/b><a menu="uploadfile" href="###">上传文件<\/a><\/li><li><a menu="themes" href="###"><b class="themes"><\/b>主题设置<\/a><\/li><li><a menu="setting" href="###"><b class="setting"><\/b>桌面设置<\/a><\/li><li style="border-bottom:1px solid #F0F0F0"><a href="###">图标设置<b class="arrow">»<\/b><\/a><div class="popup-menu"><ul><li><a href="###">排列<b class="arrow">»<\/b><\/a><div class="popup-menu"><ul><li><a menu="orderby" orderby="x" href="###"><b class="hook"><\/b>横向排列<\/a><\/li><li><a menu="orderby" orderby="y" href="###"><b class="hook"><\/b>纵向排列<\/a><\/li><\/ul><\/div><\/li><li><a href="###">尺寸<b class="arrow">»<\/b><\/a><div class="popup-menu"><ul><li><a menu="size" size="32" href="###"><b class="hook"><\/b>小图标<\/a><\/li><li><a menu="size" size="48" href="###"><b class="hook"><\/b>常规图标<\/a><\/li><li><a menu="size" size="64" href="###"><b class="hook"><\/b>大图标<\/a><\/li><\/ul><\/div><\/li><\/ul><\/div><\/li><li><a menu="lock" href="###">锁定<\/a><\/li><li><a menu="logout" href="###">注销<\/a><\/li><\/ul><\/div>');$("body").append(TEMP.popupMenuDesk);HROS.base.checkLogin()||$('body .desk-menu li a[menu="logout"]').parent().remove();$('.desk-menu a[menu="orderby"]').on("click",function(){HROS.app.updateXY($(this).attr("orderby"));$(".popup-menu").hide()});$('.desk-menu a[menu="size"]').on("click",function(){HROS.app.updateSize($(this).attr("size"));$(".popup-menu").hide()});$('.desk-menu a[menu="hideall"]').on("click",()=>{HROS.window.hideAll(),$(".popup-menu").hide()});$('.desk-menu a[menu="closeall"]').on("click",()=>{HROS.window.closeAll(),$(".popup-menu").hide()});$('.desk-menu a[menu="addfolder"]').on("click",()=>{if(HROS.base.checkLogin()){$.dialog({id:"addfolder",title:"新建文件夹",padding:0,content:editFolderDialogTemp({name:"新建文件夹",src:"/images/ui/folder_default.png"}),ok:()=>{if($("#folderName").val()!=="")HROS.request.post("/desk/createfolder",{FolderName:$("#folderName").val(),FolderImg:$(".folderSelector img").attr("src"),DeskId:HROS.CONFIG.desk},()=>{HROS.app.get()});else return $(".folderNameError").show(),!1},cancel:!0});$(".folderSelector").on("click",()=>($("#addfolder .fcDropdown").show(),!1));$(document).click(()=>{$("#addfolder .fcDropdown").hide()});$(".fcDropdown_item").on("click",function(){$(".folderSelector img").attr("src",$(this).children("img").attr("src")).attr("idx",$(this).children("img").attr("idx"));$("#addfolder .fcDropdown").hide()})}else HROS.base.login();$(".popup-menu").hide()});$('.desk-menu a[menu="addpapp"]').on("click",()=>{HROS.base.checkLogin()?NewCrm.info("正在开发中...."):HROS.base.login(),$(".popup-menu").hide()});$('.desk-menu a[menu="uploadfile"]').on("click",()=>{NewCrm.info("正在开发中...."),$(".popup-menu").hide()});$('.desk-menu a[menu="themes"]').on("click",()=>{HROS.base.checkLogin()?HROS.window.createTemp({appid:"hoorayos-ztsz",title:"主题设置",url:"/Desk/SystemWallPaper",width:580,height:520,isflash:!1}):HROS.base.login(),$(".popup-menu").hide()});$('.desk-menu a[menu="setting"]').on("click",()=>{HROS.base.checkLogin()?HROS.window.createTemp({appid:"hoorayos-zmsz",title:"桌面设置",url:"/Desk/ConfigDesk",width:750,height:450,isflash:!1}):HROS.base.login(),$(".popup-menu").hide()});$('.desk-menu a[menu="lock"]').on("click",()=>{HROS.lock.show(),$(".popup-menu").hide()});$('.desk-menu a[menu="logout"]').on("click",()=>{HROS.base.logout(),$(".popup-menu").hide()})}return $('.desk-menu a[menu="orderby"]').each(function(){$(this).children(".hook").hide();$(this).attr("orderby")===HROS.CONFIG.appXY.toLowerCase()&&$(this).children(".hook").show();$(".popup-menu").hide()}),$('.desk-menu a[menu="size"]').each(function(){$(this).children(".hook").hide();$(this).attr("size")===HROS.CONFIG.appSize&&$(this).children(".hook").show();$(".popup-menu").hide()}),TEMP.popupMenuDesk},hide:()=>{$(".popup-menu").hide()}}))();HROS.searchbar=(()=>({init:()=>{$("#pageletSearchInput").on("click",()=>!1);$("#search-suggest .resultBox").on("click","li",function(){switch($(this).attr("type")){case"window":HROS.window.create($(this).attr("realappid"),$(this).attr("type"));break;case"widget":HROS.widget.create($(this).attr("realappid"),$(this).attr("type"))}});$("#search-suggest .openAppMarket a, #pageletSearchButton").on("click",()=>{HROS.searchbar.openAppMarket($("#pageletSearchInput").val())});$("#pageletSearchInput").on("keydown",function(e){e.keyCode==="13"&&($("#search-suggest .resultBox .resultList a.selected").length===0&&$("#search-suggest > .resultList a.selected").length===0?HROS.searchbar.openAppMarket($(this).val()):$("#search-suggest .resultList a.selected").click())})},get:()=>{let oldSearchVal="";var searchFunc=setInterval(()=>{let searchVal=$("#pageletSearchInput").val();searchVal!==""?($("#search-suggest").show(),searchVal!==oldSearchVal&&(oldSearchVal=searchVal,HROS.searchbar.getSuggest(searchVal)),$("#search-bar").removeClass("above").addClass("above")):($("#search-suggest").hide(),$("#search-bar").removeClass("above"))},1e3);HROS.searchbar.set();Mousetrap.bind(["up"],()=>{if($("#search-suggest .resultBox .resultList a.selected").length===0&&$("#search-suggest > .resultList a.selected").length===0)$("#search-suggest > .resultList:last a").addClass("selected");else if($("#search-suggest .resultBox .resultList:first a").hasClass("selected"))$("#search-suggest .resultList a").removeClass("selected");else if($("#search-suggest > .resultList a.selected").length!==0){let i=$("#search-suggest > .resultList a.selected").parent(".resultList").index();$("#search-suggest .resultList a").removeClass("selected");i>1?$("#search-suggest > .resultList:eq("+(i-1)+") a").addClass("selected"):$("#search-suggest .resultBox .resultList:last a").addClass("selected")}else{let i=$("#search-suggest .resultBox .resultList a.selected").parent(".resultList").index();$("#search-suggest .resultList a").removeClass("selected");i>0&&$("#search-suggest .resultBox .resultList:eq("+(i-1)+") a").addClass("selected")}return!1});Mousetrap.bind(["down"],()=>{if($("#search-suggest .resultBox .resultList a.selected").length===0&&$("#search-suggest > .resultList a.selected").length===0)$("#search-suggest .resultBox .resultList").length===0?$("#search-suggest > .resultList:first a").addClass("selected"):$("#search-suggest .resultBox .resultList:first a").addClass("selected");else if($("#search-suggest > .resultList:last a").hasClass("selected"))$("#search-suggest .resultList a").removeClass("selected");else if($("#search-suggest .resultBox .resultList a.selected").length!==0){let i=$("#search-suggest .resultBox .resultList a.selected").parent(".resultList").index();$("#search-suggest .resultList a").removeClass("selected");i<$("#search-suggest .resultBox .resultList").length-1?$("#search-suggest .resultBox .resultList:eq("+(i+1)+") a").addClass("selected"):$("#search-suggest > .resultList:first a").addClass("selected")}else{let i=$("#search-suggest > .resultList a.selected").parent(".resultList").index();$("#search-suggest .resultList a").removeClass("selected");i<$("#search-suggest > .resultList").length-1?$("#search-suggest > .resultList:eq("+(i+1)+") a").addClass("selected"):$("#search-suggest .resultBox .resultList:first a").addClass("selected")}return!1});Mousetrap.bind(["backspace"],()=>{})},set:()=>{$("#search-bar").show(),$("#search-suggest .resultList a").removeClass("selected"),$("#pageletSearchInput").focus()},getSuggest:val=>{let apps=[];$(HROS.VAR.dock).each(function(){$.inArray(this.type,["window","widget"])>=0&&apps.push(this)});for(let i=1;i<=5;i++){let desk=eval("HROS.VAR.desk"+i);$(desk).each(function(){$.inArray(this.type,["window","widget"])>=0&&apps.push(this)})}$(HROS.VAR.folder).each(function(){$(this.apps).each(()=>{$.inArray(this.type,["window","widget"])>=0&&apps.push(this)})});let suggest="";$(apps).each(function(){this.name.indexOf(val)>=0&&(suggest+=suggestTemp({name:this.name,appid:this.appid,realappid:this.realappid,type:this.type}))});$("#search-suggest .resultBox").html(suggest);suggest===""?$("#search-suggest .resultBox").hide():$("#search-suggest .resultBox").show();HROS.searchbar.set()},openAppMarket:searchkey=>{searchkey!==""&&HROS.window.createTemp({appid:"hoorayos-yysc",title:"大资本市场",url:"/AppMarket/Index?searchText="+searchkey,width:800,height:484,isflash:!1,refresh:!0}),HROS.searchbar.hide()},hide:()=>{typeof searchFunc!="undefined"&&clearInterval(searchFunc),$("#search-bar").removeClass("above"),$("#search-bar, #search-suggest").hide(),$("#pageletSearchInput").val(""),$("#search-suggest .resultBox").html(""),Mousetrap.unbind(["up","down"])}}))();HROS.startmenu=(()=>({init:()=>{$("#startmenu-container").on("mousedown",e=>{e.preventDefault()});$("#startmenu-container .startmenu-nick a, #startmenu-container .startmenu-avatar img").on("click",()=>{HROS.startmenu.openUser()});$("#startmenu-container .startmenu-exit a").on("click",()=>{HROS.base.logout()});$("#startmenu-container .startmenu-lock").on("click",()=>{HROS.lock.show()});$("#startmenu-container .startmenu-feedback").on("click",()=>{HROS.window.createTemp({appid:"hoorayos-feedback",title:"反馈",url:"about:blank",width:700,height:500,isflash:!1})});$("#startmenu-container .startmenu a").on("click",function(){switch($(this).attr("class")){case"help":HROS.base.help();break;case"about":HROS.copyright.show()}})},getAvatar:()=>{HROS.request.get("/desk/getuserface",{},responseText=>{responseText.IsSuccess&&$("#startmenu-container .startmenu-avatar img").attr("src",responseText.Model)})},openUser:()=>{HROS.CONFIG.memberID!==0?HROS.window.createTemp({appid:"zhsz",title:"账号设置",url:"/usersetting/index",width:800,height:600}):HROS.base.login()},show:()=>{HROS.popupMenu.hide();HROS.folderView.hide();HROS.searchbar.hide();$("#startmenu-container").css({top:"auto",left:"auto",right:"auto",bottom:"auto"}).show();switch(HROS.CONFIG.dockPos.toLowerCase()){case"top":$("#startmenu-container").css({top:$("#dock-container").height()-1,right:$("#dock-container").offset().left});break;case"left":$("#startmenu-container").css({bottom:$("#dock-container").offset().top,left:$("#dock-container").width()-1});break;case"right":$("#startmenu-container").css({bottom:$("#dock-container").offset().top,right:$("#dock-container").width()-1})}},hide:()=>{$("#startmenu-container").hide()}}))();HROS.copyright=(()=>({init:()=>{$("#copyright .close").on("click",()=>{HROS.copyright.hide()})},show:()=>{var mask=HROS.maskBox.copyright();mask.show();$("#copyright").show()},hide:()=>{var mask=HROS.maskBox.copyright();mask.hide();$("#copyright").hide()}}))();HROS.taskbar=(()=>({init:()=>{$(window).on("resize",()=>{HROS.taskbar.resize()});HROS.taskbar.click();HROS.taskbar.pageClick()},click:()=>{$("#task-content-inner").on("click","a.task-item",function(){$(this).hasClass("task-item-current")?HROS.window.hide($(this).attr("appid")):HROS.window.show2top($(this).attr("appid"))}).on("contextmenu","a.task-item",function(e){$(".popup-menu").hide();$(".quick_view_container").remove();let popupmenu=HROS.popupMenu.task($(this)),l=$(window).width()-e.clientX<popupmenu.width()?e.clientX-popupmenu.width():e.clientX,t=e.clientY-popupmenu.height();return popupmenu.css({left:l,top:t}).show(),!1})},pageClick:()=>{$("#task-next-btn").on("click",function(){if($(this).hasClass("disable")===!1){let w=$("#task-bar").width(),realW=$("#task-content-inner .task-item").length*114,showW=w-112,overW=realW-showW,marginL=parseInt($("#task-content-inner").css("margin-left"))-114;marginL<=overW*-1&&(marginL=overW*-1,$("#task-next a").addClass("disable"));$("#task-pre a").removeClass("disable");$("#task-content-inner").animate({marginLeft:marginL},200)}});$("#task-pre-btn").on("click",function(){if(!$(this).hasClass("disable")){let marginL=parseInt($("#task-content-inner").css("margin-left"))+114;marginL>=0&&(marginL=0,$("#task-pre a").addClass("disable"));$("#task-next a").removeClass("disable");$("#task-content-inner").animate({marginLeft:marginL},200)}})},resize:()=>{$("#task-content-inner").removeClass("fl");HROS.CONFIG.dockPos.toLowerCase()==="left"?$("#task-bar").css({left:$("#dock-bar").width(),right:0}):HROS.CONFIG.dockPos.toLowerCase()==="right"?($("#task-bar").css({left:0,right:$("#dock-bar").width()}),$("#task-content-inner").addClass("fl")):$("#task-bar").css({left:0,right:0});let w=$("#task-bar").width(),realW=$("#task-content-inner .task-item").length*114,showW=w-112;$("#task-content-inner").css("width",realW);realW>=showW?($("#task-next, #task-pre").show(),$("#task-content").css("width",showW),$("#task-content-inner").addClass("fl").stop(!0,!1).animate({marginLeft:0},200),$("#task-next a").removeClass("disable"),$("#task-pre a").addClass("disable")):($("#task-next, #task-pre").hide(),$("#task-content").css("width","100%"),$("#task-content-inner").css({"margin-left":0,"margin-right":0}))}}))();HROS.wallpaper=(()=>({init:()=>{HROS.wallpaper.get(()=>{HROS.wallpaper.set()})},get:callback=>{HROS.request.get("/desk/getwallpaper",{},responseText=>{if(responseText.IsSuccess){let values=responseText.Model;HROS.CONFIG.wallpaperState=values.WallpaperSource;switch(HROS.CONFIG.wallpaperState.toLowerCase()){case"upload":case"system":HROS.CONFIG.wallpaper=values.WallpaperUrl;HROS.CONFIG.wallpaperType=values.WallpaperMode;HROS.CONFIG.wallpaperWidth=values.WallpaperWidth;HROS.CONFIG.wallpaperHeight=values.WallpaperHeigth;break;case"bing":case"web":HROS.CONFIG.wallpaperType=values.WallpaperMode;HROS.CONFIG.wallpaper=values.WallpaperUrl}typeof callback=="function"&&callback&&callback()}})},set:isreload=>{isreload=isreload||!0;isreload&&($("#zoomWallpaperGrid").attr("id","zoomWallpaperGrid-ready2remove").css("zIndex",-11),setTimeout(()=>{$("#zoomWallpaperGrid-ready2remove").remove(),$("#zoomWallpaperGrid").removeClass("radi")},1500));let w=$(window).width(),h=$(window).height();if(HROS.CONFIG.wallpaperState)switch(HROS.CONFIG.wallpaperState.toLowerCase()){case"upload":case"system":let t,l;switch(HROS.CONFIG.wallpaperType.toLocaleLowerCase()){case"tile":isreload&&$("body").append('<div id="zoomWallpaperGrid" class="radi" style="position:absolute;z-index:-10;top:0;left:0;height:100%;width:100%;background:#fff url('+HROS.CONFIG.wallpaper+') repeat"><\/div>');break;case"center":isreload&&$("body").append('<div id="zoomWallpaperGrid" class="radi" style="position:absolute;z-index:-10;top:0;left:0;height:100%;width:100%;background:#fff url('+HROS.CONFIG.wallpaper+') no-repeat 50% 50%"><\/div>');break;case"fill":t=(h-HROS.CONFIG.wallpaperHeight)/2;l=(w-HROS.CONFIG.wallpaperWidth)/2;isreload?$("body").append('<div id="zoomWallpaperGrid" class="radi" style="position:absolute;z-index:-10;left:0;top:0;overflow:hidden;height:'+h+"px;width:"+w+'px;background:#fff"><img id="zoomWallpaper" src="'+HROS.CONFIG.wallpaper+'" style="position:absolute;height:'+HROS.CONFIG.wallpaperHeight+"px;width:"+HROS.CONFIG.wallpaperWidth+"px;top:"+t+"px;left:"+l+'px"><div style="position:absolute;height:'+h+"px;width:"+w+'px;background:#fff;opacity:0;filter:alpha(opacity=0)"><\/div><\/div>'):($("#zoomWallpaperGrid, #zoomWallpaperGrid div").css({height:h+"px",width:w+"px"}),$("#zoomWallpaper").css({top:t+"px",left:l+"px"}));break;case"adapted":let imgH,imgW;HROS.CONFIG.wallpaperHeight/HROS.CONFIG.wallpaperWidth>h/w?(imgH=h,imgW=HROS.CONFIG.wallpaperWidth*(h/HROS.CONFIG.wallpaperHeight),t=0,l=(w-imgW)/2):HROS.CONFIG.wallpaperHeight/HROS.CONFIG.wallpaperWidth<h/w?(imgW=w,imgH=HROS.CONFIG.wallpaperHeight*(w/HROS.CONFIG.wallpaperWidth),l=0,t=(h-imgH)/2):(imgH=HROS.CONFIG.wallpaperHeight,imgW=HROS.CONFIG.wallpaperWidth,t=l=0);isreload?$("body").append('<div id="zoomWallpaperGrid" class="radi" style="position:absolute;z-index:-10;left:0;top:0;overflow:hidden;height:'+h+"px;width:"+w+'px;background:#fff"><img id="zoomWallpaper" src="'+HROS.CONFIG.wallpaper+'" style="position:absolute;height:'+imgH+"px;width:"+imgW+"px;top:"+t+"px;left:"+l+'px"><div style="position:absolute;height:'+h+"px;width:"+w+'px;background:#fff;opacity:0;filter:alpha(opacity=0)"><\/div><\/div>'):($("#zoomWallpaperGrid, #zoomWallpaperGrid div").css({height:h+"px",width:w+"px"}),$("#zoomWallpaper").css({height:imgH+"px",width:imgW+"px",top:t+"px",left:l+"px"}));break;case"draw":isreload?$("body").append('<div id="zoomWallpaperGrid" class="radi" style="position:absolute;z-index:-10;left:0;top:0;overflow:hidden;height:'+h+"px;width:"+w+'px;background:#fff"><img id="zoomWallpaper" src="'+HROS.CONFIG.wallpaper+'" style="position:absolute;height:'+h+"px;width:"+w+'px;top:0;left:0"><div style="position:absolute;height:'+h+"px;width:"+w+'px;background:#fff;opacity:0;filter:alpha(opacity=0)"><\/div><\/div>'):$("#zoomWallpaperGrid").css({height:h+"px",width:w+"px"}).children("#zoomWallpaper, div").css({height:h+"px",width:w+"px"})}break;case"bing":case"web":isreload&&$("body").append('<div id="zoomWallpaperGrid" class="radi" style="position:absolute;z-index:-10;top:0;left:0;height:100%;width:100%;overflow:hidden"><div><\/div><iframe id="iframeWallpaper" frameborder="no" border="0" scrolling="no" class="iframeWallpaper" style="position:absolute;left:0;top:0;overflow:hidden;width:100%;height:100%" src="'+HROS.CONFIG.wallpaper+'"><\/iframe><\/div>')}},update:(wallpaperShowType,wallpaperId)=>{function done(){HROS.wallpaper.get(()=>{HROS.wallpaper.set()})}HROS.base.checkLogin()?wallpaperId?HROS.request.post("/desk/modifywallpaper",{wallpaperId:wallpaperId},responseText=>{responseText.IsSuccess&&(NewCrm.success("壁纸设置成功！"),done())}):HROS.request.post("/desk/modifydisplaymodel",{wallPaperShowType:wallpaperShowType},responseText=>{responseText.IsSuccess&&(NewCrm.success("壁纸显示模式设置成功！"),done())}):(NewCrm.success("壁纸设置成功！"),done())}}))();HROS.widget=(()=>({init:()=>{HROS.widget.handle();HROS.widget.move();HROS.widget.reduction();$("#desk").on("mouseover",".widget",function(){$(this).children(".move").show()}).on("mouseout",".widget",function(){$(this).children(".move").hide()})},createTemp:obj=>{function nextDo(options){$("#desk").append(widgetWindowTemp({width:options.width,height:options.height,type:"widgetTemp",id:"w_"+options.appid,appid:options.appid,realappid:options.appid,top:options.top,right:options.right,url:options.url,zIndex:HROS.CONFIG.widgetIndexid,issetbar:0}));HROS.CONFIG.widgetIndexid+=1}let appid=obj.appid===null?Date.parse(new Date):obj.appid,iswidgetopen=!1;$("#desk .widget").each(function(){if($(this).attr("appid")===appid)return iswidgetopen=!0,!1});iswidgetopen||nextDo({appid:appid,url:obj.url,width:obj.width,height:obj.height,top:obj.top===null?0:obj.top,right:obj.right===null?0:obj.right})},create:(appid,type,realappid)=>{function nextDo(options){let widgetId="#w_"+options.appid;if(HROS.widget.checkCookie(appid,type)){let widgetState=$.parseJSON(HROS.cookie.get("widgetState"+HROS.CONFIG.memberID));$(widgetState).each(function(){this.appid===options.appid&&this.type===options.type.toLowerCase()&&(options.top=this.top,options.right=this.right)})}else HROS.widget.addCookie(options.realappid,options.type.toLowerCase(),0,0);TEMP.widgetTemp={title:options.title,width:options.width,height:options.height,type:options.type.toLowerCase(),id:"w_"+options.appid,appid:options.appid,realappid:options.realappid===0?options.appid:options.realappid,top:options.top?options.top:0,right:options.right?options.right:0,url:options.url,zIndex:HROS.CONFIG.widgetIndexid,issetbar:1,starcount:options.starcount};$("#desk").append(widgetWindowTemp(TEMP.widgetTemp));$(widgetId).data("info",TEMP.widgetTemp);HROS.CONFIG.widgetIndexid+=1}type=type?type:"widget";let iswidgetopen=!1;$("#desk .widget").each(function(){if($(this).attr("appid")===appid)return iswidgetopen=!0,!1});iswidgetopen||$("#d_"+appid).attr("opening")===1||($("#d_"+realappid).attr("opening",1),HROS.request.get("/desk/createwindow",{id:realappid,type:type},responseText=>{if(responseText.IsSuccess){let app=responseText.Model;nextDo({type:app.type,appid:app.appId,realappid:app.appId,title:app.name,imgsrc:app.icon,url:app.url,width:app.width,height:app.height,isresize:app.isResize,isopenmax:app.isOpenMax,issetbar:app.isSetbar,starcount:app.starCount});$("#d_"+appid).attr("opening",0)}else NewCrm.fail(responseText.Message)}))},reduction:()=>{if(HROS.cookie.get("widgetState"+HROS.CONFIG.memberID)){let widgetState=JSON.parse(HROS.cookie.get("widgetState"+HROS.CONFIG.memberID));$(widgetState).each(function(){HROS.widget.create(this.appid,this.type)})}},checkCookie:(appid,type)=>{let value=HROS.cookie.get("widgetState"+HROS.CONFIG.memberID),flag=!1;if(value){let widgetState=JSON.parse(value);return $(widgetState).each(function(){this.appid===appid&&this.type===type&&(flag=!0)}),flag}return flag},addCookie:(appid,type,top,right)=>{if(type==="widget"||type==="pwidget"){let coo=HROS.cookie.get("widgetState"+HROS.CONFIG.memberID),widgetState=coo?JSON.parse(coo):null;HROS.widget.checkCookie(appid,type)?$(widgetState).each(function(){this.appid===appid&&this.type===type&&(this.top=top,this.right=right)}):(widgetState===null&&(widgetState=[]),widgetState.push({appid:appid,type:type,top:top,right:right}));HROS.cookie.set("widgetState"+HROS.CONFIG.memberID,JSON.stringify(widgetState),{expires:95})}},removeCookie:(appid,type)=>{if((type==="widget"||type==="pwidget")&&HROS.widget.checkCookie(appid,type)){let widgetState=JSON.parse(HROS.cookie.get("widgetState"+HROS.CONFIG.memberID));$(widgetState).each(function(i){if(this.appid===appid&&this.type===type)return widgetState.splice(i,1),!1});HROS.cookie.set("widgetState"+HROS.CONFIG.memberID,JSON.stringify(widgetState))}},move:()=>{$("#desk").on("mousedown",".widget .move",function(e){let obj=$(this).parents(".widget");HROS.widget.show2top(obj.attr("appid"));let x=e.clientX-obj.offset().left,y=e.clientY-obj.offset().top,lay,t,r;$(document).on("mousemove",e=>{lay=HROS.maskBox.desk(),lay.show(),t=e.clientY-y<0?0:e.clientY-y,r=$(window).width()-obj.width()-(e.clientX-x),obj.css({top:t,right:r})}).on("mouseup",function(){$(this).off("mousemove").off("mouseup");typeof lay!="undefined"&&lay.hide();obj.attr("type")!=="widgetTemp"&&HROS.widget.addCookie(obj.attr("appid"),obj.attr("type"),t,r)})})},close:appid=>{let widgetId="#w_"+appid;HROS.widget.removeCookie($(widgetId).attr("appid"),$(widgetId).attr("type"));$(widgetId).html("").remove()},show2top:appid=>{let widgetId="#w_"+appid;$(widgetId).css("z-index",HROS.CONFIG.widgetIndexid);HROS.CONFIG.widgetIndexid+=1},handle:()=>{$("#desk").on("mousedown",".widget a",e=>{e.preventDefault(),e.stopPropagation()});$("#desk").on("click",".widget .ha-close",function(){let obj=$(this).parents(".widget");HROS.widget.close(obj.attr("appid"))}).on("click",".widget .ha-star",function(){let obj=$(this).parents(".widget"),point=parseFloat(obj.data("info").starcount).toFixed(1);$.dialog({title:"给“"+obj.data("info").title+"”打分",width:250,id:"star",content:starDialogTemp({realappid:obj.data("info").realappid,point:point,realpoint:point*20})})}).on("click",".widget .ha-share",function(){let obj=$(this).parents(".widget");$.dialog({title:"分享应用",width:370,id:"share",content:shareDialogTemp({sinaweiboAppkey:HROS.CONFIG.sinaweiboAppkey===""?"1197457869":HROS.CONFIG.sinaweiboAppkey,tweiboAppkey:HROS.CONFIG.tweiboAppkey===""?"801356816":HROS.CONFIG.tweiboAppkey,title:"我正在使用 %23HoorayOS%23 中的 %23"+obj.data("info").title+"%23 应用，很不错哦，推荐你也来试试！",url:HROS.CONFIG.website+"?run="+obj.data("info").realappid+"%26type=widget"})})})}}))();HROS.window=(()=>({init:()=>{HROS.window.handle();HROS.window.move();HROS.window.resize();$("#desk").on("click",".window-container .window-mask, .window-container .folder_body",function(){HROS.window.show2top($(this).parents(".window-container").attr("appid"),!0)});$("#desk").on("contextmenu",".window-container",()=>!1);$("#desk").on("click",".folder_body li",()=>!1).on("contextmenu",".folder_body .appbtn",function(e){$(".popup-menu").hide();$(".quick_view_container").remove();let popupmenu;switch($(this).attr("type")){case"app":case"window":case"widget":popupmenu=HROS.popupMenu.app($(this));break;case"pwindow":case"pwidget":popupmenu=HROS.popupMenu.papp($(this))}let l=$(window).width()-e.clientX<popupmenu.width()?e.clientX-popupmenu.width():e.clientX,t=$(window).height()-e.clientY<popupmenu.height()?e.clientY-popupmenu.height():e.clientY;return popupmenu.css({left:l,top:t}).show(),!1})},createTemp:obj=>{function nextDo(options){let windowId="#w_"+options.appid;$("#task-content-inner").prepend(taskTemp({type:options.type.toLowerCase(),id:"t_"+options.appid,appid:options.appid,realappid:options.appid,title:options.title,imgsrc:options.imgsrc}));HROS.taskbar.resize();TEMP.windowTemp={top:($(window).height()-options.height)/2<=0?0:($(window).height()-options.height)/2,left:($(window).width()-options.width)/2<=0?0:($(window).width()-options.width)/2,emptyW:$(window).width()-options.width,emptyH:$(window).height()-options.height,width:options.width,height:options.height,zIndex:HROS.CONFIG.windowIndexid,type:options.type.toLowerCase(),id:"w_"+options.appid,appid:options.appid,realappid:options.appid,title:options.title,url:options.url,imgsrc:options.imgsrc,isresize:options.isresize,isopenmax:options.isopenmax,istitlebar:options.isresize,istitlebarFullscreen:options.isresize?window.fullScreenApi.supportsFullScreen===!0?!0:!1:!1,issetbar:options.issetbar,isflash:options.isflash};$("#desk").append(windowTemp(TEMP.windowTemp));$(windowId).data("info",TEMP.windowTemp);HROS.CONFIG.windowIndexid+=1;HROS.window.setPos(!1);$(windowId+" iframe").on("load",()=>{$(windowId+" .window-frame").children("div").eq(1).fadeOut()});HROS.window.show2top(options.appid)}let appid=obj.appid===null?Date.parse(new Date):obj.appid,iswindowopen=!1;if($("#task-content-inner a.task-item").each(function(){if($(this).attr("appid")===appid)return iswindowopen=!0,HROS.window.show2top($(this).attr("appid")),!1}),iswindowopen){if(obj.refresh){let windowId="#w_"+appid;$(windowId).find("iframe").attr("src",obj.url)}}else nextDo({type:"window",appid:appid,realappid:appid,imgsrc:"/images/ui/default_icon.png",title:obj.title,url:obj.url,width:obj.width,height:obj.height,isresize:obj.isresize,isopenmax:obj.isopenmax,issetbar:!1,isflash:obj.isflash})},create:(realappid,type)=>{function nextDo(options){let windowId="#w_"+options.appid,top=($(window).height()-options.height)/2<=0?0:($(window).height()-options.height)/2,left=($(window).width()-options.width)/2<=0?0:($(window).width()-options.width)/2;switch(options.type.toLowerCase()){case"app":case"pwindow":$("#task-content-inner").prepend(taskTemp({type:options.type.toLowerCase(),id:"t_"+options.appid,appid:options.appid,realappid:options.realappid,title:options.title,imgsrc:options.imgsrc}));HROS.taskbar.resize();TEMP.windowTemp={top:top,left:left,emptyW:$(window).width()-options.width,emptyH:$(window).height()-options.height,width:options.width,height:options.height,zIndex:HROS.CONFIG.windowIndexid,type:options.type.toLowerCase(),id:"w_"+options.appid,appid:options.appid,realappid:options.realappid,title:options.title,url:options.url,imgsrc:options.imgsrc,isresize:options.isresize,isopenmax:options.isresize?options.isopenmax:!1,istitlebar:options.isresize,istitlebarFullscreen:options.isresize?window.fullScreenApi.supportsFullScreen===!0?!0:!1:!1,issetbar:options.issetbar,isflash:options.isflash,starcount:options.starcount};$("#desk").append(windowTemp(TEMP.windowTemp));$(windowId).data("info",TEMP.windowTemp);HROS.CONFIG.windowIndexid+=1;HROS.window.setPos(!1);$(windowId+" iframe").on("load",()=>{$(windowId+" .window-frame").children("div").fadeOut()});HROS.window.show2top(options.appid);break;case"folder":$("#task-content-inner").prepend(taskTemp({type:options.type.toLowerCase(),id:"t_"+options.appid,appid:options.appid,realappid:options.realappid,title:options.title,imgsrc:options.imgsrc}));HROS.taskbar.resize();TEMP.folderWindowTemp={top:top,left:left,emptyW:$(window).width()-options.width,emptyH:$(window).height()-options.height,width:options.width,height:options.height,zIndex:HROS.CONFIG.windowIndexid,type:options.type.toLowerCase(),id:"w_"+options.appid,appid:options.appid,realappid:options.realappid,title:options.title,imgsrc:options.imgsrc};$("#desk").append(folderWindowTemp(TEMP.folderWindowTemp));$(windowId).data("info",TEMP.folderWindowTemp);HROS.CONFIG.windowIndexid+=1;HROS.window.setPos(!1);let sc="";if($(HROS.VAR.folder).each(function(){if(this.memberId===options.appid)return sc=this.apps,!1}),sc!==""){let folder_append="";$(sc).each(function(){folder_append+=appbtnTemp({title:this.name,type:this.type,id:"d_"+this.memberId,appid:this.memberId,realappid:this.appId===0?this.memberId:this.appId,imgsrc:this.icon})});$(windowId).find(".folder_body").append(folder_append)}HROS.window.show2top(options.appid);break;case"file":TEMP.fileWindowTemp={top:top,left:left,emptyW:$(window).width()-options.width,emptyH:$(window).height()-options.height,width:options.width,height:options.height,zIndex:HROS.CONFIG.windowIndexid,type:options.type.toLowerCase(),id:"w_"+options.appid,appid:options.appid,realappid:options.realappid,title:options.title,imgsrc:options.imgsrc};$("body").append(fileDownloadTemp(TEMP.fileWindowTemp))}}type=type?type:"widget";let appid,iswindowopen=!1;$("#task-content-inner a.task-item").each(function(){if($(this).attr("realappid")===realappid)return iswindowopen=!0,appid=$(this).attr("appid"),HROS.window.show2top(appid),!1});iswindowopen||$("#d_"+realappid).attr("opening")===1||($("#d_"+realappid).attr("opening",1),HROS.request.get("/desk/createwindow",{id:realappid,type:type},responseText=>{if(responseText.IsSuccess){let app=responseText.Model;nextDo({type:app.type,appid:app.memberId,realappid:app.appId,title:app.name,imgsrc:app.icon,url:app.url,width:app.width,height:app.height,isresize:app.isResize,isopenmax:app.isOpenMax,issetbar:app.isSetbar,starcount:app.starCount});$("#d_"+appid).attr("opening",0)}else NewCrm.fail(responseText.Message)}))},setPos:isAnimate=>{isAnimate=isAnimate===null?!0:isAnimate,$("#desk .window-container").each(function(){let windowdata=$(this).data("info"),currentW=$(window).width()-$(this).width(),currentH=$(window).height()-$(this).height(),left=windowdata.left/windowdata.emptyW*currentW>=currentW?currentW:windowdata.left/windowdata.emptyW*currentW;left=left<=0?0:left;let top=windowdata.top/windowdata.emptyH*currentH>=currentH?currentH:windowdata.top/windowdata.emptyH*currentH;top=top<=0?0:top;$(this).attr("state")!=="hide"?$(this).stop(!0,!1).animate({left:left,top:top},isAnimate?500:0,()=>{windowdata.left=left,windowdata.top=top,windowdata.emptyW=$(window).width()-$(this).width(),windowdata.emptyH=$(window).height()-$(this).height()}):(windowdata.left=left,windowdata.top=top,windowdata.emptyW=$(window).width()-$(this).width(),windowdata.emptyH=$(window).height()-$(this).height())})},close:appid=>{let windowId="#w_"+appid,taskId="#t_"+appid;$(windowId).removeData("info").html("").remove();$("#task-content-inner "+taskId).html("").remove();$("#task-content-inner").css("width",$("#task-content-inner .task-item").length*114);$("#task-bar, #nav-bar").removeClass("min-zIndex");HROS.taskbar.resize()},closeAll:()=>{$("#desk .window-container").each(function(){HROS.window.close($(this).attr("appid"))})},hide:appid=>{let windowId="#w_"+appid,taskId="#t_"+appid;$(windowId).css("left",-1e4).attr("state","hide");$("#task-content-inner "+taskId).removeClass("task-item-current");$(windowId).attr("ismax")===1&&$("#task-bar, #nav-bar").removeClass("min-zIndex")},hideAll:()=>{$("#task-content-inner a.task-item").removeClass("task-item-current"),$("#desk-"+HROS.CONFIG.desk).nextAll("div.window-container").css("left",-1e4).attr("state","hide")},max:appid=>{HROS.window.show2top(appid);let windowId="#w_"+appid,taskId="#t_"+appid;$(windowId+" .title-handle .ha-max").hide().next(".ha-revert").show();$(windowId).addClass("window-maximize").attr("ismax",1).animate({width:"100%",height:"100%",top:0,left:0},200);$("#task-bar, #nav-bar").addClass("min-zIndex")},revert:appid=>{HROS.window.show2top(appid);let windowId="#w_"+appid,taskId="#t_"+appid;$(windowId+" .title-handle .ha-revert").hide().prev(".ha-max").show();let obj=$(windowId),windowdata=obj.data("info");obj.removeClass("window-maximize").attr("ismax",0).animate({width:windowdata.width,height:windowdata.height,left:windowdata.left,top:windowdata.top},500);$("#task-bar, #nav-bar").removeClass("min-zIndex")},refresh:appid=>{let windowId="#w_"+appid,taskId="#t_"+appid;$(windowId+"_iframe").length!==0?$(windowId+"_iframe").attr("src",$(windowId+"_iframe").attr("src")):HROS.window.updateFolder(appid)},show2top:(appid,isAnimate)=>{function show(){HROS.window.show2under();$("#task-content-inner "+taskId).addClass("task-item-current");$(windowId).attr("ismax")===1&&$("#task-bar, #nav-bar").addClass("min-zIndex");$(windowId).addClass("window-current").css({"z-index":HROS.CONFIG.windowIndexid,left:windowdata.left,top:windowdata.top}).attr("state","show");$(windowId).attr("ismax")===1&&$(windowId).css({left:0,top:0});$(windowId+" .window-mask").hide();$(windowId+" iframe").show();HROS.CONFIG.windowIndexid+=1}isAnimate=isAnimate===null?!1:isAnimate;let windowId="#w_"+appid,taskId="#t_"+appid,windowdata=$(windowId).data("info"),arr=[];if(isAnimate){let baseStartX=$(windowId).offset().left,baseEndX=baseStartX+$(windowId).width(),baseStartY=$(windowId).offset().top,baseEndY=baseStartY+$(windowId).height(),baseCenterX=baseStartX+$(windowId).width()/2,baseCenterY=baseStartY+$(windowId).height()/2,baseZIndex=parseInt($(windowId).css("zIndex"));$("#desk .window-container:not("+windowId+")").each(function(){let thisStartX=$(this).offset().left,thisEndX=thisStartX+$(this).width(),thisStartY=$(this).offset().top,thisEndY=thisStartY+$(this).height(),thisCenterX=thisStartX+$(this).width()/2,thisCenterY=thisStartY+$(this).height()/2,thisZIndex=parseInt($(this).css("zIndex")),flag="";if(thisZIndex>baseZIndex&&((thisStartX>=baseStartX&&thisStartX<=baseEndX&&thisStartY>=baseStartY&&thisStartY<=baseEndY||thisStartX>=baseStartX&&thisStartX<=baseEndX&&thisEndY>=baseStartY&&thisEndY<=baseEndY||thisEndX>=baseStartX&&thisEndX<=baseEndX&&thisStartY>=baseStartY&&thisStartY<=baseEndY||thisEndX>=baseStartX&&thisEndX<=baseEndX&&thisEndY>=baseStartY&&thisEndY<=baseEndY)&&(flag="x"),(thisStartX>=baseStartX&&thisStartX<=baseEndX&&thisStartY<baseStartY&&thisEndY>baseEndY||thisEndX>=baseStartX&&thisEndX<=baseEndX&&thisStartY<baseStartY&&thisEndY>baseEndY)&&(flag="x"),(thisStartY>=baseStartY&&thisStartY<=baseEndY&&thisStartX<baseStartX&&thisEndX>baseEndX||thisEndY>=baseStartY&&thisEndY<=baseEndY&&thisStartX<baseStartX&&thisEndX>baseEndX)&&(flag="y"),(thisStartX>=baseStartX&&thisStartX<=baseEndX&&thisEndY>=baseStartY&&thisEndY<=baseEndY&&thisEndX>=baseStartX&&thisEndX<=baseEndX&&thisEndY>=baseStartY&&thisEndY<=baseEndY||thisStartX>=baseStartX&&thisStartX<=baseEndX&&thisStartY>=baseStartY&&thisStartY<=baseEndY&&thisEndX>=baseStartX&&thisEndX<=baseEndX&&thisStartY>=baseStartY&&thisStartY<=baseEndY)&&(flag="y")),flag!==""){let direction,distance;flag==="x"?thisCenterX>baseCenterX?(direction="right",distance=baseEndX-thisStartX+30):(direction="left",distance=thisEndX-baseStartX+30):thisCenterY>baseCenterY?(direction="bottom",distance=baseEndY-thisStartY+30):(direction="top",distance=thisEndY-baseStartY+30);arr.push({id:$(this).attr("id"),direction:direction,distance:distance})}});let delayTime=0;for(let i=0;i<arr.length;i++){let baseLeft=$("#"+arr[i].id).offset().left,baseTop=$("#"+arr[i].id).offset().top;arr[i].direction==="left"?$("#"+arr[i].id).delay(delayTime).animate({left:baseLeft-arr[i].distance},300).animate({left:baseLeft},300):arr[i].direction==="right"?$("#"+arr[i].id).delay(delayTime).animate({left:baseLeft+arr[i].distance},300).animate({left:baseLeft},300):arr[i].direction==="top"?$("#"+arr[i].id).delay(delayTime).animate({top:baseTop-arr[i].distance},300).animate({top:baseTop},300):arr[i].direction==="bottom"&&$("#"+arr[i].id).delay(delayTime).animate({top:baseTop+arr[i].distance},300).animate({top:baseTop},300);delayTime+=100}setTimeout(show,delayTime+100)}else show()},show2under:()=>{$("#task-content-inner a.task-item").removeClass("task-item-current"),$("#desk .window-container").removeClass("window-current"),$("#desk .window-container .window-mask").show(),$("#desk .window-container-flash iframe").hide()},updateFolder:appid=>{let windowId="#w_"+appid,taskId="#t_"+appid,sc="";if($(HROS.VAR.folder).each(function(){if(this.memberId===parseInt(appid))return sc=this.apps,!1}),sc!==null){let folder_append="";for(let i=0;i<sc.length;i++)folder_append+=appbtnTemp({top:0,left:0,title:sc[i].name,type:sc[i].type,id:"d_"+sc[i].memberId,appid:sc[i].memberId,realappid:sc[i].appId,imgsrc:sc[i].icon});$(windowId).find(".folder_body").html("").append(folder_append).on("contextmenu",".appbtn",function(e){$(".popup-menu").hide();$(".quick_view_container").remove();TEMP.AppRight=HROS.popupMenu.app($(this));let l=$(window).width()-e.clientX<TEMP.AppRight.width()?e.clientX-TEMP.AppRight.width():e.clientX,t=$(window).height()-e.clientY<TEMP.AppRight.height()?e.clientY-TEMP.AppRight.height():e.clientY;return TEMP.AppRight.css({left:l,top:t}).show(),!1})}},handle:()=>{$("#desk").on("mousedown",".window-container .title-bar .title-handle a",e=>{e.preventDefault(),e.stopPropagation()});$("#desk").on("dblclick",".window-container .title-bar",function(){let obj=$(this).parents(".window-container");obj.find(".ha-max").is(":hidden")?obj.find(".ha-revert").click():obj.find(".ha-max").click()}).on("click",".window-container .ha-hide",function(){let obj=$(this).parents(".window-container");HROS.window.hide(obj.attr("appid"))}).on("click",".window-container .ha-max",function(){let obj=$(this).parents(".window-container");HROS.window.max(obj.attr("appid"))}).on("click",".window-container .ha-revert",function(){let obj=$(this).parents(".window-container");HROS.window.revert(obj.attr("appid"))}).on("click",".window-container .ha-fullscreen",function(){let obj=$(this).parents(".window-container");window.fullScreenApi.requestFullScreen(document.getElementById(obj.find("iframe").attr("id")))}).on("click",".window-container .ha-close",function(){let obj=$(this).parents(".window-container");HROS.window.close(obj.attr("appid"))}).on("click",".window-container .refresh",function(){let obj=$(this).parents(".window-container");HROS.window.refresh(obj.attr("appid"))}).on("click",".window-container .detail",function(){let obj=$(this).parents(".window-container");obj.attr("realappid")!==0?HROS.window.createTemp({appid:"hoorayos-yysc",title:"应用市场",url:"/AppMarket/AppDetail?appId="+obj.attr("realappid"),width:800,height:484,isflash:!1,refresh:!0}):NewCrm.info("对不起，该应用没有任何详细介绍")}).on("click",".window-container .star",function(){let obj=$(this).parents(".window-container"),point=parseFloat(obj.data("info").starcount).toFixed(1);$.dialog({title:"给“"+obj.data("info").title+"”打分",width:250,id:"star",content:starDialogTemp({realappid:obj.data("info").realappid,point:point,realpoint:point*20})})}).on("click",".window-container .share",function(){let obj=$(this).parents(".window-container");$.dialog({title:"分享应用",width:370,id:"share",content:shareDialogTemp({sinaweiboAppkey:HROS.CONFIG.sinaweiboAppkey===""?"1197457869":HROS.CONFIG.sinaweiboAppkey,tweiboAppkey:HROS.CONFIG.tweiboAppkey===""?"801356816":HROS.CONFIG.tweiboAppkey,title:"我正在使用 %23HoorayOS%23 中的 %23"+obj.data("info").title+"%23 应用，很不错哦，推荐你也来试试！",url:HROS.CONFIG.website+"?run="+obj.data("info").realappid+"%26type=app"})})}).on("contextmenu",".window-container",()=>($(".popup-menu").hide(),$(".quick_view_container").remove(),!1))},move:()=>{$("#desk").on("mousedown",".window-container .title-bar",function(e){let obj=$(this).parents(".window-container");if(obj.attr("ismax")===1)return!1;HROS.window.show2top(obj.attr("appid"));let windowdata=obj.data("info"),x=e.clientX-obj.offset().left,y=e.clientY-obj.offset().top,lay;$(document).on("mousemove",e=>{lay=HROS.maskBox.desk(),lay.show(),obj.find(".ha-revert").hide().prev(".ha-max").show(),obj.css({width:windowdata.width,height:windowdata.height,left:e.clientX-x,top:e.clientY-y<=10?0:e.clientY-y>=lay.height()-30?lay.height()-30:e.clientY-y}),obj.data("info").left=obj.offset().left,obj.data("info").top=obj.offset().top}).on("mouseup",function(){$(this).off("mousemove").off("mouseup");typeof lay!="undefined"&&lay.hide()})})},resize:()=>{$("#desk").on("mousedown",".window-container .window-resize",function(e){let obj=$(this).parents(".window-container"),resizeobj=$(this),lay,x=e.clientX,y=e.clientY,w=obj.width(),h=obj.height();$(document).on("mousemove",e=>{lay=HROS.maskBox.desk();lay.show();let _x=e.clientX<=10?0:e.clientX>=lay.width()-12?lay.width()-2:e.clientX,_y=e.clientY<=10?0:e.clientY>=lay.height()-12?lay.height():e.clientY;switch(resizeobj.attr("resize")){case"t":h+y-_y>HROS.CONFIG.windowMinHeight?obj.css({height:h+y-_y,top:_y}):obj.css({height:HROS.CONFIG.windowMinHeight});break;case"r":w-x+_x>HROS.CONFIG.windowMinWidth?obj.css({width:w-x+_x}):obj.css({width:HROS.CONFIG.windowMinWidth});break;case"b":h-y+_y>HROS.CONFIG.windowMinHeight?obj.css({height:h-y+_y}):obj.css({height:HROS.CONFIG.windowMinHeight});break;case"l":w+x-_x>HROS.CONFIG.windowMinWidth?obj.css({width:w+x-_x,left:_x}):obj.css({width:HROS.CONFIG.windowMinWidth});break;case"rt":h+y-_y>HROS.CONFIG.windowMinHeight?obj.css({height:h+y-_y,top:_y}):obj.css({height:HROS.CONFIG.windowMinHeight});w-x+_x>HROS.CONFIG.windowMinWidth?obj.css({width:w-x+_x}):obj.css({width:HROS.CONFIG.windowMinWidth});break;case"rb":w-x+_x>HROS.CONFIG.windowMinWidth?obj.css({width:w-x+_x}):obj.css({width:HROS.CONFIG.windowMinWidth});h-y+_y>HROS.CONFIG.windowMinHeight?obj.css({height:h-y+_y}):obj.css({height:HROS.CONFIG.windowMinHeight});break;case"lt":w+x-_x>HROS.CONFIG.windowMinWidth?obj.css({width:w+x-_x,left:_x}):obj.css({width:HROS.CONFIG.windowMinWidth});h+y-_y>HROS.CONFIG.windowMinHeight?obj.css({height:h+y-_y,top:_y}):obj.css({height:HROS.CONFIG.windowMinHeight});break;case"lb":w+x-_x>HROS.CONFIG.windowMinWidth?obj.css({width:w+x-_x,left:_x}):obj.css({width:HROS.CONFIG.windowMinWidth});h-y+_y>HROS.CONFIG.windowMinHeight?obj.css({height:h-y+_y}):obj.css({height:HROS.CONFIG.windowMinHeight})}}).on("mouseup",function(){typeof lay!="undefined"&&lay.hide();obj.data("info").width=obj.width();obj.data("info").height=obj.height();obj.data("info").left=obj.offset().left;obj.data("info").top=obj.offset().top;obj.data("info").emptyW=$(window).width()-obj.width();obj.data("info").emptyH=$(window).height()-obj.height();$(this).off("mousemove").off("mouseup")})})}}))();HROS.zoom=(()=>({init:()=>{$("body").append('<div id="zoombox"><\/div>'),swfobject.embedSWF("/js/hooray/zoom.swf?onchange=HROS.zoom.check","zoombox","10","10","6.0.0","expressInstall.swf","",{allowScriptAccess:"always",wmode:"transparent",scale:"noScale"},{id:"accessory_zoom",name:"zoom_detect"})},check:o=>{let s=o.scale,m=s>1?"放大":"缩小";s!==1?(HROS.VAR.zoomLevel=s,$("#zoom-tip").show().find("span").text("您的浏览器目前处于"+m+"状态，会导致显示不正常，您可以键盘按“ctrl+数字0”组合键恢复初始状态！")):s!==HROS.VAR.zoomLevel&&$("#zoom-tip").fadeOut()},close:()=>{$("#zoom-tip").remove()}}))();HROS.signalR=(()=>({init:()=>{let connection=(new signalR.HubConnectionBuilder).withUrl("/hubs?userId="+HROS.CONFIG.memberID).configureLogging(signalR.LogLevel.None).build();connection.on("Message",responseText=>{let message=JSON.parse(responseText),Notification=window.Notification||window.mozNotification||window.webKitNotification;Notification&&Notification.permission==="granted"?new Notification(message.Title,{dir:"rtl",lang:"zh-CN",body:message.Content}):Lobibox.notify("success",{size:"mini",icon:!1,msg:message.Content})});connection.start().catch(()=>NewCrm.fail("推送服务连接失败"));HROS.signalR.instance=connection},stop:callback=>{HROS.signalR.instance.stop();HROS.signalR.instance.onclose(()=>{callback&&callback&&callback()})}}))();HROS.cookie=(()=>({set:(key,value,timeout)=>{let v=`${key}=${value}`;timeout&&(v+=`; expires=${timeout}`);document.cookie=v},get:key=>{let arr,reg=new RegExp(`(^| )${key}=([^;]*)(;|$)`);return(arr=document.cookie.match(reg))?unescape(arr[2]):null},remove:key=>{document.cookie=`${key}=0; expires=Thu, 01 Jan 1970 00:00:00 UTC`}}))();HROS.request=(()=>({get:(url,parameter,callback)=>HROS.request.internalRequset(url,"GET",parameter,callback),post:(url,parameter,callback)=>{if(HROS.request.state==="posting")NewCrm.fail(HROS.CONFIG.postOnce);else return HROS.request.internalRequset(url,"POST",parameter,callback)},internalRequset:(url,method,parameter,callback)=>{let CancelToken=axios.CancelToken,source=CancelToken.source(),cookie=HROS.cookie.get("User");if(cookie||["/desk/landing"].includes(url.toLowerCase())){NewCrm.loading(HROS.CONFIG.loadingPrompt);method==="POST";axios.defaults.timeout=method==="GET"?5e3:1e4;axios.defaults.transformRequest=()=>{method==="POST"&&HROS.request.state==="posting"?source.cancel("Operation canceled by the user."):HROS.request.state="posting"};axios.defaults.transformResponse=d=>{let data=JSON.parse(d);return HROS.request.state=data.IsSuccess?"posted":"normal",data};let ax;if(method==="GET")ax=axios.get(url,{params:Object.keys(parameter).length?parameter:null,cancelToken:source.token});else{let params=new URLSearchParams;for(let key in parameter)parameter.hasOwnProperty(key)&&params.append(key,parameter[key]);ax=axios.post(url,JSON.stringify(parameter),{headers:{"Content-Type":"application/json;charset=UTF-8"}})}ax.then(responseText=>{let data=responseText.data;NewCrm.close();callback&&callback&&callback(data)}).catch(thrown=>{thrown.code&&thrown.code==="ECONNABORTED"?NewCrm.warning("请求超时,请重试"):ax.isCancel&&ax.isCancel(thrown)?NewCrm.warning("请不要重复提交"):NewCrm.fail("请求失败,请重试"),HROS.request.state="normal"})}else NewCrm.fail(HROS.CONFIG.timeOutPrompt)}}))(),function($,win,undef){function setCenter(obj,time){var left=($(window).width()-obj.outerWidth())/2,top=($(window).height()-obj.outerHeight())/2,top=(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop)+(top>0?top:0);obj.css({left:left}).animate({top:top},{duration:time,queue:!1})}function creatMsgbox(){if($("#Validform_msg").length!==0)return!1;msgobj=$('<div id="Validform_msg"><div class="Validform_title">'+tipmsg.tit+'<a class="Validform_close" href="javascript:void(0);">&chi;<\/a><\/div><div class="Validform_info"><\/div><div class="iframe"><iframe frameborder="0" scrolling="no" height="100%" width="100%"><\/iframe><\/div><\/div>').appendTo("body");msgobj.find("a.Validform_close").click(function(){return msgobj.hide(),msghidden=!0,errorobj&&errorobj.focus().addClass("Validform_error"),!1}).focus(function(){this.blur()});$(window).bind("scroll resize",function(){msghidden||setCenter(msgobj,400)})}var errorobj=null,msgobj=null,msghidden=!0,tipmsg={tit:"提示信息",w:{"*":"不能为空！","*6-16":"请填写6到16位任意字符！",n:"请填写数字！","n6-16":"请填写6到16位数字！",s:"不能输入特殊字符！","s6-18":"请填写6到18位字符！",p:"请填写邮政编码！",m:"请填写手机号码！",e:"邮箱地址格式不对！",url:"请填写网址！"},def:"请填写正确信息！",undef:"datatype未定义！",reck:"两次输入的内容不一致！",r:"通过信息验证！",c:"正在检测信息…",s:"请{填写|选择}{0|信息}！",v:"所填信息没有经过验证，请稍后…",p:"正在提交数据…"},Validform;$.Tipmsg=tipmsg;Validform=function(forms,settings,inited){var settings=$.extend({},Validform.defaults,settings),brothers;if(settings.datatype&&$.extend(Validform.util.dataType,settings.datatype),brothers=this,brothers.tipmsg={w:{}},brothers.forms=forms,brothers.objects=[],inited===!0)return!1;forms.each(function(){var curform,$this;if(this.validform_inited=="inited")return!0;this.validform_inited="inited";curform=this;curform.settings=$.extend({},settings);$this=$(curform);curform.validform_status="normal";$this.data("tipmsg",brothers.tipmsg);$this.delegate("[datatype]","blur",function(){var subpost=arguments[1];Validform.util.check.call(this,$this,subpost)});$this.delegate(":text","keypress",function(event){event.keyCode==13&&$this.find(":submit").length==0&&$this.submit()});Validform.util.enhance.call($this,curform.settings.tiptype,curform.settings.usePlugin,curform.settings.tipSweep);curform.settings.btnSubmit&&$this.find(curform.settings.btnSubmit).bind("click",function(){return $this.trigger("submit"),!1});$this.submit(function(){var subflag=Validform.util.submitForm.call($this,curform.settings);return subflag===undef&&(subflag=!0),subflag});$this.find("[type='reset']").add($this.find(curform.settings.btnReset)).bind("click",function(){Validform.util.resetForm.call($this)})});(settings.tiptype==1||(settings.tiptype==2||settings.tiptype==3)&&settings.ajaxPost)&&creatMsgbox()};Validform.defaults={tiptype:1,tipSweep:!1,showAllError:!1,postonce:!1,ajaxPost:!1};Validform.util={dataType:{"*":/[\w\W]+/,"*6-16":/^[\w\W]{6,16}$/,n:/^\d+$/,"n6-16":/^\d{6,16}$/,s:/^[\u4E00-\u9FA5\uf900-\ufa2d\w\.\s]+$/,"s6-18":/^[\u4E00-\u9FA5\uf900-\ufa2d\w\.\s]{6,18}$/,p:/^[0-9]{6}$/,m:/^13[0-9]{9}$|14[0-9]{9}|15[0-9]{9}$|18[0-9]{9}$/,e:/^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,url:/^(\w+:\/\/)?\w+(\.\w+)+.*$/},toString:Object.prototype.toString,isEmpty:function(val){return val===""||val===$.trim(this.attr("tip"))},getValue:function(obj){var inputval,curform=this;return obj.is(":radio")?(inputval=curform.find(":radio[name='"+obj.attr("name")+"']:checked").val(),inputval=inputval===undef?"":inputval):obj.is(":checkbox")?(inputval="",curform.find(":checkbox[name='"+obj.attr("name")+"']:checked").each(function(){inputval+=$(this).val()+","}),inputval=inputval===undef?"":inputval):inputval=obj.val(),inputval=$.trim(inputval),Validform.util.isEmpty.call(obj,inputval)?"":inputval},enhance:function(tiptype,usePlugin,tipSweep,addRule){var curform=this;curform.find("[datatype]").each(function(){tiptype==2?$(this).parent().next().find(".Validform_checktip").length==0&&($(this).parent().next().append("<span class='Validform_checktip' />"),$(this).siblings(".Validform_checktip").remove()):(tiptype==3||tiptype==4)&&$(this).siblings(".Validform_checktip").length==0&&($(this).parent().append("<span class='Validform_checktip' />"),$(this).parent().next().find(".Validform_checktip").remove())});curform.find("input[recheck]").each(function(){if(this.validform_inited=="inited")return!0;this.validform_inited="inited";var _this=$(this),recheckinput=curform.find("input[name='"+$(this).attr("recheck")+"']");recheckinput.bind("keyup",function(){if(recheckinput.val()==_this.val()&&recheckinput.val()!=""){if(recheckinput.attr("tip")&&recheckinput.attr("tip")==recheckinput.val())return!1;_this.trigger("blur")}}).bind("blur",function(){if(recheckinput.val()!=_this.val()&&_this.val()!=""){if(_this.attr("tip")&&_this.attr("tip")==_this.val())return!1;_this.trigger("blur")}})});curform.find("[tip]").each(function(){if(this.validform_inited=="inited")return!0;this.validform_inited="inited";var defaultvalue=$(this).attr("tip"),altercss=$(this).attr("altercss");$(this).focus(function(){$(this).val()==defaultvalue&&($(this).val(""),altercss&&$(this).removeClass(altercss))}).blur(function(){$.trim($(this).val())===""&&($(this).val(defaultvalue),altercss&&$(this).addClass(altercss))})});curform.find(":checkbox[datatype],:radio[datatype]").each(function(){if(this.validform_inited=="inited")return!0;this.validform_inited="inited";var _this=$(this),name=_this.attr("name");curform.find("[name='"+name+"']").filter(":checkbox,:radio").bind("click",function(){setTimeout(function(){_this.trigger("blur")},0)})});curform.find("select[datatype][multiple]").bind("click",function(){var _this=$(this);setTimeout(function(){_this.trigger("blur")},0)});Validform.util.usePlugin.call(curform,usePlugin,tiptype,tipSweep,addRule)},usePlugin:function(plugin,tiptype,tipSweep,addRule){var curform=this,plugin=plugin||{},custom;if(curform.find("input[plugin='swfupload']").length&&typeof swfuploadhandler!="undefined"&&(custom={custom_settings:{form:curform,showmsg:function(msg,type){Validform.util.showmsg.call(curform,msg,tiptype,{obj:curform.find("input[plugin='swfupload']"),type:type,sweep:tipSweep})}}},custom=$.extend(!0,{},plugin.swfupload,custom),curform.find("input[plugin='swfupload']").each(function(n){if(this.validform_inited=="inited")return!0;this.validform_inited="inited";$(this).val("");swfuploadhandler.init(custom,n)})),curform.find("input[plugin='datepicker']").length&&$.fn.datePicker&&(plugin.datepicker=plugin.datepicker||{},plugin.datepicker.format&&(Date.format=plugin.datepicker.format,delete plugin.datepicker.format),plugin.datepicker.firstDayOfWeek&&(Date.firstDayOfWeek=plugin.datepicker.firstDayOfWeek,delete plugin.datepicker.firstDayOfWeek),curform.find("input[plugin='datepicker']").each(function(){if(this.validform_inited=="inited")return!0;this.validform_inited="inited";plugin.datepicker.callback&&$(this).bind("dateSelected",function(){var d=new Date($.event._dpCache[this._dpId].getSelected()[0]).asString(Date.format);plugin.datepicker.callback(d,this)});$(this).datePicker(plugin.datepicker)})),curform.find("input[plugin*='passwordStrength']").length&&$.fn.passwordStrength&&(plugin.passwordstrength=plugin.passwordstrength||{},plugin.passwordstrength.showmsg=function(obj,msg,type){Validform.util.showmsg.call(curform,msg,tiptype,{obj:obj,type:type,sweep:tipSweep})},curform.find("input[plugin='passwordStrength']").each(function(){if(this.validform_inited=="inited")return!0;this.validform_inited="inited";$(this).passwordStrength(plugin.passwordstrength)})),addRule!="addRule"&&plugin.jqtransform&&$.fn.jqTransSelect){if(curform[0].jqTransSelected=="true")return;curform[0].jqTransSelected="true";var jqTransformHideSelect=function(oTarget){var ulVisible=$(".jqTransformSelectWrapper ul:visible");ulVisible.each(function(){var oSelect=$(this).parents(".jqTransformSelectWrapper:first").find("select").get(0);oTarget&&oSelect.oLabel&&oSelect.oLabel.get(0)==oTarget.get(0)||$(this).hide()})},jqTransformCheckExternalClick=function(event){$(event.target).parents(".jqTransformSelectWrapper").length===0&&jqTransformHideSelect($(event.target))},jqTransformAddDocumentListener=function(){$(document).mousedown(jqTransformCheckExternalClick)};plugin.jqtransform.selector?(curform.find(plugin.jqtransform.selector).filter('input:submit, input:reset, input[type="button"]').jqTransInputButton(),curform.find(plugin.jqtransform.selector).filter("input:text, input:password").jqTransInputText(),curform.find(plugin.jqtransform.selector).filter("input:checkbox").jqTransCheckBox(),curform.find(plugin.jqtransform.selector).filter("input:radio").jqTransRadio(),curform.find(plugin.jqtransform.selector).filter("textarea").jqTransTextarea(),curform.find(plugin.jqtransform.selector).filter("select").length>0&&(curform.find(plugin.jqtransform.selector).filter("select").jqTransSelect(),jqTransformAddDocumentListener())):curform.jqTransform();curform.find(".jqTransformSelectWrapper").find("li a").click(function(){$(this).parents(".jqTransformSelectWrapper").find("select").trigger("blur")})}},getNullmsg:function(curform){var obj=this,reg=/[\u4E00-\u9FA5\uf900-\ufa2da-zA-Z\s]+/g,nullmsg,label=curform[0].settings.label||".Validform_label";if(label=obj.siblings(label).eq(0).text()||obj.siblings().find(label).eq(0).text()||obj.parent().siblings(label).eq(0).text()||obj.parent().siblings().find(label).eq(0).text(),label=label.replace(/\s(?![a-zA-Z])/g,"").match(reg),label=label?label.join(""):[""],reg=/\{(.+)\|(.+)\}/,nullmsg=curform.data("tipmsg").s||tipmsg.s,label!=""){if(nullmsg=nullmsg.replace(/\{0\|(.+)\}/,label),obj.attr("recheck"))return nullmsg=nullmsg.replace(/\{(.+)\}/,""),obj.attr("nullmsg",nullmsg),nullmsg}else nullmsg=obj.is(":checkbox,:radio,select")?nullmsg.replace(/\{0\|(.+)\}/,""):nullmsg.replace(/\{0\|(.+)\}/,"$1");return nullmsg=obj.is(":checkbox,:radio,select")?nullmsg.replace(reg,"$2"):nullmsg.replace(reg,"$1"),obj.attr("nullmsg",nullmsg),nullmsg},getErrormsg:function(curform,datatype,recheck){var mac=datatype.match(/^(.+?)((\d+)-(\d+))?$/),str,tipmsg_w_ex,name;if(recheck=="recheck")return curform.data("tipmsg").reck||tipmsg.reck;if(tipmsg_w_ex=$.extend({},tipmsg.w,curform.data("tipmsg").w),mac[0]in tipmsg_w_ex)return curform.data("tipmsg").w[mac[0]]||tipmsg.w[mac[0]];for(name in tipmsg_w_ex)if(name.indexOf(mac[1])!=-1&&/^(.+?)(\d+)-(\d+)$/.test(name))return str=(curform.data("tipmsg").w[name]||tipmsg.w[name]).replace(/(.*?)\d+(.+?)\d+(.*)/,"$1"+mac[3]+"$2"+mac[4]+"$3"),curform.data("tipmsg").w[mac[0]]=str,str;return curform.data("tipmsg").def||tipmsg.def},_regcheck:function(datatype,gets,obj,curform){var curform=curform,info=null,passed=!1,reg=/\/.+\//g,regex=/^(.+?)(\d+)-(\d+)$/,type=3,mac,temp,name,theother;if(reg.test(datatype)){var regstr=datatype.match(reg)[0].slice(1,-1),param=datatype.replace(reg,""),rexp=RegExp(regstr,param);passed=rexp.test(gets)}else if(Validform.util.toString.call(Validform.util.dataType[datatype])=="[object Function]")passed=Validform.util.dataType[datatype](gets,obj,curform,Validform.util.dataType),passed===!0||passed===undef?passed=!0:(info=passed,passed=!1);else{if(!(datatype in Validform.util.dataType))if(mac=datatype.match(regex),mac){for(name in Validform.util.dataType)if((temp=name.match(regex),temp)&&mac[1]===temp[1]){var str=Validform.util.dataType[name].toString(),param=str.match(/\/[mgi]*/g)[1].replace("/",""),regxp=new RegExp("\\{"+temp[2]+","+temp[3]+"\\}","g");str=str.replace(/\/[mgi]*/g,"/").replace(regxp,"{"+mac[2]+","+mac[3]+"}").replace(/^\//,"").replace(/\/$/,"");Validform.util.dataType[datatype]=new RegExp(str,param);break}}else passed=!1,info=curform.data("tipmsg").undef||tipmsg.undef;Validform.util.toString.call(Validform.util.dataType[datatype])=="[object RegExp]"&&(passed=Validform.util.dataType[datatype].test(gets))}return passed?(type=2,info=obj.attr("sucmsg")||curform.data("tipmsg").r||tipmsg.r,obj.attr("recheck")&&(theother=curform.find("input[name='"+obj.attr("recheck")+"']:first"),gets!=theother.val()&&(passed=!1,type=3,info=obj.attr("errormsg")||Validform.util.getErrormsg.call(obj,curform,datatype,"recheck")))):(info=info||obj.attr("errormsg")||Validform.util.getErrormsg.call(obj,curform,datatype),Validform.util.isEmpty.call(obj,gets)&&(info=obj.attr("nullmsg")||Validform.util.getNullmsg.call(obj,curform))),{passed:passed,type:type,info:info}},regcheck:function(datatype,gets,obj){var curform=this,info=null,dtype,res,eithor,dtp;if(obj.attr("ignore")==="ignore"&&Validform.util.isEmpty.call(obj,gets))return obj.data("cked")&&(info=""),{passed:!0,type:4,info:info};for(obj.data("cked","cked"),dtype=Validform.util.parseDatatype(datatype),eithor=0;eithor<dtype.length;eithor++){for(dtp=0;dtp<dtype[eithor].length;dtp++)if(res=Validform.util._regcheck(dtype[eithor][dtp],gets,obj,curform),!res.passed)break;if(res.passed)break}return res},parseDatatype:function(datatype){var reg=/\/.+?\/[mgi]*(?=(,|$|\||\s))|[\w\*-]+/g,dtype=datatype.match(reg),sepor=datatype.replace(reg,"").replace(/\s*/g,"").split(""),arr=[],m=0,n;for(arr[0]=[],arr[0].push(dtype[0]),n=0;n<sepor.length;n++)sepor[n]=="|"&&(m++,arr[m]=[]),arr[m].push(dtype[n+1]);return arr},showmsg:function(msg,type,o,triggered){if(msg!=undef&&(triggered!="bycheck"||!o.sweep||(!o.obj||o.obj.is(".Validform_error"))&&typeof type!="function")){if($.extend(o,{curform:this}),typeof type=="function"){type(msg,o,Validform.util.cssctl);return}(type==1||triggered=="byajax"&&type!=4)&&msgobj.find(".Validform_info").html(msg);(type==1&&triggered!="bycheck"&&o.type!=2||triggered=="byajax"&&type!=4)&&(msghidden=!1,msgobj.find(".iframe").css("height",msgobj.outerHeight()),msgobj.show(),setCenter(msgobj,100));type==2&&o.obj&&(o.obj.parent().next().find(".Validform_checktip").html(msg),Validform.util.cssctl(o.obj.parent().next().find(".Validform_checktip"),o.type));(type==3||type==4)&&o.obj&&(o.obj.siblings(".Validform_checktip").html(msg),Validform.util.cssctl(o.obj.siblings(".Validform_checktip"),o.type))}},cssctl:function(obj,status){switch(status){case 1:obj.removeClass("Validform_right Validform_wrong").addClass("Validform_checktip Validform_loading");break;case 2:obj.removeClass("Validform_wrong Validform_loading").addClass("Validform_checktip Validform_right");break;case 4:obj.removeClass("Validform_right Validform_wrong Validform_loading").addClass("Validform_checktip");break;default:obj.removeClass("Validform_right Validform_loading").addClass("Validform_checktip Validform_wrong")}},check:function(curform,subpost,bool){var settings=curform[0].settings,subpost=subpost||"",inputval=Validform.util.getValue.call(curform,$(this)),flag,_this,ajaxurl,inputobj,ajaxsetup,localconfig,temp_suc,temp_err;if(settings.ignoreHidden&&$(this).is(":hidden")||$(this).data("dataIgnore")==="dataIgnore")return!0;if(settings.dragonfly&&!$(this).data("cked")&&Validform.util.isEmpty.call($(this),inputval)&&$(this).attr("ignore")!="ignore")return!1;if(flag=Validform.util.regcheck.call(curform,$(this).attr("datatype"),inputval,$(this)),inputval==this.validform_lastval&&!$(this).attr("recheck")&&subpost=="")return flag.passed?!0:!1;if(this.validform_lastval=inputval,errorobj=_this=$(this),!flag.passed)return Validform.util.abort.call(_this[0]),bool||(Validform.util.showmsg.call(curform,flag.info,settings.tiptype,{obj:$(this),type:flag.type,sweep:settings.tipSweep},"bycheck"),settings.tipSweep||_this.addClass("Validform_error")),!1;if(ajaxurl=$(this).attr("ajaxurl"),!ajaxurl||Validform.util.isEmpty.call($(this),inputval)||bool)ajaxurl&&Validform.util.isEmpty.call($(this),inputval)&&(Validform.util.abort.call(_this[0]),_this[0].validform_valid="true");else return(inputobj=$(this),inputobj[0].validform_subpost=subpost=="postform"?"postform":"",inputobj[0].validform_valid==="posting"&&inputval==inputobj[0].validform_ckvalue)?"ajax":(inputobj[0].validform_valid="posting",inputobj[0].validform_ckvalue=inputval,Validform.util.showmsg.call(curform,curform.data("tipmsg").c||tipmsg.c,settings.tiptype,{obj:inputobj,type:1,sweep:settings.tipSweep},"bycheck"),Validform.util.abort.call(_this[0]),ajaxsetup=$.extend(!0,{},settings.ajaxurl||{}),localconfig={type:"POST",cache:!1,url:ajaxurl,data:"param="+encodeURIComponent(inputval)+"&name="+encodeURIComponent($(this).attr("name")),success:function(data){$.trim(data.status)==="y"?(inputobj[0].validform_valid="true",data.info&&inputobj.attr("sucmsg",data.info),Validform.util.showmsg.call(curform,inputobj.attr("sucmsg")||curform.data("tipmsg").r||tipmsg.r,settings.tiptype,{obj:inputobj,type:2,sweep:settings.tipSweep},"bycheck"),_this.removeClass("Validform_error"),errorobj=null,inputobj[0].validform_subpost=="postform"&&curform.trigger("submit")):(inputobj[0].validform_valid=data.info,Validform.util.showmsg.call(curform,data.info,settings.tiptype,{obj:inputobj,type:3,sweep:settings.tipSweep}),_this.addClass("Validform_error"));_this[0].validform_ajax=null},error:function(data){if(data.status=="200")return data.responseText=="y"?ajaxsetup.success({status:"y"}):ajaxsetup.success({status:"n",info:data.responseText}),!1;if(data.statusText!=="abort"){var msg="status: "+data.status+"; statusText: "+data.statusText;Validform.util.showmsg.call(curform,msg,settings.tiptype,{obj:inputobj,type:3,sweep:settings.tipSweep});_this.addClass("Validform_error")}return inputobj[0].validform_valid=data.statusText,_this[0].validform_ajax=null,!0}},ajaxsetup.success&&(temp_suc=ajaxsetup.success,ajaxsetup.success=function(data){localconfig.success(data);temp_suc(data,inputobj)}),ajaxsetup.error&&(temp_err=ajaxsetup.error,ajaxsetup.error=function(data){localconfig.error(data)&&temp_err(data,inputobj)}),ajaxsetup=$.extend({},localconfig,ajaxsetup,{dataType:"json"}),_this[0].validform_ajax=$.ajax(ajaxsetup),"ajax");return bool||(Validform.util.showmsg.call(curform,flag.info,settings.tiptype,{obj:$(this),type:flag.type,sweep:settings.tipSweep},"bycheck"),_this.removeClass("Validform_error")),errorobj=null,!0},submitForm:function(settings,flg,url,ajaxPost){var curform=this,beforeCheck,flag,inflag,beforeSubmit,ajaxsetup,obj,arr,url;if(curform[0].validform_status==="posting"||settings.postonce&&curform[0].validform_status==="posted")return settings.postonceTip(),!1;if(beforeCheck=settings.beforeCheck&&settings.beforeCheck(curform),beforeCheck===!1)return!1;if(flag=!0,curform.find("[datatype]").each(function(){var inputval,_this,thisobj;if(flg)return!1;if(settings.ignoreHidden&&$(this).is(":hidden")||$(this).data("dataIgnore")==="dataIgnore")return!0;if(inputval=Validform.util.getValue.call(curform,$(this)),errorobj=_this=$(this),inflag=Validform.util.regcheck.call(curform,$(this).attr("datatype"),inputval,$(this)),!inflag.passed)return(Validform.util.showmsg.call(curform,inflag.info,settings.tiptype,{obj:$(this),type:inflag.type,sweep:settings.tipSweep}),_this.addClass("Validform_error"),!settings.showAllError)?(_this.focus(),flag=!1,!1):(flag&&(flag=!1),!0);if($(this).attr("ajaxurl")&&!Validform.util.isEmpty.call($(this),inputval)){if(this.validform_valid!=="true")return(thisobj=$(this),Validform.util.showmsg.call(curform,curform.data("tipmsg").v||tipmsg.v,settings.tiptype,{obj:thisobj,type:3,sweep:settings.tipSweep}),_this.addClass("Validform_error"),thisobj.trigger("blur",["postform"]),!settings.showAllError)?(flag=!1,!1):(flag&&(flag=!1),!0)}else $(this).attr("ajaxurl")&&Validform.util.isEmpty.call($(this),inputval)&&(Validform.util.abort.call(this),this.validform_valid="true");Validform.util.showmsg.call(curform,inflag.info,settings.tiptype,{obj:$(this),type:inflag.type,sweep:settings.tipSweep});_this.removeClass("Validform_error");errorobj=null}),settings.showAllError&&curform.find(".Validform_error:first").focus(),flag){if(beforeSubmit=settings.beforeSubmit&&settings.beforeSubmit(curform),beforeSubmit===!1)return!1;if(curform[0].validform_status="posting",settings.ajaxPost||ajaxPost==="ajaxPost"){ajaxsetup=$.extend(!0,{},settings.ajaxpost||{});ajaxsetup.url=url||ajaxsetup.url||settings.url||curform.attr("action");Validform.util.showmsg.call(curform,curform.data("tipmsg").p||tipmsg.p,settings.tiptype,{obj:curform,type:1,sweep:settings.tipSweep},"byajax");obj={};arr=curform.serializeArray();for(let index=0;index<arr.length;index++){let element=arr[index];obj[element.name]=element.value}HROS.request.post(ajaxsetup.url,obj,function(data){$.trim(data.status)==="y"?(curform[0].validform_status="posted",Validform.util.showmsg.call(curform,data.info,settings.tiptype,{obj:curform,type:2,sweep:settings.tipSweep},"byajax")):(curform[0].validform_status="normal",Validform.util.showmsg.call(curform,data.info,settings.tiptype,{obj:curform,type:3,sweep:settings.tipSweep},"byajax"));settings.callback&&settings.callback(data);curform[0].validform_ajax=null})}else return settings.postonce||(curform[0].validform_status="normal"),url=url||settings.url,url&&curform.attr("action",url),settings.callback&&settings.callback(curform)}return!1},resetForm:function(){var brothers=this;brothers.each(function(){this.reset&&this.reset();this.validform_status="normal"});brothers.find(".Validform_right").text("");brothers.find(".passwordStrength").children().removeClass("bgStrength");brothers.find(".Validform_checktip").removeClass("Validform_wrong Validform_right Validform_loading");brothers.find(".Validform_error").removeClass("Validform_error");brothers.find("[datatype]").removeData("cked").removeData("dataIgnore").each(function(){this.validform_lastval=null});brothers.eq(0).find("input:first").focus()},abort:function(){this.validform_ajax&&this.validform_ajax.abort()}};$.Datatype=Validform.util.dataType;Validform.prototype={dataType:Validform.util.dataType,eq:function(n){var obj=this;return n>=obj.forms.length?null:(n in obj.objects||(obj.objects[n]=new Validform($(obj.forms[n]).get(),{},!0)),obj.objects[n])},resetStatus:function(){var obj=this;return $(obj.forms).each(function(){this.validform_status="normal"}),this},setStatus:function(status){var obj=this;return $(obj.forms).each(function(){this.validform_status=status||"posting"}),this},getStatus:function(){var obj=this;return $(obj.forms)[0].validform_status},ignore:function(selector){var obj=this,selector=selector||"[datatype]";return $(obj.forms).find(selector).each(function(){$(this).data("dataIgnore","dataIgnore").removeClass("Validform_error")}),this},unignore:function(selector){var obj=this,selector=selector||"[datatype]";return $(obj.forms).find(selector).each(function(){$(this).removeData("dataIgnore")}),this},addRule:function(rule){for(var o,attr,obj=this,rule=rule||[],index=0;index<rule.length;index++){o=$(obj.forms).find(rule[index].ele);for(attr in rule[index])attr!=="ele"&&o.attr(attr,rule[index][attr])}return $(obj.forms).each(function(){var $this=$(this);Validform.util.enhance.call($this,this.settings.tiptype,this.settings.usePlugin,this.settings.tipSweep,"addRule")}),this},ajaxPost:function(flag,sync,url){var obj=this;return $(obj.forms).each(function(){(this.settings.tiptype==1||this.settings.tiptype==2||this.settings.tiptype==3)&&creatMsgbox();Validform.util.submitForm.call($(obj.forms[0]),this.settings,flag,url,"ajaxPost",sync)}),this},submitForm:function(flag,url){var obj=this;return $(obj.forms).each(function(){var subflag=Validform.util.submitForm.call($(this),this.settings,flag,url);subflag===undef&&(subflag=!0);subflag===!0&&this.submit()}),this},resetForm:function(){var obj=this;return Validform.util.resetForm.call($(obj.forms)),this},abort:function(){var obj=this;return $(obj.forms).each(function(){Validform.util.abort.call(this)}),this},check:function(bool,selector){var selector=selector||"[datatype]",obj=this,curform=$(obj.forms),flag=!0;return curform.find(selector).each(function(){Validform.util.check.call(this,curform,"",bool)||(flag=!1)}),flag},config:function(setup){var obj=this;return setup=setup||{},$(obj.forms).each(function(){var $this=$(this);this.settings=$.extend(!0,this.settings,setup);Validform.util.enhance.call($this,this.settings.tiptype,this.settings.usePlugin,this.settings.tipSweep)}),this}};$.fn.Validform=function(settings){return new Validform(this,settings)};$.Showmsg=function(msg){creatMsgbox();Validform.util.showmsg.call(win,msg,1,{})};$.Hidemsg=function(){msgobj.hide();msghidden=!0}}(jQuery,window);!function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p;a.noop=a.noop||function(){};h=0;i=a(b);j=a(document);k=a("html");l=document.documentElement;m=b.VBArray&&!b.XMLHttpRequest;n="createTouch"in document&&!("onmousemove"in l)||/(iPhone|iPad|iPod)/i.test(navigator.userAgent);o="artDialog"+ +new Date;p=function(b,e,f){var g,i,j,k;b=b||{};("string"==typeof b||1===b.nodeType)&&(b={content:b,fixed:!n});i=p.defaults;j=b.follow=1===this.nodeType&&this||b.follow;for(k in i)b[k]===c&&(b[k]=i[k]);return a.each({ok:"yesFn",cancel:"noFn",close:"closeFn",init:"initFn",okVal:"yesText",cancelVal:"noText"},function(a,d){b[a]=b[a]!==c?b[a]:b[d]}),"string"==typeof j&&(j=a(j)[0]),b.id=j&&j[o+"follow"]||b.id||o+h,g=p.list[b.id],j&&g?g.follow(j).zIndex().focus():g?g.zIndex().focus():(n&&(b.fixed=!1),a.isArray(b.button)||(b.button=b.button?[b.button]:[]),e!==c&&(b.ok=e),f!==c&&(b.cancel=f),b.ok&&b.button.push({name:b.okVal,callback:b.ok,focus:!0}),b.cancel&&b.button.push({name:b.cancelVal,callback:b.cancel}),p.defaults.zIndex=b.zIndex,h++,p.list[b.id]=d?d._init(b):new p.fn._init(b))};p.fn=p.prototype={version:"4.1.7",closed:!0,_init:function(a){var c,e=this,f=a.icon,g=f&&(m?{png:"icons/"+f+".png"}:{backgroundImage:"url('"+a.path+"/skins/icons/"+f+".png')"});return e.closed=!1,e.config=a,e.DOM=c=e.DOM||e._getDOM(),c.wrap.addClass(a.skin),c.close[a.cancel===!1?"hide":"show"](),c.icon[0].style.display=f?"":"none",c.iconBg.css(g||{background:"none"}),c.se.css("cursor",a.resize?"se-resize":"auto"),c.title.css("cursor",a.drag?"move":"auto"),c.content.css("padding",a.padding),e[a.show?"show":"hide"](!0),e.button(a.button).title(a.title).content(a.content,!0).size(a.width,a.height).time(a.time),a.follow?e.follow(a.follow):e.position(a.left,a.top),e.zIndex().focus(),a.lock&&e.lock(),e._addEvent(),e._ie6PngFix(),d=null,a.init&&a.init.call(e,b),e},content:function(a){var b,d,e,f,g=this,h=g.DOM,i=h.wrap[0],j=i.offsetWidth,k=i.offsetHeight,l=parseInt(i.style.left),m=parseInt(i.style.top),n=i.style.width,o=h.content,p=o[0];return g._elemBack&&g._elemBack(),i.style.width="auto",a===c?p:("string"==typeof a?o.html(a):a&&1===a.nodeType&&(f=a.style.display,b=a.previousSibling,d=a.nextSibling,e=a.parentNode,g._elemBack=function(){b&&b.parentNode?b.parentNode.insertBefore(a,b.nextSibling):d&&d.parentNode?d.parentNode.insertBefore(a,d):e&&e.appendChild(a);a.style.display=f;g._elemBack=null},o.html(""),p.appendChild(a),a.style.display="block"),arguments[1]||(g.config.follow?g.follow(g.config.follow):(j=i.offsetWidth-j,k=i.offsetHeight-k,l-=j/2,m-=k/2,i.style.left=Math.max(l,0)+"px",i.style.top=Math.max(m,0)+"px"),n&&"auto"!==n&&(i.style.width=i.offsetWidth+"px"),g._autoPositionType()),g._ie6SelectFix(),g._runScript(p),g)},title:function(a){var b=this.DOM,d=b.wrap,e=b.title,f="aui_state_noTitle";return a===c?e[0]:(a===!1?(e.hide().html(""),d.addClass(f)):(e.show().html(a||""),d.removeClass(f)),this)},position:function(a,b){var d=this,e=d.config,f=d.DOM.wrap[0],g=m?!1:e.fixed,h=m&&d.config.fixed,k=j.scrollLeft(),l=j.scrollTop(),n=g?0:k,o=g?0:l,p=i.width(),q=i.height(),r=f.offsetWidth,s=f.offsetHeight,t=f.style;return(a||0===a)&&(d._left=-1!==a.toString().indexOf("%")?a:null,a=d._toNumber(a,p-r),"number"==typeof a?(a=h?a+=k:a+n,t.left=Math.max(a,n)+"px"):"string"==typeof a&&(t.left=a)),(b||0===b)&&(d._top=-1!==b.toString().indexOf("%")?b:null,b=d._toNumber(b,q-s),"number"==typeof b?(b=h?b+=l:b+o,t.top=Math.max(b,o)+"px"):"string"==typeof b&&(t.top=b)),a!==c&&b!==c&&(d._follow=null,d._autoPositionType()),d},size:function(a,b){var c,d,e,f,g=this,h=(g.config,g.DOM),j=h.wrap,k=h.main,l=j[0].style,m=k[0].style;return a&&(g._width=-1!==a.toString().indexOf("%")?a:null,c=i.width()-j[0].offsetWidth+k[0].offsetWidth,e=g._toNumber(a,c),a=e,"number"==typeof a?(l.width="auto",m.width=Math.max(g.config.minWidth,a)+"px",l.width=j[0].offsetWidth+"px"):"string"==typeof a&&(m.width=a,"auto"===a&&j.css("width","auto"))),b&&(g._height=-1!==b.toString().indexOf("%")?b:null,d=i.height()-j[0].offsetHeight+k[0].offsetHeight,f=g._toNumber(b,d),b=f,"number"==typeof b?m.height=Math.max(g.config.minHeight,b)+"px":"string"==typeof b&&(m.height=b)),g._ie6SelectFix(),g},follow:function(b){var c,d,e,f,g,h,k,l,n,p,q,r,s,t,u,v,w,x,y,z,A=this,B=A.config;return("string"==typeof b||b&&1===b.nodeType)&&(c=a(b),b=c[0]),b&&(b.offsetWidth||b.offsetHeight)?(d=o+"follow",e=i.width(),f=i.height(),g=j.scrollLeft(),h=j.scrollTop(),k=c.offset(),l=b.offsetWidth,n=b.offsetHeight,p=m?!1:B.fixed,q=p?k.left-g:k.left,r=p?k.top-h:k.top,s=A.DOM.wrap[0],t=s.style,u=s.offsetWidth,v=s.offsetHeight,w=q-(u-l)/2,x=r+n,y=p?0:g,z=p?0:h,w=y>w?q:w+u>e&&q-u>y?q-u+l:w,x=x+v>f+z&&r-v>z?r-v:x,t.left=w+"px",t.top=x+"px",A._follow&&A._follow.removeAttribute(d),A._follow=b,b[d]=B.id,A._autoPositionType(),A):A.position(A._left,A._top)},button:function(){var b=this,d=arguments,e=b.DOM,f=e.buttons,g=f[0],h="aui_state_highlight",i=b._listeners=b._listeners||{},j=a.isArray(d[0])?d[0]:[].slice.call(d);return d[0]===c?g:(a.each(j,function(c,d){var e=d.name,f=!i[e],j=f?document.createElement("button"):i[e].elem;i[e]||(i[e]={});d.callback&&(i[e].callback=d.callback);d.className&&(j.className=d.className);d.focus&&(b._focus&&b._focus.removeClass(h),b._focus=a(j).addClass(h),b.focus());j.setAttribute("type","button");j[o+"callback"]=e;j.disabled=!!d.disabled;f&&(j.innerHTML=e,i[e].elem=j,g.appendChild(j))}),f[0].style.display=j.length?"":"none",b._ie6SelectFix(),b)},show:function(){return this.DOM.wrap.show(),!arguments[0]&&this._lockMaskWrap&&this._lockMaskWrap.show(),this},hide:function(){return this.DOM.wrap.hide(),!arguments[0]&&this._lockMaskWrap&&this._lockMaskWrap.hide(),this},close:function(){var a,c,e,f,g,h,i;if(this.closed)return this;if(a=this,c=a.DOM,e=c.wrap,f=p.list,g=a.config.close,h=a.config.follow,a.time(),"function"==typeof g&&g.call(a,b)===!1)return a;a.unlock();a._elemBack&&a._elemBack();e[0].className=e[0].style.cssText="";c.title.html("");c.content.html("");c.buttons.html("");p.focus===a&&(p.focus=null);h&&h.removeAttribute(o+"follow");delete f[a.config.id];a._removeEvent();a.hide(!0)._setAbsolute();for(i in a)a.hasOwnProperty(i)&&"DOM"!==i&&delete a[i];return d?e.remove():d=a,a},time:function(a){var b=this,c=b.config.cancelVal,d=b._timer;return d&&clearTimeout(d),a&&(b._timer=setTimeout(function(){b._click(c)},1e3*a)),b},focus:function(){try{if(this.config.focus){var a=this._focus&&this._focus[0]||this.DOM.close[0];a&&a.focus()}}catch(b){}return this},zIndex:function(){var a=this,b=a.DOM,c=b.wrap,d=p.focus,e=p.defaults.zIndex++;return c.css("zIndex",e),a._lockMask&&a._lockMask.css("zIndex",e-1),d&&d.DOM.wrap.removeClass("aui_state_focus"),p.focus=a,c.addClass("aui_state_focus"),a},lock:function(){if(this._lock)return this;var b=this,c=p.defaults.zIndex-1,d=b.DOM.wrap,e=b.config,f=j.width(),g=j.height(),h=b._lockMaskWrap||a(document.body.appendChild(document.createElement("div"))),i=b._lockMask||a(h[0].appendChild(document.createElement("div"))),k="(document).documentElement",l=n?"width:"+f+"px;height:"+g+"px":"width:100%;height:100%",o=m?"position:absolute;left:expression("+k+".scrollLeft);top:expression("+k+".scrollTop);width:expression("+k+".clientWidth);height:expression("+k+".clientHeight)":"";return b.zIndex(),d.addClass("aui_state_lock"),h[0].style.cssText=l+";position:fixed;z-index:"+c+";top:0;left:0;overflow:hidden;"+o,i[0].style.cssText="height:100%;background:"+e.background+";filter:alpha(opacity=0);opacity:0",m&&i.html('<iframe src="about:blank" style="width:100%;height:100%;position:absolute;top:0;left:0;z-index:-1;filter:alpha(opacity=0)"><\/iframe>'),i.stop(),i.bind("click",function(){b._reset()}).bind("dblclick",function(){b._click(b.config.cancelVal)}),0===e.duration?i.css({opacity:e.opacity}):i.animate({opacity:e.opacity},e.duration),b._lockMaskWrap=h,b._lockMask=i,b._lock=!0,b},unlock:function(){var a,b,c=this,e=c._lockMaskWrap,f=c._lockMask;return c._lock?(a=e[0].style,b=function(){m&&(a.removeExpression("width"),a.removeExpression("height"),a.removeExpression("left"),a.removeExpression("top"));a.cssText="display:none";d&&e.remove()},f.stop().unbind(),c.DOM.wrap.removeClass("aui_state_lock"),c.config.duration?f.animate({opacity:0},c.config.duration,b):b(),c._lock=!1,c):c},_getDOM:function(){var b,c,d,e,f,g=document.createElement("div"),h=document.body;for(g.style.cssText="position:absolute;left:0;top:0",g.innerHTML=p._templates,h.insertBefore(g,h.firstChild),c=0,d={wrap:a(g)},e=g.getElementsByTagName("*"),f=e.length;f>c;c++)b=e[c].className.split("aui_")[1],b&&(d[b]=a(e[c]));return d},_toNumber:function(a,b){if(!a&&0!==a||"number"==typeof a)return a;var c=a.length-1;return a.lastIndexOf("px")===c?a=parseInt(a):a.lastIndexOf("%")===c&&(a=parseInt(b*a.split("%")[0]/100)),a},_ie6PngFix:m?function(){for(var a,b,c,d,e=0,f=p.defaults.path+"/skins/",g=this.DOM.wrap[0].getElementsByTagName("*");e<g.length;e++)a=g[e],b=a.currentStyle.png,b&&(c=f+b,d=a.runtimeStyle,d.backgroundImage="none",d.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+c+"',sizingMethod='crop')")}:a.noop,_ie6SelectFix:m?function(){var a=this.DOM.wrap,b=a[0],c=o+"iframeMask",d=a[c],e=b.offsetWidth,f=b.offsetHeight;e+="px";f+="px";d?(d.style.width=e,d.style.height=f):(d=b.appendChild(document.createElement("iframe")),a[c]=d,d.src="about:blank",d.style.cssText="position:absolute;z-index:-1;left:0;top:0;filter:alpha(opacity=0);width:"+e+";height:"+f)}:a.noop,_runScript:function(a){for(var b,c=0,d=0,e=a.getElementsByTagName("script"),f=e.length,g=[];f>c;c++)"text/dialog"===e[c].type&&(g[d]=e[c].innerHTML,d++);g.length&&(g=g.join(""),b=new Function(g),b.call(this))},_autoPositionType:function(){this[this.config.fixed?"_setFixed":"_setAbsolute"]()},_setFixed:function(){return m&&a(function(){var b="backgroundAttachment";"fixed"!==k.css(b)&&"fixed"!==a("body").css(b)&&k.css({zoom:1,backgroundImage:"url(about:blank)",backgroundAttachment:"fixed"})}),function(){var a,b,c,d,e,f=this.DOM.wrap,g=f[0].style;m?(a=parseInt(f.css("left")),b=parseInt(f.css("top")),c=j.scrollLeft(),d=j.scrollTop(),e="(document.documentElement)",this._setAbsolute(),g.setExpression("left","eval("+e+".scrollLeft+"+(a-c)+') + "px"'),g.setExpression("top","eval("+e+".scrollTop+"+(b-d)+') + "px"')):g.position="fixed"}}(),_setAbsolute:function(){var a=this.DOM.wrap[0].style;m&&(a.removeExpression("left"),a.removeExpression("top"));a.position="absolute"},_click:function(a){var c=this,d=c._listeners[a]&&c._listeners[a].callback;return"function"!=typeof d||d.call(c,b)!==!1?c.close():c},_reset:function(a){var b,c=this,d=c._winSize||i.width()*i.height(),e=c._follow,f=c._width,g=c._height,h=c._left,j=c._top;a&&(b=c._winSize=i.width()*i.height(),d===b)||((f||g)&&c.size(f,g),e?c.follow(e):(h||j)&&c.position(h,j))},_addEvent:function(){var a,c=this,d=c.config,e="CollectGarbage"in b,f=c.DOM;c._winResize=function(){a&&clearTimeout(a);a=setTimeout(function(){c._reset(e)},40)};i.bind("resize",c._winResize);f.wrap.bind("click",function(a){var b,e=a.target;return e.disabled?!1:e===f.close[0]?(c._click(d.cancelVal),!1):(b=e[o+"callback"],b&&c._click(b),c._ie6SelectFix(),void 0)}).bind("mousedown",function(){c.zIndex()})},_removeEvent:function(){var a=this,b=a.DOM;b.wrap.unbind();i.unbind("resize",a._winResize)}};p.fn._init.prototype=p.fn;a.fn.dialog=a.fn.artDialog=function(){var a=arguments;return this[this.live?"live":"bind"]("click",function(){return p.apply(this,a),!1}),this};p.focus=null;p.get=function(a){return a===c?p.list:p.list[a]};p.list={};j.bind("keydown",function(a){var b=a.target,c=b.nodeName,e=p.focus,f=a.keyCode;e&&e.config.esc&&!/^INPUT|TEXTAREA$/.test(c)&&27===f&&e._click(e.config.cancelVal)});g=b._artDialog_path||function(a,c,d){for(c in a)a[c].src&&-1!==a[c].src.indexOf("artDialog")&&(d=a[c]);return e=d||a[a.length-1],d=e.src.replace(/\\/g,"/"),b._artDialog_path=d.lastIndexOf("/")<0?".":d.substring(0,d.lastIndexOf("/"))}(document.getElementsByTagName("script"));i.bind("load",function(){setTimeout(function(){if(!h){if(f=p.defaults.skin){var a=document.createElement("link");a.rel="stylesheet";a.href="/js/artDialog4.1.7/skins/"+f+".css?"+p.fn.version;e.parentNode.insertBefore(a,e)}p({left:"-9999em",time:9,fixed:!1,lock:!1,focus:!1})}},150)});try{document.execCommand("BackgroundImageCache",!1,!0)}catch(q){}p._templates='<div class="aui_outer"><table class="aui_border"><tbody><tr><td class="aui_nw"><\/td><td class="aui_n"><\/td><td class="aui_ne"><\/td><\/tr><tr><td class="aui_w"><\/td><td class="aui_c"><div class="aui_inner"><table class="aui_dialog"><tbody><tr><td colspan="2" class="aui_header"><div class="aui_titleBar"><div class="aui_title"><\/div><a class="aui_close" href="javascript:;">×<\/a><\/div><\/td><\/tr><tr><td class="aui_icon"><div class="aui_iconBg"><\/div><\/td><td class="aui_main"><div class="aui_content"><\/div><\/td><\/tr><tr><td colspan="2" class="aui_footer"><div class="aui_buttons"><\/div><\/td><\/tr><\/tbody><\/table><\/div><\/td><td class="aui_e"><\/td><\/tr><tr><td class="aui_sw"><\/td><td class="aui_s"><\/td><td class="aui_se"><\/td><\/tr><\/tbody><\/table><\/div>';p.defaults={content:'<div class="aui_loading"><span>loading..<\/span><\/div>',title:"消息",button:null,ok:null,cancel:null,init:null,close:null,okVal:"确定",cancelVal:"取消",width:"auto",height:"auto",minWidth:96,minHeight:32,padding:"20px 25px",skin:"",icon:null,time:null,esc:!0,focus:!0,show:!0,follow:null,path:g,lock:!1,background:"#000",opacity:.7,duration:300,fixed:!1,left:"50%",top:"38.2%",zIndex:1987,resize:!0,drag:!0};b.artDialog=a.dialog=a.artDialog=p}(this.art||this.jQuery&&(this.art=jQuery),this),function(a){var b,c,d=a(window),e=a(document),f=document.documentElement,g=!("minWidth"in f.style),h="onlosecapture"in f,i="setCapture"in f;artDialog.dragEvent=function(){var a=this,b=function(b){var c=a[b];a[b]=function(){return c.apply(a,arguments)}};b("start");b("move");b("end")};artDialog.dragEvent.prototype={onstart:a.noop,start:function(a){return e.bind("mousemove",this.move).bind("mouseup",this.end),this._sClientX=a.clientX,this._sClientY=a.clientY,this.onstart(a.clientX,a.clientY),!1},onmove:a.noop,move:function(a){return this._mClientX=a.clientX,this._mClientY=a.clientY,this.onmove(a.clientX-this._sClientX,a.clientY-this._sClientY),!1},onend:a.noop,end:function(a){return e.unbind("mousemove",this.move).unbind("mouseup",this.end),this.onend(a.clientX,a.clientY),!1}};c=function(a){var c,f,j,k,l,m,n=artDialog.focus,o=n.DOM,p=o.wrap,q=o.title,r=o.main,s="getSelection"in window?function(){window.getSelection().removeAllRanges()}:function(){try{document.selection.empty()}catch(a){}};b.onstart=function(){m?(f=r[0].offsetWidth,j=r[0].offsetHeight):(k=p[0].offsetLeft,l=p[0].offsetTop);e.bind("dblclick",b.end);!g&&h?q.bind("losecapture",b.end):d.bind("blur",b.end);i&&q[0].setCapture();p.addClass("aui_state_drag");n.focus()};b.onmove=function(a,b){var d,e,g,h,i,o;m?(d=p[0].style,e=r[0].style,g=a+f,h=b+j,d.width="auto",e.width=Math.max(0,g)+"px",d.width=p[0].offsetWidth+"px",e.height=Math.max(0,h)+"px"):(e=p[0].style,i=Math.max(c.minX,Math.min(c.maxX,a+k)),o=Math.max(c.minY,Math.min(c.maxY,b+l)),e.left=i+"px",e.top=o+"px");s();n._ie6SelectFix()};b.onend=function(){e.unbind("dblclick",b.end);!g&&h?q.unbind("losecapture",b.end):d.unbind("blur",b.end);i&&q[0].releaseCapture();g&&!n.closed&&n._autoPositionType();p.removeClass("aui_state_drag")};m=a.target===o.se[0]?!0:!1;c=function(){var b,c=n.DOM.wrap[0],f="fixed"===c.style.position,g=c.offsetWidth,h=c.offsetHeight,i=d.width(),j=d.height(),k=f?0:e.scrollLeft(),l=f?0:e.scrollTop(),a=i-g+k;return b=j-h+l,{minX:k,minY:l,maxX:a,maxY:b}}();b.start(a)};e.bind("mousedown",function(a){var d,e,f,g=artDialog.focus;if(g)return(d=a.target,e=g.config,f=g.DOM,e.drag!==!1&&d===f.title[0]||e.resize!==!1&&d===f.se[0]?(b=b||new artDialog.dragEvent,c(a),!1):void 0)})}(this.art||this.jQuery&&(this.art=jQuery));
/*!
 * artDialog iframeTools
 * Date: 2011-12-08 1:32
 * http://code.google.com/p/artdialog/
 * (c) 2009-2011 TangBin, http://www.planeArt.cn
 *
 * This is licensed under the GNU LGPL, version 2.1 or later.
 * For details, see: http://creativecommons.org/licenses/LGPL/2.1/
 */
eval(function(B,D,A,G,E,F){function C(A){return A<62?String.fromCharCode(A+=A<26?65:A<52?71:-4):A<63?"_":A<64?"$":C(A>>6)+C(A&63)}while(A>0)E[C(G--)]=D[--A];return B.replace(/[\w\$]+/g,function(A){return E[A]==F[A]?A:E[A]})}('(6(E,C,D,A){c B,X,W,J="@_.DATA",K="@_.OPEN",H="@_.OPENER",I=C.k=C.k||"@_.WINNAME"+(Bd Bo).Be(),F=C.VBArray&&!C.XMLHttpRequest;E(6(){!C.Bu&&7.BY==="B0"&&Br("9 Error: 7.BY === \\"B0\\"")});c G=D.d=6(){c W=C,X=6(A){f{c W=C[A].7;W.BE}u(X){v!V}v C[A].9&&W.BE("frameset").length===U};v X("d")?W=C.d:X("BB")&&(W=C.BB),W}();D.BB=G,B=G.9,W=6(){v B.BW.w},D.m=6(C,B){c W=D.d,X=W[J]||{};W[J]=X;b(B!==A)X[C]=B;else v X[C];v X},D.BQ=6(W){c X=D.d[J];X&&X[W]&&1 X[W]},D.through=X=6(){c X=B.BR(i,BJ);v G!==C&&(D.B4[X.0.Z]=X),X},G!==C&&E(C).BN("unload",6(){c A=D.B4,W;BO(c X BS A)A[X]&&(W=A[X].0,W&&(W.duration=U),A[X].s(),1 A[X])}),D.p=6(B,O,BZ){O=O||{};c N,L,M,Bc,T,S,R,Q,BF,P=D.d,Ba="8:BD;n:-Bb;d:-Bb;Bp:o U;Bf:transparent",BI="r:g%;x:g%;Bp:o U";b(BZ===!V){c BH=(Bd Bo).Be(),BG=B.replace(/([?&])W=[^&]*/,"$1_="+BH);B=BG+(BG===B?(/\\?/.test(B)?"&":"?")+"W="+BH:"")}c G=6(){c B,C,W=L.2.B2(".aui_loading"),A=N.0;M.addClass("Bi"),W&&W.hide();f{Q=T.$,R=E(Q.7),BF=Q.7.Bg}u(X){T.q.5=BI,A.z?N.z(A.z):N.8(A.n,A.d),O.j&&O.j.l(N,Q,P),O.j=By;v}B=A.r==="Bt"?R.r()+(F?U:parseInt(E(BF).Bv("marginLeft"))):A.r,C=A.x==="Bt"?R.x():A.x,setTimeout(6(){T.q.5=BI},U),N.Bk(B,C),A.z?N.z(A.z):N.8(A.n,A.d),O.j&&O.j.l(N,Q,P),O.j=By},I={w:W(),j:6(){N=i,L=N.h,Bc=L.BM,M=L.2,T=N.BK=P.7.Bn("BK"),T.Bx=B,T.k="Open"+N.0.Z,T.q.5=Ba,T.BX("frameborder",U,U),T.BX("allowTransparency",!U),S=E(T),N.2().B3(T),Q=T.$;f{Q.k=T.k,D.m(T.k+K,N),D.m(T.k+H,C)}u(X){}S.BN("BC",G)},s:6(){S.Bv("4","o").unbind("BC",G);b(O.s&&O.s.l(i,T.$,P)===!V)v!V;M.removeClass("Bi"),S[U].Bx="about:blank",S.remove();f{D.BQ(T.k+K),D.BQ(T.k+H)}u(X){}}};Bq O.Y=="6"&&(I.Y=6(){v O.Y.l(N,T.$,P)}),Bq O.y=="6"&&(I.y=6(){v O.y.l(N,T.$,P)}),1 O.2;BO(c J BS O)I[J]===A&&(I[J]=O[J]);v X(I)},D.p.Bw=D.m(I+K),D.BT=D.m(I+H)||C,D.p.origin=D.BT,D.s=6(){c X=D.m(I+K);v X&&X.s(),!V},G!=C&&E(7).BN("mousedown",6(){c X=D.p.Bw;X&&X.w()}),D.BC=6(C,D,B){B=B||!V;c G=D||{},H={w:W(),j:6(A){c W=i,X=W.0;E.ajax({url:C,success:6(X){W.2(X),G.j&&G.j.l(W,A)},cache:B})}};1 D.2;BO(c F BS G)H[F]===A&&(H[F]=G[F]);v X(H)},D.Br=6(B,A){v X({Z:"Alert",w:W(),BL:"warning",t:!U,BA:!U,2:B,Y:!U,s:A})},D.confirm=6(C,A,B){v X({Z:"Confirm",w:W(),BL:"Bm",t:!U,BA:!U,3:U.V,2:C,Y:6(X){v A.l(i,X)},y:6(X){v B&&B.l(i,X)}})},D.prompt=6(D,B,C){C=C||"";c A;v X({Z:"Prompt",w:W(),BL:"Bm",t:!U,BA:!U,3:U.V,2:["<e q=\\"margin-bottom:5px;font-Bk:12px\\">",D,"<\/e>","<e>","<Bl B1=\\"",C,"\\" q=\\"r:18em;Bh:6px 4px\\" />","<\/e>"].join(""),j:6(){A=i.h.2.B2("Bl")[U],A.select(),A.BP()},Y:6(X){v B&&B.l(i,A.B1,X)},y:!U})},D.tips=6(B,A){v X({Z:"Tips",w:W(),title:!V,y:!V,t:!U,BA:!V}).2("<e q=\\"Bh: U 1em;\\">"+B+"<\/e>").time(A||V.B6)},E(6(){c A=D.dragEvent;b(!A)v;c B=E(C),X=E(7),W=F?"BD":"t",H=A.prototype,I=7.Bn("e"),G=I.q;G.5="4:o;8:"+W+";n:U;d:U;r:g%;x:g%;"+"cursor:move;filter:alpha(3=U);3:U;Bf:#FFF",7.Bg.B3(I),H.Bj=H.Bs,H.BV=H.Bz,H.Bs=6(){c E=D.BP.h,C=E.BM[U],A=E.2[U].BE("BK")[U];H.Bj.BR(i,BJ),G.4="block",G.w=D.BW.w+B5,W==="BD"&&(G.r=B.r()+"a",G.x=B.x()+"a",G.n=X.scrollLeft()+"a",G.d=X.scrollTop()+"a"),A&&C.offsetWidth*C.offsetHeight>307200&&(C.q.BU="hidden")},H.Bz=6(){c X=D.BP;H.BV.BR(i,BJ),G.4="o",X&&(X.h.BM[U].q.BU="visible")}})})(i.art||i.Bu,i,i.9)',"P|R|T|U|V|W|0|1|_|$|ok|id|px|if|var|top|div|try|100|DOM|this|init|name|call|data|left|none|open|style|width|close|fixed|catch|return|zIndex|height|cancel|follow|config|delete|content|opacity|display|cssText|function|document|position|artDialog|ARTDIALOG|contentWindow|lock|parent|load|absolute|getElementsByTagName|S|Y|Z|a|arguments|iframe|icon|main|bind|for|focus|removeData|apply|in|opener|visibility|_end|defaults|setAttribute|compatMode|O|Q|9999em|X|new|getTime|background|body|padding|aui_state_full|_start|size|input|question|createElement|Date|border|typeof|alert|start|auto|jQuery|css|api|src|null|end|BackCompat|value|find|appendChild|list|3|5".split("|"),109,122,{},{}));