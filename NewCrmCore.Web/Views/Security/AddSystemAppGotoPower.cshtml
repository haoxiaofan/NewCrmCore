@using NewCrmCore.Dto
@{
    Layout = "~/Views/Shared/_LayoutRoot.cshtml";
    var apps = ViewData["SystemApp"] as IList<AppDto>;
}
@section ChildrenCss
    {
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet">
}
@section SysCss
    {
    <link rel="stylesheet" href="/css/hoorayui/sys.css" />
}

<div class="alert_addapps">
    @{
        foreach (var appDto in apps)
        {
            <div class="app" title="@appDto.Name" appid="@appDto.Id">
                <img src="@appDto.IconUrl" alt="@appDto.Name" title="@appDto.Name" />
                <div class="name">@appDto.Name</div>
                <span class="selected"></span>
            </div>
        }
    }
    <input type="hidden" id="value_1" />
</div>


@section ChildrenScript
    {
    @{
        <text>
            if ($.dialog.data('appsid') !== '') {
            $('#value_1').val($.dialog.data('appsid'));
            let appsid = $.dialog.data('appsid').split(',');
            $('.app').each(  ()  =>{
            for (let i = 0; i < appsid.length; i++) {
            if (appsid[i] === $(this).attr('appid')) {
            $(this).addClass('act');
            break;
            }
            }
            })
            }
            $('.app').click(  () => {
            if ($(this).hasClass('act')) {
            let appsid = $('#value_1').val().split(',');
            let newappsid = [];
            for (let i = 0, j = 0; i < appsid.length; i++) {
            if (appsid[i] !== $(this).attr('appid')) {
            newappsid[j] = appsid[i];
            j++;
            }
            }
            $('#value_1').val(newappsid.join(','));
            $(this).removeClass('act');
            } else {
            if ($('#value_1').val() !== '') {
            let appsid = $('#value_1').val().split(',');
            appsid[appsid.length] = $(this).attr('appid');
            $('#value_1').val(appsid.join(','));
            } else {
            $('#value_1').val($(this).attr('appid'));
            }
            $(this).addClass('act');
            }
            $.dialog.data('appsid', $('#value_1').val());
            });
        </text>
    }
}
